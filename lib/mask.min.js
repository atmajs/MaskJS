(function(n,e){"use strict";function t(n){null==n&&(n={});var t,o=e(r,n,i);for(t in n)o[t]=n[t];return o}var r,o,i;if("undefined"==typeof exports||null!=n&&n!==exports&&n!==global||(n=exports,r=global),null==r&&(r="undefined"==typeof window||null==window.document?global:window),i=r.document,o=n||r,"undefined"!=typeof exports&&exports===n)return module.exports=t(),void 0;if("function"==typeof define&&define.amd)return define(t),void 0;var l={},s=t(l);o.mask=s;for(var u in l)o[u]=l[u]})(this,function(global,exports,document){"use strict";function util_extend(n,e){null==n&&(n={});for(var t in e)hasOwnProp.call(e,t)!==!1&&(n[t]=e[t]);return n}function util_getProperty(n,e){if("."===e)return n;for(var t=n,r=e.split("."),o=-1,i=r.length;null!=t&&i>++o;)t=t[r[o]];return t}function util_interpolate(n,e,t,r,o,i,l){for(var s,u,a,c,f,h=n.length,d=0,p=null,g="",v=!0;h>d;d++)v===!0?null==p?g+=n[d]:p.push(n[d]):(c=n[d],u=null,a=c.indexOf(":"),-1===a?u=util_getProperty(t,c):(s=a>0?str_trim(c.substring(0,a)):"",""===s&&(s="expression"),c=c.substring(a+1),f=custom_Utils[s],u=fn_isFunction(f)?f(c,t,r,o,i,l,e):f.process(c,t,r,o,i,l,e)),null!=u&&("object"==typeof u&&null==p&&(p=[g]),null==p?g+=u:p.push(u))),v=!v;return null==p?g:p}function attr_extend(n,e){if(null==n&&(n={}),null==e)return n;for(var t in e)"class"!==t||"string"!=typeof n[t]?n[t]=e[t]:n[t]+=" "+e[t];return n}function Template(n){this.template=n,this.index=0,this.length=n.length}function str_trim(n){for(var e,t=n.length,r=0,o=t-1;t>r&&(e=n.charCodeAt(r),33>e);r++);for(;o>=r&&(e=n.charCodeAt(o),33>e);o--);return 0===r&&o===t-1?n:n.substring(r,o+1)}function fn_isFunction(n){return"function"==typeof n}function Node(n,e){this.type=Dom.NODE,this.tagName=n,this.parent=e,this.attr={}}function TextNode(n,e){this.content=n,this.parent=e,this.type=Dom.TEXTNODE}function Fragment(){this.nodes=[]}function Component(n,e,t){this.tagName=n,this.parent=e,this.controller=t,this.attr={}}var regexpWhitespace=/\s/g,regexpEscapedChar={"'":/\\'/g,'"':/\\"/g,"{":/\\\{/g,">":/\\>/g,";":/\\>/g},hasOwnProp={}.hasOwnProperty,listeners=null,__cfg={allowCache:!0};Template.prototype={skipWhitespace:function(){for(var n=this.template,e=this.index,t=this.length;t>e&&!(n.charCodeAt(e)>32);e++);return this.index=e,this},skipToAttributeBreak:function(){var n,e=this.template,t=this.index,r=this.length;do if(n=e.charCodeAt(++t),35===n&&123===e.charCodeAt(t+1))return this.index=t,this.sliceToChar("}"),this.index++,void 0;while(46!==n&&35!==n&&62!==n&&123!==n&&32!==n&&59!==n&&r>t);this.index=t},sliceToChar:function(n){for(var e,t,r=this.template,o=this.index,i=o,l=!1;(t=r.indexOf(n,o))>-1&&(o=t,92===r.charCodeAt(o-1));)l=!0,o++;return e=r.substring(i,o),this.index=o,l?e.replace(regexpEscapedChar[n],n):e}};var ConditionUtil=function(){function n(n,e){var t,r=e,o=n.index;if(null==r&&(n.skipWhitespace(),o=n.index,e=r=n.template.charCodeAt(n.index)),34===r||39===r)return n.index++,t=n.sliceToChar(39===r?"'":'"'),n.index++,t;do r=n.template.charCodeAt(++n.index);while(n.index<n.length&&32!==r&&33!==r&&60!==r&&61!==r&&62!==r&&40!==r&&41!==r&&38!==r&&124!==r);return t=n.template.substring(o,n.index),r=e,45===r||r>47&&58>r?t-0:116===r&&"true"===t?!0:102===r&&"false"===t?!1:{value:t}}function e(t,r){var o,i={assertions:null,join:null,left:null,right:null};null==r&&(r=[]),"string"==typeof t&&(t=new Template(t));n:for(;t.skipWhitespace(),!(t.index>=t.length);)switch(o=t.template.charCodeAt(t.index)){case 61:case 60:case 62:case 33:var l=t.index;do o=t.template.charCodeAt(++t.index);while(t.index<t.length&&(60===o||61===o||62===o));i.sign=t.template.substring(l,t.index);continue;case 38:case 124:t.template.charCodeAt(++t.index)!==o&&console.error("Unary operation not valid"),i.join=38===o?"&&":"||",r.push(i),i={assertions:null,join:null,left:null,right:null},++t.index;continue;case 40:t.index++,e(t,i.assertions=[]);break;case 41:t.index++;break n;default:i[null==i.left?"left":"right"]=n(t,o);continue}return(i.left||i.assertions)&&r.push(i),r}function t(t){if(null!=o[t])return o[t];var r=t.length,i={assertions:null,case1:null,case2:null},l=t.indexOf("?"),s=new Template(t);return-1!==l&&(s.length=l),i.assertions=e(s),-1!==l&&(s.length=r,s.index=l+1,i.case1=n(s),s.skipWhitespace(),58===s.template.charCodeAt(s.index)&&(s.index++,i.case2=n(s))),o[t]=i}function r(n,e){"string"==typeof n&&(n=t(n).assertions),null!=n.assertions&&(n=n.assertions);var o,i,l,s,u,a=!1;for(s=0,u=n.length;u>s;s++){if(o=n[s],o.assertions)a=r(o.assertions,e);else if(i="object"==typeof o.left?util_getProperty(e,o.left.value):o.left,null==o.right)a=i,"!"===o.sign&&(a=!a);else switch(l="object"==typeof o.right?util_getProperty(e,o.right.value):o.right,o.sign){case"<":a=l>i;break;case"<=":a=l>=i;break;case">":a=i>l;break;case">=":a=i>=l;break;case"!=":a=i!==l;break;case"==":a=i===l}if(a){if("&&"===o.join)continue;break}if("||"!==o.join&&"&&"===o.join)for(++s;u>s&&"||"!==n[s].join;s++);}return a}var o=[];return{condition:function(n,e){var o=t(n),i=r(o.assertions,e);return null!=o.case1&&(i=i?o.case1:o.case2),null==i?"":"object"==typeof i&&i.value?util_getProperty(e,i.value):i},isCondition:r,parse:t,out:{isCondition:r,parse:t}}}(),ExpressionUtil=function(){function n(n){this.parent=n,this.type=Q,this.body=[],this.join=null}function e(n){this.parent=n}function t(n){this.type=z,this.body=n,this.join=null}function r(n,e){this.parent=n,this.type=Z,this.body=e,this.arguments=[],this.next=null}function o(n,e){this.parent=n,this.type=q,this.body=e,this.next=null}function i(n,e){this.parent=n,this.prefix=e}function l(e){this.body=e,this.case1=new n(this),this.case2=new n(this)}function s(n,e){null==n&&console.error("Undefined",n,e);var t=n.type;return Q===t?(n.body.push(e),e):X===t||J===t?n.body=e:q===t||Z===t?n.next=e:(console.error("Unsupported - append:",n,e),e)}function u(){if(0===arguments.length)return null;var e=new n(arguments[0].parent);return e.join=arguments[arguments.length-1].join,e.body=Array.prototype.slice.call(arguments),e}function a(n){if(n.type!==Q)return null!=n.body&&"object"==typeof n.body&&a(n.body),void 0;for(var e,t,r,o=n.body,i=0,l=o.length;l>i;i++)a(o[i]);for(i=1;l>i&&(e=o[i],t=o[i-1],!(te[t.join]>te[e.join]));i++);if(i!==l){for(r=[o[0]],i=1;l>i;i++)e=o[i],t=o[i-1],te[t.join]>te[e.join]&&l-1>i&&(e=u(o[i],o[++i])),r.push(e);n.body=r}}function c(n,e){console.error("Expression parser:",n,e,y.substring(x))}function f(n,e,t,r){var o,i,l=n,s=n.body;if(null==i&&null!=e&&(o=e,i=e[s]),null==i&&null!=t&&(o=t,i=t[s]),null==i&&null!=r)do o=r,i=r[s];while(null==i&&null!=(r=r.parent));if(null!=i)for(;;){if(l.type===Z){for(var u,a=[],f=0,h=l.arguments.length;h>f;f++)u=l.arguments[f],a[f]=m(u,e,t,r);i=i.apply(o,a)}if(null==i||null==l.next)break;if(l=l.next,s=l.body,o=i,i=i[s],null==i)break}return null==i&&(null==l||null!=l.next)&&c("Mask - Accessor error - ",s),i}function h(n){for(var e,t,r=!1,o=39===n?"'":'"',i=x;(e=y.indexOf(o,x))>-1&&(x=e,92===y.charCodeAt(e-1));)r=!0,x++;return t=y.substring(i,x),r===!0&&(t=t.replace(regexpEscapedChar[o],o)),t}function d(){for(var n,e,t=x;;){if(n=y.charCodeAt(x),46===n){if(e===!0)return c("Unexpected punc"),null;e=!0}if(!((n>=48&&57>=n||46===n)&&_>x))break;x++}return+y.substring(t,x)}function p(){var n,e=x,t=y.charCodeAt(x);if(34===t||39===t)return x++,n=h(t),x++,n;for(;t=y.charCodeAt(x),t>47&&58!==t&&60!==t&&61!==t&&62!==t&&63!==t&&124!==t&&_>x;)x++;return y.substring(e,x)}function g(n){if(null==n&&x===_)return null;switch(n){case 40:return L;case 41:return M;case 44:return $;case 46:return H;case 43:return k;case 45:return w;case 42:return A;case 47:return N;case 37:return O;case 61:return y.charCodeAt(++x)!==n?(c("Not supported (Apply directive) - view can only access model/controllers"),null):S;case 33:return 61===y.charCodeAt(x+1)?(x++,R):E;case 62:return 61===y.charCodeAt(x+1)?(x++,D):U;case 60:return 61===y.charCodeAt(x+1)?(x++,I):P;case 38:return y.charCodeAt(++x)!==n?(c("Single Binary Operator AND"),null):T;case 124:return y.charCodeAt(++x)!==n?(c("Single Binary Operator OR"),null):j;case 63:return B;case 58:return V}return n>=65&&90>=n||n>=97&&122>=n||95===n||36===n?W:n>=48&&57>=n?G:34===n||39===n?K:(c("Unexpected / Unsupported directive"),null)}function v(u){y=u,x=0,_=u.length,b=new n;var f,v,m=b,C=ne;n:for(;;)if(_>x&&33>(f=y.charCodeAt(x)))x++;else{if(x>=_)break;if(v=g(f),null==v&&_>x)break;switch(v){case L:m=s(m,new e(m)),m=s(m,new n(m)),x++;continue;case M:var F=Q;C===ee&&(C=ne,F=Z);do m=m.parent;while(null!=m&&m.type!==F);if(F===Q&&(m=m.parent),null==m){c("OutOfAst Exception - body closed");break n}x++;continue;case $:if(C!==ee){c("Unexpected punctuation, comma");break n}do m=m.parent;while(null!=m&&m.type!==Z);if(null==m){c("OutOfAst Exception - next argument");break n}m=m.newArgument(),x++;continue;case B:b=new l(b),m=b.case1,x++;continue;case V:m=b.case2,x++;continue;case H:f=y.charCodeAt(x+1),f>=48&&57>=f?v=G:(v=W,x++)}if(m.type===Q&&(m=s(m,new e(m))),w!==v&&E!==v||null!=m.body)switch(v){case w:case k:case A:case N:case O:case T:case j:case S:case R:case U:case D:case P:case I:for(;m&&m.type!==X;)m=m.parent;if(null==m.body){c("Unexpected operator",m);break n}m.join=v;do m=m.parent;while(null!=m&&m.type!==Q);null==m&&console.error("Unexpected parent",m),x++;continue;case K:case G:if(null!=m.body&&null==m.join){c("Directive Expected");break}K===v&&(x++,s(m,new t(h(f))),x++),G===v&&s(m,new t(d(f)));continue;case W:for(var q=p();_>x&&(f=y.charCodeAt(x),33>f);)x++;if(40===f){C=ee,x++;var z=s(m,new r(m,q));m=z.newArgument();continue}110===f&&"null"===q&&(q=null),102===f&&"false"===q&&(q=!1),116===f&&"true"===q&&(q=!0),m=s(m,"string"==typeof q?new o(m,q):new t(q))}else m=s(m,new i(m,v)),x++}return null==m.body&&m.type===X&&c("Unexpected end of expression"),a(b),b}function m(n,e,t,r){var o,i;if(null==n)return null;i="string"==typeof n?C.hasOwnProperty(n)===!0?C[n]:C[n]=v(n):n;var l,s,u,a=i.type;if(Q===a){var c,h;n:for(l=0,u=i.body.length;u>l;l++)if(s=i.body[l],c=m(s,e,t,r),null!=h){if(h.join===T)if(o)o=c;else for(;u>l&&i.body[l].join!==j;l++);if(h.join===j){if(o)break n;if(c){o=c;break n}}switch(h.join){case w:o-=c;break;case k:o+=c;break;case N:o/=c;break;case A:o*=c;break;case O:o%=c;break;case R:o=o!=c;break;case S:o=o==c;break;case U:o=o>c;break;case D:o=o>=c;break;case P:o=c>o;break;case I:o=c>=o}h=s}else h=s,o=c}if(X===a)return m(i.body,e,t,r);if(z===a)return i.body;if(q===a||Z===a)return f(i,e,t,r);if(J===a)switch(o=m(i.body,e,t,r),i.prefix){case w:o=-o;break;case E:o=!o}return Y===a&&(o=m(i.body,e,t,r),o=m(o?i.case1:i.case2,e,t,r)),o}var y,b,x=0,_=0,C={},w="-",k="+",N="/",A="*",O="%",j="||",T="&&",E="!",S="==",R="!=",U=">",D=">=",P="<",I="<=",F=".",L=20,M=21,$=22,H=23,B=24,V=25,W=30,K=31,G=32,Q=1,X=2,q=3,Z=4,z=6,J=9,Y=10,ne=1,ee=2,te={};te[F]=1,te[N]=2,te[A]=2,te[w]=3,te[k]=3,te[U]=4,te[D]=4,te[P]=4,te[I]=4,te[S]=5,te[R]=5,te[T]=6,te[j]=6,e.prototype={constructor:e,type:X,join:null,body:null},r.prototype={constructor:r,newArgument:function(){var e=new n(this);return this.arguments.push(e),e}},i.prototype={constructor:i,type:J,body:null},l.prototype={constructor:l,type:Y,case1:null,case2:null};var re=function(){function n(r){if(null==r)return null;var o,i;if(Q===r.type)for(var l=0,s=r.body.length;s>l;l++)i=n(r.body[l]),o=e(o,i);if(q===r.type){for(var u=r.body,a=r.next;null!=a;){if(Z===a.type)return n(a);if(q!==a.type)return console.error("Ast Exception: next should be a symbol/function ref"),null;u+="."+a.body,a=a.next}return u}switch(r.type){case X:case J:case Y:i=n(r.body),o=e(o,i)}if(Y===r.type&&(i=n(b.case1),o=e(o,i),i=n(b.case2),o=e(o,i)),Z===r.type){for(var l=0,s=r.arguments.length;s>l;l++)i=n(r.arguments[l]),o=e(o,i);i=null;var c=r;n:for(;c=c.parent;)switch(c.type){case q:i=c.body+(null==i?"":"."+i);break;case Q:case X:break n;default:i=null;break n}null!=i&&(o=e(o,i)),r.next&&(i=n(r.next),o=e(o,{accessor:t(r),ref:i}))}return o}function e(n,e){if(null==n)return e;if(null==e)return n;if(("object"!=typeof n||null==n.length)&&(n=[n]),"object"!=typeof e||null==e.length)return-1===n.indexOf(e)&&n.push(e),n;for(var t=0,r=e.length;r>t;t++)-1===n.indexOf(e[t])&&n.push(e[t]);return n}function t(n){var e=n;n:for(;e.parent;){switch(e.parent.type){case Q:case X:break n}e=e.parent}return r(e,n.next)}function r(n,e){if(n===e||null==n)return null;if("object"!=typeof n)return n;if(null!=n.length&&"function"==typeof n.splice){for(var t=[],o=0,i=n.length;i>o;o++)t[o]=r(n[o],e);return t}var l={};for(var s in n)null!=n[s]&&"parent"!==s&&(l[s]=r(n[s],e));return l}return function(e){return"string"==typeof e&&(e=v(e)),n(e)}}();return{parse:v,eval:m,varRefs:re}}(),custom_Utils={condition:ConditionUtil.condition,expression:function(n,e,t,r,o){return ExpressionUtil.eval(n,e,t,o)}},custom_Attributes={"class":null,id:null,style:null,name:null,type:null},custom_Tags={div:null,span:null,input:null,button:null,textarea:null,select:null,option:null,h1:null,h2:null,h3:null,h4:null,h5:null,h6:null,a:null,p:null,img:null,table:null,td:null,tr:null,pre:null,ul:null,li:null,ol:null,i:null,b:null,strong:null,form:null},custom_Tags_defs={},Dom={NODE:1,TEXTNODE:2,FRAGMENT:3,COMPONENT:4,CONTROLLER:9,SET:10,Node:Node,TextNode:TextNode,Fragment:Fragment,Component:Component};Node.prototype={constructor:Node,type:Dom.NODE,tagName:null,parent:null,attr:null,nodes:null,__single:null},TextNode.prototype={type:Dom.TEXTNODE,content:null,parent:null},Fragment.prototype={constructor:Fragment,type:Dom.FRAGMENT,nodes:null},Component.prototype={constructor:Component,type:Dom.COMPONENT,parent:null,attr:null,controller:null,nodes:null,components:null,model:null,modelRef:null};var Parser=function(n,e,t,r){function o(n){for(var e=-1;-1!==(e=n.indexOf(l,e))&&n.charCodeAt(e+1)!==a;)e++;if(-1===e)return n;for(var t,r=[],o=0,i=0;t=n.indexOf(s,e+2),-1!==t;){for(r[i++]=o===e?"":n.substring(o,e),r[i++]=n.substring(e+2,t),o=e=t+1;-1!==(e=n.indexOf(l,e))&&n.charCodeAt(e+1)!==a;)e++;if(-1===e)break}return n.length>o&&(r[i]=n.substring(o)),n=null,function(n,e,t,o,i,l){if(null==n){for(var s,u="",a=0,c=r.length;c>a;a++)s=r[a],u+=1===a%2?"~["+s+"]":s;return u}return util_interpolate(r,n,e,t,o,i,l)}}function i(n,e,t,r){var o={2:"tag",3:"tag",5:"attribute key",6:"attribute value",8:"literal"}[t],i=n.substring(0,e).split("\n"),l=i.length,s=i[l-1].length,u=["Mask - Unexpected:",r,"at(",l,":",s,") [ in",o,"]"];console.error(u.join(" "),{stopped:n.substring(e),template:n})}var l="~",s="]",u=126,a=91,c=93;return{parse:function(l){for(var s,f,h,d,p,g,v,m,y=new t,b=y,x=2,_=3,C=0,w=l.length,k=2,N=3,A=5,O=6,j=7,T=8,E=9;;)if(w>C&&33>(g=l.charCodeAt(C)))C++;else if(47!==g||47!==l.charCodeAt(C+1)){if(_===A&&(null!=s&&(y.attr["class"]=o(s),s=null),null!=h&&(y.attr[h]=h,h=null,f=null)),null!=f){if(x===A)null==h?h=f:d=f,null!=h&&null!=d&&("class"!==h?y.attr[h]=d:s=null==s?d:s+" "+d,h=null,d=null);else if(_===N)p=null!=custom_Tags[f]?new r(f,y,custom_Tags[f]):new n(f,y),null==y.nodes?y.nodes=[p]:y.nodes.push(p),y=p,x=A;else if(_===T){if(p=new e(f,y),null==y.nodes?y.nodes=[p]:y.nodes.push(p),y.__single===!0)do y=y.parent;while(null!=y&&null!=y.__single);x=k}f=null}if(C>=w){x===A&&(null!=s&&(y.attr["class"]=o(s)),null!=h&&(y.attr[h]=h));break}if(x===E){for(y=y.parent;null!=y&&null!=y.__single;)y=y.parent;x=k}switch(g){case 123:_=x,x=k,C++;continue;case 62:_=x,x=k,C++,y.__single=!0;continue;case 59:if(null!=y.nodes){C++;continue}case 125:C++,_=x,x=E;continue;case 39:case 34:x===O?x=A:_=x=T,C++;var S,R=!1,U=!1,D=39===g?"'":'"';for(v=C;(S=l.indexOf(D,C))>-1&&(C=S,92===l.charCodeAt(S-1));)R=!0,C++;v===C&&(m=l.charCodeAt(C+1),(124===m||m===g)&&(U=!0,v=C+2,C=S=l.indexOf((124===m?"|":D)+D+D,v),-1===C&&(C=w))),f=l.substring(v,C),R===!0&&(f=f.replace(regexpEscapedChar[D],D)),f=o(f),C+=U?3:1;continue}if(x===k){if(_=N,x=N,46===g||35===g){f="div";continue}}else if(x===A)if(46===g)C++,h="class",x=j;else if(35===g)C++,h="id",x=j;else{if(61===g){C++,x=O;continue}if(null!=h){f=h;continue}}(x===O||x===j)&&(_=x,x=A);var P=null;for(v=C;w>C;){if(g=l.charCodeAt(C),g===u&&l.charCodeAt(C+1)===a){P=!0,++C;do g=l.charCodeAt(++C);while(g!==c&&w>C)}if(39===g||34===g||47===g||60===g||44===g){i(l,C,x,String.fromCharCode(g));break}if(_!==O&&(46===g||35===g))break;if(61===g||62===g||123===g||33>g||59===g)break;C++}if(f=l.substring(v,C),!f){i(l,C,x,"*EMPTY*");break}if(P===!0&&x===N){i(l,C,x,"Tag Names cannt be interpolated (in dev)");break}P===!0&&(x===A&&"class"===h)==!1&&(f=o(f))}else for(C++;10!==g&&13!==g&&w>C;)g=l.charCodeAt(++C);return null!=y.parent&&y.parent!==b&&y.parent.__single!==!0&&null!=y.nodes&&console.warn("Mask - ",y.parent.tagName,JSON.stringify(y.parent.attr),"was not proper closed."),1===b.nodes.length?b.nodes[0]:b},cleanObject:function(n){if(n instanceof Array){for(var e=0;n.length>e;e++)this.cleanObject(n[e]);return n}return delete n.parent,delete n.__single,null!=n.nodes&&this.cleanObject(n.nodes),n},setInterpolationQuotes:function(n,e){return n&&2===n.length?e&&1===e.length?(u=n.charCodeAt(0),a=n.charCodeAt(1),c=e.charCodeAt(0),s=e,l=n.charAt(0),void 0):(console.error("Interpolation End must be of 1 Character"),void 0):(console.error("Interpolation Start must contain 2 Characters"),void 0)},ensureTemplateFunction:o}}(Node,TextNode,Fragment,Component),builder_build=function(n,e){function t(n,e,t,o,i){var l=o.appendChild(document.createComment(""));return function(){return r(n,e,t,l,i)}}function r(e,t,r,o,i){null!=e.tagName&&e.tagName!==e.compoName&&(e.nodes={tagName:e.tagName,attr:e.attr,nodes:e.nodes,type:1}),null!=e.model&&(t=e.model);var l=e.nodes,s=[];if(null!=l){for(var a=l instanceof Array,c=a===!0?l.length:1,f=0,h=null,d=document.createDocumentFragment();c>f;f++)h=a===!0?l[f]:l,u(h,t,r,d,e,s);o.parentNode.insertBefore(d,o)}if(null==e.tagName){var p,g,v=e.handlers&&e.handlers.attr;for(g in e.attr)p=null,v&&fn_isFunction(v[g])&&(p=v[g]),null==p&&fn_isFunction(n[g])&&(p=n[g]),null!=p&&p(node,e.attr[g],t,r,s[0],e)}if(fn_isFunction(e.renderEnd)&&e.renderEnd(s,t,r,o.parentNode),null!=i&&i!==s){var m=i.length,y=s.length;for(j=-1;y>++j;)i[m+j]=s[j]}}function o(n,e,r,o,l){var s,u,a=n.controller,c=fn_isFunction(a)?new a(e):a;if(null!=c){c.compoName=n.tagName,c.attr=s=attr_extend(c.attr,n.attr),c.parent=l,c.model=e;for(u in s)fn_isFunction(s[u])&&(s[u]=s[u]("attr",e,r,o,l,u));if(null!=n.nodes&&(c.nodes=n.nodes),null!=listeners&&null!=listeners.compoCreated)for(var f=listeners.compoCreated,h=f.length,d=0;h>d;d++)f[d](c,e,r,o);fn_isFunction(c.renderStart)&&c.renderStart(e,r,o),n=c}return null==l.components?l.components=[n]:l.components.push(n),l=n,l.ID=++i,l.async===!0?(l.await(t(l,e,r,o)),null):(null!=l.model&&(e=l.model),null!=c&&null!=c.tagName&&(c.nodes={tagName:c.tagName,attr:c.attr,nodes:c.nodes,type:1}),"function"==typeof l.render?(l.render(e,r,o),null):l)}var i=0,l=function(){var n=function(n){return function(e,t){e.appendChild(n.createTextNode(t))}}(document);return function(e,t,r,o,i){var l=e.content;if(fn_isFunction(l)){var s=l("node",t,r,o,i);if("string"==typeof s)return n(o,s),void 0;for(var u,a="",c=s.length,f=0;c>f;f++)if(u=s[f],"object"!=typeof u)a+=u;else{if(""!==a&&(n(o,a),a=""),null==u.nodeType){a+=""+u;continue}o.appendChild(u)}return""!==a&&n(o,a),void 0}n(o,l)}}(),s=function(){var e=function(n){return function(e){return n.createElement(e)}}(document);return function(t,r,o,i,l,s){var u,a=t.tagName,c=t.attr;try{u=e(a)}catch(f){return console.error(a,"element cannot be created. If this should be a custom handler tag, then controller is not defined"),void 0}null!=s&&(s.push(u),c["x-compo-id"]=l.ID),null!=i&&i.appendChild(u);var h,d;for(h in c)fn_isFunction(c[h])?(d=c[h]("attr",r,o,u,l,h),d instanceof Array&&(d=d.join(""))):d=c[h],d&&(fn_isFunction(n[h])?n[h](t,d,r,o,u,l,i):u.setAttribute(h,d));return u}}();return function u(t,r,i,a,c,f){if(null==t)return a;var h,d,p,g,v=t.type;if(null==a&&1!==v&&(a=document.createDocumentFragment()),null==c&&(c=new e),10===v||t instanceof Array){for(p=0,g=t.length;g>p;p++)u(t[p],r,i,a,c,f);return a}if(null==v&&(null!=t.tagName?v=1:null!=t.content&&(v=2)),1===v&&(a=s(t,r,i,a,c,f),f=null),2===v)return l(t,r,i,a,c),a;if(4===v){if(c=o(t,r,i,a,c),null==c)return a;h=[],t=c}var m=t.nodes;if(null!=m){null!=f&&null==h&&(h=f);for(var y=m instanceof Array,b=y===!0?m.length:1,x=0,_=null;b>x;x++)_=y===!0?m[x]:m,u(_,r,i,a,c,h)}if(4===v){if(null==t.tagName){var C,d,w=t.handlers&&t.handlers.attr;for(d in t.attr)C=null,null!=w&&fn_isFunction(w[d])&&(C=w[d]),null==C&&fn_isFunction(n[d])&&(C=n[d]),null!=C&&C(t,t.attr[d],r,i,h[0],c)}fn_isFunction(t.renderEnd)&&t.renderEnd(h,r,i,a)}if(null!=f&&f!==h){var k=f.length,N=h.length;for(p=-1;N>++p;)f[k+p]=h[p]}return a}}(custom_Attributes,Component),cache={},Mask={render:function(n,e,t,r,o){return null!=r&&"function"!=typeof r.appendChild&&(console.error(".render(template[, model, cntx, container, controller]","Container should implement .appendChild method"),console.warn("Args:",arguments)),"string"==typeof n&&(n=hasOwnProp.call(cache,n)?cache[n]:cache[n]=Parser.parse(n)),null==t&&(t={}),builder_build(n,e,t,r,o)},compile:Parser.parse,parse:Parser.parse,build:builder_build,registerHandler:function(n,e){custom_Tags[n]=e},getHandler:function(n){return null!=n?custom_Tags[n]:custom_Tags},registerAttrHandler:function(n,e,t){fn_isFunction(e)&&(t=e),custom_Attributes[n]=t},getAttrHandler:function(n){return null!=n?custom_Attributes[n]:custom_Attributes},registerUtil:function(n,e){return"function"==typeof e?(custom_Utils[n]=e,void 0):("function"!=typeof e.process&&(e.process=function(n,e,t,r,o,i,l){return"node"===l?(this.nodeRenderStart(n,e,t,r,o),this.node(n,e,t,r,o)):(this.attrRenderStart(n,e,t,r,o,i),this.attr(n,e,t,r,o,i))}),custom_Utils[n]=e,void 0)},getUtil:function(n){return null!=n?custom_Utils[n]:custom_Utils},registerUtility:function(n,e){console.warn("@registerUtility - deprecated - use registerUtil(utilName, mix)",n),this.registerUtility=this.registerUtil,this.registerUtility(n,e)},getUtility:function(n){return console.warn("@getUtility - deprecated - use getUtil(utilName)",n),this.getUtility=this.getUtil,this.getUtility()},clearCache:function(n){"string"==typeof n?delete cache[n]:cache={}},ValueUtils:{condition:ConditionUtil.condition,out:ConditionUtil},Utils:{Condition:ConditionUtil,Expression:ExpressionUtil,getProperty:util_getProperty,ensureTmplFn:Parser.ensureTemplateFunction},Dom:Dom,plugin:function(source){eval(source)},on:function(n,e){null==listeners&&(listeners={}),(listeners[n]||(listeners[n]=[])).push(e)},delegateReload:function(){},setInterpolationQuotes:Parser.setInterpolationQuotes,compoIndex:function(n){_controllerID=n},cfg:function(){var n=arguments;if(0===n.length)return __cfg;var e;if(2===n.length)return e=n[0],__cfg[e]=n[1],void 0;var t=n[0];if("object"==typeof t)for(e in t)__cfg[e]=t[e]}};Mask.renderDom=Mask.render,function(n){var e=function(){function e(n){for(var e="";n--;)e+=" ";return e}function t(n,t,o){var i,l;null==t&&(t=0),null==o&&(i=!0,o=[]);var s=o.length;if(n.type===f.FRAGMENT&&(n=n.nodes),n instanceof Array)for(l=0;n.length>l;l++)r(n[l],t,o);else r(n,t,o);var u=e(t);for(l=s;o.length>l;l++)o[l]=u+o[l];return i?o.join(0===c?"":"\n"):void 0}function r(n,e,r){return"string"==typeof n.content?(r.push(u(n.content)),void 0):"function"==typeof n.content?(r.push(u(n.content())),void 0):i(n)?(r.push(o(n)+";"),void 0):l(n)?(r.push(o(n)+" > "),t(s(n),c,r),void 0):(r.push(o(n)+"{"),t(n.nodes,c,r),r.push("}"),void 0)}function o(n){var e=n.tagName,t=n.attr.id||"",r=n.attr["class"]||"";"function"==typeof t&&(t=t()),"function"==typeof r&&(r=r()),t&&(t=-1!==t.indexOf(" ")?"":"#"+t),r&&(r="."+r.split(" ").join("."));var o="";for(var i in n.attr)if("id"!==i&&"class"!==i){var l=n.attr[i];"function"==typeof l&&(l=l()),(a===!1||/\s/.test(l))&&(l=u(l)),o+=" "+i+"="+l}return"div"===e&&(t||r)&&(e=""),e+t+r+o}function i(n){return null==n.nodes||n.nodes instanceof Array&&0===n.nodes.length}function l(n){return n.nodes&&(n.nodes instanceof Array==!1||1===n.nodes.length)}function s(n){return n.nodes instanceof Array?n.nodes[0]:n.nodes}function u(n){return-1===n.indexOf('"')?'"'+n.trim()+'"':-1===n.indexOf("'")?"'"+n.trim()+"'":'"'+n.replace(/"/g,'\\"').trim()+'"'}var a,c,f=n.Dom;return function(e,r){return null==e?"":("string"==typeof e&&(e=n.parse(e)),"number"==typeof r?(c=r,a=0===c):(c=r&&r.indent||4,a=0===c||r&&r.minimizeAttributes),t(e))}}();n.stringify=e}(Mask),function(n){function e(){this.attr={}}function t(n,e,t,r){null==n.nodes&&void 0!==Compo&&Compo.ensureTemplate(n);var l=n.attr.foreach||n.attr.each,s=util_getProperty(e,l),u=n.nodes,a=n.attr.index||"index";if(null==s)for(var c=n;null!=c&&null==s;)s=util_getProperty(c,l),c=c.parent;if(n.nodes=[],n.model=s,n.modelRef=l,n.template=u,n.container=r,null!=s&&"object"==typeof s&&null!=s.length){for(var f,h=0,d=s.length;d>h;h++)f=o(u,s[h],h,r,n),f[a]=h,n.nodes[h]=f;for(var p in i)n[p]=i[p]}}function r(n,e,t,r){var i,l=n.attr.repeat.split(".."),s=+l[0],u=+l[1],a=n.nodes;(isNaN(s)||isNaN(u))&&console.error("Repeat attribute(from..to) invalid",n.attr.repeat),n.nodes=[];for(var c=0;u>s;s++)i=o(a,e,s,r,n),i._repeatIndex=s,n.nodes[c++]=i}function o(n,e,t,r,o){var i=new Component;return i.nodes=n,i.model=e,i.container=r,i.parent=o,i.modelRef=t,i}n.registerHandler("%",e),e.prototype={"debugger":null,use:null,repeat:null,"if":null,"else":null,each:null,log:null,visible:null,model:null,constructor:e,renderStart:function(n,e,o){var i=this.attr;if(null!=i.use){var l=i.use;return this.model=util_getProperty(n,l),this.modelRef=l,void 0}if(null==i["debugger"]){if(null!=i.visible){var s=ExpressionUtil.eval(i.visible,n,e,this.parent);return s||(this.nodes=null),void 0}if(null!=i.log){var u=i.log,a=util_getProperty(n,u);return console.log("Key: %s, Value: %s",u,a),void 0}if(null!=i.repeat&&r(this,n,e,o),null!=i["if"])return this.state=ExpressionUtil.eval(i["if"],n,e,this.parent),this.state||(this.nodes=null),void 0;if(null!=i["else"]){var c=this.parent.components,f=c&&c[c.length-1];return null!=f&&"%"===f.compoName&&null!=f.attr["if"]?(f.state&&(this.nodes=null),void 0):(console.error("Previous Node should be \"% if='condition'\"",f,this.parent),void 0)}(null!=i.each||null!=i.foreach)&&t(this,n,e,o)}},render:null};var i={append:function(e){var t;t=new Component,t.nodes=this.template,t.model=e,n.render(t,e,null,this.container,this)}}}(Mask),function(n){function e(){}function t(){}function r(){}var o={};n.templates=o,n.registerHandler(":template",e),e.prototype.render=function(){return null==this.attr.id?(console.warn("Template Should be defined with ID attribute for future lookup"),void 0):(o[this.attr.id]=this.nodes,void 0)},n.registerHandler(":import",t),t.prototype={constructor:t,attr:null,template:null,renderStart:function(){if(this.attr.id){if(this.nodes=this.template,null==this.nodes&&(this.nodes=o[this.attr.id]),null==this.nodes){for(var n,e=this,t=":template[id="+this.attr.id+"]";null==n&&null!=(e=e.parent);)null!=e.nodes&&(n=jmask(e.nodes).filter(t).get(0));null!=n&&(this.nodes=n.nodes)}null==this.nodes&&console.warn("Template could be not imported",this.attr.id)}}},n.registerHandler(":html",r),r.prototype={mode:"server:all",render:function(n,e,t){var r=jmask(this.nodes).text(n,e,this);return r?t.insertAdjacentHTML?(t.insertAdjacentHTML("beforeend",r),void 0):(this.toHtml=function(){return r},void 0):(console.warn("No HTML for node",this),void 0)}}}(Mask);var Compo=exports.Compo=function(n){function e(n){return"string"!=typeof n?n:m(n)}function t(n,e){if(null==n&&(n={}),null==e)return n;for(var t in e)n[t]=e[t];return n}function r(n){var e={};for(var t in n)e[t]=n[t];return e}function o(n,e){return function(){return n.apply(e,arguments)}}function i(n,e,t){if(null==n&&console.warn("selector is null for type",e),"object"==typeof n)return n;var r,o,i;if(null==r)switch(n[0]){case"#":r="id",n=n.substring(1),o="attr";break;case".":r="class",n=s(n.substring(1)),o="attr";break;default:r=e===g.SET?"tagName":"compoName"}return i="up"===t?"parent":e===g.SET?"nodes":"components",{key:r,prop:o,selector:n,nextKey:i}}function l(n,e,t){"string"==typeof e&&(null==t&&(t=g[n.compoName?"CONTROLLER":"SET"]),e=i(e,t));var r=e.prop?n[e.prop]:n;if(null==r)return!1;if("function"==typeof e.selector)return e.selector(r[e.key]);if(null!=e.selector.test){if(e.selector.test(r[e.key]))return!0}else if(r[e.key]==e.selector)return!0;return!1}function s(n){return function(e){return u(e,n)}}function u(n,e,t){if("string"!=typeof n)return!1;if(null==t&&(t=0),t=n.indexOf(e,t),-1===t)return!1;if(t>0&&n.charCodeAt(t-1)>32)return u(n,e,t+1);var r=n.length,o=e.length;return r-o>t&&n.charCodeAt(t+o)>32?u(n,e,t+1):!0}function a(n,e){if(n instanceof Array){for(var t,r=0,o=n.length;o>r;r++){t=n[r];var i=a(t,e);if(null!=i)return i}return null}return l(n,e)===!0?n:(n=n[e.nextKey])&&a(n,e)}function c(n,e,t){return null!=x&&(e=x(e)),null!=p?(p(n).on(e,t),void 0):null!=n.addEventListener?(n.addEventListener(e,t,!1),void 0):(n.attachEvent&&n.attachEvent("on"+e,t),void 0)}function f(n,e){return n.filter(e).add(n.find(e))}function h(n,e,t,r){return null==t?n.on(e,r):(n.on(e,t,r),n.filter(t).on(e,r),n)}function d(){}var p=global.jQuery||global.Zepto||global.$,g=n.Dom,v=Array.prototype.slice,m=n.Utils.ensureTmplFn;null!=document&&null==p&&console.warn("jQuery / Zepto etc. was not loaded before compo.js, please use Compo.config.setDOMLibrary to define dom engine");var y={select:function(n,e){for(var t in e){var r=e[t],o=null,i=null;if(r instanceof Array&&(i=r[0],o=r.splice(1)),"string"==typeof r&&(i=r),null==r||null==i)return console.error("Unknown component child",t,e[t]),console.warn("Is this object shared within multiple compo classes? Define it in constructor!"),void 0;var l=i.indexOf(":"),s=i.substring(0,l);s=k.config.selectors[s],null==s?n.compos[t]=n.$[0].querySelector(i):(i=i.substring(++l).trim(),n.compos[t]=s(n,i));var u=n.compos[t];null!=o&&(null!=u.$&&(u=u.$),b.on(n,o,u))}}},b={on:function(n,e,t){null==t&&(t=n.$);for(var r,i=e instanceof Array,l=i?e.length:1,s=0;i?l>s:1>s;s++)if(r=i?e[s]:e,r instanceof Array)null!=x&&(r[0]=x(r[0])),t.on.apply(t,r);else for(var u in r){var a,c,f="string"==typeof r[u]?n[r[u]]:r[u],d=u.indexOf(":");-1!==d?(a=u.substring(0,d),c=u.substring(d+1).trim()):a=u,null!=x&&(a=x(a)),h(t,a,c,o(f,n))}}},x=null,_=function(){var n=function(){if(null==document)return!1;if("createTouch"in document)return!0;try{return!!document.createEvent("TouchEvent").initTouchEvent}catch(n){return!1}}();return{touch:function(e){return n===!1?e:"click"===e?"touchend":"mousedown"===e?"touchstart":"mouseup"===e?"touchend":"mousemove"===e?"touchmove":e}}}(),C=function(){function e(n,e){return function(){new l(n).emit(e)}}function t(n,e){return null==e.pipes[n]?(console.error("Controller has no pipes to be added to collection",n,e),void 0):(null==s[n]&&(s[n]=[]),s[n].push(e),void 0)}function r(n,e){for(var t=s[n],r=t.length;--r;)t[r]===e&&(t.splice(r,1),r++)}function o(){var n=this,e=n.pipes;for(var t in e)r(t,n)}function i(n){var e=n.pipes;if(null==e)return console.error("Controller has no pipes",n),void 0;for(var r in e)t(r,n);k.attachDisposer(n,o.bind(n))}function l(n){return this instanceof l==!1?new l(n):(this.pipeName=n,this)}n.registerAttrHandler("x-pipe-signal",function(n,t,r,o,i){for(var l,s=t.split(";"),u=0,a=s.length;a>u;u++)if(l=s[u].trim(),""!==l){var f,h,d=l.substring(0,l.indexOf(":")),p=l.substring(l.indexOf(":")+1).trim(),g=p.indexOf(".");if(-1===g)return console.error('define pipeName "click: pipeName.pipeSignal"'),void 0;f=p.substring(0,g),h=p.substring(++g);var v=e(f,h);!d&&console.error("Signal: event type is not set",t),c(i,d,v)}});var s={};return l.prototype={constructor:l,emit:function(n,e){var t=s[this.pipeName],r=this.pipeName;if(null==t)return console.warn("Pipe.emit: No signals were bound to a Pipe",r),void 0;for(var o,i,l,u,a=t.length;-1!==--a;)o=t[a],i=o.pipes[r],null!=i&&(l=i[n],"function"==typeof l&&(l.apply(o,e),u=!0));u!==!0&&console.warn("No piped slot found for a signal",n,r)}},l.addController=i,l.removeController=o,{addController:i,removeController:o,emit:function(n,e,t){l(n).emit(e,t)
},pipe:l}}(),w=function(){var n={};return{create:function(e){return null==e.ID?(console.warn("Component should have an ID"),void 0):(n[e.ID]=e,void 0)},resolveCompo:function(e){if(null==e)return null;var t,r,o;do{if(r=e.getAttribute("x-compo-id"),r&&(null==t&&(t=r),o=n[r],null!=o&&(o=k.find(o,{key:"ID",selector:t,nextKey:"components"}),null!=o)))return o;e=e.parentNode}while(e&&1===e.nodeType);return t&&console.warn("No controller for ID",t),null},removeCompo:function(e){null!=e.ID&&delete n[e.ID]}}}(),k=function(){function o(n){if(this instanceof o)return null;var t;if(null==n&&(n={}),null!=n.attr)for(var r in n.attr)n.attr[r]=e(n.attr[r]);var i=n.slots;if(null!=i)for(var r in i)"string"==typeof i[r]&&("function"!=typeof n[i[r]]&&console.error("Not a Function @Slot.",i[r]),i[r]=n[i[r]]);n.hasOwnProperty("constructor")&&(t=n.constructor),t=h(t,n),null==t&&(t=function(){});for(var r in d)null==n[r]&&(n[r]=d[r]),n["base_"+r]=d[r];return t.prototype=n,n=null,t}function l(n){null!=n.dispose&&n.dispose(),w.removeCompo(n);var e=0,t=n.components,r=t&&t.length;if(r)for(;r>e;e++)l(t[e])}function s(e){if(null==e.nodes){null!=e.attr.template&&(e.template=e.attr.template,delete e.attr.template);var t=e.template;if(null!=typeof t){if("string"==typeof t){if("#"===t[0]){var r=document.getElementById(t.substring(1));if(null==r)return console.error("Template holder not found by id:",t),void 0;t=r.innerHTML}t=n.parse(t)}"object"==typeof t&&(e.nodes=t)}}}function u(n,e){if("function"==typeof n.dispose){var t=n.dispose;return n.dispose=function(){e.call(this),t.call(this)},void 0}n.dispose=e}function h(n,e){var t=e.compos,o=e.pipes,i=e.attr;return null==t&&null==o&&null==e.attr?n:function(){null!=t&&(this.compos=r(this.compos)),null!=o&&C.addController(this),null!=i&&(this.attr=r(this.attr)),"function"==typeof n&&n.call(this)}}t(o,{create:function(n){var e;null==n&&(n={}),n.hasOwnProperty("constructor")&&(e=n.constructor),null==e&&(e=function(){});for(var t in d)null==n[t]&&(n[t]=d[t]),n["base_"+t]=d[t];return e.prototype=n,e},render:function(e,t,r,o){s(e);var i=[];return n.render(null==e.tagName?e.nodes:e,t,r,o,e,i),e.$=p(i),null!=e.events&&b.on(e,e.events),null!=e.compos&&y.select(e,e.compos),e},initialize:function(e,t,r,i,l){var s;null==i&&(r&&null!=r.nodeType?(i=r,r=null):t&&null!=t.nodeType&&(i=t,t=null)),"string"==typeof e&&(s=e,e=n.getHandler(s),e||console.error("Compo not found:",e));var u={controller:e,type:g.COMPONENT,tagName:s};null==l&&null!=i&&(l=w.resolveCompo(i)),null==l&&(l=new g.Component);var a=n.render(u,t,r,null,l),c=l.components[l.components.length-1];return null!=i&&(i.appendChild(a),o.signal.emitIn(c,"domInsert")),c},dispose:function(n){"function"==typeof n.dispose&&n.dispose();var e=0,t=n.components,r=t&&t.length;if(r)for(;r>e;e++)o.dispose(t[e])},find:function(n,e){return a(n,i(e,g.CONTROLLER,"down"))},closest:function(n,e){return a(n,i(e,g.CONTROLLER,"up"))},ensureTemplate:s,attachDisposer:u,config:{selectors:{$:function(n,e){var t=f(n.$,e);return 0===t.length&&console.error("Compo Selector - element not found -",e,n),t},compo:function(n,e){var t=o.find(n,e);return null==t&&console.error("Compo Selector - component not found -",e,n),t}},setDOMLibrary:function(n){p=n},eventDecorator:function(n){return"function"==typeof n?(x=n,void 0):"string"==typeof n?(x=_[n],void 0):"boolean"==typeof n&&n===!1?(x=null,void 0):void 0}},pipe:C.pipe,resource:function(n){for(var e=n;null!=e;){if(e.resource)return e.resource;e=e.parent}return include.instance()},Dom:{addEventListener:c}}),function(){function n(n,e,t){return null==n[e]&&(n[e]=[]),n[e].push(t),n}function e(n,e,t){var r=n[e];if(null!=r)for(var o,i=0,l=r.length;l>i;i++)o=r[i],null!=o&&(r[i]=null,null!=t?o.apply(this,t):o())}var t={done:function(e){return n(this,"_cbs_done",e)},fail:function(e){return n(this,"_cbs_fail",e)},always:function(e){return n(this,"_cbs_always",e)},resolve:function(){this.async=!1,e(this,"_cbs_done",arguments),e(this,"_cbs_always",arguments)},reject:function(){this.async=!1,e(this,"_cbs_fail",arguments),e(this,"_cbs_always")}},r={async:!0,await:function(n){this.resume=n}};o.pause=function(n,e){if(null==e.async){e.defers=[],e._cbs_done=null,e._cbs_fail=null,e._cbs_always=null;for(var o in t)e[o]=t[o]}e.async=!0;for(var o in r)n[o]=r[o];e.defers.push(n)},o.resume=function(n,e){n.resume&&n.resume(),n.async=!1;for(var t,r=!1,o=0,i=e.defers.length;i>o;o++)t=e.defers[o],t!==n?r===!1&&(r=null!=t):e.defers[o]=null;r===!1&&e.resolve()}}();var d={type:g.CONTROLLER,tagName:null,compoName:null,nodes:null,attr:null,slots:null,pipes:null,compos:null,events:null,onRenderStart:null,onRenderEnd:null,render:null,renderStart:function(n,e,t){1===arguments.length&&null!=n&&n instanceof Array==!1&&null!=n[0]&&(n=arguments[0][0],e=arguments[0][1],t=arguments[0][2]),null==this.nodes&&s(this),"function"==typeof this.onRenderStart&&this.onRenderStart(n,e,t)},renderEnd:function(n,e,t,r){1===arguments.length&&n instanceof Array==!1&&(n=arguments[0][0],e=arguments[0][1],t=arguments[0][2],r=arguments[0][3]),w.create(this,n),this.$=p(n),null!=this.events&&b.on(this,this.events),null!=this.compos&&y.select(this,this.compos),"function"==typeof this.onRenderEnd&&this.onRenderEnd(n,e,t,r)},appendTo:function(n){var e="string"==typeof n?document.querySelector(n):n;if(null==e)return console.warn("Compo.appendTo: parent is undefined. Args:",arguments),this;for(var t=0;this.$.length>t;t++)e.appendChild(this.$[t]);return this.emitIn("domInsert"),this},append:function(e,t,r){var o;if(null==this.$){var l="string"==typeof e?n.compile(e):e;return o=r?a(this,i(r,g.CONTROLLER,"down")):this,null==o.nodes?(this.nodes=l,this):(o.nodes=[this.nodes,l],this)}var s=n.render(e,t,null,null,this);return o=r?this.$.find(r):this.$,o.append(s),this.emitIn("domInsert"),this},find:function(n){return a(this,i(n,g.CONTROLLER,"down"))},closest:function(n){return a(this,i(n,g.CONTROLLER,"up"))},on:function(){var n=Array.prototype.slice.call(arguments);return 3>arguments.length?(console.error("Invalid Arguments Exception @use .on(type,selector,fn)"),this):(null!=this.$&&b.on(this,[n]),null==this.events?this.events=[n]:this.events instanceof Array?this.events.push(n):this.events=[n,this.events],this)},remove:function(){if(null!=this.$){this.$.remove();var n=this.parent&&this.parent.elements;if(null!=n)for(var e,t=0,r=n.length;r>t;t++){e=n[t];for(var o=0,i=this.$.length;i>o;o++)e===this.$[o]&&(n.splice(t,1),t--,r--)}this.$=null}l(this);var s=this.parent&&this.parent.components;if(null!=s){var t=s.indexOf(this);if(-1===t)return console.warn("Compo::remove - parent doesnt contains me",this),this;s.splice(t,1)}return this},slotState:function(n,e){o.slot.toggle(this,n,e)},signalState:function(n,e){o.signal.toggle(this,n,e)},emitOut:function(n){o.signal.emitOut(this,n,this,arguments.length>1?v.call(arguments,1):null)},emitIn:function(n){o.signal.emitIn(this,n,this,arguments.length>1?v.call(arguments,1):null)}};return o.prototype=d,o}();return function(){function e(n,t,r,o,i){if(null==n)return!1;var l=!1,s=null!=n.slots&&n.slots[t];if("string"==typeof s&&(s=n[s]),"function"==typeof s){l=!0;var u=null!=n.slots.__disabled&&n.slots.__disabled[t];if(u!==!0){var a=null==o?s.call(n,r):s.apply(n,[r].concat(o));if(a===!1)return!0;null!=a&&"object"==typeof a&&null!=a.length&&(o=a)}}if(-1===i&&null!=n.parent)return e(n.parent,t,r,o,i)||l;if(1===i&&null!=n.components)for(var c,f=n.components,h=f.length,d=0;h>d;d++)c=e(f[d],t,r,o,i),!l&&(l=c);return l}function r(n,e,t,o){if(null==n)return!1;var i=n.slots;if(null!=i&&null!=i[e]&&("string"==typeof i[e]&&(i[e]=n[i[e]]),"function"==typeof i[e])){if(o!==!0)return!0;if(null==i.__disabled||i.__disabled[e]!==!0)return!0}if(-1===t&&null!=n.parent)return r(n.parent,e,t);if(1===t&&null!=n.components)for(var l=0,s=n.components.length;s>l;l++)if(r(n.components[l],e,t))return!0;return!1}function o(n,t){return r(n,t,-1)===!1?null:function(r){var o=arguments.length>1?v.call(arguments,1):null;e(n,t,r,o,-1)}}function i(n,e,t){var r=n.slots;null!=r&&r.hasOwnProperty(e)!==!1&&(null==r.__disabled&&(r.__disabled={}),r.__disabled[e]=t===!1)}function l(n,e,t){if(i(n,e,t),null!=n.components)for(var r=0,o=n.components.length;o>r;r++)l(n.components[r],e,t)}function s(n,e,t){return null==n.$?(console.warn("Controller has no elements to toggle state"),void 0):(p().add(n.$.filter("[data-signals]")).add(n.$.find("[data-signals]")).each(function(n,r){var o=r.getAttribute("data-signals");null!=o&&-1!==o.indexOf(e)&&r[t===!0?"removeAttribute":"setAttribute"]("disabled","disabled")}),void 0)}function u(n,e,t){for(var r=n,o=n;null!=(r=r.parent);)i(r,e,t),null!=r.$&&0!==r.$.length&&(o=r);l(n,e,t),s(o,e,t)}function a(n,e,t){i(n,e,t),(t||!r(n,e,-1,!0)&&!r(n,e,1,!0))&&s(n,e,t)}n.registerAttrHandler("x-signal","client",function(n,e,t,r,i,l){for(var s,u=e.split(";"),a="",f=0,h=u.length;h>f;f++)if(s=u[f].trim(),""!==s){var d=s.substring(0,s.indexOf(":")),p=s.substring(s.indexOf(":")+1).trim(),g=o(l,p);!d&&console.error("Signal: event type is not set",e),g&&(a+=","+p+",",c(i,d,g)),!g&&console.warn("No slot found for signal",p,l)}""!==a&&i.setAttribute("data-signals",a)}),t(k,{signal:{toggle:u,emitOut:function(n,t,r,o){var i=e(n,t,r,o,-1);!i&&console.warn("Signal %c%s","font-weight:bold;",t,"was not captured")},emitIn:function(n,t,r,o){e(n,t,r,o,1)},enable:function(n,e){u(n,e,!0)},disable:function(n,e){u(n,e,!1)}},slot:{toggle:a,enable:function(n,e){a(n,e,!0)},disable:function(n,e){a(n,e,!1)},invoke:function(n,e,t,r){var o=n.slots;return null==o||"function"!=typeof o[e]?(console.error("Slot not found",e,n),null):null==r?o[e].call(n,t):o[e].apply(n,[t].concat(r))}}})}(),function(){null!=p&&null!=p.fn&&(p.fn.compo=function(n){if(0===this.length)return null;var e=w.resolveCompo(this[0]);return null==n?e:a(e,i(n,g.CONTROLLER,"up"))},p.fn.model=function(n){var e=this.compo(n);if(null==e)return null;for(var t=e.model;null==t&&e.parent;)e=e.parent,t=e.model;return t})}(),n.registerHandler(":slot",d),d.prototype={constructor:d,renderEnd:function(){this.slots={},this.expression=this.attr.on,this.slots[this.attr.signal]=this.handle},handle:function(){var e=this.expression;n.Utils.Expression.eval(e,this.model,global,this)}},k}(Mask),jmask=exports.jmask=function(n){function e(n){return"string"!=typeof n?n:x(n)}function t(n,e){if(null==n&&(n={}),null==e)return n;for(var t in e)n[t]=e[t];return n}function r(n,e){for(var t=0,r=n.length;r>t;t++)e(n[t],t)}function o(n,e){if(null==n)return console.error("Can not remove myself from parent",e),void 0;var t=n.indexOf(e);return-1===t?(console.error("Can not remove myself from parent",e,t),void 0):(n.splice(t,1),void 0)}function i(n){return null!=n&&"object"==typeof n&&null!=n.length&&"function"==typeof n.slice}function l(n,e,t){if(null==n&&console.warn("selector is null for type",e),"object"==typeof n)return n;var r,o,i,l,u,c,f,h,d,p=0,g=n.length;for(r="up"===t?w:e===m.SET?k:N;g>p;)u=n.charCodeAt(p),33>u||(c=a(n,p+1,g),46===u?(o="class",i=A,l=s(n.substring(p+1,c))):35===u?(o="id",i=A,l=n.substring(p+1,c)):91===u?(h=n.indexOf("=",p),-1===h&&console.error('Attribute Selector: should contain "="'),i=A,o=n.substring(p+1,h),u=n.charCodeAt(h+1),d=34===u||39===u?2:1,l=n.substring(h+d,c-d+1),c++):(i=null,o=e===m.SET?"tagName":"compoName",l=n.substring(p,c)),p=c,null!=f?(null==f.filters&&(f.filters=[]),f.filters.push({key:o,selector:l,prop:i})):f={key:o,prop:i,selector:l,nextKey:r,filters:null});return f}function s(n){return function(e){return u(e,n)}}function u(n,e,t){if("string"!=typeof n)return!1;if(null==t&&(t=0),t=n.indexOf(e,t),-1===t)return!1;if(t>0&&n.charCodeAt(t-1)>32)return u(n,e,t+1);var r=n.length,o=e.length;return r-o>t&&n.charCodeAt(t+o)>32?u(n,e,t+1):!0}function a(n,e,t){for(var r,o=!1,i=!1;t>e&&(r=n.charCodeAt(e),(34===r||39===r)&&(o=!o),92===r&&(i=!i),!(46===r||35===r||91===r||93===r||33>r)||o===!0||i===!0);)e++;return e}function c(n,e,t){"string"==typeof e&&(null==t&&(t=m[n.compoName?"CONTROLLER":"SET"]),e=l(e,t));var r=e.prop?n[e.prop]:n,o=!1;if(null==r)return!1;if("function"==typeof e.selector?o=e.selector(r[e.key]):null!=e.selector.test?e.selector.test(r[e.key])&&(o=!0):r[e.key]===e.selector&&(o=!0),o===!0&&null!=e.filters)for(var i,s=0,u=e.filters.length;u>s;s++)if(i=e.filters[s],c(n,i,t)===!1)return!1;return o}function f(n,e){if(null==e)return n;for(var t,r=[],o=0,i=n.length;i>o;o++)t=n[o],c(t,e)&&r.push(t);return r}function h(n,e,t){if(null==n)return t;if(null==t&&(t=[]),n instanceof Array){for(var r=0,o=n.length;o>r;r++)h(n[r],e,t);return t}c(n,e)&&t.push(n);var i=n[e.nextKey];return null!=i&&h(i,e,t),t}function d(n,e){var r={type:1,tagName:1,compoName:1,controller:1},o={parent:e};for(var i in n)1===r[i]&&(o[i]=n[i]);n.attr&&(o.attr=t({},n.attr));var l=n.nodes;if(null!=l&&l.length>0){o.nodes=[];for(var s=l instanceof Array,u=s===!0?l.length:1,a=0;u>a;a++)o.nodes[a]=d(s===!0?l[a]:l,o)}return o}function p(n){for(var e,t=n;null!=t;)e=t,t=t.nodes&&t.nodes[0];return e}function g(n,e,t,r){if(m.TEXTNODE===n.type)return"function"==typeof n.content?n.content("node",e,t,null,r):n.content;var o="";if(null!=n.nodes)for(var i,l=0,s=n.nodes.length;s>l;l++)i=n.nodes[l],o+=g(i,e,t,r);return o}function v(n){return this instanceof v==!1?new v(n):null==n?this:n.type===m.SET?n:this.add(n)}var m=n.Dom,y=n.render,b=n.parse,x=n.Utils.ensureTmplFn,_=(global.Compo||n.Compo||Compo).signal.emitIn,C=function(){function n(n,t){return n===t?(e=!0,0):1}var e=!1;return function(t){var r,o,i,l;if(e=!1,t.sort(n),e===!1)return t;for(r=[],o=0,i=0,l=t.length-1;l>o;)t[o++]===t[o]&&(r[i++]=o);for(;i--;)t.splice(r[i],1);return t}}(),w="parent",k="nodes",N="components",A="attr";return v.prototype={constructor:v,type:m.SET,length:0,components:null,add:function(n){var e,t;if("string"==typeof n&&(n=b(n)),i(n)){for(e=0,t=n.length;t>e;e++)this.add(n[e]);return this}"function"==typeof n&&null!=n.prototype.type&&(n={controller:n,type:m.COMPONENT});var r=n.type;if(!r)return console.error("Only Mask Node/Component/NodeText/Fragment can be added to jmask set",n),this;if(r===m.FRAGMENT){var o=n.nodes;for(e=0,t=o.length;t>e;)this[this.length++]=o[e++];return this}if(r===m.CONTROLLER){if(null!=n.nodes&&n.nodes.length)for(e=n.nodes.length;0!==e;)n.nodes[--e].parent=n;null!=n.$&&(this.type=m.CONTROLLER)}return this[this.length++]=n,this},toArray:function(){return Array.prototype.slice.call(this)},render:function(n,e,t,r){if(this.components=[],1===this.length)return y(this[0],n,e,t,r||this);null==t&&(t=document.createDocumentFragment());for(var o=0,i=this.length;i>o;o++)y(this[o],n,e,t,r||this);return t},prevObject:null,end:function(){return this.prevObject||this},pushStack:function(n){var e;return e=v(n),e.prevObject=this,e},controllers:function(){return null==this.components&&console.warn("Set was not rendered"),this.pushStack(this.components||[])},mask:function(e){if(null!=e)return this.empty().append(e);if(arguments.length)return this;var t;if(0===this.length)t=new m.Node;else if(1===this.length)t=this[0];else{t=new m.Fragment;for(var r=0,o=this.length;o>r;r++)t.nodes[r]=this[r]}return n.stringify(t)},text:function(n,e,t){if("string"==typeof n&&1===arguments.length){for(var r,o=[new m.TextNode(n)],i=0,l=this.length;l>i;i++)r=this[i],r.nodes=o;return this}for(var r,s="",i=0,l=this.length;l>i;i++)r=this[i],s+=g(r,n,e,t);return s}},r(["append","prepend"],function(n){v.prototype[n]=function(e){for(var t,r,o=v(e),i=0,l=this.length;l>i;i++){r=this[i],t=o.toArray();for(var s=0,u=t.length;u>s;s++)t[s].parent=r;r.nodes=null!=r.nodes?"append"===n?r.nodes.concat(t):t.concat(r.nodes):t}return this}}),r(["appendTo"],function(n){v.prototype[n]=function(n,e,t,r){return null==r&&(r=this),null!=n.nodeType&&"function"==typeof n.appendChild?(n.appendChild(this.render(e,t,null,r)),_(r,"domInsert"),this):(v(n).append(this),this)}}),function(){function n(n){for(var e,t,r=n.split(";"),o={},i=0,l=r.length;l>i;i++)t=r[i],e=t.indexOf(":"),o[t.substring(0,e).trim()]=t.substring(e+1).trim();return o}function o(n){var e=[],t=0;for(var r in n)e[t++]=r+":"+n[r];return e.join(";")}r(["add","remove","toggle","has"],function(n){v.prototype[n+"Class"]=function(e){var t,r,o,i,l,s=this.length,u=0;if("string"!=typeof e){if("remove"===n)for(;s>u;u++)this[0].attr["class"]=null;return this}for(;s>u;u++)if(i=this[u],null!=i.attr){if(l=i.attr["class"],null==l)l=e;else{for(l=" "+l+" ",null==t&&(t=e.split(" "),o=t.length),r=0;o>r;r++)if(t[r]){var a=l.indexOf(" "+t[r]+" ")>-1;if("has"!==n)a!==!1||"add"!==n&&"toggle"!==n?a!==!0||"remove"!==n&&"toggle"!==n||(l=l.replace(" "+t[r]+" "," ")):l+=t[r]+" ";else if(a)return!0}l=l.trim()}"has"!==n&&(i.attr["class"]=l)}return"has"===n?!1:this}}),r(["attr","removeAttr","prop","removeProp"],function(n){v.prototype[n]=function(t,r){if(!t)return this;for(var o,i=this.length,l=0,s=arguments.length;i>l;l++)switch(o=this[l],n){case"attr":case"prop":if(1===s){if("string"==typeof t)return o.attr[t];for(var u in t)o.attr[u]=e(t[u])}else 2===s&&(o.attr[t]=e(r));break;case"removeAttr":case"removeProp":o.attr[t]=null}return this}}),t(v.prototype,{tag:function(n){if("string"==typeof n){for(var e=0,t=this.length;t>e;e++)this[e].tagName=n;return this}return this[0]&&this[0].tagName},css:function(e,t){var r,i,l,s=arguments.length,u=this.length,a=0;if(1===s&&"string"==typeof e)return 0===u?null:"string"==typeof this[0].attr.style?n(this[0].attr.style)[e]:null;for(;u>a;a++)if(l=this[a].attr.style,"function"!=typeof l){if(1===s&&"object"==typeof e){if(null==l){this[a].attr.style=o(e);continue}r=n(l);for(i in e)r[i]=e[i];this[a].attr.style=o(r)}if(2===s){if(null==l){this[a].attr.style=e+":"+t;continue}r=n(l),r[e]=t,this[a].attr.style=o(r)}}return this}})}(),t(v.prototype,{clone:function(){for(var n=[],e=0,t=this.length;t>e;e++)n[e]=d(this[0]);return v(n)},wrap:function(n){var e,t=v(n),r=[];if(0===t.length)return console.log("Not valid wrapper",n),this;for(var o=0,i=this.length;i>o;o++){e=i>0?t.clone():t,p(e[0]).nodes=[this[o]],r[o]=e[0];var l=this[o].parent&&this[o].parent.nodes;if(null!=l)for(var s=0,u=l.length;u>s;s++)if(l[s]===this[o]){l.splice(s,1,r[o]);break}}return v(r)},wrapAll:function(n){var e=v(n);return 0===e.length?(console.error("Not valid wrapper",n),this):(this.parent().mask(e),p(e[0]).nodes=this.toArray(),this.pushStack(e))}}),r(["empty","remove"],function(n){v.prototype[n]=function(){for(var e,t=0,r=this.length;r>t;t++)e=this[t],"empty"!==n?"remove"!==n||null!=e.parent&&o(e.parent.nodes,e):e.nodes=null;return this}}),t(v.prototype,{each:function(n,e){for(var t=0;this.length>t;t++)n.call(e||this,this[t],t);return this},eq:function(n){return-1===n?this.slice(n):this.slice(n,n+1)},get:function(n){return 0>n?this[this.length-n]:this[n]},slice:function(){return this.pushStack(Array.prototype.slice.apply(this,arguments))}}),r(["filter","children","closest","parent","find","first","last"],function(n){v.prototype[n]=function(e){var t,r,o=[],i=null==e?null:l(e,this.type,"closest"===n?"up":"down");switch(n){case"filter":return v(f(this,i));case"children":for(t=0;this.length>t;t++)r=this[t],null!=r.nodes&&(o=o.concat(null==i?r.nodes:f(r.nodes,i)));break;case"parent":for(t=0;this.length>t;t++)r=this[t].parent,!r||r.type===m.FRAGMENT||i&&c(r,i)||o.push(r);C(o);break;case"closest":case"find":if(null==i)break;for(t=0;this.length>t;t++)h(this[t][i.nextKey],i,o);break;case"first":case"last":var s;for(t=0;this.length>t;t++)if(s="first"===n?t:this.length-t-1,r=this[s],null==i||c(r,i)){o[0]=r;break}}return this.pushStack(o)}}),v}(Mask);return function(n,e){function t(n,e){for(var t=0,r=e.length-1;r>t;t++){var o=e[t];null==n[o]&&(n[o]={}),n=n[o]}return n}function r(n,e){for(var t=e.split("."),r=t.length,o=0;r>o;o++){if(null==n)return null;n=n[t[o]]}return n}function o(n,e,t){for(var r=e.split("."),o=r.length,i=0,l=null;o-1>i;i++)l=r[i],null==n[l]&&(n[l]={}),n=n[l];n[r[i]]=t}function i(n,e,t){for(var o=e.split("."),i=o.length,s=0,u=n;i--&&(u=u[o[s++]],null!=u);)if(null!=u.__observers){var a=o.slice(s).join(".");if(u.__observers[a])return u.__observers[a].push(t),d(n,e,t),void 0}var c=d(n,e,t);1===c.length&&l(n,e,c,o,!0);var f=r(n,e);p(f)&&v(f,t)}function l(n,e,r,o){var i=o.length,l=i>1?t(n,o):n,u=o[i-1],a=l[u];return i>1&&s(n,o),"length"===u&&p(l)?(v(l,callback),a):(Object.defineProperty(l,u,{get:function(){return a},set:function(n){var t=0,o=r.length;if(n!==a){if(a=n,p(n))for(t=0;o>t;t++)v(n,r[t]);if(null!=r.__dirties)return r.__dirties[e]=1,void 0;for(t=0;o>t;t++)r[t](n)}},configurable:!0}),a)}function s(n,e){for(var t,r=a(n),o="",i=0,l=e.length-1;l>i;i++)t=e[i],o+=t+".",u(o,n,t,r),n=n[t]}function u(n,e,t,r){var o,i=e[t];Object.defineProperty(e,t,{get:function(){return i},set:function(e){e!==i&&(o=i,i=e,r(n,o))},configurable:!0})}function a(n){return function(e,t){var o=n.__observers;if(null!=o)for(var l in o)if(0===l.indexOf(e)){var s=o[l].slice(0),u=s.length,a=0;if(0!==u){var f,h,d=r(n,l);for(a=0;u>a;a++)f=s[a],c(n,l,f),h=l.substring(e.length),c(t,h,f);for(a=0;u>a;a++)s[a](d);for(a=0;u>a;a++)i(n,l,s[a])}}}}function c(n,e,t){for(var o=e.split("."),i=o.length,l=0,s=n;i--&&(s=s[o[l++]],null!=s);)if(null!=s.__observers){c(s,o.slice(l).join("."),t);break}if(null!=n.__observers&&null!=n.__observers[e]){var u=r(n,e);if(2===arguments.length)return n.__observers[e].length=0,void 0;g(n.__observers[e],t),p(u)&&m(u,t)}}function f(n,e){if(null==e)return n;null==n&&(n={});for(var t in e)n[t]=e[t];return n}function h(n,e){if(null==n)return!1;for(var t=e.split("."),r=t.length,o=0;r--;)if(null==(n=n[t[o++]]))return!1;return!0}function d(n,e,t){null==n.__observers&&Object.defineProperty(n,"__observers",{value:{__dirty:null},enumerable:!1});var r=n.__observers;return null!=r[e]?r[e].push(t):r[e]=[t],r[e]}function p(n){return null!=n&&"object"==typeof n&&null!=n.length&&"function"==typeof n.splice}function g(n){if(null==n)return!1;for(var e,t=0,r=n.length,o=1,i=arguments.length,l=0;r>t;t++)for(e=n[t],o=1;i>o;o++)if(arguments[o]===e){n.splice(t,1),t--,r--,l++;break}return l+1===i}function v(n,e){null==n.__observers&&Object.defineProperty(n,"__observers",{value:{__dirty:null},enumerable:!1});var t=n.__observers.__array;if(null==t&&(t=n.__observers.__array=[]),0===t.length)for(var r,o=0,i=["push","unshift","splice","pop","shift","reverse","sort"],l=i.length;l>o;o++)r=i[o],n[r]=y(n,n[r],r);t[t.length++]=e}function m(n,e){var t=n.__observers&&n.__observers.__array;if(null!=t)for(var r=0,o=t.length;o>r;r++)if(t[r]===e){t[r]=null;for(var i=r;o>i;i++)t[i]=t[i+1];o--,t.length--}}function y(n,e,t){return function(){return b(n,e,t,K.call(arguments))}}function b(n,e,t,r){var o=n.__observers&&n.__observers.__array,i=e.apply(n,r);if(null==o||0===o.length)return i;if(null!=n.__observers.__dirty)return n.__observers.__dirty=!0,i;for(var l,s=0,u=o.length;u>s;s++)l=o[s],"function"==typeof l&&l(n,t,r);return i}function x(n,e){for(var t=0,r=n.length;r>t;t++)e(n[t])}function _(n){return n.parentNode.removeChild(n)}function C(n){if(null!=n)for(var e=0,t=n.length;t>e;e++)_(n[e])}function w(n,e){return e.parentNode.insertBefore(n,e.nextSibling)}function k(n,e){return e.parentNode.insertBefore(n,e)}function N(n,e,t){if(null==n.components)return w(t,n.placeholder);for(var r,o=n.components,i=null,l=!0,s=o.length,u=e;s>u;u++)if(r=o[u].elements,r&&r.length){i=r[0];break}if(null==i)for(l=!1,u=s>e?e:s;--u>-1;)if(r=o[u].elements,r&&r.length){i=r[r.length-1];break}return null==i&&(i=n.placeholder),l?k(t,i):w(t,i)}function A(e,t,r,o,i){return n.render(t,r,o,i,e)}function O(n,e){if(null==n)return!1;C(n.elements),n.elements=null,null!=$&&$.dispose(n);var t=e&&e.components||n.parent&&n.parent.components;return null==t?(console.error("Parent Components Collection is undefined"),!1):g(t,n)}function j(n){null!=$&&$.signal.emitIn(n,"domInsert")}function T(n,e){if("function"==typeof n.dispose){var t=n.dispose;return n.dispose=function(){e.call(this),t.call(this)},void 0}n.dispose=e}function E(n,e,t,r,o){if("."===n)return p(e)&&v(e,o),void 0;var l,s=q(n),u=Z(s);if(null!=u){if("string"==typeof u)return h(e,u)&&(l=e),null==l&&h(r,u)&&(l=r),null==l&&(l=e),i(l,u,o),void 0;for(var a,c=null!=u.length&&"function"==typeof u.splice,f=c===!0?u.length:1,d=0;f>d;d++)if(a=c?u[d]:u,null!=a){if("object"==typeof a){if(l=Q(a.accessor,e,t,r),null==l||"object"!=typeof l){console.error("Binding failed to an object over accessor",a);continue}a=a.ref}else l=h(e,a)?e:h(r,a)?r:e;i(l,a,o)}}}function S(n,e,t,r){if("function"==typeof t&&console.warn("[mask.binding] - expression unbind(expr, model, controller, callback)"),"."===n)return m(e,r),void 0;var o,i=Z(n);if(null!=i){if("string"==typeof i)return h(e,i)&&c(e,i,r),h(t,i)&&c(t,i,r),void 0;for(var o,l=null!=i.length&&"function"==typeof i.splice,s=l===!0?i.length:1,u=0;s>u;u++)if(o=l?i[u]:i,null!=o)if("object"!=typeof o)h(e,o)&&c(e,o,r),h(t,o)&&c(t,o,r);else{var a=Q(o.accessor,e,null,t);a&&c(a,o.ref,r)}}}function R(n,e,t,r,o){var i=0;return function(){if(i++>10)return console.warn("Concurent binder detected",n),void 0;var l=X(n,e,t,r);if(arguments.length>1){var s=K.call(arguments);s[0]=l,o.apply(this,s)}else o(l);i--}}function U(n,e,t){for(var r,o,i,l,s=n.split(";"),u=[],a=0,c=s.length;c>a;a++)r=s[a].split(":"),1===r.length||2===r.length?(i=2==r.length?r[0]:t,o=r[2==r.length?1:0],l=D(o.trim(),i,e),null!=l&&u.push(l)):console.error('Too much ":" in a signal def.',s[a]);return u}function D(n,e,t){if(t!==!0)return{signal:n,type:e};var r=n.indexOf(".");return-1===r?(console.error("No pipe name in a signal",n),null):{signal:n.substring(r+1),pipe:n.substring(0,r),type:e}}function P(){}function I(){}function F(){}function L(n,e){if(null==e&&(e=[]),null==n.components)return e;for(var t,r=n.components,o=0,i=r.length;i>o;o++)t=r[o],"validate"!==t.compoName?L(t):e.push(t);return e}var M=global.jQuery||global.Zepto||global.$,$=void 0!==e?e:n.Compo||global.Compo,H=$.Dom.addEventListener,B=n.registerHandler,V=n.registerAttrHandler,W=n.registerUtil,K=Array.prototype.slice,G=n.Utils.Expression,Q=G.eval,X=function(n,e,t,r){if("."===n)return e;var o=Q(n,e,t,r);return null==o?"":o},q=G.parse,Z=G.varRefs,z=function(){function e(n,e,t,r){null==r&&(r=":bind"===t.compoName?"single":"dual");var o,i=t.attr;if(this.node=t,this.controller=t,this.model=n,this.element=e,this.value=i.value,this.property=i.property,this.setter=t.attr.setter,this.getter=t.attr.getter,this.dismiss=0,this.bindingType=r,this.log=!1,this.signal_domChanged=null,this.signal_objectChanged=null,this.locked=!1,null==this.property)switch(e.tagName){case"INPUT":if(o=e.getAttribute("type"),"checkbox"===o){this.property="element.checked";break}this.property="element.value";break;case"TEXTAREA":this.property="element.value";break;case"SELECT":this.domWay=u.SELECT;break;default:this.property="element.innerHTML"}if(i.log&&(this.log=!0,"log"!==i.log&&(this.logExpression=i.log)),i["x-signal"]){var l=U(i["x-signal"],null,"dom")[0];l&&("dom"===l.type?this.signal_domChanged=l.signal:"object"===l.type?this.signal_objectChanged=l.signal:console.error("Type is not supported",l))}if(i["x-pipe-signal"]){var l=U(i["x-pipe-signal"],!0,"dom")[0];l&&("dom"===l.type?this.pipe_domChanged=l:"object"===l.type?this.pipe_objectChanged=l:console.error("Type is not supported",l))}if(i["dom-slot"]){this.slots={};var s=t.parent,a=s.parent;s.parent=this,this.parent=a,this.slots[i["dom-slot"]]=function(n,e){this.domChanged(n,e)}}var c=i["object-pipe-slot"]||i["x-pipe-slot"];if(c){var f=c,h=f.indexOf("."),d=f.substring(0,h),l=f.substring(h+1);this.pipes={},this.pipes[d]={},this.pipes[d][l]=function(){this.objectChanged()},$.pipe.addController(this)}if(i.expression){if(this.expression=i.expression,null==this.value&&"single"!==r){var p=Z(this.expression);"string"==typeof p?this.value=p:console.warn("Please set value attribute in DualBind Control.")}}else this.expression=this.value}function t(n){var e=n.expression,t=n.model,r=n.objectChanged=n.objectChanged.bind(n);if(n.binder=R(e,t,n.cntx,n.node,r),E(e,t,n.cntx,n.node,n.binder),"dual"===n.bindingType){var o=n.node.attr;if(!o["change-slot"]&&!o["change-pipe-event"]){var i=n.element,l=o["change-event"]||o.changeEvent||"change",s=n.domChanged.bind(n);H(i,l,s)}}return n.objectChanged(),n}function l(n,e,t){var r=n.slots;(null==r||"function"!=typeof r[e]||r[e].apply(n,t)!==!1)&&null!=n.parent&&l(n.parent,e,t)}var s={};n.registerBinding=function(n,e){s[n]=e},n.BindingProvider=e,e.create=function(n,t,r,o){var i,l=r.attr.bindingProvider,u=null==l?null:s[l];return"function"==typeof u?new u(n,t,r,o):(i=new e(n,t,r,o),null!=u&&f(i,u),i)},e.bind=function(n){return t(n)},e.prototype={constructor:e,dispose:function(){S(this.expression,this.model,this.controller,this.binder)},objectChanged:function(n){if(!(this.dismiss-->0)){if(this.locked===!0)return console.warn("Concurance change detected",this),void 0;if(this.locked=!0,null==n&&(n=this.objectWay.get(this,this.expression)),this.domWay.set(this,n),this.log&&console.log("[BindingProvider] objectChanged -",n),this.signal_objectChanged&&l(this.node,this.signal_objectChanged,[n]),this.pipe_objectChanged){var e=this.pipe_objectChanged;$.pipe(e.pipe).emit(e.signal)}this.locked=!1}},domChanged:function(n,e){if(this.locked===!0)return console.warn("Concurance change detected",this),void 0;this.locked=!0;var t=e||this.domWay.get(this),r=!0;if(this.node.validations)for(var o,i=0,s=this.node.validations.length;s>i;i++)if(o=this.node.validations[i],o.validate(t,this.element,this.objectChanged.bind(this))===!1){r=!1;break}if(r&&(this.dismiss=1,this.objectWay.set(this.model,this.value,t),this.dismiss=0,this.log&&console.log("[BindingProvider] domChanged -",t),this.signal_domChanged&&l(this.node,this.signal_domChanged,[t]),this.pipe_domChanged)){var u=this.pipe_domChanged;$.pipe(u.pipe).emit(u.signal)}this.locked=!1},objectWay:{get:function(n,e){return X(e,n.model,n.cntx,n.controller)},set:function(n,e,t){o(n,e,t)}},domWay:{get:function(n){if(n.getter){var e=n.node.parent;return null==e||"function"!=typeof e[n.getter]?(console.error("Mask.bindings: Getter should be a function",n.getter,n),null):e[n.getter]()}return r(n,n.property)},set:function(n,e){if(n.setter){var t=n.node.parent;if(null==t||"function"!=typeof t[n.setter])return console.error("Mask.bindings: Setter should be a function",n.setter,n),void 0;t[n.setter](e)}else o(n,n.property,e)}}};var u={SELECT:{get:function(n){var e=n.element;return-1===e.selectedIndex?"":e.options[e.selectedIndex].getAttribute("name")},set:function(n,e){for(var t,r=n.element,o=0,i=r.options.length;i>o;o++)if(t=r.options[o],t.getAttribute("name")==e)return r.selectedIndex=o,void 0}}};return f(e,{addObserver:i,removeObserver:c}),e}();B(":visible",P),P.prototype={constructor:P,refresh:function(n,e){e.style.display=X(this.attr.check,n)?"":"none"},renderStart:function(n,e,t){this.refresh(n,t),this.attr.bind&&i(n,this.attr.bind,this.refresh.bind(this,n,t))}},function(){function n(){}B(":bind",n),n.prototype={constructor:n,renderEnd:function(n,e,t,r){this.provider=z.create(e,r,this,"single"),z.bind(this.provider)},dispose:function(){this.provider&&"function"==typeof this.provider.dispose&&this.provider.dispose()}}}(),B(":dualbind",I),I.prototype={constructor:I,renderEnd:function(e,t,r,o){if(this.provider=z.create(t,o,this),this.components)for(var i,l=0,s=this.components.length;s>l;l++)i=this.components[l],":validate"===i.compoName&&(this.validations||(this.validations=[])).push(i);if(!this.attr["no-validation"]&&!this.validations){var u=t.Validate,a=this.provider.value;if(null==u&&-1!==a.indexOf(".")){for(var c=a.split("."),l=0,f=c.length,h=t[c[0]];null==u&&f>++l&&h;)u=h.Validate,h=h[c[l]];a=c.slice(l).join(".")}var d=u&&u[a];"function"==typeof d&&(d=n.getHandler(":validate").createCustom(o,d),(this.validations||(this.validations=[])).push(d))}z.bind(this.provider)},dispose:function(){this.provider&&"function"==typeof this.provider.dispose&&this.provider.dispose()},handlers:{attr:{"x-signal":function(){}}}},function(){function t(){}function o(n,e){this.fn=n,this.message=e}function i(n,e,t){console.warn("Validate Notification:",n,e);var r=M(n).next("."+s);
return 0===r.length&&(r=M("<div>").addClass(s).html("<span></span><button>cancel</button>").insertAfter(n)),r.children("button").off().on("click",function(){r.hide(),t&&t()}).end().children("span").text(e).end().show()}function l(n){return M(n).next("."+s).hide()}var s="-validate-invalid";n.registerValidator=function(n,e){u[n]=e},B(":validate",t),t.prototype={constructor:t,attr:{},renderStart:function(n,e,r){if(this.element=r,this.attr.value){var i=t.resolveFromModel(n,this.attr.value);i&&(this.validators=[new o(i)])}},validate:function(n,e,t){null==e&&(e=this.element),this.attr&&(null==n&&this.attr.getter&&(n=r({node:this,element:e},this.attr.getter)),null==n&&this.attr.value&&(n=r(this.model,this.attr.value))),null==this.validators&&this.initValidators();for(var o,i=0,l=this.validators.length;l>i;i++)if(o=this.validators[i].validate(n),o&&!this.attr.silent)return this.notifyInvalid(e,o,t),!1;return this.makeValid(e),!0},notifyInvalid:function(n,e,t){return i(n,e,t)},makeValid:function(n){return l(n)},initValidators:function(){this.validators=[];for(var n in this.attr){switch(n){case"message":case"value":case"getter":continue}if(n in u!=!1){var e=u[n];this.validators.push(new o(e(this.attr[n],this),this.attr.message))}else console.error("Unknown Validator:",n,this)}}},t.resolveFromModel=function(n,e){return r(n.Validate,e)},t.createCustom=function(n,e){var r=new t;return r.element=n,r.validators=[new o(e)],r},o.prototype.validate=function(n){var e=this.fn(n);return e===!1?this.message||"Invalid - "+n:e},B(":validate:message",e({template:"div."+s+' { span > "~[bind:message]" button > "~[cancel]" }',onRenderStart:function(n){"string"==typeof n&&(n={message:n}),n.cancel||(n.cancel="cancel"),this.model=n},compos:{button:"$: button"},show:function(n,e){var t=this;this.model.message=n,this.compos.button.off().on(function(){t.hide(),e&&e()}),this.$.show()},hide:function(){this.$.hide()}}));var u={match:function(n){return function(e){return RegExp(n).test(e)}},unmatch:function(n){return function(e){return!RegExp(n).test(e)}},minLength:function(n){return function(e){return e.length>=parseInt(n,10)}},maxLength:function(n){return function(e){return e.length<=parseInt(n,10)}},check:function(n,e){return function(t){return X("x"+n,e.model,{x:t},e)}}}}(),B(":validate:group",F),F.prototype={constructor:F,validate:function(){for(var n,e=L(this),t=0,r=e.length;r>t;t++)if(n=e[t],!n.validate())return!1;return!0}},function(){function n(n,e,t){return n?null==e||""===e?n+" "+t:n.replace(e,t):t}function e(e,t,r,o,i){return function(t){switch(e){case"node":r.textContent=t;break;case"attr":var l,s,u=typeof r[i];if("boolean"===u)return o=r[i]=!!t,void 0;if("string"===u)return o=r[i]=n(r[i],o,t),void 0;l=r.getAttribute(i),s=n(l,o,t),r.setAttribute(i,s),o=t}}}function t(n,t,r,o,i,l,s,u){var a=e(u,t,i,n,s),c=R(t,r,o,l,a);E(t,r,o,l,c),T(l,function(){S(t,r,l,c)})}W("bind",{current:null,element:null,nodeRenderStart:function(n,e,t,r,o){var i=X(n,e,t,o);this.current=i,this.element=document.createTextNode(i)},node:function(n,e,r,o,i){return t(this.current,n,e,r,this.element,i,null,"node"),this.element},attrRenderStart:function(n,e,t,r,o){this.current=X(n,e,t,o)},attr:function(n,e,r,o,i,l){return t(this.current,n,e,r,o,i,l,"attr"),this.current}})}(),V("xx-visible",function(n,e,t,r,o,i){var l=R(e,t,r,i,function(n){o.style.display=n?"":"none"});E(e,t,r,i,l),T(i,function(){S(e,t,i,l)}),X(e,t,r,i)||(o.style.display="none")}),V("x-toggle","client",function(n,e,t,r,i,l){var s=e.substring(0,e.indexOf(":")),u=e.substring(s.length+1),a=Z(u);"string"!=typeof a&&(a=a[0]),H(i,s,function(){var n=X(u,t,r,l);o(t,a,n)})}),function(n){function t(){this.attr={"debugger":null,use:null,log:null,"if":null,each:null,visible:null}}n.registerHandler("%%",t);var r=function(){var n={refresh:function(n){this.model=n,this.elements&&(C(this.elements),this.elements=[]),null!=$&&$.dispose(this),k(A(this,this.nodes,this.model,this.cntx),this.placeholder)},dispose:function(){S(this.expr,this.originalModel,this,this.binder)}};return function(e,t,r,o){var i=e.attr.use;f(e,{expr:i,placeholder:document.createComment(""),binder:R(i,t,r,e,n.refresh.bind(e)),originalModel:t,model:X(i,t,r,e),dispose:n.dispose}),E(i,t,r,e,e.binder),o.appendChild(e.placeholder)}}(),o=function(){return function(n,e,t){function r(n){console.log("Logger > Key: %s, Value: %s",o,n)}var o=n.attr.log,i=R(o,e,t,n,r),l=X(o,e,t,n);E(o,e,t,n,i),T(n,function(){S(o,e,n,i)}),r(l)}}(),i=function(){function n(n,e){return function(){return n.apply(e,arguments)}}var e={refresh:function(n){(null!=this.elements||n)&&(null==this.elements?(k(A(this,this.template,this.model,this.cntx),this.placeholder),this.$=M(this.elements)):(null==this.$&&(this.$=M(this.elements)),this.$[n?"show":"hide"]()),this.onchange&&this.onchange(n))},dispose:function(){S(this.expr,this.model,this,this.binder),this.onchange=null,this.elements=null}};return function(t,r,o,i){var l=t.attr["if"];f(t,{expr:l,template:t.nodes,placeholder:document.createComment(""),binder:R(l,r,o,t,n(e.refresh,t)),state:!!X(l,r,o,t)}),t.state||(t.nodes=null),E(l,r,o,t,t.binder),i.appendChild(t.placeholder)}}(),l=function(){var n={refresh:function(n){if(null!=this.elements||!n){if(null==this.elements)return k(A(this,this.template,this.model,this.cntx)),this.$=M(this.elements),void 0;null==this.$&&(this.$=M(this.elements)),this.$[n?"hide":"show"]()}}};return function(e,t,r,o){var i=e.parent.components,l=i&&i[i.length-1];return e.template=e.nodes,e.placeholder=document.createComment(""),null==l||"%%"!==l.compoName||null==l.attr["if"]?(console.error('Mask.Binding: Binded ELSE should be after binded IF - %% if="expression" { ...'),void 0):(l.onchange=n.refresh.bind(e),l.state&&(e.nodes=null),o.appendChild(e.placeholder),void 0)}}(),s=function(){function t(n,e){var t=[];if(null==e||"object"!=typeof e||null==e.length)return t;for(var r,o=0,i=e.length;i>o;o++){switch(r=e[o],typeof r){case"string":case"number":case"boolean":r=e[o]=Object(r)}t[o]=new l(n.template,r,n)}return t}function r(n,e){for(var t=n.components,r=0,o=t.length,i=0,l=null,s=null,u=null,a=document.createDocumentFragment(),c=[];o>r;r++)if(u=t[r],null!=u.elements&&0!==u.elements.length)for(i=0,l=u.elements.length;l>i;i++)s=u.elements[i],s.parentNode.removeChild(s);n:for(i=0,l=e.length;l>i;i++){for(r=0;o>r;r++)if(e[i]===t[r].model){c[i]=t[r];continue n}console.warn("No Model Found for",e[i])}for(r=0,o=c.length;o>r;r++)if(u=c[r],null!=u.elements&&0!==u.elements.length)for(i=0,l=u.elements.length;l>i;i++)s=u.elements[i],a.appendChild(s);n.components=c,k(a,n.placeholder)}function o(n,e,r,o,l){if(null!=e&&null!=r){var s=e,u=e+r;for(u>n.components.length&&(u=n.components.length);u>s;s++)O(n.components[s],n)&&(s--,u--)}if(null!=o&&l&&l.length){var a=new i,c=t(n,l),f=A(a,c),h=a.components;N(n,o,f),j(a),null==n.components&&(n.components=[]),n.components.splice.apply(n.components,[o,0].concat(h))}}var i=n.Dom.Component,l=function(){function n(n,e,t){this.nodes=n,this.model=e,this.parent=t}var e=i.prototype;n.prototype={constructor:s,renderEnd:function(n){this.elements=n}};for(var t in e)n.prototype[t]=e[t];return n}(),s={append:function(e){var t=new l(this.template,e,this);n.render(t,e,null,this.container,this)}},u={refresh:function(n,e,i){var l,s,u=0;if(null==e){if(null!=this.components)for(u=0,s=this.components.length;s>u;u++)l=this.components[u],O(l,this)&&(u--,s--);return this.components=[],this.nodes=t(this,n),k(A(this,this.nodes),this.placeholder),x(this.components,j),void 0}for(s=n.length;s>u;u++)switch(l=n[u],typeof l){case"string":case"number":case"boolean":n[u]=Object(l)}switch(e){case"push":o(this,null,null,n.length,n.slice(n.length-1));break;case"pop":o(this,n.length,1);break;case"unshift":o(this,null,null,0,n.slice(0,1));break;case"shift":o(this,0,1);break;case"splice":var a=i[0],c=1===i.length?this.components.length:i[1],f=i.length>2?n.slice(i[0],i.length-2+i[0]):null;o(this,a,c,a,f);break;case"sort":case"reverse":r(this,n)}},dispose:function(){S(this.expr,this.model,this,this.refresh)}};return function(n,r,o,i){null==n.nodes&&void 0!==e&&e.ensureTemplate(n);var l=n.attr.each||n.attr.foreach,a=X(l,r,o,n);f(n,{expr:l,binder:R(l,r,o,n,u.refresh.bind(n)),template:n.nodes,container:i,placeholder:document.createComment(""),dispose:u.dispose}),i.appendChild(n.placeholder),E(n.expr,r,o,n,n.binder);for(var c in s)n[c]=s[c];n.nodes=t(n,a)}}(),u=function(){var n={refresh:function(){if(this.refreshing!==!0){this.refreshing=!0;for(var n=X(this.expr,this.model,this.cntx,this),e=0,t=this.elements.length;t>e;e++)this.elements[e].style.display=n?"":"none";this.refreshing=!1}},dispose:function(){S(this.expr,this.model,this,this.binder)}};return function(e,t,r){var o=e.attr.visible;f(e,{expr:o,binder:R(o,t,r,e,n.refresh.bind(e)),dispose:n.dispose}),E(o,t,r,e,e.binder),n.refresh.call(e)}}();t.prototype={constructor:t,elements:null,renderStart:function(n,e,t){var u=this.attr;return null==u["debugger"]?null!=u.use?(r(this,n,e,t),void 0):null!=u.log?(o(this,n,e,t),void 0):(this.model=n,null!=u["if"]?(i(this,n,e,t),void 0):null!=u["else"]?(l(this,n,e,t),void 0):((null!=u.each||null!=u.foreach)&&s(this,n,e,t),void 0)):void 0},render:null,renderEnd:function(n){this.elements=n,null!=this.attr.visible&&u(this,this.model,this.cntx)}}}(n)}(Mask,Compo),Mask});