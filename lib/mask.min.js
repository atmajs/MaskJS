/*!
 * MaskJS v0.8.12
 * Part of the Atma.js Project
 * http://atmajs.com/
 *
 * MIT license
 * http://opensource.org/licenses/MIT
 *
 * (c) 2012, 2014 Atma.js and other contributors
 */
(function(n,e){"use strict";function t(){return e(i,r,o)}var r,o,i="undefined"==typeof window||null==window.navigator?global:window;return"undefined"==typeof exports||null!=n&&n!==exports&&n!==i||(n=exports),o=i.document,r=n||i,"function"==typeof define&&define.amd?define(t):t()})(this,function(global,exports,document){"use strict";function util_interpolate(n,e,t,r,o,i,l){for(var s,u,a,c,f,d=n.length,p=-1,h=null,m="",v=!0;d>++p;)v===!0?null==h?m+=n[p]:h.push(n[p]):(c=n[p],u=null,a=c.indexOf(":"),-1===a?u=obj_getPropertyEx(c,t,r,i):(s=a>0?str_trim(c.substring(0,a)):"",""===s&&(s="expression"),c=c.substring(a+1),f=custom_Utils[s],u=f(c,t,r,o,i,l,e)),null!=u&&("object"==typeof u&&null==h&&(h=[m]),null==h?m+=u:h.push(u))),v=!v;return null==h?m:h}function attr_extend(n,e){if(null==n&&(n={}),null==e)return n;for(var t in e)"class"!==t||"string"!=typeof n[t]?n[t]=e[t]:n[t]+=" "+e[t];return n}function Template(n){this.template=n,this.index=0,this.length=n.length}function str_trim(n){for(var e,t=n.length,r=0,o=t-1;t>r&&(e=n.charCodeAt(r),33>e);r++);for(;o>=r&&(e=n.charCodeAt(o),33>e);o--);return 0===r&&o===t-1?n:n.substring(r,o+1)}function fn_proxy(n,e){return function(){return fn_apply(n,e,arguments)}}function fn_apply(n,e,t){switch(t.length){case 0:return n.call(e);case 1:return n.call(e,t[0]);case 2:return n.call(e,t[0],t[1]);case 3:return n.call(e,t[0],t[1],t[2]);case 4:return n.call(e,t[0],t[1],t[2],t[3])}return n.apply(e,t)}function fn_doNothing(){}var regexpWhitespace=/\s/g,regexpEscapedChar={"'":/\\'/g,'"':/\\"/g,"{":/\\\{/g,">":/\\>/g,";":/\\>/g},hasOwnProp={}.hasOwnProperty,listeners=null,__cfg={allowCache:!0},_Array_slice=Array.prototype.slice,is_Function,is_Array;(function(){is_Function=function(n){return"function"==typeof n},is_Array=function(n){return null!=n&&"object"==typeof n&&"number"==typeof n.length&&"function"==typeof n.splice}})(),Template.prototype={skipWhitespace:function(){for(var n=this.template,e=this.index,t=this.length;t>e&&!(n.charCodeAt(e)>32);e++);return this.index=e,this},skipToAttributeBreak:function(){var n,e=this.template,t=this.index,r=this.length;do if(n=e.charCodeAt(++t),35===n&&123===e.charCodeAt(t+1))return this.index=t,this.sliceToChar("}"),this.index++,void 0;while(46!==n&&35!==n&&62!==n&&123!==n&&32!==n&&59!==n&&r>t);this.index=t},sliceToChar:function(n){for(var e,t,r=this.template,o=this.index,i=o,l=!1;(t=r.indexOf(n,o))>-1&&(o=t,92===r.charCodeAt(o-1));)l=!0,o++;return e=r.substring(i,o),this.index=o,l?e.replace(regexpEscapedChar[n],n):e}};var arr_pushMany;(function(){arr_pushMany=function(n,e){for(var t=n.length,r=e.length,o=-1;r>++o;)n[t+o]=e[o]}})();var obj_extend,obj_getProperty,obj_getPropertyEx,obj_toDictionary;(function(){function n(n,e,t,r){for(var o=n;r>t&&null!=o;)o=o[e[t]],t++;return o}obj_extend=function(n,e){null==n&&(n={});for(var t in e)n[t]=e[t];return n},obj_getProperty=function(n,e){if("."===e)return n;for(var t=n,r=e.split("."),o=-1,i=r.length;null!=t&&i>++o;)t=t[r[o]];return t},obj_getPropertyEx=function(e,t,r,o){if("."===e)return t;var i,l=e.split("."),s=t,u=-1,a=l.length,c=l[0];for("$c"===c?(s=o,u++):"$a"===c?(s=o&&o.attr,u++):"$u"===c?(s=customUtil_$utils,u++):"$ctx"===c&&(s=r,u++),i=u;null!=s&&a>++u;)s=s[l[u]];if(null==s&&-1===i)for(var f;null!=o;){if(f=o.scope,null!=f&&(s=n(f,l,0,a),null!=s))return s;o=o.parent}return s},obj_toDictionary=function(n){var e,t=[],r=0;for(e in n)t[r++]={key:e,value:n[e]};return t}})();var customUtil_register,customUtil_get,customUtil_$utils={};(function(){function n(n){return"parsed"!==n.arguments?fn_proxy(n.process||e,n):t(n.process)}function e(n,e,t,r,o,i,l){return"node"===l?(this.nodeRenderStart(n,e,t,r,o),this.node(n,e,t,r,o)):(this.attrRenderStart(n,e,t,r,o,i),this.attr(n,e,t,r,o,i))}function t(n){return function(e,t,r,o,i){var l=ExpressionUtil.evalStatements(e,t,r,i);return n.apply(null,l)}}customUtil_register=function(e,t){return is_Function(t)?(custom_Utils[e]=t,void 0):(custom_Utils[e]=n(t),"parsed"===t.arguments&&(customUtil_$utils[e]=t.process),void 0)},customUtil_get=function(n){return null!=n?custom_Utils[n]:custom_Utils}})();var custom_Utils={expression:function(n,e,t,r,o){return ExpressionUtil.eval(n,e,t,o)}},custom_Statements={},custom_Attributes={"class":null,id:null,style:null,name:null,type:null},custom_Tags={div:null,span:null,input:null,button:null,textarea:null,select:null,option:null,h1:null,h2:null,h3:null,h4:null,h5:null,h6:null,a:null,p:null,img:null,table:null,td:null,tr:null,pre:null,ul:null,li:null,ol:null,i:null,b:null,strong:null,form:null},custom_Tags_defs={},ExpressionUtil=function(){function n(n){for(var e,t,r=!1,o=39===n?"'":'"',i=u;(e=l.indexOf(o,u))>-1&&(u=e,92===l.charCodeAt(e-1));)r=!0,u++;return t=l.substring(i,u),r===!0&&(t=t.replace(regexpEscapedChar[o],o)),t}function e(){for(var n,e,t=u;;){if(n=l.charCodeAt(u),46===n){if(e===!0)return re("Unexpected punc"),null;e=!0}if(!((n>=48&&57>=n||46===n)&&a>u))break;u++}return+l.substring(t,u)}function t(){var e,t=u,r=l.charCodeAt(u);if(34===r||39===r)return u++,e=n(r),u++,e;for(;u!==a;)if(r=l.charCodeAt(u),36!==r){if(!(r>47&&58!==r&&60!==r&&61!==r&&62!==r&&63!==r&&124!==r))break;u++}else u++;return l.substring(t,u)}function r(n){if(null==n&&u===a)return null;switch(n){case 40:return N;case 41:return O;case 44:return T;case 46:return S;case 43:return d;case 45:return f;case 42:return h;case 47:return p;case 37:return m;case 61:return l.charCodeAt(++u)!==n?(re("Not supported (Apply directive) - view can only access model/controllers"),null):l.charCodeAt(u+1)===n?(u++,_):y;case 33:return 61===l.charCodeAt(u+1)?(u++,61===l.charCodeAt(u+1)?(u++,C):x):b;case 62:return 61===l.charCodeAt(u+1)?(u++,A):k;case 60:return 61===l.charCodeAt(u+1)?(u++,E):w;case 38:return l.charCodeAt(++u)!==n?(re("Single Binary Operator AND"),null):g;case 124:return l.charCodeAt(++u)!==n?(re("Single Binary Operator OR"),null):v;case 63:return D;case 58:return L}return n>=65&&90>=n||n>=97&&122>=n||95===n||36===n?$:n>=48&&57>=n?I:34===n||39===n?P:(re("Unexpected / Unsupported directive"),null)}function o(o){l=o,u=0,a=o.length,s=new z;var i,c,j=s,R=W;n:for(;;)if(a>u&&33>(i=l.charCodeAt(u)))u++;else{if(u>=a)break;if(c=r(i),null==c&&a>u)break;switch(c){case N:j=te(j,new G(j)),j=te(j,new z(j)),u++;continue;case O:var H=U;R===K&&(R=W,H=M);do j=j.parent;while(null!=j&&j.type!==H);if(H===U&&(j=j.parent),null==j){re("OutOfAst Exception - body closed");break n}u++;continue;case T:if(R!==K){R=W;do j=j.parent;while(null!=j&&j.type!==U);if(u++,null==j){re("Unexpected punctuation, comma");break n}continue}do j=j.parent;while(null!=j&&j.type!==M);if(null==j){re("OutOfAst Exception - next argument");break n}j=j.newArgument(),u++;continue;case D:s=new ne(s),j=s.case1,u++;continue;case L:j=s.case2,u++;continue;case S:i=l.charCodeAt(u+1),i>=48&&57>=i?c=I:(c=$,u++)}if(j.type===U&&(j=te(j,new G(j))),f!==c&&b!==c||null!=j.body)switch(c){case f:case d:case h:case p:case m:case g:case v:case y:case _:case x:case C:case k:case A:case w:case E:for(;j&&j.type!==F;)j=j.parent;if(null==j.body){re("Unexpected operator",j);break n}j.join=c;do j=j.parent;while(null!=j&&j.type!==U);null==j&&console.error("Unexpected parent",j),u++;continue;case P:case I:if(null!=j.body&&null==j.join){re("Directive Expected");break n}P===c&&(u++,te(j,new q(n(i))),u++),I===c&&te(j,new q(e(i)));continue;case $:var V=t();if("null"===V&&(V=null),"false"===V&&(V=!1),"true"===V&&(V=!0),"string"!=typeof V){te(j,new q(V));continue}for(;a>u&&(i=l.charCodeAt(u),33>i);)u++;if(40===i){R=K,u++;var B=te(j,new X(j,V));j=B.newArgument();continue}j=te(j,new Z(j,V))}else j=te(j,new Y(j,c)),u++}return null==j.body&&j.type===F&&re("Unexpected end of expression"),ee(s),s}function i(n,e,t,r){var l,s;if(null==n)return null;s="string"==typeof n?c.hasOwnProperty(n)===!0?c[n]:c[n]=o(n):n;var u,a,j,N=s.type;if(U===N){var O,T;n:for(u=0,j=s.body.length;j>u;u++)if(a=s.body[u],O=i(a,e,t,r),null!=T&&null!=T.join){if(T.join===g)if(l)l=O;else for(;j>u&&s.body[u].join!==v;u++);if(T.join===v){if(l)break n;if(O){l=O;break n}}switch(T.join){case f:l-=O;break;case d:l+=O;break;case p:l/=O;break;case h:l*=O;break;case m:l%=O;break;case x:l=l!=O;break;case C:l=l!==O;break;case y:l=l==O;break;case _:l=l===O;break;case k:l=l>O;break;case A:l=l>=O;break;case w:l=O>l;break;case E:l=O>=l}T=a}else T=a,l=O}if(F===N)return i(s.body,e,t,r);if(H===N)return s.body;if(R===N||M===N)return oe(s,e,t,r);if(V===N)switch(l=i(s.body,e,t,r),s.prefix){case f:l=-l;break;case b:l=!l}return B===N&&(l=i(s.body,e,t,r),l=i(l?s.case1:s.case2,e,t,r)),l}var l,s,u=0,a=0,c={},f="-",d="+",p="/",h="*",m="%",v="||",g="&&",b="!",y="==",_="===",x="!=",C="!==",k=">",A=">=",w="<",E="<=",j=".",N=20,O=21,T=22,S=23,D=24,L=25,$=30,P=31,I=32,U=1,F=2,R=3,M=4,H=6,V=9,B=10,W=1,K=2,Q={};Q[j]=1,Q[p]=2,Q[h]=2,Q[f]=3,Q[d]=3,Q[k]=4,Q[A]=4,Q[w]=4,Q[E]=4,Q[y]=5,Q[_]=5,Q[x]=5,Q[C]=5,Q[g]=6,Q[v]=6;var z,G,q,X,Z,J,Y,ne;(function(){z=function(n){this.parent=n,this.type=U,this.body=[],this.join=null},G=function(n){this.parent=n},G.prototype={constructor:G,type:F,join:null,body:null},q=function(n){this.type=H,this.body=n,this.join=null},X=function(n,e){this.parent=n,this.type=M,this.body=e,this.arguments=[],this.next=null},X.prototype={constructor:X,newArgument:function(){var n=new z(this);return this.arguments.push(n),n}},Z=function(n,e){this.parent=n,this.type=R,this.body=e,this.next=null},J=function(n,e){this.parent=n,this.body=e,this.next=null},Y=function(n,e){this.parent=n,this.prefix=e},Y.prototype={constructor:Y,type:V,body:null},ne=function(n){this.body=n,this.case1=new z(this),this.case2=new z(this)},ne.prototype={constructor:ne,type:B,case1:null,case2:null}})();var ee,te;(function(){function n(n){if(0===n.length)return null;var e=new z(n[0].parent);return e.join=n[n.length-1].join,e.body=n,e}te=function(n,e){null==n&&console.error("<Mask:Ast> Current undefined",e);var t=n.type;return U===t?(n.body.push(e),e):F===t||V===t?n.body=e:R===t||M===t?n.next=e:(console.error("Unsupported - append:",n,e),e)},ee=function(e){if(e.type!==U)return null!=e.body&&"object"==typeof e.body&&ee(e.body),void 0;for(var t,r,o,i=e.body,l=0,s=i.length;s>l;l++)ee(i[l]);for(l=1;s>l&&(t=i[l],r=i[l-1],!(Q[r.join]>Q[t.join]));l++);if(l!==s){for(o=[i[0]],l=1;s>l;l++){t=i[l],r=i[l-1];var u=Q[r.join];if(u>Q[t.join]&&s-1>l){for(var a,c,f=l;s>++l&&(a=i[l].join,null!=a)&&!(Q[a]>=u););c=i.slice(f,l+1),t=n(c),ee(t)}o.push(t)}e.body=o}}})();var re,oe;(function(){oe=function(n,e,t,r){var o,l,s,u,a,c=n,f=n.body;if("$c"===f){l=r;var d=c.next;null!=d&&d.type===M&&null==l[d.body]&&"function"==typeof Compo.prototype[d.body]&&(o=r,l=Compo.prototype[d.body],c=d)}else if("$a"===f)l=r&&r.attr;else if("$u"===f)l=customUtil_$utils;else if("$ctx"===f)l=t;else if(null!=e&&(o=e,l=e[f]),null==l)for(;null!=r&&(o=r.scope,null!=o&&(l=o[f]),null==l);)r=r.parent;if(null!=l)for(;;){if(c.type===M){for(s=[],u=-1,a=c.arguments.length;a>++u;)s[u]=i(c.arguments[u],e,t,r);l=l.apply(o,s)}if(null==l||null==c.next)break;if(c=c.next,f=c.body,o=l,l=l[f],null==l)break}return null==l&&(null==c||null!=c.next)&&re("Mask - Accessor error - ",f),l},re=function(n,e){console.error("Expression parser:",n,e,l.substring(u))}})();var ie=function(){function n(r){if(null==r)return null;var o,i;if(U===r.type)for(var l=0,u=r.body.length;u>l;l++)i=n(r.body[l]),o=e(o,i);if(R===r.type){for(var a=r.body,c=r.next;null!=c;){if(M===c.type)return n(c);if(R!==c.type)return console.error("Ast Exception: next should be a symbol/function ref"),null;a+="."+c.body,c=c.next}return a}switch(r.type){case F:case V:case B:i=n(r.body),o=e(o,i)}if(B===r.type&&(i=n(s.case1),o=e(o,i),i=n(s.case2),o=e(o,i)),M===r.type){for(var l=0,u=r.arguments.length;u>l;l++)i=n(r.arguments[l]),o=e(o,i);i=null;var f=r;n:for(;f=f.parent;)switch(f.type){case R:i=f.body+(null==i?"":"."+i);break;case U:case F:break n;default:i=null;break n}null!=i&&(o=e(o,i)),r.next&&(i=n(r.next),o=e(o,{accessor:t(r),ref:i}))}return o}function e(n,e){if(null==n)return e;if(null==e)return n;if(("object"!=typeof n||null==n.length)&&(n=[n]),"object"!=typeof e||null==e.length)return-1===n.indexOf(e)&&n.push(e),n;for(var t=0,r=e.length;r>t;t++)-1===n.indexOf(e[t])&&n.push(e[t]);return n}function t(n){var e=n;n:for(;e.parent;){switch(e.parent.type){case U:case F:break n}e=e.parent}return r(e,n.next)}function r(n,e){if(n===e||null==n)return null;if("object"!=typeof n)return n;if(null!=n.length&&"function"==typeof n.splice){for(var t=[],o=0,i=n.length;i>o;o++)t[o]=r(n[o],e);return t}var l={};for(var s in n)null!=n[s]&&"parent"!==s&&(l[s]=r(n[s],e));return l}return function(e){return"string"==typeof e&&(e=o(e)),n(e)}}();return{parse:o,eval:i,varRefs:ie,evalStatements:function(n,e,t,r){for(var l=o(n).body,s=[],u=l.length,a=-1;u>++a;)s[a]=i(l[a],e,t,r);return s}}}();(function(){function n(n,e,t,r){function o(n){return ExpressionUtil.eval(n,e,t,r)}if(o(n.expression))return n.nodes;for(;n=n.nextSibling,null!=n&&"else"===n.tagName;){var i=n.expression;if(null==i||""===i||o(i))return n.nodes}return null}custom_Statements["if"]={getNodes:n,render:function(e,t,r,o,i,l){var s=n(e,t,r,i);null!=s&&builder_build(s,t,r,o,i,l)}}})(),function(){function n(n,e,r,o){for(var i,l=-1,s=e.length,u=Array(s);s>++l;)i={},i[r]=e[l],o&&(i[o]=l),u[l]=t("for..of/item",n,i);return u}function e(n,e,r,o){var i,l,s,u=[],a=0;for(l in e)s=e[l],i={},i[r]=l,o&&(i[o]=s),u[a++]=t("for..in/item",n,i);return u}function t(n,e,t){return{type:Dom.COMPONENT,tagName:n,nodes:e,controller:{compoName:n,scope:t}}}function r(n){s=n,a=n.length,u=0;var e,t,r,f,d;if(d=o(),40===d&&(f=!0,u++,o()),e=i(),d=o(),44===d){if(f!==!0)return l("Parenthese must be used in multiple var declarion");u++,o(),t=i()}if(f){if(d=o(),41!==d)return l("Closing parenthese expected");u++}d=o();var r;return 105===d&&110===s.charCodeAt(++u)&&(r="in"),111===d&&102===s.charCodeAt(++u)&&(r="of"),null==r?l("Invalid FOR statement. (in|of) expected"):(c[0]=e,c[1]=t,c[2]=r,c[3]=s.substring(++u),c)}function o(){for(var n;a>u;u++)if(n=s.charCodeAt(u),!(33>n))return n;return-1}function i(){for(var n,e=u;a>u;u++)if(n=s.charCodeAt(u),n>48&&57>n){if(e===u)return l("Variable name begins with a digit")}else if(!(36===n||95===n||n>=97&&122>=n||n>=65&&90>=n))break;return e===u?l("Variable declaration expected"):s.substring(e,u)}function l(n){throw Error("<ForStatement parser> "+n+" `"+s.substring(u,20)+"`")}custom_Statements["for"]=function(t,o,i,l,s,u){r(t.expression);var a=c[0],f=c[1],d=c[2],p=c[3],h=ExpressionUtil.eval(p,o,i,s);if(null!=h){var m;if("of"===d){if(is_Array(h)===!1)return console.warn("<ForStatement> Value is not enumerable",p),void 0;m=n(t.nodes,h,a,f)}if("in"===d){if("object"!=typeof h)return console.warn("<ForStatement> Value is not an object",p),void 0;m=e(t.nodes,h,a,f)}builder_build(m,o,i,l,s,u)}};var s,u,a,c=["prop1","prop2","in|of","expression"]}(),function(){function n(n,e,t){return{compoName:n,attr:{},scope:{index:e},parent:t,nodes:null}}custom_Statements.each=function(e,t,r,o,i,l){var s=ExpressionUtil.eval(e.expression,t,r,i);if(null!=s)for(var u,a=s.length,c=-1,f=e.nodes;a>++c;)u=n("each::item",c,i),builder_build(f,s[c],r,o,u,l)}}(),custom_Statements["with"]=function(n,e,t,r,o,i){var l=ExpressionUtil.eval(n.expression,e,t,o);builder_build(n.nodes,l,t,r,o,i)},custom_Statements["switch"]=function(n,e,t,r,o,i){var l=ExpressionUtil.eval,s=l(n.expression,e,t,o),u=n.nodes;if(null!=u){for(var a,c,f,d,p=u.length,h=-1;p>++h;)if(a=u[h],"default"!==a.tagName)if("case"===a.tagName)if(c=a.expression){if(l(c,e,t,o)==s){//! `==` comparison
f=a;break}}else console.warn("<mask:switch:case> Expression expected");else console.warn("<mask:switch> Case expected",a.tagName);else d=a;null==f&&(f=d),null!=f&&builder_build(f.nodes,e,t,r,o,i)}},function(){function n(n){this.parent=n,this.compoName="include",this.components=[],this.templates=null}custom_Statements.include=function(e,t,r,o,i,l){for(var s,u=ExpressionUtil.evalStatements(e.expression);null!=i&&(s=i.resource,null==s);)i=i.parent;var a=new n(i),c=Compo.pause(a,r);include.instance(s&&s.url).load.apply(s,u).done(function(n){a.templates=n.load,builder_build(e.nodes,t,r,o,a,l),c()})}}(),custom_Statements["import"]=function(n,e,t,r,o,i){var l=n.expression,s=ExpressionUtil.evalStatements(l,e,t,o),u=s[0];if("string"!=typeof u)return console.error("<mask:import> Invalid argument",l);for(;"include"!=o.compoName&&(o=o.parent,null!=o););if(null!=o){var a=o.templates[u];null!=a&&builder_build(Parser.parse(a),e,t,r,o,i)}};var Dom;(function(){function n(n){if(null==this.nodes)return this.nodes=[n],void 0;this.nodes.push(n);var e=this.nodes[this.nodes.length-2];e.nextSibling=n}function e(n,e){this.type=Dom.NODE,this.tagName=n,this.parent=e,this.attr={}}function t(n,e){this.content=n,this.parent=e}function r(n,e,t){this.tagName=n,this.parent=e,this.controller=t,this.attr={}}function o(){}var i=1,l=2,s=3,u=4,a=9,c=10,f=15;e.prototype={constructor:e,type:i,tagName:null,parent:null,attr:null,nodes:null,expression:null,appendChild:n,__single:null},t.prototype={type:l,content:null,parent:null},r.prototype={constructor:r,type:u,parent:null,attr:null,controller:null,nodes:null,components:null,model:null,modelRef:null},o.prototype={constructor:o,type:s,nodes:null,appendChild:n},Dom={NODE:i,TEXTNODE:l,FRAGMENT:s,COMPONENT:u,CONTROLLER:a,SET:c,STATEMENT:f,Node:e,TextNode:t,Fragment:o,Component:r}})();var parser_parse,parser_ensureTemplateFunction,parser_setInterpolationQuotes,parser_cleanObject,Parser;(function(n,e,t){function r(n){for(var e=-1;-1!==(e=n.indexOf(s,e))&&n.charCodeAt(e+1)!==f;)e++;if(-1===e)return n;for(var t,r=[],o=0,i=0;t=n.indexOf(a,e+2),-1!==t;){for(r[i++]=o===e?"":n.substring(o,e),r[i++]=n.substring(e+2,t),o=e=t+1;-1!==(e=n.indexOf(s,e))&&n.charCodeAt(e+1)!==f;)e++;if(-1===e)break}return n.length>o&&(r[i]=n.substring(o)),n=null,function(n,e,t,o,i,l){if(null==n){for(var c,f="",d=r.length,p=-1;d>++p;)c=r[p],f+=1===p%2?s+u+c+a:c;return f}return util_interpolate(r,n,e,t,o,i,l)}}function o(n,e,t,r){var o={2:"tag",3:"tag",5:"attribute key",6:"attribute value",8:"literal"}[t],i=n.substring(0,e).split("\n"),l=i.length,s=i[l-1].length,u=["Mask - Unexpected:",r,"at(",l,":",s,") [ in",o,"]"];console.error(u.join(" "),{stopped:n.substring(e),template:n})}var i,l,s="~",u="[",a="]",c=126,f=91,d=93;(function(){i=function(n,e,t,r,i){for(var s,u=0;t>e;e++)if(s=n.charCodeAt(e),34!==s)if(s!==r){if(s===i&&-1===--u)return e}else u++;else e=l(n,e+1,t,'"');return o(n,e,null,"Not closed brackets `"+String.fromCharCode(r)+"`"),e},l=function(n,e,t,r){for(var o;-1!==(o=n.indexOf(r,e))&&(e=o,92===n.charCodeAt(o-1));)e++;return e}})();var p=2,h=3,m=5,v=6,g=7,b=8,y=9;Parser={parse:function(o){for(var l,s,u,a,_,x,C,k,A=new t,w=A,E=p,j=h,N=0,O=o.length;;)if(O>N&&33>(x=o.charCodeAt(N)))N++;else{if(47===x){if(k=o.charCodeAt(N+1),47===k){for(N++;10!==x&&13!==x&&O>N;)x=o.charCodeAt(++N);continue}if(42===k){N=o.indexOf("*/",N+2)+2,1===N&&(N=O);continue}}if(j===m&&(null!=l&&(A.attr["class"]=r(l),l=null),null!=u&&(A.attr[u]=u,u=null,s=null)),null!=s){if(E===m)null==u?u=s:a=s,null!=u&&null!=a&&("class"!==u?A.attr[u]=a:l=null==l?a:l+" "+a,u=null,a=null);else if(j===h)_=new n(s,A),A.appendChild(_),A=_,E=m;else if(j===b){if(_=new e(s,A),A.appendChild(_),A.__single===!0)do A=A.parent;while(null!=A&&null!=A.__single);E=p}s=null}if(N>=O){E===m&&(null!=l&&(A.attr["class"]=r(l)),null!=u&&(A.attr[u]=u));break}if(E===y){for(A=A.parent;null!=A&&null!=A.__single;)A=A.parent;E=p}switch(x){case 123:j=E,E=p,N++;continue;case 62:j=E,E=p,N++,A.__single=!0;continue;case 59:if(null!=A.nodes){N++;continue}case 125:N++,j=E,E=y;continue;case 39:case 34:E===v?E=m:j=E=b,N++;var T,S=!1,D=!1,L=39===x?"'":'"';for(C=N;(T=o.indexOf(L,N))>-1&&(N=T,92===o.charCodeAt(T-1));)S=!0,N++;C===N&&(k=o.charCodeAt(N+1),(124===k||k===x)&&(D=!0,C=N+2,N=T=o.indexOf((124===k?"|":L)+L+L,C),-1===N&&(N=O))),s=o.substring(C,N),S===!0&&(s=s.replace(regexpEscapedChar[L],L)),s=r(s),N+=D?3:1;continue}if(E===p){if(j=h,E=h,46===x||35===x){s="div";continue}}else if(E===m)if(46===x)N++,u="class",E=g;else if(35===x)N++,u="id",E=g;else{if(61===x){N++,E=v;continue}if(40===x){C=1+N,N=1+i(o,C,O,x,41),A.expression=o.substring(C,N-1),A.type=Dom.STATEMENT;continue}if(null!=u){s=u;continue}}(E===v||E===g)&&(j=E,E=m);var $=null;for(C=N;O>N;){if(x=o.charCodeAt(N),x===c&&o.charCodeAt(N+1)===f){$=!0,++N;do x=o.charCodeAt(++N);while(x!==d&&O>N)}if(j!==v&&(46===x||35===x))break;if(61===x||62===x||123===x||33>x||59===x||40===x)break;N++}s=o.substring(C,N),$===!0&&(E===m&&"class"===u)==!1&&(s=r(s))}return null!=w.nodes&&1===w.nodes.length?w.nodes[0]:w},cleanObject:function(n){if(n instanceof Array){for(var e=0;n.length>e;e++)this.cleanObject(n[e]);return n}return delete n.parent,delete n.__single,null!=n.nodes&&this.cleanObject(n.nodes),n},setInterpolationQuotes:function(n,e){return n&&2===n.length?e&&1===e.length?(c=n.charCodeAt(0),f=n.charCodeAt(1),d=e.charCodeAt(0),s=n[0],u=n[1],a=e,void 0):(console.error("Interpolation End must be of 1 Character"),void 0):(console.error("Interpolation Start must contain 2 Characters"),void 0)},ensureTemplateFunction:r},parser_parse=Parser.parse,parser_ensureTemplateFunction=Parser.ensureTemplateFunction,parser_cleanObject=Parser.cleanObject,parser_setInterpolationQuotes=Parser.setInterpolationQuotes})(Dom.Node,Dom.TextNode,Dom.Fragment,Dom.Component);var builder_componentID=0,builder_build;(function(n,e,t){function r(n){if(null!=listeners&&null!=listeners[n])for(var e=listeners.compoCreated,t=e.length,r=-1,o=_Array_slice.call(arguments,1);t>++r;)e[r].apply(null,o)}function o(n,e,t,r,o){var l=r.appendChild(document.createComment(""));return function(){return i(n,e,t,l,o)}}function i(e,t,r,o,i){null!=e.tagName&&e.tagName!==e.compoName&&(e.nodes={tagName:e.tagName,attr:e.attr,nodes:e.nodes,type:1}),null!=e.model&&(t=e.model);var l=e.nodes,s=[];if(null!=l){for(var u=l instanceof Array,a=u===!0?l.length:1,c=0,f=null,d=document.createDocumentFragment();a>c;c++)f=u===!0?l[c]:l,builder_build(f,t,r,d,e,s);o.parentNode.insertBefore(d,o)}if(null==e.tagName){var p,h,m=e.handlers&&e.handlers.attr;for(h in e.attr)p=null,m&&is_Function(m[h])&&(p=m[h]),null==p&&is_Function(n[h])&&(p=n[h]),null!=p&&p(node,e.attr[h],t,r,s[0],e)}if(is_Function(e.renderEnd))try{e.renderEnd(s,t,r,o.parentNode)}catch(v){console.error("Custom Tag Handler:",e.tagName,v)}if(null!=i&&i!==s){var g=i.length,b=s.length;for(j=-1;b>++j;)i[g+j]=s[j]}}function l(n,e){return null==n.components?(n.components=[e],void 0):(n.components.push(e),void 0)}var s,u=function(){var n=function(n){return function(e,t){e.appendChild(n.createTextNode(t))}}(document);return function(e,t,r,o,i){var l=e.content;if(is_Function(l)){var s=l("node",t,r,o,i);if("string"==typeof s)return n(o,s),void 0;for(var u,a="",c=s.length,f=0;c>f;f++)if(u=s[f],"object"!=typeof u)a+=u;else{if(""!==a&&(n(o,a),a=""),null==u.nodeType){a+=""+u;continue}o.appendChild(u)}return""!==a&&n(o,a),void 0}n(o,l)}}(),a=function(){var e=function(n){return function(e){return n.createElement(e)}}(document);return function(t,r,o,i,l,s){var u=t.tagName,a=t.attr,c=e(u);if(null!=c){null!=s&&(s.push(c),a["x-compo-id"]=l.ID),null!=i&&i.appendChild(c);var f,d;for(f in a)hasOwnProp.call(a,f)!==!1&&(is_Function(a[f])?(d=a[f]("attr",r,o,c,l,f),d instanceof Array&&(d=d.join(""))):d=a[f],d&&(is_Function(n[f])?n[f](t,d,r,o,c,l,i):c.setAttribute(f,d)));return c}}}();(function(){function n(n,e,t,i,s,u,a){var c,f;n.compoName=e.tagName,n.attr=c=attr_extend(n.attr,e.attr),n.parent=u,n.ID=++builder_componentID,null==n.model&&(n.model=t),null==n.nodes&&(n.nodes=e.nodes);for(f in c)"function"==typeof c[f]&&(c[f]=c[f]("attr",t,i,s,u,f));return null!=listeners&&r("compoCreated",n,t,i,s),"function"==typeof n.renderStart&&n.renderStart(t,i,s),l(u,n),n.async===!0?(n.await(o(n,t,i,s,a)),null):(null!=n.tagName&&(n.nodes={tagName:n.tagName,attr:n.attr,nodes:n.nodes,type:1}),"function"==typeof n.render?(n.render(n.model,i,s),null):n)}function t(n,e,t,r,o,i,s){var u,a,c=n;for(var f in e)c[f]=e[f];var d=c.attr;if(null!=d)for(var f in d)"function"==typeof d[f]&&(d[f]=d[f]("attr",t,r,o,i,f));return is_Function(c.renderStart)&&c.renderStart(t,r,o,i,s),is_Function(c.render)===!1?c:(u=c.render(t,r,o,i,s),is_Function(c.renderEnd)&&(a=c.renderEnd(u,t,r,o,i),null!=a&&l(i,a)),null)}function i(n,e,t,r,o,i){n.ID=++builder_componentID,l(o,n),null==n.model&&(n.model=e);var s=n.elements=[];return builder_build(n.nodes,n.model,t,r,n,s),null!=i&&0!==s.length&&arr_pushMany(i,s),null}s=function(r,o,l,s,u,a){var c,f=r.tagName;if(null!=r.controller&&(c=r.controller),null==c&&(c=e[f]),null==c)return i(r,o,l,s,u,a);var d,p=!1;"function"==typeof c?d=new c(o):(d=c,p=!0);var h=p?t:n;return h(d,r,o,l,s,u,a)}})(),builder_build=function(r,o,i,l,c,f){if(null==r)return l;var d,p,h,m,v=r.type;if(null==c&&(c=new t),null==v&&(r instanceof Array?v=10:null!=r.tagName?v=1:null!=r.content&&(v=2)),1==v&&null!=e[r.tagName]&&(v=4),null==l&&1!==v&&(l=document.createDocumentFragment()),10===v){for(h=0,m=r.length;m>h;h++)builder_build(r[h],o,i,l,c,f);return l}if(15===v){var g=custom_Statements[r.tagName];if(null==g){if(null==e[r.tagName])return console.error("<mask: statement is undefined",r.tagName),l;v=4}if(15===v)return is_Function(g)?g(r,o,i,l,c,f):is_Function(g.render)?g.render(r,o,i,l,c,f):console.error("<mask:build> Invalid Statement Handler",g),l}if(1===v){if("else"===r.tagName)return l;l=a(r,o,i,l,c,f),f=null}if(2===v)return u(r,o,i,l,c),l;if(4===v){if(c=s(r,o,i,l,c,f),null==c)return l;d=[],r=c,c.model!==o&&null!=c.model&&(o=c.model)}var b=r.nodes;if(null!=b){null!=f&&null==d&&(d=f);for(var y=b instanceof Array,_=y===!0?b.length:1,x=0,C=null;_>x;x++)C=y===!0?b[x]:b,builder_build(C,o,i,l,c,d)}if(4===v){if(null==r.tagName&&"%"!==r.compoName){var k,A,p,w=r.handlers&&r.handlers.attr;for(p in r.attr)A=r.attr[p],null!=A&&(k=null,null!=w&&is_Function(w[p])&&(k=w[p]),null==k&&null!=n[p]&&(k=n[p]),null!=k&&k(r,A,o,i,d[0],c))}is_Function(r.renderEnd)&&r.renderEnd(d,o,i,l)}return null!=f&&f!==d&&arr_pushMany(f,d),l}})(custom_Attributes,custom_Tags,Dom.Component);var cache={},Mask={render:function(n,e,t,r,o){return"string"==typeof n&&(n=hasOwnProp.call(cache,n)?cache[n]:cache[n]=parser_parse(n)),null==t&&(t={}),builder_build(n,e,t,r,o)},compile:parser_parse,parse:parser_parse,build:builder_build,registerHandler:function(n,e){custom_Tags[n]=e},getHandler:function(n){return null!=n?custom_Tags[n]:custom_Tags},registerStatement:function(n,e){custom_Statements[n]=is_Function(e)?{render:e}:e},getStatement:function(n){return null!=n?custom_Statements[n]:custom_Statements},registerAttrHandler:function(n,e,t){is_Function(e)&&(t=e),custom_Attributes[n]=t},getAttrHandler:function(n){return null!=n?custom_Attributes[n]:custom_Attributes},registerUtil:customUtil_register,getUtil:customUtil_get,$utils:customUtil_$utils,registerUtility:function(n,e){this.registerUtility=this.registerUtil,this.registerUtility(n,e)},getUtility:function(){return this.getUtility=this.getUtil,this.getUtility()},clearCache:function(n){"string"==typeof n?delete cache[n]:cache={}},Utils:{Expression:ExpressionUtil,getProperty:obj_getProperty,ensureTmplFn:Parser.ensureTemplateFunction},Dom:Dom,plugin:function(source){eval(source)},on:function(n,e){null==listeners&&(listeners={}),(listeners[n]||(listeners[n]=[])).push(e)},delegateReload:function(){},setInterpolationQuotes:Parser.setInterpolationQuotes,setCompoIndex:function(n){builder_componentID=n},cfg:function(){var n=arguments;if(0===n.length)return __cfg;var e;if(2===n.length)return e=n[0],__cfg[e]=n[1],void 0;var t=n[0];if("object"==typeof t)for(e in t)__cfg[e]=t[e]}};Mask.renderDom=Mask.render,function(n){var e;(function(){function t(n){for(var e="";n--;)e+=" ";return e}function r(n,e,r){var i,l;null==e&&(e=0),null==r&&(i=!0,r=[]);var s=r.length;if(n.type===d.FRAGMENT&&(n=n.nodes),n instanceof Array)for(l=0;n.length>l;l++)o(n[l],e,r);else o(n,e,r);var u=t(e);for(l=s;r.length>l;l++)r[l]=u+r[l];return i?r.join(0===f?"":"\n"):void 0}function o(n,e,t){if("string"==typeof n.content)return t.push(a(n.content)),void 0;if("function"==typeof n.content)return t.push(a(n.content())),void 0;if(l(n))return t.push(i(n)+";"),void 0;if(s(n)){var o=c?">":" > ";return t.push(i(n)+o),r(u(n),f,t),void 0}t.push(i(n)+"{"),r(n.nodes,f,t),t.push("}")}function i(n){var e=n.tagName,t=n.attr.id||"",r=n.attr["class"]||"";"function"==typeof t&&(t=t()),"function"==typeof r&&(r=r()),t&&(t=-1!==t.indexOf(" ")?"":"#"+t),r&&(r="."+r.split(" ").join("."));var o="";for(var i in n.attr)if("id"!==i&&"class"!==i){var l=n.attr[i];"function"==typeof l&&(l=l()),(c===!1||/[^\w_$\-\.]/.test(l))&&(l=a(l)),o+=" "+i,i!==l&&(o+="="+l)}"div"===e&&(t||r)&&(e="");var s="";return n.expression&&(s="("+n.expression+")"),e+t+r+o+s}function l(n){return null==n.nodes||n.nodes instanceof Array&&0===n.nodes.length}function s(n){return n.nodes&&(n.nodes instanceof Array==!1||1===n.nodes.length)}function u(n){return n.nodes instanceof Array?n.nodes[0]:n.nodes}function a(n){return-1===n.indexOf("'")?"'"+n.trim()+"'":-1===n.indexOf('"')?'"'+n.trim()+'"':'"'+n.replace(/"/g,'\\"').trim()+'"'}e=function(e,t){return null==e?"":("string"==typeof e&&(e=n.parse(e)),null==t?(f=0,c=!0):"number"==typeof t?(f=t,c=0===f):(f=t&&t.indent||4,c=0===f||t&&t.minimizeAttributes),r(e))};var c,f,d=n.Dom})(),n.stringify=e}(Mask),function(n){function e(){this.attr={"debugger":null,use:null,repeat:null,"if":null,"else":null,each:null,log:null,visible:null,model:null},this.model=null,this.modelRef=null,this.nodes=null,this.parent=null,this.container=null,this.template=null}function t(n,e,t,r){null==n.nodes&&Compo.ensureTemplate(n);var l=n.attr.each||n.attr.foreach,s=obj_getPropertyEx(l,e,t,n),u=n.nodes;if(n.nodes=null,null!=s){"number"!=typeof s.length&&(s=obj_toDictionary(s)),n.nodes=[],n.model=s,n.modelRef=l,n.template=u,n.container=r;var a=s.length,c=-1;if(null!=a){for(;a>++c;)n.nodes[c]=o("%.each.item",u,s[c],c,r,n);n.append=i.append}}}function r(n,e,t,r){var i=n.attr.repeat.split(".."),l=(+i[0],+i[1]),s=n.nodes;n.nodes=[];for(var u=-1;l>++u;)n.nodes[u]=o("%.repeat.item",s,e,u,r,n)}function o(n,e,t,r,o,i){return{type:Dom.COMPONENT,compoName:n,attr:{},nodes:e,model:t,container:o,parent:i,index:r}}n.registerHandler("%",e),e.prototype={renderStart:function(n,e,o){var i=this.attr;if(null!=i.each||null!=i.foreach)return t(this,n,e,o),void 0;if(null!=i["if"])return this.state=ExpressionUtil.eval(i["if"],n,e,this.parent),this.state||(this.nodes=null),void 0;if(null!=i["else"]){var l=this.parent.components,s=l&&l[l.length-1];return null!=s&&"%"===s.compoName&&null!=s.attr["if"]?(s.state&&(this.nodes=null),void 0):(console.error("Previous Node should be \"% if='condition'\"",s,this.parent),void 0)}if(null!=i.use){var u=i.use;return this.model=obj_getProperty(n,u),this.modelRef=u,void 0}if(null==i["debugger"]){if(null!=i.visible){var a=ExpressionUtil.eval(i.visible,n,e,this.parent);return a||(this.nodes=null),void 0}if(null!=i.log){var c=i.log,f=obj_getProperty(n,c);return console.log("Key: %s, Value: %s",c,f),void 0}null!=i.repeat&&r(this,n,e,o)}},render:null,renderEnd:null,append:null};var i={append:function(e){var t=new Component;t.nodes=this.template,t.model=e,n.render(t,e,null,this.container,this)}}}(Mask),function(n){function e(){}function t(){}function r(){}var o={};n.templates=o,n.registerHandler(":template",e),e.prototype.render=function(){return null==this.attr.id?(console.warn("Template Should be defined with ID attribute for future lookup"),void 0):(o[this.attr.id]=this.nodes,void 0)},n.registerHandler(":import",t),t.prototype={constructor:t,attr:null,template:null,renderStart:function(){if(this.attr.id){if(this.nodes=this.template,null==this.nodes&&(this.nodes=o[this.attr.id]),null==this.nodes){for(var n,e=this,t=":template[id="+this.attr.id+"]";null==n&&null!=(e=e.parent);)null!=e.nodes&&(n=jmask(e.nodes).filter(t).get(0));null!=n&&(this.nodes=n.nodes)}null==this.nodes&&console.warn("Template could be not imported",this.attr.id)}}},n.registerHandler(":html",r),r.prototype={mode:"server:all",render:function(n,e,t){var r=jmask(this.nodes).text(n,e,this);return r?t.insertAdjacentHTML?(t.insertAdjacentHTML("beforeend",r),void 0):(this.toHtml=function(){return r},void 0):(console.warn("No HTML for node",this),void 0)}}}(Mask);var Compo=exports.Compo=function(mask){function _mask_ensureTmplFn(n){return"string"!=typeof n?n:_mask_ensureTmplFnOrig(n)}function is_Function(n){return"function"==typeof n}function is_Object(n){return null!=n&&"object"==typeof n}function is_Array(n){return null!=n&&"object"==typeof n&&"number"==typeof n.length&&"function"==typeof n.splice}function is_String(n){return"string"==typeof n}function is_notEmptyString(n){return"string"==typeof n&&""!==n}function is_rawObject(n){return null==n?!1:"object"!=typeof n?!1:n.constructor===Object}function domLib_initialize(){null!=domLib&&null!=domLib.fn&&(domLib.fn.compo=function(n){if(0===this.length)return null;var e=Anchor.resolveCompo(this[0]);return null==n?e:find_findSingle(e,selector_parse(n,Dom.CONTROLLER,"up"))},domLib.fn.model=function(n){var e=this.compo(n);if(null==e)return null;for(var t=e.model;null==t&&e.parent;)e=e.parent,t=e.model;return t},function(){var n=["append","prepend","before","after"];arr_each(["appendMask","prependMask","beforeMask","afterMask"],function(e,t){domLib.fn[e]=function(e,r,o,i){if(0===this.length)return this;this.length>1,null==o&&(o=2>t?this.compo():this.parent().compo()),null==o&&(o={}),null==o.components&&(o.components=[]);for(var l=o.components,s=l.length,u=mask.render(e,r,i,null,o),a=this[n[t]](u),c=l.length;c>s;s++)Compo.signal.emitIn(l[s],"domInsert");return a}})}(),function(){function n(n,e){node_tryDispose(e)}function e(n,e){node_tryDisposeChildren(e)}var t=domLib.fn.remove,r=domLib.fn.empty;domLib.fn.removeAndDispose=function(){return this.each(n),t.call(this)},domLib.fn.emptyAndDispose=function(){return this.each(e),r.call(this)}}())}function SlotHandler(){}var Dom=mask.Dom,_array_slice=Array.prototype.slice,_Array_splice=Array.prototype.splice,_Array_indexOf=Array.prototype.indexOf,_mask_ensureTmplFnOrig=mask.Utils.ensureTmplFn,domLib,Class;(function(){function n(){for(var n,t,r,o=arguments,i=e.length;--i>-1;)if(n=e[i],null!=n)for(r=o.length;--r>-1;)if(t=n[o[r]],null!=t)return t}var e=[global.atma,exports,global];domLib=n("jQuery","Zepto","$"),Class=n("Class")})(),Array.prototype.indexOf||(Array.prototype.indexOf=function(n){for(var e=0,t=this.length;t>e;e++)if(this[e]===n)return e;return-1});var obj_extend,obj_copy;(function(){obj_extend=function(n,e){if(null==n&&(n={}),null==e)return n;for(var t in e)n[t]=e[t];return n},obj_copy=function(n){var e,t={};for(e in n)t[e]=n[e];return t}})();var arr_each,arr_remove;(function(){arr_each=function(n,e){for(var t=n.length,r=-1;t>++r;)e(n[r],r)},arr_remove=function(n,e){if(null==n)return console.error("Can not remove myself from parent",e),void 0;var t=n.indexOf(e);return-1===t?(console.error("Can not remove myself from parent",e,t),void 0):(n.splice(t,1),void 0)}})();var fn_proxy,fn_apply;(function(){fn_proxy=function(n,e){return function(){return fn_apply(n,e,arguments)}},fn_apply=function(n,e,t){switch(t.length){case 0:return n.call(e);case 1:return n.call(e,t[0]);case 2:return n.call(e,t[0],t[1]);case 3:return n.call(e,t[0],t[1],t[2]);case 4:return n.call(e,t[0],t[1],t[2],t[3])}return n.apply(e,t)}})();var selector_parse,selector_match;(function(){function n(n){return function(t){return e(t,n)}}function e(n,t,r){if("string"!=typeof n)return!1;if(null==r&&(r=0),r=n.indexOf(t,r),-1===r)return!1;if(r>0&&n.charCodeAt(r-1)>32)return e(n,t,r+1);var o=n.length,i=t.length;return o-i>r&&n.charCodeAt(r+i)>32?e(n,t,r+1):!0}selector_parse=function(e,t,r){if(null==e&&console.error("<compo>selector is undefined",t),"object"==typeof e)return e;var o,i,l;if(null==o)switch(e[0]){case"#":o="id",e=e.substring(1),i="attr";break;case".":o="class",e=n(e.substring(1)),i="attr";break;default:o=t===Dom.SET?"tagName":"compoName"}return l="up"===r?"parent":t===Dom.SET?"nodes":"components",{key:o,prop:i,selector:e,nextKey:l}},selector_match=function(n,e,t){is_String(e)&&(null==t&&(t=Dom[n.compoName?"CONTROLLER":"SET"]),e=selector_parse(e,t));var r=e.prop?n[e.prop]:n;return null==r?!1:is_Function(e.selector)?e.selector(r[e.key]):null!=e.selector.test?e.selector.test(r[e.key]):r[e.key]==e.selector}})();var find_findSingle;(function(){find_findSingle=function(n,e){if(is_Array(n)){for(var t,r=n.length,o=-1;r>++o;)if(t=find_findSingle(n[o],e),null!=t)return t;return null}return selector_match(n,e)?n:(n=n[e.nextKey],null==n?null:find_findSingle(n,e))}})();var dom_addEventListener,node_tryDispose,node_tryDisposeChildren;(function(){dom_addEventListener=function(n,e,t){return null!=EventDecorator&&(e=EventDecorator(e)),null!=domLib?domLib(n).on(e,t):null!=n.addEventListener?n.addEventListener(e,t,!1):(n.attachEvent&&n.attachEvent("on"+e,t),void 0)},node_tryDispose=function(n){if(n.hasAttribute("x-compo-id")){var e=n.getAttribute("x-compo-id"),t=Anchor.getByID(e);if(t){if(null==t.$||1===t.$.length)return compo_dispose(t),compo_detachChild(t),void 0;var r=_Array_indexOf.call(t.$,n);-1!==r&&_Array_splice.call(t.$,r,1)}}node_tryDisposeChildren(n)},node_tryDisposeChildren=function(n){for(var e=n.firstChild;null!=e;)1===e.nodeType&&node_tryDispose(e),e=e.nextSibling}})();var domLib_find,domLib_on;(function(){domLib_find=function(n,e){return n.filter(e).add(n.find(e))},domLib_on=function(n,e,t,r){return null==t?n.on(e,r):(n.on(e,t,r).filter(t).on(e,r),n)}})();var Children_={select:function(n,e){for(var t in e){var r=e[t],o=null,i=null;if(r instanceof Array&&(i=r[0],o=r.splice(1)),"string"==typeof r&&(i=r),null==r||null==i)return console.error("Unknown component child",t,e[t]),console.warn("Is this object shared within multiple compo classes? Define it in constructor!"),void 0;var l=i.indexOf(":"),s=i.substring(0,l);s=Compo.config.selectors[s],null==s?n.compos[t]=n.$[0].querySelector(i):(i=i.substring(++l).trim(),n.compos[t]=s(n,i));var u=n.compos[t];null!=o&&(null!=u.$&&(u=u.$),Events_.on(n,o,u))}}},Events_={on:function(n,e,t){null==t&&(t=n.$);for(var r,o=e instanceof Array,i=o?e.length:1,l=0;o?i>l:1>l;l++)if(r=o?e[l]:e,r instanceof Array)null!=EventDecorator&&(r[0]=EventDecorator(r[0])),t.on.apply(t,r);else for(var s in r){var u,a,c="string"==typeof r[s]?n[r[s]]:r[s],f=s.indexOf(":");-1!==f?(u=s.substring(0,f),a=s.substring(f+1).trim()):u=s,null!=EventDecorator&&(u=EventDecorator(u)),domLib_on(t,u,a,fn_proxy(c,n))}}},EventDecorator=null,EventDecos=function(){var n=function(){if(null==document)return!1;if("createTouch"in document)return!0;try{return!!document.createEvent("TouchEvent").initTouchEvent}catch(n){return!1}}();return{touch:function(e){return n===!1?e:"click"===e?"touchend":"mousedown"===e?"touchstart":"mouseup"===e?"touchend":"mousemove"===e?"touchmove":e}}}(),Pipes=function(){function n(n,e){return function(t){new i(n).emit(e,t)}}function e(n,e){return null==e.pipes[n]?(console.error("Controller has no pipes to be added to collection",n,e),void 0):(null==l[n]&&(l[n]=[]),l[n].push(e),void 0)}function t(n,e){for(var t=l[n],r=t.length;--r>-1;)t[r]===e&&t.splice(r,1)}function r(){var n=this,e=n.pipes;for(var r in e)t(r,n)}function o(n){var t=n.pipes;for(var o in t)e(o,n);Compo.attachDisposer(n,r.bind(n))}function i(n){return this instanceof i==!1?new i(n):(this.pipeName=n,this)}var l={};return mask.registerAttrHandler("x-pipe-signal","client",function(e,t,r,o,i){for(var l,s=t.split(";"),u=s.length,a=-1;u>++a;)if(l=s[a].trim(),""!==l){var c,f,d=l.indexOf(":"),p=l.substring(0,d),h=l.substring(d+1).trim(),m=h.indexOf(".");if(-1===m)return console.error('define pipeName "click: pipeName.pipeSignal"'),void 0;c=h.substring(0,m),f=h.substring(++m);var v=n(c,f);dom_addEventListener(i,p,v)}}),i.prototype={constructor:i,emit:function(n){var e,t=l[this.pipeName],r=this.pipeName;if(null!=t){2===arguments.length&&is_Array(arguments[1])?e=arguments[1]:arguments.length>1&&(e=_array_slice.call(arguments,1));for(var o,i,s,u,a=t.length;-1!==--a;)o=t[a],i=o.pipes[r],null!=i&&(s=i[n],is_Function(s)&&(s.apply(o,e),u=!0))}}},i.addController=o,i.removeController=r,{addController:o,removeController:r,pipe:i}}(),Anchor=function(){var n={};return{create:function(e){return null==e.ID?(console.warn("Component should have an ID"),void 0):(n[e.ID]=e,void 0)},resolveCompo:function(e){if(null==e)return null;var t,r,o;do{if(r=e.getAttribute("x-compo-id"),r&&(null==t&&(t=r),o=n[r],null!=o&&(o=Compo.find(o,{key:"ID",selector:t,nextKey:"components"}),null!=o)))return o;e=e.parentNode}while(e&&1===e.nodeType);return null},removeCompo:function(e){null!=e.ID&&delete n[e.ID]},getByID:function(e){return n[e]}}}(),Compo=function(){function Compo(n){if(this instanceof Compo)return null;var e;if(null==n&&(n={}),hasInclude&&global.include&&(n.__resource=global.include.url),null!=n.attr)for(var t in n.attr)n.attr[t]=_mask_ensureTmplFn(n.attr[t]);var r=n.slots;if(null!=r)for(var t in r)"string"==typeof r[t]&&(r[t]=n[r[t]]);n.hasOwnProperty("constructor")&&(e=n.constructor),e=compo_createConstructor(e,n),null==e&&(e=function(){});for(var t in Proto)null==n[t]&&(n[t]=Proto[t]);return e.prototype=n,n=null,e}var hasInclude=!!(global.include||void 0!==global.atma&&global.atma.include||void 0!==exports&&exports.include),compo_dispose,compo_detachChild,compo_ensureTemplate,compo_attachDisposer,compo_createConstructor;(function(){compo_dispose=function(n){null!=n.dispose&&n.dispose(),Anchor.removeCompo(n);for(var e=n.components,t=e&&e.length||0;--t>-1;)compo_dispose(e[t])},compo_detachChild=function(n){var e=n.parent;if(null!=e){var t,r=n.$,o=e.$||e.elements;if(o&&r){var i,l,s=r.length;for(t=o.length;--t>-1;)for(i=o[t],l=s;--l>-1;)if(i===r[l]){o.splice(t,1);break}}var u=e.components;if(null!=u){for(t=u.length;--t>-1;)if(u[t]===n){u.splice(t,1);break}-1===t&&console.warn("<compo:remove> - i`m not in parents collection",n)}}},compo_ensureTemplate=function(n){if(null==n.nodes){null!=n.attr.template&&(n.template=n.attr.template,delete n.attr.template);var e=n.template;if(null!=e){if(is_String(e)){if(35===e.charCodeAt(0)&&/^#[\w\d_-]+$/.test(e)){var t=document.getElementById(e.substring(1));if(null==t)return console.error("<compo> Template holder not found by id:",e),void 0;e=t.innerHTML}e=mask.parse(e)}"object"==typeof e&&(n.nodes=e)}}},compo_attachDisposer=function(n,e){if(null==n.dispose)return n.dispose=e,void 0;var t=n.dispose;n.dispose=function(){e.call(this),t.call(this)}},compo_createConstructor=function(n,e){var t=e.compos,r=e.pipes,o=e.attr;return null==t&&null==r&&null==e.attr?n:function(){null!=t&&(this.compos=obj_copy(this.compos)),null!=r&&Pipes.addController(this),null!=o&&(this.attr=obj_copy(this.attr)),is_Function(n)&&n.call(this)}}})(),obj_extend(Compo,{create:function(n){var e;null==n&&(n={}),n.hasOwnProperty("constructor")&&(e=n.constructor),null==e&&(e=function(){});for(var t in Proto)null==n[t]&&(n[t]=Proto[t]);return e.prototype=n,e},createClass:function(n){if(null!=n.attr)for(var e in n.attr)n.attr[e]=_mask_ensureTmplFn(n.attr[e]);hasInclude&&global.include&&(n.__resource=global.include.url);var t=n.slots;if(null!=t)for(var e in t)"string"==typeof t[e]&&(t[e]=n[t[e]]);var r;n.hasOwnProperty("constructor")&&(r=n.constructor),null==r&&(r=n.Construct),n.Construct=compo_createConstructor(r,n);var o=n.Extends;return null==o?n.Extends=Proto:is_Array(o)?o.unshift(Proto):n.Extends=[Proto,o],Class(n)},render:function(n,e,t,r){compo_ensureTemplate(n);var o=[];return mask.render(null==n.tagName?n.nodes:n,e,t,r,n,o),n.$=domLib(o),null!=n.events&&Events_.on(n,n.events),null!=n.compos&&Children_.select(n,n.compos),n},initialize:function(n,e,t,r,o){var i;null==r&&(t&&null!=t.nodeType?(r=t,t=null):e&&null!=e.nodeType&&(r=e,e=null)),"string"==typeof n&&(i=n,n=mask.getHandler(i),n||console.error("Compo not found:",n));var l={controller:n,type:Dom.COMPONENT,tagName:i};null==o&&null!=r&&(o=Anchor.resolveCompo(r)),null==o&&(o=new Dom.Component);var s=mask.render(l,e,t,null,o),u=o.components[o.components.length-1];return null!=r&&(r.appendChild(s),Compo.signal.emitIn(u,"domInsert")),u},find:function(n,e){return find_findSingle(n,selector_parse(e,Dom.CONTROLLER,"down"))},closest:function(n,e){return find_findSingle(n,selector_parse(e,Dom.CONTROLLER,"up"))},dispose:compo_dispose,ensureTemplate:compo_ensureTemplate,attachDisposer:compo_attachDisposer,config:{selectors:{$:function(n,e){var t=domLib_find(n.$,e);return t},compo:function(n,e){var t=Compo.find(n,e);return t}},setDOMLibrary:function(n){domLib!==n&&(domLib=n,domLib_initialize())},eventDecorator:function(n){return"function"==typeof n?(EventDecorator=n,void 0):"string"==typeof n?(EventDecorator=EventDecos[n],void 0):"boolean"==typeof n&&n===!1?(EventDecorator=null,void 0):void 0}},pipe:Pipes.pipe,resource:function(n){for(var e=n;null!=e;){if(e.resource)return e.resource;e=e.parent}return include.instance()},plugin:function(source){eval(source)},Dom:{addEventListener:dom_addEventListener}}),function(){function n(n,e,t){return null==n[e]&&(n[e]=[]),n[e].push(t),n}function e(n,e,t){var r=n[e];if(null!=r)for(var o,i=0,l=r.length;l>i;i++)o=r[i],null!=o&&(r[i]=null,null!=t?o.apply(this,t):o())}var t={done:function(e){return n(this,"_cbs_done",e)},fail:function(e){return n(this,"_cbs_fail",e)},always:function(e){return n(this,"_cbs_always",e)},resolve:function(){this.async=!1,e(this,"_cbs_done",arguments),e(this,"_cbs_always",arguments)},reject:function(){this.async=!1,e(this,"_cbs_fail",arguments),e(this,"_cbs_always")}},r={async:!0,await:function(n){this.resume=n}};Compo.pause=function(n,e){if(null==e.async){e.defers=[],e._cbs_done=null,e._cbs_fail=null,e._cbs_always=null;for(var o in t)e[o]=t[o]}e.async=!0;for(var o in r)n[o]=r[o];return e.defers.push(n),function(){Compo.resume(n,e)}},Compo.resume=function(n,e){n.resume&&n.resume(),n.async=!1;for(var t,r=!1,o=0,i=e.defers.length;i>o;o++)t=e.defers[o],t!==n?r===!1&&(r=null!=t):e.defers[o]=null;r===!1&&e.resolve()}}();var Proto={type:Dom.CONTROLLER,tagName:null,compoName:null,nodes:null,attr:null,model:null,slots:null,pipes:null,compos:null,events:null,async:!1,onRenderStart:null,onRenderEnd:null,render:null,renderStart:function(n,e,t){if(1===arguments.length&&null!=n&&n instanceof Array==!1&&null!=n[0]){var r=arguments[0];n=r[0],e=r[1],t=r[2]}null==this.nodes&&compo_ensureTemplate(this),is_Function(this.onRenderStart)&&this.onRenderStart(n,e,t)},renderEnd:function(n,e,t,r){if(1===arguments.length&&n instanceof Array==!1){var o=arguments[0];n=o[0],e=o[1],t=o[2],r=o[3]}Anchor.create(this,n),this.$=domLib(n),null!=this.events&&Events_.on(this,this.events),null!=this.compos&&Children_.select(this,this.compos),is_Function(this.onRenderEnd)&&this.onRenderEnd(n,e,t,r)},appendTo:function(n){var e="string"==typeof n?document.querySelector(n):n;if(null==e)return console.warn("Compo.appendTo: parent is undefined. Args:",arguments),this;for(var t=this.$,r=0,o=t.length;o>r;r++)e.appendChild(t[r]);return this.emitIn("domInsert"),this},append:function(n,e,t){var r;if(null==this.$){var o="string"==typeof n?mask.compile(n):n;return r=t?find_findSingle(this,selector_parse(t,Dom.CONTROLLER,"down")):this,null==r.nodes?(this.nodes=o,this):(r.nodes=[this.nodes,o],this)}var i=mask.render(n,e,null,null,this);return r=t?this.$.find(t):this.$,r.append(i),this.emitIn("domInsert"),this},find:function(n){return find_findSingle(this,selector_parse(n,Dom.CONTROLLER,"down"))},closest:function(n){return find_findSingle(this,selector_parse(n,Dom.CONTROLLER,"up"))
},on:function(){var n=_array_slice.call(arguments);return 3>arguments.length?(console.error("Invalid Arguments Exception @use .on(type,selector,fn)"),this):(null!=this.$&&Events_.on(this,[n]),null==this.events?this.events=[n]:is_Array(this.events)?this.events.push(n):this.events=[n,this.events],this)},remove:function(){return null!=this.$&&this.$.remove(),compo_detachChild(this),compo_dispose(this),this.$=null,this},slotState:function(n,e){return Compo.slot.toggle(this,n,e),this},signalState:function(n,e){return Compo.signal.toggle(this,n,e),this},emitOut:function(n){return Compo.signal.emitOut(this,n,this,arguments.length>1?_array_slice.call(arguments,1):null),this},emitIn:function(n){return Compo.signal.emitIn(this,n,this,arguments.length>1?_array_slice.call(arguments,1):null),this}};return Compo.prototype=Proto,Compo}();return function(){function n(e,t,r,o,i){if(null==e)return!1;var l=!1,s=null!=e.slots&&e.slots[t];if("string"==typeof s&&(s=e[s]),"function"==typeof s){l=!0;var u=null!=e.slots.__disabled&&e.slots.__disabled[t];if(u!==!0){var a=null==o?s.call(e,r):s.apply(e,[r].concat(o));if(a===!1)return!0;null!=a&&"object"==typeof a&&null!=a.length&&(o=a)}}if(-1===i&&null!=e.parent)return n(e.parent,t,r,o,i)||l;if(1===i&&null!=e.components)for(var c,f=e.components,d=f.length,p=0;d>p;p++)c=n(f[p],t,r,o,i),!l&&(l=c);return l}function e(n,t,r,o){if(null==n)return!1;var i=n.slots;if(null!=i&&null!=i[t]&&("string"==typeof i[t]&&(i[t]=n[i[t]]),"function"==typeof i[t])){if(o!==!0)return!0;if(null==i.__disabled||i.__disabled[t]!==!0)return!0}if(-1===r&&null!=n.parent)return e(n.parent,t,r);if(1===r&&null!=n.components)for(var l=0,s=n.components.length;s>l;l++)if(e(n.components[l],t,r))return!0;return!1}function t(t,r){return e(t,r,-1)===!1?null:function(e){var o=arguments.length>1?_array_slice.call(arguments,1):null;n(t,r,e,o,-1)}}function r(n,e,t){var r=n.slots;null!=r&&r.hasOwnProperty(e)!==!1&&(null==r.__disabled&&(r.__disabled={}),r.__disabled[e]=t===!1)}function o(n,e,t){if(r(n,e,t),null!=n.components)for(var i=0,l=n.components.length;l>i;i++)o(n.components[i],e,t)}function i(n,e,t){return null==n.$?(console.warn("Controller has no elements to toggle state"),void 0):(domLib().add(n.$.filter("[data-signals]")).add(n.$.find("[data-signals]")).each(function(n,r){var o=r.getAttribute("data-signals");null!=o&&-1!==o.indexOf(e)&&r[t===!0?"removeAttribute":"setAttribute"]("disabled","disabled")}),void 0)}function l(n,e,t){for(var l=n,s=n;null!=(l=l.parent);)r(l,e,t),null!=l.$&&0!==l.$.length&&(s=l);o(n,e,t),i(s,e,t)}function s(n,t,o){r(n,t,o),(o||!e(n,t,-1,!0)&&!e(n,t,1,!0))&&i(n,t,o)}mask.registerAttrHandler("x-signal","client",function(n,e,r,o,i,l){for(var s,u=e.split(";"),a="",c=u.length,f=-1;c>++f;)if(s=u[f].trim(),""!==s){var d=s.indexOf(":"),p=s.substring(0,d),h=s.substring(d+1).trim(),m=t(l,h);m&&(a+=","+h+",",dom_addEventListener(i,p,m))}""!==a&&i.setAttribute("data-signals",a)}),obj_extend(Compo,{signal:{toggle:l,emitOut:function(e,t,r,o){n(e,t,r,o,-1)},emitIn:function(e,t,r,o){n(e,t,r,o,1)},enable:function(n,e){l(n,e,!0)},disable:function(n,e){l(n,e,!1)}},slot:{toggle:s,enable:function(n,e){s(n,e,!0)},disable:function(n,e){s(n,e,!1)},invoke:function(n,e,t,r){var o=n.slots;return null==o||"function"!=typeof o[e]?(console.error("Slot not found",e,n),null):null==r?o[e].call(n,t):o[e].apply(n,[t].concat(r))}}})}(),domLib_initialize(),mask.registerHandler(":slot",SlotHandler),SlotHandler.prototype={constructor:SlotHandler,renderEnd:function(){this.slots={},this.expression=this.attr.on,this.slots[this.attr.signal]=this.handle},handle:function(){var n=this.expression;mask.Utils.Expression.eval(n,this.model,global,this)}},Compo}(Mask),jmask=exports.jmask=function(n){function e(n){return"string"!=typeof n?n:_(n)}function t(n,e){if(null==n&&(n={}),null==e)return n;for(var t in e)n[t]=e[t];return n}function r(n,e){for(var t=0,r=n.length;r>t;t++)e(n[t],t)}function o(n,e){if(null==n)return console.error("Can not remove myself from parent",e),void 0;var t=n.indexOf(e);return-1===t?(console.error("Can not remove myself from parent",e,t),void 0):(n.splice(t,1),void 0)}function i(n){return null!=n&&"object"==typeof n&&null!=n.length&&"function"==typeof n.slice}function l(n,e,t){if(null==n&&console.warn("selector is null for type",e),"object"==typeof n)return n;var r,o,i,l,u,c,f,d,p,h=0,m=n.length;for(r="up"===t?k:e===g.SET?A:w;m>h;)u=n.charCodeAt(h),33>u||(c=a(n,h+1,m),46===u?(o="class",i=E,l=s(n.substring(h+1,c))):35===u?(o="id",i=E,l=n.substring(h+1,c)):91===u?(d=n.indexOf("=",h),i=E,o=n.substring(h+1,d),u=n.charCodeAt(d+1),p=34===u||39===u?2:1,l=n.substring(d+p,c-p+1),c++):(i=null,o=e===g.SET?"tagName":"compoName",l=n.substring(h,c)),h=c,null!=f?(null==f.filters&&(f.filters=[]),f.filters.push({key:o,selector:l,prop:i})):f={key:o,prop:i,selector:l,nextKey:r,filters:null});return f}function s(n){return function(e){return u(e,n)}}function u(n,e,t){if("string"!=typeof n)return!1;if(null==t&&(t=0),t=n.indexOf(e,t),-1===t)return!1;if(t>0&&n.charCodeAt(t-1)>32)return u(n,e,t+1);var r=n.length,o=e.length;return r-o>t&&n.charCodeAt(t+o)>32?u(n,e,t+1):!0}function a(n,e,t){for(var r,o=!1,i=!1;t>e&&(r=n.charCodeAt(e),(34===r||39===r)&&(o=!o),92===r&&(i=!i),!(46===r||35===r||91===r||93===r||33>r)||o===!0||i===!0);)e++;return e}function c(n,e,t){"string"==typeof e&&(null==t&&(t=g[n.compoName?"CONTROLLER":"SET"]),e=l(e,t));var r=e.prop?n[e.prop]:n,o=!1;if(null==r)return!1;if("function"==typeof e.selector?o=e.selector(r[e.key]):null!=e.selector.test?e.selector.test(r[e.key])&&(o=!0):r[e.key]===e.selector&&(o=!0),o===!0&&null!=e.filters)for(var i,s=0,u=e.filters.length;u>s;s++)if(i=e.filters[s],c(n,i,t)===!1)return!1;return o}function f(n,e){if(null==e)return n;for(var t,r=[],o=0,i=n.length;i>o;o++)t=n[o],c(t,e)&&r.push(t);return r}function d(n,e,t){if(null==n)return t;if(null==t&&(t=[]),n instanceof Array){for(var r=0,o=n.length;o>r;r++)d(n[r],e,t);return t}c(n,e)&&t.push(n);var i=n[e.nextKey];return null!=i&&d(i,e,t),t}function p(n,e){var r={type:1,tagName:1,compoName:1,controller:1},o={parent:e};for(var i in n)1===r[i]&&(o[i]=n[i]);n.attr&&(o.attr=t({},n.attr));var l=n.nodes;if(null!=l&&l.length>0){o.nodes=[];for(var s=l instanceof Array,u=s===!0?l.length:1,a=0;u>a;a++)o.nodes[a]=p(s===!0?l[a]:l,o)}return o}function h(n){for(var e,t=n;null!=t;)e=t,t=t.nodes&&t.nodes[0];return e}function m(n,e,t,r){if(g.TEXTNODE===n.type)return"function"==typeof n.content?n.content("node",e,t,null,r):n.content;var o="";if(null!=n.nodes)for(var i,l=0,s=n.nodes.length;s>l;l++)i=n.nodes[l],o+=m(i,e,t,r);return o}function v(n){return this instanceof v==!1?new v(n):null==n?this:n.type===g.SET?n:this.add(n)}var g=n.Dom,b=n.render,y=n.parse,_=n.Utils.ensureTmplFn,x=(global.Compo||n.Compo||Compo).signal.emitIn,C=function(){function n(n,t){return n===t?(e=!0,0):1}var e=!1;return function(t){var r,o,i,l;if(e=!1,t.sort(n),e===!1)return t;for(r=[],o=0,i=0,l=t.length-1;l>o;)t[o++]===t[o]&&(r[i++]=o);for(;i--;)t.splice(r[i],1);return t}}(),k="parent",A="nodes",w="components",E="attr";return v.prototype={constructor:v,type:g.SET,length:0,components:null,add:function(n){var e,t;if("string"==typeof n&&(n=y(n)),i(n)){for(e=0,t=n.length;t>e;e++)this.add(n[e]);return this}"function"==typeof n&&null!=n.prototype.type&&(n={controller:n,type:g.COMPONENT});var r=n.type;if(!r)return console.error("Only Mask Node/Component/NodeText/Fragment can be added to jmask set",n),this;if(r===g.FRAGMENT){var o=n.nodes;for(e=0,t=o.length;t>e;)this[this.length++]=o[e++];return this}if(r===g.CONTROLLER){if(null!=n.nodes&&n.nodes.length)for(e=n.nodes.length;0!==e;)n.nodes[--e].parent=n;null!=n.$&&(this.type=g.CONTROLLER)}return this[this.length++]=n,this},toArray:function(){return Array.prototype.slice.call(this)},render:function(n,e,t,r){if(this.components=[],1===this.length)return b(this[0],n,e,t,r||this);null==t&&(t=document.createDocumentFragment());for(var o=0,i=this.length;i>o;o++)b(this[o],n,e,t,r||this);return t},prevObject:null,end:function(){return this.prevObject||this},pushStack:function(n){var e;return e=v(n),e.prevObject=this,e},controllers:function(){return null==this.components&&console.warn("Set was not rendered"),this.pushStack(this.components||[])},mask:function(e){if(null!=e)return this.empty().append(e);if(arguments.length)return this;var t;if(0===this.length)t=new g.Node;else if(1===this.length)t=this[0];else{t=new g.Fragment;for(var r=0,o=this.length;o>r;r++)t.nodes[r]=this[r]}return n.stringify(t)},text:function(n,e,t){if("string"==typeof n&&1===arguments.length){for(var r,o=[new g.TextNode(n)],i=0,l=this.length;l>i;i++)r=this[i],r.nodes=o;return this}for(var r,s="",i=0,l=this.length;l>i;i++)r=this[i],s+=m(r,n,e,t);return s}},r(["append","prepend"],function(n){v.prototype[n]=function(e){for(var t,r,o=v(e),i=0,l=this.length;l>i;i++){r=this[i],t=o.toArray();for(var s=0,u=t.length;u>s;s++)t[s].parent=r;r.nodes=null!=r.nodes?"append"===n?r.nodes.concat(t):t.concat(r.nodes):t}return this}}),r(["appendTo"],function(n){v.prototype[n]=function(n,e,t,r){return null==r&&(r=this),null!=n.nodeType&&"function"==typeof n.appendChild?(n.appendChild(this.render(e,t,null,r)),x(r,"domInsert"),this):(v(n).append(this),this)}}),function(){function n(n){for(var e,t,r=n.split(";"),o={},i=0,l=r.length;l>i;i++)t=r[i],e=t.indexOf(":"),o[t.substring(0,e).trim()]=t.substring(e+1).trim();return o}function o(n){var e=[],t=0;for(var r in n)e[t++]=r+":"+n[r];return e.join(";")}r(["add","remove","toggle","has"],function(n){v.prototype[n+"Class"]=function(e){var t,r,o,i,l,s=this.length,u=0;if("string"!=typeof e){if("remove"===n)for(;s>u;u++)this[0].attr["class"]=null;return this}for(;s>u;u++)if(i=this[u],null!=i.attr){if(l=i.attr["class"],null==l)l=e;else{for(l=" "+l+" ",null==t&&(t=e.split(" "),o=t.length),r=0;o>r;r++)if(t[r]){var a=l.indexOf(" "+t[r]+" ")>-1;if("has"!==n)a!==!1||"add"!==n&&"toggle"!==n?a!==!0||"remove"!==n&&"toggle"!==n||(l=l.replace(" "+t[r]+" "," ")):l+=t[r]+" ";else if(a)return!0}l=l.trim()}"has"!==n&&(i.attr["class"]=l)}return"has"===n?!1:this}}),r(["attr","removeAttr","prop","removeProp"],function(n){v.prototype[n]=function(t,r){if(!t)return this;for(var o,i=this.length,l=0,s=arguments.length;i>l;l++)switch(o=this[l],n){case"attr":case"prop":if(1===s){if("string"==typeof t)return o.attr[t];for(var u in t)o.attr[u]=e(t[u])}else 2===s&&(o.attr[t]=e(r));break;case"removeAttr":case"removeProp":o.attr[t]=null}return this}}),t(v.prototype,{tag:function(n){if("string"==typeof n){for(var e=0,t=this.length;t>e;e++)this[e].tagName=n;return this}return this[0]&&this[0].tagName},css:function(e,t){var r,i,l,s=arguments.length,u=this.length,a=0;if(1===s&&"string"==typeof e)return 0===u?null:"string"==typeof this[0].attr.style?n(this[0].attr.style)[e]:null;for(;u>a;a++)if(l=this[a].attr.style,"function"!=typeof l){if(1===s&&"object"==typeof e){if(null==l){this[a].attr.style=o(e);continue}r=n(l);for(i in e)r[i]=e[i];this[a].attr.style=o(r)}if(2===s){if(null==l){this[a].attr.style=e+":"+t;continue}r=n(l),r[e]=t,this[a].attr.style=o(r)}}return this}})}(),t(v.prototype,{clone:function(){for(var n=[],e=0,t=this.length;t>e;e++)n[e]=p(this[0]);return v(n)},wrap:function(n){var e,t=v(n),r=[];if(0===t.length)return console.log("Not valid wrapper",n),this;for(var o=0,i=this.length;i>o;o++){e=i>0?t.clone():t,h(e[0]).nodes=[this[o]],r[o]=e[0];var l=this[o].parent&&this[o].parent.nodes;if(null!=l)for(var s=0,u=l.length;u>s;s++)if(l[s]===this[o]){l.splice(s,1,r[o]);break}}return v(r)},wrapAll:function(n){var e=v(n);return 0===e.length?(console.error("Not valid wrapper",n),this):(this.parent().mask(e),h(e[0]).nodes=this.toArray(),this.pushStack(e))}}),r(["empty","remove"],function(n){v.prototype[n]=function(){for(var e,t=0,r=this.length;r>t;t++)e=this[t],"empty"!==n?"remove"!==n||null!=e.parent&&o(e.parent.nodes,e):e.nodes=null;return this}}),t(v.prototype,{each:function(n,e){for(var t=0;this.length>t;t++)n.call(e||this,this[t],t);return this},eq:function(n){return-1===n?this.slice(n):this.slice(n,n+1)},get:function(n){return 0>n?this[this.length-n]:this[n]},slice:function(){return this.pushStack(Array.prototype.slice.apply(this,arguments))}}),r(["filter","children","closest","parent","find","first","last"],function(n){v.prototype[n]=function(e){var t,r,o=[],i=null==e?null:l(e,this.type,"closest"===n?"up":"down");switch(n){case"filter":return v(f(this,i));case"children":for(t=0;this.length>t;t++)r=this[t],null!=r.nodes&&(o=o.concat(null==i?r.nodes:f(r.nodes,i)));break;case"parent":for(t=0;this.length>t;t++)r=this[t].parent,!r||r.type===g.FRAGMENT||i&&c(r,i)||o.push(r);C(o);break;case"closest":case"find":if(null==i)break;for(t=0;this.length>t;t++)d(this[t][i.nextKey],i,o);break;case"first":case"last":var s;for(t=0;this.length>t;t++)if(s="first"===n?t:this.length-t-1,r=this[s],null==i||c(r,i)){o[0]=r;break}}return this.pushStack(o)}}),v}(Mask);return function(n,e){function t(n,e){return function(){return n.apply(e,arguments)}}function r(n){return n.parentNode.removeChild(n)}function o(n){if(null!=n)for(var e=0,t=n.length;t>e;e++)r(n[e])}function i(n,e){return e.parentNode.insertBefore(n,e.nextSibling)}function l(n,e){return e.parentNode.insertBefore(n,e)}function s(n,e,t){if(null==n.components)return i(t,n.placeholder);for(var r,o=n.components,s=null,u=!0,a=o.length,c=e;a>c;c++)if(r=o[c].elements,r&&r.length){s=r[0];break}if(null==s)for(u=!1,c=a>e?e:a;--c>-1;)if(r=o[c].elements,r&&r.length){s=r[r.length-1];break}return null==s&&(s=n.placeholder),u?l(t,s):i(t,s)}function u(e,t,r,o,i){return n.render(t,r,o,i,e)}function a(n,e){if(null==n)return!1;o(n.elements),n.elements=null,null!=E&&E.dispose(n);var t=e&&e.components||n.parent&&n.parent.components;return null==t?(console.error("Parent Components Collection is undefined"),!1):L(t,n)}function c(n){null!=E&&E.signal.emitIn(n,"domInsert")}function f(n,e){if("function"==typeof n.dispose){var t=n.dispose;return n.dispose=function(){e.call(this),t.call(this)},void 0}n.dispose=e}function d(){}function p(){}function h(){}function m(n,e){if(null==e&&(e=[]),null==n.components)return e;for(var t,r=n.components,o=0,i=r.length;i>o;o++)t=r[o],"validate"!==t.compoName?m(t):e.push(t);return e}var v,g,b,y,_,x,C,k,A,w=global.jQuery||global.Zepto||global.$,E=void 0!==e?e:n.Compo||global.Compo,j=E.Dom.addEventListener,N=n.registerHandler,O=n.registerAttrHandler,T=n.registerUtil,S=Array.prototype.slice;(function(){function n(n,e){for(var t,r=-1,o=e.length-1;o>++r;)t=e[r],null==n[t]&&(n[t]={}),n=n[t];return n}function e(e,r,o,i){var l=i.length,s=l>1?n(e,i):e,u=i[l-1],a=s[u];return l>1&&t(e,i),"length"===u&&D(s)?(I(s,function(n,e,t,r){for(var i=o.length,l=-1;i>++l;)o[l](n,e,t,r)}),a):(Object.defineProperty(s,u,{get:function(){return a},set:function(n){var e=0,t=o.length;if(n!==a){if(a=n,D(n))for(e=0;t>e;e++)I(n,o[e]);if(null!=o.__dirties)return o.__dirties[r]=1,void 0;for(e=0;t>e;e++)o[e](n)}},configurable:!0}),a)}function t(n,e){for(var t,i=o(n),l="",s=0,u=e.length-1;u>s;s++)t=e[s],l+=t+".",r(l,n,t,i),n=n[t]}function r(n,e,t,r){var o,i=e[t];Object.defineProperty(e,t,{get:function(){return i},set:function(e){e!==i&&(o=i,i=e,r(n,o))},configurable:!0})}function o(n){return function(e,t){var r=n.__observers;if(null!=r)for(var o in r)if(0===o.indexOf(e)){var i=r[o].slice(0),l=i.length,s=0;if(0!==l){var u,a,c=v(n,o);for(s=0;l>s;s++)u=i[s],_(n,o,u),a=o.substring(e.length),_(t,a,u);for(s=0;l>s;s++)i[s](c);for(s=0;l>s;s++)b(n,o,i[s])}}}}function i(n,e,t){null==n.__observers&&Object.defineProperty(n,"__observers",{value:{__dirty:null},enumerable:!1});var r=n.__observers;return null!=r[e]?-1===P(r[e],t)&&r[e].push(t):r[e]=[t],r[e]}v=function(n,e){for(var t=e.split("."),r=t.length,o=-1;r>++o;){if(null==n)return null;n=n[t[o]]}return n},g=function(n,e,t){for(var r,o=e.split("."),i=o.length-1,l=-1;i>++l;)r=o[l],null==n[r]&&(n[r]={}),n=n[r];n[o[l]]=t},b=function(n,t,r){for(var o=t.split("."),l=o.length,s=-1,u=n;l>++s&&(u=u[o[s]],null!=u);)if(null!=u.__observers){var a=o.slice(s+1).join(".");if(u.__observers[a])return i(n,t,r),void 0}var c=i(n,t,r);1===c.length&&e(n,t,c,o,!0);var f=v(n,t);D(f)&&I(f,r)},y=function(n,e,t){for(var r=e.split("."),o=r.length,i=-1,l=n;o>++i&&(l=l[r[i]],null!=l);)if(null!=l.__observers){if(y(l,r.slice(i).join("."),t))return!0;break}var s=n.__observers;return null==s||null==s[e]?!1:-1!==P(s[e],t)},_=function(n,e,t){for(var r=e.split("."),o=r.length,i=-1,l=n;o>++i&&(l=l[r[i]],null!=l);)if(null!=l.__observers){_(l,r.slice(i).join("."),t);break}var s=n.__observers;if(null!=s&&null!=s[e]){var u=v(n,e);if(2===arguments.length)return s[e].length=0,void 0;L(s[e],t),D(u)&&U(u,t)}},x=function(n){if(D(n))return F(n),void 0;var e=n.__observers;null!=e&&(e.__dirties={})},C=function(n){if(D(n))return R(n),void 0;var e=n.__observers,t=null==e?null:e.__dirties;if(null!=t){for(var r in t){var o=n.__observers[r],i=v(n,r);if(null!=o)for(var l=0,s=o.length;s>l;l++)o[l](i)}e.__dirties=null}},k=function(n,e){if(null==e)return n;null==n&&(n={});for(var t in e)n[t]=e[t];return n},A=function(n,e){if(null==n)return!1;for(var t=e.split("."),r=t.length,o=-1;r>++o;)if(null==(n=n[t[o]]))return!1;return!0}})();var D,L,$,P,I,U,F,R;(function(){function n(n,t,r){return function(){return e(n,t,r,S.call(arguments))}}function e(n,e,t,r){var o=n.__observers&&n.__observers.__array,i=e.apply(n,r);if(null==o||0===o.length)return i;if(null!=n.__observers.__dirty)return n.__observers.__dirty=!0,i;for(var l,s=0,u=o.length;u>s;s++)l=o[s],"function"==typeof l&&l(n,t,r,i);return i}D=function(n){return null!=n&&"object"==typeof n&&null!=n.length&&"function"==typeof n.splice},L=function(n){if(null==n)return!1;for(var e,t=0,r=n.length,o=1,i=arguments.length,l=0;r>t;t++)for(e=n[t],o=1;i>o;o++)if(arguments[o]===e){n.splice(t,1),t--,r--,l++;break}return l+1===i},I=function(e,t){null==e.__observers&&Object.defineProperty(e,"__observers",{value:{__dirty:null},enumerable:!1});var r=e.__observers.__array;if(null==r&&(r=e.__observers.__array=[]),0===r.length)for(var o,i,l=0,s=["push","unshift","splice","pop","shift","reverse","sort","remove"],u=s.length;u>l;l++)i=s[l],o=e[i],null!=o&&(e[i]=n(e,o,i));r[r.length++]=t},U=function(n,e){var t=n.__observers&&n.__observers.__array;if(null!=t)for(var r=0,o=t.length;o>r;r++)if(t[r]===e){t[r]=null;for(var i=r;o>i;i++)t[i]=t[i+1];o--,t.length--}},F=function(n){null!=n.__observers&&(n.__observers.__dirty=!1)},R=function(n){var e=n.__observers,t=e&&e.__array;if(null!=t&&e.__dirty===!0){for(var r,o=0,i=t.length;i>o;o++)r=t[o],"function"==typeof r&&r(n);e.__dirty=null}},$=function(n,e){for(var t=0,r=n.length;r>t;t++)e(n[t])},P=function(n,e){return n.indexOf(e)}})();var M,H,V,B,W,K,Q;(function(){var e=n.Utils.Expression,t=e.eval;K=e.parse,Q=e.varRefs,M=function(n,e,r,o){if("."===n)return e;var i=t(n,e,r,o);return null==i?"":i},H=function(n,e,r,o,i){if("."===n)return D(e)&&I(e,i),void 0;var l,s=K(n),u=Q(s);if(null!=u){if("string"==typeof u)return A(e,u)&&(l=e),null==l&&A(o,u)&&(l=o),null==l&&(l=e),b(l,u,i),void 0;for(var a,c=null!=u.length&&"function"==typeof u.splice,f=c===!0?u.length:1,d=0;f>d;d++)if(a=c?u[d]:u,null!=a){if("object"==typeof a){if(l=t(a.accessor,e,r,o),null==l||"object"!=typeof l){console.error("Binding failed to an object over accessor",a);continue}a=a.ref}else l=A(e,a)?e:A(o,a)?o:e;null!=a&&"$c"!==a&&b(l,a,i)}}},V=function(n,e,r,o){if("function"==typeof r&&console.warn("[mask.binding] - expression unbind(expr, model, controller, callback)"),"."===n)return U(e,o),void 0;var i,l=Q(n);if(null!=l){if("string"==typeof l)return A(e,l)&&_(e,l,o),A(r,l)&&_(r,l,o),void 0;for(var i,s=null!=l.length&&"function"==typeof l.splice,u=s===!0?l.length:1,a=0;u>a;a++)if(i=s?l[a]:l,null!=i)if("object"!=typeof i)A(e,i)&&_(e,i,o),A(r,i)&&_(r,i,o);else{var c=t(i.accessor,e,null,r);c&&_(c,i.ref,o)}}},B=function(n,e,t,r,o){var i=0;return function(){if(++i>1)return i=0,console.warn("<mask:bind:expression> Concurent binder detected",n),void 0;var l=M(n,e,t,r);if(arguments.length>1){var s=S.call(arguments);s[0]=l,o.apply(this,s)}else o(l);i--}},W=function(n){var e=0;return function(){return++e>-1?(e=0,console.warn("<mask:listener:expression> concurent binder"),void 0):(n(),e--,void 0)}}})();var z,G;(function(){z=function(n,e,t){for(var r,o,i,l,s=n.split(";"),u=[],a=0,c=s.length;c>a;a++)r=s[a].split(":"),1===r.length||2===r.length?(i=2==r.length?r[0]:t,o=r[2==r.length?1:0],l=G(o.trim(),i,e),null!=l&&u.push(l)):console.error('Too much ":" in a signal def.',s[a]);return u},G=function(n,e,t){if(t!==!0)return{signal:n,type:e};var r=n.indexOf(".");return-1===r?(console.error("No pipe name in a signal",n),null):{signal:n.substring(r+1),pipe:n.substring(0,r),type:e}}})();var q=function(){function e(n,e,t,r){null==r&&(r=":bind"===t.compoName?"single":"dual");var o,l=t.attr;if(this.node=t,this.controller=t,this.model=n,this.element=e,this.value=l.value,this.property=l.property,this.setter=l.setter,this.getter=l.getter,this.dismiss=0,this.bindingType=r,this.log=!1,this.signal_domChanged=null,this.signal_objectChanged=null,this.locked=!1,null==this.property&&null==this.getter)switch(e.tagName){case"INPUT":if(o=e.getAttribute("type"),"checkbox"===o){this.property="element.checked";break}this.property="element.value";break;case"TEXTAREA":this.property="element.value";break;case"SELECT":this.domWay=i.SELECT;break;default:this.property="element.innerHTML"}if(l.log&&(this.log=!0,"log"!==l.log&&(this.logExpression=l.log)),l["x-signal"]){var s=z(l["x-signal"],null,"dom")[0],u=s&&s.type;switch(u){case"dom":case"object":this["signal_"+u+"Changed"]=s.signal;break;default:console.error("Signal typs is not supported",s)}}if(l["x-pipe-signal"]){var s=z(l["x-pipe-signal"],!0,"dom")[0],u=s&&s.type;switch(u){case"dom":case"object":this["pipe_"+u+"Changed"]=s;break;default:console.error("Pipe type is not supported")}}if(l["dom-slot"]){this.slots={};var a=t.parent,c=a.parent;a.parent=this,this.parent=c,this.slots[l["dom-slot"]]=function(n,e){this.domChanged(n,e)}}var f=l["object-pipe-slot"]||l["x-pipe-slot"];if(f){var d=f,p=d.indexOf("."),h=d.substring(0,p),s=d.substring(p+1);this.pipes={},this.pipes[h]={},this.pipes[h][s]=function(){this.objectChanged()},E.pipe.addController(this)}if(l.expression){if(this.expression=l.expression,null==this.value&&"single"!==r){var m=Q(this.expression);"string"==typeof m?this.value=m:console.warn("Please set value attribute in DualBind Control.")}}else this.expression=this.value}function t(n){var e=n.expression,t=n.model,r=n.objectChanged=n.objectChanged.bind(n);if(n.binder=B(e,t,n.cntx,n.node,r),H(e,t,n.cntx,n.node,n.binder),"dual"===n.bindingType){var o=n.node.attr;if(!o["change-slot"]&&!o["change-pipe-event"]){var i=n.element,l=o["change-event"]||o.changeEvent||"change",s=n.domChanged.bind(n);j(i,l,s)}if(!n.objectWay.get(n,n.expression))return setTimeout(function(){n.domWay.get(n)&&n.domChanged()}),n}return n.objectChanged(),n}function r(n,e,t){var o=n.slots;(null==o||"function"!=typeof o[e]||o[e].apply(n,t)!==!1)&&null!=n.parent&&r(n.parent,e,t)}var o={};n.registerBinding=function(n,e){o[n]=e},n.BindingProvider=e,e.create=function(n,t,r,i){var l,s=r.attr.bindingProvider,u=null==s?null:o[s];return"function"==typeof u?new u(n,t,r,i):(l=new e(n,t,r,i),null!=u&&k(l,u),l)},e.bind=function(n){return t(n)},e.prototype={constructor:e,dispose:function(){V(this.expression,this.model,this.controller,this.binder)},objectChanged:function(n){if(!(this.dismiss-->0)){if(this.locked===!0)return console.warn("Concurance change detected",this),void 0;if(this.locked=!0,null==n&&(n=this.objectWay.get(this,this.expression)),this.domWay.set(this,n),this.log&&console.log("[BindingProvider] objectChanged -",n),this.signal_objectChanged&&r(this.node,this.signal_objectChanged,[n]),this.pipe_objectChanged){var e=this.pipe_objectChanged;E.pipe(e.pipe).emit(e.signal)}this.locked=!1}},domChanged:function(n,e){if(this.locked===!0)return console.warn("Concurance change detected",this),void 0;this.locked=!0;var t=e||this.domWay.get(this),o=!0;if(this.node.validations)for(var i,l=0,s=this.node.validations.length;s>l;l++)if(i=this.node.validations[l],i.validate(t,this.element,this.objectChanged.bind(this))===!1){o=!1;break}if(o&&(this.dismiss=1,this.objectWay.set(this.model,this.value,t),this.dismiss=0,this.log&&console.log("[BindingProvider] domChanged -",t),this.signal_domChanged&&r(this.node,this.signal_domChanged,[t]),this.pipe_domChanged)){var u=this.pipe_domChanged;E.pipe(u.pipe).emit(u.signal)}this.locked=!1},objectWay:{get:function(n,e){return M(e,n.model,n.cntx,n.controller)},set:function(n,e,t){g(n,e,t)}},domWay:{get:function(n){if(n.getter){var e=n.node.parent;return e[n.getter]()}return v(n,n.property)},set:function(n,e){if(n.setter){var t=n.node.parent;t[n.setter](e)}else g(n,n.property,e)}}};var i={SELECT:{get:function(n){var e=n.element;return-1===e.selectedIndex?"":e.options[e.selectedIndex].getAttribute("name")},set:function(n,e){for(var t,r=n.element,o=0,i=r.options.length;i>o;o++)if(t=r.options[o],t.getAttribute("name")==e)return r.selectedIndex=o,void 0}}};return k(e,{addObserver:b,removeObserver:_}),e}();N(":visible",d),d.prototype={constructor:d,refresh:function(n,e){e.style.display=M(this.attr.check,n)?"":"none"},renderStart:function(n,e,t){this.refresh(n,t),this.attr.bind&&b(n,this.attr.bind,this.refresh.bind(this,n,t))}},function(){function n(){}N(":bind",n),n.prototype={constructor:n,renderEnd:function(n,e,t,r){this.provider=q.create(e,r,this,"single"),q.bind(this.provider)},dispose:function(){this.provider&&"function"==typeof this.provider.dispose&&this.provider.dispose()}}}(),N(":dualbind",p),p.prototype={constructor:p,renderEnd:function(e,t,r,o){if(this.provider=q.create(t,o,this),this.components)for(var i,l=0,s=this.components.length;s>l;l++)i=this.components[l],":validate"===i.compoName&&(this.validations||(this.validations=[])).push(i);if(!this.attr["no-validation"]&&!this.validations){var u=t.Validate,a=this.provider.value;if(null==u&&-1!==a.indexOf(".")){for(var c=a.split("."),l=0,f=c.length,d=t[c[0]];null==u&&f>++l&&d;)u=d.Validate,d=d[c[l]];a=c.slice(l).join(".")}var p=u&&u[a];"function"==typeof p&&(p=n.getHandler(":validate").createCustom(o,p),(this.validations||(this.validations=[])).push(p))}q.bind(this.provider)},dispose:function(){this.provider&&"function"==typeof this.provider.dispose&&this.provider.dispose()},handlers:{attr:{"x-signal":function(){}}}},function(){function t(){}function r(n,e){this.fn=n,this.message=e}function o(n,e,t){console.warn("Validate Notification:",n,e);var r=w(n).next("."+l);return 0===r.length&&(r=w("<div>").addClass(l).html("<span></span><button>cancel</button>").insertAfter(n)),r.children("button").off().on("click",function(){r.hide(),t&&t()}).end().children("span").text(e).end().show()}function i(n){return w(n).next("."+l).hide()}var l="-validate-invalid";n.registerValidator=function(n,e){s[n]=e},N(":validate",t),t.prototype={constructor:t,attr:{},renderStart:function(n,e,o){if(this.element=o,this.attr.value){var i=t.resolveFromModel(n,this.attr.value);i&&(this.validators=[new r(i)])}},validate:function(n,e,t){null==e&&(e=this.element),this.attr&&(null==n&&this.attr.getter&&(n=v({node:this,element:e},this.attr.getter)),null==n&&this.attr.value&&(n=v(this.model,this.attr.value))),null==this.validators&&this.initValidators();for(var r,o=0,i=this.validators.length;i>o;o++)if(r=this.validators[o].validate(n),r&&!this.attr.silent)return this.notifyInvalid(e,r,t),!1;return this.makeValid(e),!0},notifyInvalid:function(n,e,t){return o(n,e,t)},makeValid:function(n){return i(n)},initValidators:function(){this.validators=[];for(var n in this.attr){switch(n){case"message":case"value":case"getter":continue}if(n in s!=!1){var e=s[n];this.validators.push(new r(e(this.attr[n],this),this.attr.message))}else console.error("Unknown Validator:",n,this)}}},t.resolveFromModel=function(n,e){return v(n.Validate,e)},t.createCustom=function(n,e){var o=new t;return o.element=n,o.validators=[new r(e)],o},r.prototype.validate=function(n){var e=this.fn(n);return e===!1?this.message||"Invalid - "+n:e},N(":validate:message",e({template:"div."+l+' { span > "~[bind:message]" button > "~[cancel]" }',onRenderStart:function(n){"string"==typeof n&&(n={message:n}),n.cancel||(n.cancel="cancel"),this.model=n},compos:{button:"$: button"},show:function(n,e){var t=this;this.model.message=n,this.compos.button.off().on(function(){t.hide(),e&&e()}),this.$.show()},hide:function(){this.$.hide()}}));var s={match:function(n){return function(e){return RegExp(n).test(e)}},unmatch:function(n){return function(e){return!RegExp(n).test(e)}},minLength:function(n){return function(e){return e.length>=parseInt(n,10)}},maxLength:function(n){return function(e){return e.length<=parseInt(n,10)}},check:function(n,e){return function(t){return M("x"+n,e.model,{x:t},e)}}}}(),N(":validate:group",h),h.prototype={constructor:h,validate:function(){for(var n,e=m(this),t=0,r=e.length;r>t;t++)if(n=e[t],!n.validate())return!1;return!0}},function(){function n(n,e,t){return n?null==e||""===e?n+" "+t:n.replace(e,t):t}function e(e,t,r,o,i){return function(t){switch(e){case"node":r.textContent=t;break;case"attr":var l,s,u=typeof r[i];if("boolean"===u)return o=r[i]=!!t,void 0;if("string"===u)return o=r[i]=n(r[i],o,t),void 0;l=r.getAttribute(i),s=n(l,o,t),r.setAttribute(i,s),o=t}}}function t(n,t,r,o,i,l,s,u){var a=e(u,t,i,n,s),c=B(t,r,o,l,a);H(t,r,o,l,c),f(l,function(){V(t,r,l,c)})}T("bind",{mode:"partial",current:null,element:null,nodeRenderStart:function(n,e,t,r,o){var i=M(n,e,t,o);return this.element=document.createTextNode(i),this.current=i},node:function(n,e,r,o,i){return t(this.current,n,e,r,this.element,i,null,"node"),this.element},attrRenderStart:function(n,e,t,r,o){return this.current=M(n,e,t,o)},attr:function(n,e,r,o,i,l){return t(this.current,n,e,r,o,i,l,"attr"),this.current}})}(),O("xx-visible",function(n,e,t,r,o,i){var l=B(e,t,r,i,function(n){o.style.display=n?"":"none"});H(e,t,r,i,l),f(i,function(){V(e,t,i,l)}),M(e,t,r,i)||(o.style.display="none")}),O("x-toggle","client",function(n,e,t,r,o,i){var l=e.substring(0,e.indexOf(":")),s=e.substring(l.length+1),u=Q(s);"string"!=typeof u&&(u=u[0]),j(o,l,function(){var n=M(s,t,r,i);g(t,u,n)})}),O("x-class-toggle","client",function(n,e,t,r,o){var i=e.substring(0,e.indexOf(":")),l=e.substring(i.length+1).trim();j(o,i,function(){w(o).toggleClass(l)})}),function(n){function t(){this.attr={"debugger":null,use:null,log:null,"if":null,each:null,visible:null}}n.registerHandler("%%",t);var r=function(){var n={refresh:function(n){this.model=n,this.elements&&(o(this.elements),this.elements=[]),null!=E&&E.dispose(this),l(u(this,this.nodes,this.model,this.cntx),this.placeholder)},dispose:function(){V(this.expr,this.originalModel,this,this.binder)}};return function(e,t,r,o){var i=e.attr.use;k(e,{expr:i,placeholder:document.createComment(""),binder:B(i,t,r,e,n.refresh.bind(e)),originalModel:t,model:M(i,t,r,e),dispose:n.dispose}),H(i,t,r,e,e.binder),o.appendChild(e.placeholder)}}(),i=function(){return function(n,e,t){function r(n){console.log("Logger > Key: %s, Value: %s",o,n)}var o=n.attr.log,i=B(o,e,t,n,r),l=M(o,e,t,n);H(o,e,t,n,i),f(n,function(){V(o,e,n,i)}),r(l)}}(),d=function(){function n(n,e){return function(){return n.apply(e,arguments)}}var e={refresh:function(n){(null!=this.elements||n)&&(null==this.elements?(l(u(this,this.template,this.model,this.cntx),this.placeholder),this.$=w(this.elements)):(null==this.$&&(this.$=w(this.elements)),this.$[n?"show":"hide"]()),this.onchange&&this.onchange(n))},dispose:function(){V(this.expr,this.model,this,this.binder),this.onchange=null,this.elements=null}};return function(t,r,o,i){var l=t.attr["if"];k(t,{expr:l,template:t.nodes,placeholder:document.createComment(""),binder:B(l,r,o,t,n(e.refresh,t)),state:!!M(l,r,o,t)}),t.state||(t.nodes=null),H(l,r,o,t,t.binder),i.appendChild(t.placeholder)}}(),p=function(){var n={refresh:function(n){if(null!=this.elements||!n){if(null==this.elements)return l(u(this,this.template,this.model,this.cntx)),this.$=w(this.elements),void 0;
null==this.$&&(this.$=w(this.elements)),this.$[n?"hide":"show"]()}}};return function(e,t,r,o){var i=e.parent.components,l=i&&i[i.length-1];e.template=e.nodes,e.placeholder=document.createComment(""),l.onchange=n.refresh.bind(e),l.state&&(e.nodes=null),o.appendChild(e.placeholder)}}(),h=function(){function t(n,e){var t=[];if(null==e||"object"!=typeof e||null==e.length)return t;for(var r,o=0,i=e.length;i>o;o++){switch(r=e[o],typeof r){case"string":case"number":case"boolean":r=e[o]=Object(r)}t[o]=new d(n.template,r,n)}return t}function r(n,e){for(var t=n.components,r=0,o=t.length,i=0,s=null,u=null,a=null,c=document.createDocumentFragment(),f=[];o>r;r++)if(a=t[r],null!=a.elements&&0!==a.elements.length)for(i=0,s=a.elements.length;s>i;i++)u=a.elements[i],u.parentNode.removeChild(u);n:for(i=0,s=e.length;s>i;i++){for(r=0;o>r;r++)if(e[i]===t[r].model){f[i]=t[r];continue n}console.warn("No Model Found for",e[i])}for(r=0,o=f.length;o>r;r++)if(a=f[r],null!=a.elements&&0!==a.elements.length)for(i=0,s=a.elements.length;s>i;i++)u=a.elements[i],c.appendChild(u);n.components=f,l(c,n.placeholder)}function o(n,e,r,o,i){if(null!=e&&null!=r){var l=e,d=e+r;for(d>n.components.length&&(d=n.components.length);d>l;l++)a(n.components[l],n)&&(l--,d--)}if(null!=o&&i&&i.length){var p=new f,h=t(n,i),m=u(p,h),v=p.components;s(n,o,m),c(p),null==n.components&&(n.components=[]),n.components.splice.apply(n.components,[o,0].concat(v))}}function i(n,e){for(var t,r=n.components,o=r.length;--o>-1;)t=r[o],-1!==e.indexOf(t.model)&&a(t,n)}var f=n.Dom.Component,d=function(){function n(n,e,t){this.nodes=n,this.model=e,this.parent=t}var e=f.prototype;n.prototype={compoName:"%%.each.item",constructor:p,renderEnd:function(n){this.elements=n}};for(var t in e)n.prototype[t]=e[t];return n}(),p={append:function(e){var t=new d(this.template,e,this);n.render(t,e,null,this.container,this)}},h={refresh:function(n,e,s,f){var d,p,h=0;if(null==e){if(null!=this.components)for(h=0,p=this.components.length;p>h;h++)d=this.components[h],a(d,this)&&(h--,p--);return this.components=[],this.nodes=t(this,n),l(u(this,this.nodes),this.placeholder),$(this.components,c),void 0}for(p=n.length;p>h;h++)switch(d=n[h],typeof d){case"string":case"number":case"boolean":n[h]=Object(d)}switch(e){case"push":o(this,null,null,n.length,n.slice(n.length-1));break;case"pop":o(this,n.length,1);break;case"unshift":o(this,null,null,0,n.slice(0,1));break;case"shift":o(this,0,1);break;case"splice":var m=s[0],v=1===s.length?this.components.length:s[1],g=s.length>2?n.slice(s[0],s.length-2+s[0]):null;o(this,m,v,m,g);break;case"sort":case"reverse":r(this,n);break;case"remove":null!=f&&f.length&&i(this,f)}},dispose:function(){V(this.expr,this.model,this,this.refresh)}};return function(n,r,o,i){null==n.nodes&&void 0!==e&&e.ensureTemplate(n);var l=n.attr.each||n.attr.foreach,s=M(l,r,o,n);k(n,{expr:l,binder:B(l,r,o,n,h.refresh.bind(n)),template:n.nodes,container:i,placeholder:document.createComment(""),dispose:h.dispose}),i.appendChild(n.placeholder),H(n.expr,r,o,n,n.binder);for(var u in p)n[u]=p[u];n.nodes=t(n,s)}}(),m=function(){var n={refresh:function(){if(this.refreshing!==!0){this.refreshing=!0;for(var n=M(this.expr,this.model,this.cntx,this),e=0,t=this.elements.length;t>e;e++)this.elements[e].style.display=n?"":"none";this.refreshing=!1}},dispose:function(){V(this.expr,this.model,this,this.binder)}};return function(e,t,r){var o=e.attr.visible;k(e,{expr:o,binder:B(o,t,r,e,n.refresh.bind(e)),dispose:n.dispose}),H(o,t,r,e,e.binder),n.refresh.call(e)}}();t.prototype={constructor:t,elements:null,renderStart:function(n,e,t){var o=this.attr;return null==o["debugger"]?null!=o.use?(r(this,n,e,t),void 0):null!=o.log?(i(this,n,e,t),void 0):(this.model=n,null!=o["if"]?(d(this,n,e,t),void 0):null!=o["else"]?(p(this,n,e,t),void 0):((null!=o.each||null!=o.foreach)&&h(this,n,e,t),void 0)):void 0},render:null,renderEnd:function(n){this.elements=n,null!=this.attr.visible&&m(this,this.model,this.cntx)}}}(n),function(){var e,r,o=n.getStatement();(function(){e=function(n,e,t,r,i){o[n].getNodes(e,t,r,i)},r=function(n,e,t,r,o,i){var l=[];if(builder_build(n,e,t,r,o,l),null==i)return l;for(var s=i.length,u=l.length,a=-1;u>++a;)i[s+a]=l[a];return l}})(),function(){function e(n,e,r,o,i,l){for(this.model=r,this.ctx=o,this.controller=l,this.refresh=t(this.refresh,this),this.binder=W(this.refresh),this.Switch=[{node:n,elements:null}],H(n.expression,r,o,l,this.binder);n=n.nextSibling,null!=n&&"else"===n.tagName;)this.Switch.push({node:n,elements:null}),n.expression&&H(n.expression,r,o,l,this.binder)}e.prototype={refresh:function(){(null!=this.elements||value)&&(null==this.elements?(l(u(this,this.template,this.model,this.cntx),this.placeholder),this.$=w(this.elements)):(null==this.$&&(this.$=w(this.elements)),this.$[value?"show":"hide"]()),this.onchange&&this.onchange(value))},dispose:function(){V(this.expr,this.model,this,this.binder),this.onchange=null,this.elements=null}},n.registerHandler("+if",e)}()}()}(Mask,Compo),Mask.Compo=Compo,Mask.jmask=jmask,exports.mask=Mask});