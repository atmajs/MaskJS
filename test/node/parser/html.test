UTest({
	'content' () {
		var template = `Lorem ipsum doler!`;
		var node = parseHtml(template);
		eq_(node.content, template);
	},
	'node':{
		'single notation' () {
			var template = `<div/>`;
			var node = parseHtml(template);
			eq_(node.tagName, 'div');
		},
		'open-close notation' () {
			var template = `<div > </div>`;
			var node = parseHtml(template);
			eq_(node.tagName, 'div');
		},
		'attributes' () {
			[
				`<div id='qux' data-name="foo bar daz" checked='checked'> </div>`,
				`
					<div
						id = 'qux'
						data-name = "foo bar daz"
						checked
					> </div>
				`,
				`
					<div
						checked id = qux
						data-name = 'foo bar daz'
					> </ div >
				`,
			].forEach(str => {
				var node = parseHtml(str);
				eq_(node.tagName, 'div');
				has_(node.attr, {
					'id': 'qux',
					'data-name': 'foo bar daz',
					'checked': 'checked'
				});
			});
		}
	},
	'children': {
		'text' () {
			var template = `<span>Foo</span>`;
			var node = parseHtml(template);
			eq_(node.tagName, 'span');
			eq_(node.nodes[0].content, 'Foo');
		},
		'nodes' () {
			var template = `
				<section>
					Lorem <li>ipsum</li> doler
				</section>
			`;

			var node = parseHtml(template);
			eq_(node.tagName, 'section');
			var nodes = node.nodes;
			eq_(nodes.length, 3);
			eq_(nodes[0].content.trim(), 'Lorem');
			eq_(nodes[1].tagName, 'li');
			eq_(nodes[1].nodes[0].content, 'ipsum');
			eq_(nodes[2].content.trim(), 'doler');
		},
		'implies close' () {
			var template = `
				<ul>
					<li>A
					<li><div>B
				</ul>
			`;
			var node = parseHtml(template);
			return UTest
				.domtest
				.use('jmask')
				.process(node, `
					find('ul') > children('li') {
						length 2;
						eq(0) > equal ($.text().trim(), 'A');
						eq(1) > children('div') > equal ($.text().trim(), 'B');
					}
				`);
		}
	},
	'expression' () {
		var template = `
			<if expression='foo%2 === 1'>Hello</if>
		`;

		var node = parseHtml(template);
		eq_(node.tagName, 'if');
		eq_(node.expression, 'foo%2 === 1');
		eq_(node.type, mask.Dom.STATEMENT);
		eq_(node.nodes[0].content, 'Hello')
	},
	'parsers': {
		'method' () {
			var template = `
				<mask>
				function foo() {
					var a = 10;
				}
				</mask>
			`;

			var node = parseHtml(template);
			eq_(node.tagName, 'function');
			eq_(node.body.trim(), 'var a = 10;');
		}
	},
	'embedded html': {
		'simple' () {
			var template = `
				div {
					<span>Hello</span>
				}
			`;
			return UTest
				.domtest
				.use('jmask')
				.process(Mask.parse(template), `
					filter('div') {
						find('span') > text ("Hello");
					}
				`);
		},
		'nested mix' () {
			var template = `
				<section>
					<mask>
						h4.header {
							<span>Foo</span>
						}
					</mask>
				</section>
			`;
			return UTest
				.domtest
				.use('jmask')
				.process(Mask.parse(template), `
					find('section') >
						find('.header') >
							find ('span') >
								text ("Foo");
				`);
		}
	}
});

function parseHtml(template) {
	return Mask.parseHtml(template.trim());
}