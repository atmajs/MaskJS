/*!
 * MaskJS v0.10.0
 * Part of the Atma.js Project
 * http://atmajs.com/
 *
 * MIT license
 * http://opensource.org/licenses/MIT
 *
 * (c) 2012, 2014 Atma.js and other contributors
 */
!function(n,e){"use strict";function t(){return e(i,r,o)}var r,o,i="undefined"==typeof window||null==window.navigator?global:window;return"undefined"==typeof exports||null!=n&&n!==exports&&n!==i||(n=exports),o=i.document,r=n||i,"function"==typeof define&&define.amd?define(t):t()}(this,function(global,exports,document){"use strict";function util_interpolate(n,e,t,r,o,i,l){for(var u,s,a,c,f,d=n.length,p=-1,h=null,g="",m=!0;++p<d;){if(m===!0)null==h?g+=n[p]:h.push(n[p]);else{if(c=n[p],s=null,a=c.indexOf(":"),-1===a)s=obj_getPropertyEx(c,t,r,i);else{if(u=a>0?c.substring(0,a).trim():"",""===u&&(u="expression"),c=c.substring(a+1),f=custom_Utils[u],null==f){log_error("Undefined custom util `%s`",u);continue}s=f(c,t,r,o,i,l,e)}null!=s&&("object"==typeof s&&null==h&&(h=[g]),null==h?g+=s:h.push(s))}m=!m}return null==h?g:h}function attr_extend(n,e){if(null==n&&(n={}),null==e)return n;for(var t in e)"class"!==t||"string"!=typeof n[t]?n[t]=e[t]:n[t]+=" "+e[t];return n}function Template(n){this.template=n,this.index=0,this.length=n.length}function VarStatement(){}var coll_each,coll_remove,coll_map,coll_indexOf,coll_find;if(function(){coll_each=function(n,e,t){if(null==t&&(t=n),null==n)return n;for(var r=n.length,o=0;r>o;o++)e.call(t,n[o],o);return t},coll_indexOf=function(n,e){if(null==n)return-1;for(var t=n.length,r=0;t>r;r++)if(n[r]===e)return r;return-1},coll_remove=function(n,e){var t=coll_indexOf(n,e);return-1===t?!1:(n.splice(t,1),!0)},coll_map=function(n,e,t){var r=new Array(n.length);return coll_each(n,function(n,t){r[t]=e.call(this,n,t)},t),r},coll_find=function(n,e,t){for(var r=n.length,o=0;r>o;o++)if(e.call(t||n,n[o],o))return!0;return!1}}(),void 0===Array.prototype.forEach&&(Array.prototype.forEach=function(n,e){coll_each(this,n,e)}),void 0===Array.prototype.indexOf&&(Array.prototype.indexOf=function(n){return coll_indexOf(this,n)}),null==String.prototype.trim&&(String.prototype.trim=function(){var n,e=-1,t=this.length;if(0===t)return this;for(;++e<t&&(n=this.charCodeAt(e),!(n>32)););for(;0!==--t&&(n=this.charCodeAt(t),!(n>32)););return 0!==e&&t!==length-1?this.substring(e,t+1):this}),null==Function.prototype.bind){var _Array_slice;Function.prototype.bind=function(){if(arguments.length<2&&"undefined"==typeof arguments[0])return this;var n=this,e=_Array_slice.call(arguments),t=e.shift();return function(){return n.apply(t,e.concat(_Array_slice.call(arguments)))}}}var is_Function,is_Array,is_ArrayLike,is_String,is_Object,is_notEmptyString,is_rawObject;!function(){is_Function=function(n){return"function"==typeof n},is_Object=function(n){return null!=n&&"object"==typeof n},is_Array=is_ArrayLike=function(n){return null!=n&&"object"==typeof n&&"number"==typeof n.length&&"function"==typeof n.slice},is_String=function(n){return"string"==typeof n},is_notEmptyString=function(n){return"string"==typeof n&&""!==n},is_rawObject=function(n){return null==n||"object"!=typeof n?!1:n.constructor===Object}}();var obj_getProperty,obj_setProperty,obj_extend,obj_create;!function(){obj_getProperty=function(n,e){if("."===e)return n;for(var t=e.split("."),r=t.length,o=-1;null!=n&&++o<r;)n=n[t[o]];return n},obj_setProperty=function(n,e,t){for(var r,o=e.split("."),i=o.length-1,l=-1;++l<i;)r=o[l],null==n[r]&&(n[r]={}),n=n[r];n[o[l]]=t},obj_extend=function(n,e){if(null==e)return n||{};if(null==n)return obj_create(e);for(var t in e)n[t]=e[t];return n},obj_create=Object.create||function(n){var e=function(){};return e.prototype=n,new e}}();var arr_remove,arr_each,arr_indexOf,arr_contains;!function(){arr_remove=function(n,e){var t=n.indexOf(e);return-1===t?!1:(n.splice(t,1),!0)},arr_each=function(n,e,t){n.forEach(e,t)},arr_indexOf=function(n,e){return n.indexOf(e)},arr_contains=function(n,e){return-1!==n.indexOf(e)}}();var fn_proxy,fn_apply,fn_doNothing;!function(){fn_proxy=function(n,e){return function(){return fn_apply(n,e,arguments)}},fn_apply=function(n,e,t){var r=t.length;return 0===r?n.call(e):1===r?n.call(e,t[0]):2===r?n.call(e,t[0],t[1]):3===r?n.call(e,t[0],t[1],t[2]):4===r?n.call(e,t[0],t[1],t[2],t[3]):n.apply(e,t)},fn_doNothing=function(){return!1}}();var _Array_slice=Array.prototype.slice,_Array_splice=Array.prototype.splice,_Array_indexOf=Array.prototype.indexOf,_Object_create=obj_create,_Object_hasOwnProp=Object.hasOwnProperty,__rgxEscapedChar={"'":/\\'/g,'"':/\\"/g,"{":/\\\{/g,">":/\\>/g,";":/\\>/g},__cfg={allowCache:!0};Template.prototype={skipWhitespace:function(){for(var n=this.template,e=this.index,t=this.length;t>e&&!(n.charCodeAt(e)>32);e++);return this.index=e,this},skipToAttributeBreak:function(){var n,e=this.template,t=this.index,r=this.length;do if(n=e.charCodeAt(++t),35===n&&123===e.charCodeAt(t+1))return this.index=t,this.sliceToChar("}"),void this.index++;while(46!==n&&35!==n&&62!==n&&123!==n&&32!==n&&59!==n&&r>t);this.index=t},sliceToChar:function(n){for(var e,t,r=this.template,o=this.index,i=o,l=!1;(t=r.indexOf(n,o))>-1&&(o=t,92===r.charCodeAt(o-1));)l=!0,o++;return e=r.substring(i,o),this.index=o,l?e.replace(__rgxEscapedChar[n],n):e}};var arr_pushMany;!function(){arr_pushMany=function(n,e){if(null!=e&&null!=n)for(var t=n.length,r=e.length,o=-1;++o<r;)n[t+o]=e[o]}}();var obj_getPropertyEx,obj_toDictionary;!function(){function n(n,e,t,r){for(var o=n;r>t&&null!=o;)o=o[e[t]],t++;return o}obj_getPropertyEx=function(e,t,r,o){if("."===e)return t;var i,l=e.split("."),u=t,s=-1,a=l.length,c=l[0];for("$c"===c?(u=o,s++):"$a"===c?(u=o&&o.attr,s++):"$u"===c?(u=customUtil_$utils,s++):"$ctx"===c&&(u=r,s++),i=s;null!=u&&++s<a;)u=u[l[s]];if(null==u&&-1===i)for(var f;null!=o;){if(f=o.scope,null!=f&&(u=n(f,l,0,a),null!=u))return u;o=o.parent}return u},obj_toDictionary=function(n){var e,t=[],r=0;for(e in n)t[r++]={key:e,value:n[e]};return t}}();var listeners_on,listeners_off,listeners_emit;!function(){listeners_on=function(e,t){(n[e]||(n[e]=[])).push(t)},listeners_off=function(e,t){return null==t?void(n[e]=[]):void arr_remove(n[e],t)},listeners_emit=function(e){var t=n[e];if(null!=t)for(var r=t.length,o=-1,i=_Array_slice.call(arguments,1);++o<r;)t[o].apply(null,i)};var n={compoCreated:null,error:null}}();var throw_,parser_error,parser_warn,log_warn,log_error;!function(){function n(n){function r(t,r,o){this.type="Parser"+n,this.message=t,this.original=r,this.index=o,this.stack=e()}return t(r,Error),r}function e(){var n=(new Error).stack;return null==n?null:n.split("\n").slice(6,8).join("\n")}function t(n,e){Object.create&&(n.prototype=Object.create(e.prototype))}function r(n,e,t,r,s,f,d){e+=o(s)+i(t,r,d)+u(n,t,r)+l(f);var p="error"===n?a:c;return new p(e,t,r)}function o(n){return null==n?"":("number"==typeof n&&(n=String.fromCharCode(n))," Invalid token: `"+n+"`")}function i(n,e,t){if(null==e&&!t)return"";var r=n.substring(0,e).split("\n"),o=r.length,i=e+1-r.slice(0,o-2).join("\n").length;return" at "+(t||"")+"("+o+":"+i+")"}function l(n){var e={2:"tag",3:"tag",5:"attribute key",6:"attribute value",8:"literal","var":"VarStatement",expr:"Expression"};return null==n||null==e[n]?"":"\n    , when parsing "+e[n]}function u(n,e,t){if(null==t)return"";var r=e.substring(t);return r.length>30&&(r=r.substring(0,30)+"..."),"\n    Parser "+n+" at: "+r}if(throw_=function(n){log_error(n),listeners_emit("error",n)},parser_error=function(n,e,t,o,i,l){var u=r("error",n,e,t,o,i,l);log_error(u.message),log_warn(u.stack),listeners_emit("error",u)},parser_warn=function(n,e,t,o,i,l){var u=r("warn",n,e,t,o,i,l);log_warn(u.message),log_warn(u.stack),listeners_emit("error",u)},"undefined"==typeof console)log_warn=log_error=function(){};else{var s=Function.prototype.bind;log_warn=s.call(console.warn,console,"MaskJS [Warn] :"),log_error=s.call(console.error,console,"MaskJS [Error] :")}var a=n("Error"),c=n("Warning")}();var custom_Utils,custom_Statements,custom_Attributes,custom_Tags,custom_Tags_defs,customUtil_get,customUtil_$utils,customUtil_register,customTag_register;!function(){function n(){custom_Utils={expression:function(n,e,t,r,o){return ExpressionUtil.eval(n,e,t,o)}},custom_Statements={},custom_Attributes={"class":null,id:null,style:null,name:null,type:null},custom_Tags={div:null,span:null,input:null,button:null,textarea:null,select:null,option:null,h1:null,h2:null,h3:null,h4:null,h5:null,h6:null,a:null,p:null,img:null,table:null,td:null,tr:null,pre:null,ul:null,li:null,ol:null,i:null,em:null,b:null,strong:null,form:null,audio:null,video:null,canvas:null,svg:null},custom_Tags_defs={}}n(),function(n){function e(n){function e(n,e){this.tagName=n.tagName,this.attr=n.attr,this.expression=n.expression,this.nodes=n.nodes,this.nextSibling=n.nextSibling,this.parent=e,this.components=null}return e.prototype=n,e}customTag_register=function(t,r){null!=r&&"object"==typeof r&&(r.__Ctor=e(r)),n[t]=r}}(custom_Tags),function(n){function e(n){if("parsed"===n.arguments)return r(n.process);var e=fn_proxy(n.process||t,n);return e.util=n,e}function t(n,e,t,r,o,i,l){return"node"===l?(this.nodeRenderStart(n,e,t,r,o),this.node(n,e,t,r,o)):(this.attrRenderStart(n,e,t,r,o,i),this.attr(n,e,t,r,o,i))}function r(n){return function(e,t,r,o,i){var l=ExpressionUtil.evalStatements(e,t,r,i);return n.apply(null,l)}}customUtil_$utils={},customUtil_register=function(t,r){return is_Function(r)?void(n[t]=r):(n[t]=e(r),void("parsed"===r.arguments&&(customUtil_$utils[t]=r.process)))},customUtil_get=function(e){return null!=e?n[e]:n}}(custom_Utils)}();var ExpressionUtil=function(){function n(n,e){null==e&&(e=!1),t=n,o=0,i=n.length,r=new ne;var l,C,z=r,Y=X;n:for(;;)if(i>o&&(l=t.charCodeAt(o))<33)o++;else{if(o>=i)break;if(C=be(l),null==C&&i>o)break;if(C===F){if(e===!0)return[r,o];break}if(e===!0){var q=z.parent;if(null!=q&&q.type===R&&null==q.parent&&C===I)return[r,o]}if(C===F)break;switch(C){case A:z=de(z,new ee(z)),z=de(z,new ne(z)),o++;continue;case N:var Z=R;Y===J&&(Y=X,Z=W);do z=z.parent;while(null!=z&&z.type!==Z);if(Z===R&&(z=z.parent),null==z){he("OutOfAst Exception",l);break n}o++;continue;case E:z=de(z,new oe(z)),C=L,o++;break;case O:for(;null!=z&&z.type!==K;)z=z.parent;o++;continue;case S:if(Y!==J){Y=X;do z=z.parent;while(null!=z&&z.type!==R&&z.type!==K);if(o++,null==z){he("Unexpected comma",l);break n}if(z.type===K){C=L;break}continue}do z=z.parent;while(null!=z&&z.type!==W);if(null==z){he("OutOfAst Exception",l);break n}z=z.newArgument(),o++;continue;case D:r=new ce(r),z=r.case1,o++;continue;case M:z=r.case2,o++;continue;case T:l=t.charCodeAt(o+1),l>=48&&57>=l?C=$:(C=z.type===R?I:U,o++);break;case k:if(z.type===B||z.type===G||z.type===V){z=de(z,new se(z)),z=z.getBody(),o++;continue}z=de(z,new re(z)),z=z.body,o++;continue;case j:do z=z.parent;while(null!=z&&z.type!==G&&z.type!==Q);o++;continue}if(z.type===R&&(z=de(z,new ee(z))),u!==C&&h!==C||null!=z.body)switch(C){case u:case s:case c:case a:case f:case p:case d:case g:case m:case v:case y:case b:case _:case x:case w:for(;z&&z.type!==H;)z=z.parent;if(null==z.body)return he("Unexpected operator",l);z.join=C;do z=z.parent;while(null!=z&&z.type!==R);if(null==z)return he("Unexpected operator",l);o++;continue;case P:case $:if(null!=z.body&&null==z.join)return he("Directive expected",l);P===C&&(o++,de(z,new te(me(l))),o++),$===C&&de(z,new te(ve(l)));continue;case I:case U:var pe=ye();if(C===I&&("null"===pe&&(pe=null),"false"===pe&&(pe=!1),"true"===pe&&(pe=!0),"string"!=typeof pe)){de(z,new te(pe));continue}for(;i>o;){l=t.charCodeAt(o);{if(!(33>l))break;o++}}if(40===l){Y=J,o++;var _e=de(z,new ie(z,pe));z=_e.newArgument();continue}var xe=C===I?le:ue;z=de(z,new xe(z,pe));break;case L:if(125===ge())continue;var we=ye();if(58!==ge())return he("Object parser. Semicolon expeted",l);o++,z=z.nextProp(we),C=I;continue}else z=de(z,new ae(z,C)),o++}return null==z.body&&z.type===H?he("Unexpected end of expression",l):(fe(r),r)}function e(t,r,o,i){var C,A;if(null==t)return null;if("."===t)return r;if(A="string"==typeof t?l.hasOwnProperty(t)===!0?l[t]:l[t]=n(t):t,null==A)return null;var N,k,j,E=A.type;if(R===E){var O,S;n:for(N=0,j=A.body.length;j>N;N++)if(k=A.body[N],O=e(k,r,o,i),null!=S&&null!=S.join){if(S.join===p)if(C)C=O;else for(;j>N&&A.body[N].join!==d;N++);if(S.join===d){if(C)break n;if(O){C=O;break n}}switch(S.join){case u:C-=O;break;case s:C+=O;break;case a:C/=O;break;case c:C*=O;break;case f:C%=O;break;case v:C=C!=O;break;case y:C=C!==O;break;case g:C=C==O;break;case m:C=C===O;break;case b:C=C>O;break;case _:C=C>=O;break;case x:C=O>C;break;case w:C=O>=C}S=k}else S=k,C=O}if(H===E)return C=e(A.body,r,o,i),null==A.next?C:pe(A.next,C);if(z===E)return A.body;if(Q===E){var T=A.body.body,D=T.length,N=-1;for(C=new Array(D);++N<D;)C[N]=e(T[N],r,o,i);return C}if(K===E){C={};var M=A.props;for(var F in M)C[F]=e(M[F],r,o,i);return C}if(B===E||W===E||G===E||V===E)return pe(A,r,o,i);if(Y===E)switch(C=e(A.body,r,o,i),A.prefix){case u:C=-C;break;case h:C=!C}return q===E&&(C=e(A.body,r,o,i),C=e(C?A.case1:A.case2,r,o,i)),C}var t,r,o=0,i=0,l={},u="-",s="+",a="/",c="*",f="%",d="||",p="&&",h="!",g="==",m="===",v="!=",y="!==",b=">",_=">=",x="<",w="<=",C=".",A=20,N=21,k=22,j=23,E=24,O=25,S=26,T=27,D=28,M=29,F=30,I=31,U=32,P=33,$=34,L=35,R=1,H=2,B=3,W=4,V=5,G=6,z=7,K=10,Q=11,Y=12,q=13,X=1,J=2,Z={};Z[C]=1,Z[a]=2,Z[c]=2,Z[u]=3,Z[s]=3,Z[b]=4,Z[_]=4,Z[x]=4,Z[w]=4,Z[g]=5,Z[m]=5,Z[v]=5,Z[y]=5,Z[p]=6,Z[d]=6;var ne,ee,te,re,oe,ie,le,ue,se,ae,ce;!function(){ne=function(n){this.parent=n,this.type=R,this.body=[],this.join=null},ee=function(n){this.parent=n},ee.prototype={constructor:ee,type:H,join:null,body:null},te=function(n){this.type=z,this.body=n,this.join=null},re=function(n){this.type=Q,this.parent=n,this.body=new ne(this)},oe=function(n){this.type=K,this.parent=n,this.props={}},oe.prototype={nextProp:function(n){var e=new ee(this);return this.props[n]=e,e}},ie=function(n,e){this.parent=n,this.type=W,this.body=e,this.arguments=[],this.next=null},ie.prototype={constructor:ie,newArgument:function(){var n=new ne(this);return this.arguments.push(n),n}},le=function(n,e){this.type=B,this.parent=n,this.body=e,this.next=null},ue=function(n,e){this.type=V,this.parent=n,this.body=e,this.next=null},se=function(n){this.parent=n,this.body=new ee(this),this.body.body=new ne(this.body),this.next=null},se.prototype={type:G,getBody:function(){return this.body.body}},ae=function(n,e){this.parent=n,this.prefix=e},ae.prototype={constructor:ae,type:Y,body:null},ce=function(n){this.body=n,this.case1=new ne(this),this.case2=new ne(this)},ce.prototype={constructor:ce,type:q,case1:null,case2:null}}();var fe,de;!function(){function n(n){if(0===n.length)return null;var e=new ne(n[0].parent);return e.join=n[n.length-1].join,e.body=n,e}de=function(n,e){switch(n.type){case R:return n.body.push(e),e;case H:if(e.type===V||e.type===G)return n.next=e;case Y:return n.body=e;case B:case W:case V:case G:return n.next=e}return he("Invalid expression")},fe=function(e){if(e.type!==R)return void(null!=e.body&&"object"==typeof e.body&&fe(e.body));for(var t,r,o,i=e.body,l=0,u=i.length;u>l;l++)fe(i[l]);for(l=1;u>l&&(t=i[l],r=i[l-1],!(Z[r.join]>Z[t.join]));l++);if(l!==u){for(o=[i[0]],l=1;u>l;l++){t=i[l],r=i[l-1];var s=Z[r.join];if(s>Z[t.join]&&u-1>l){for(var a,c,f=l;++l<u&&(a=i[l].join,null!=a)&&!(s<=Z[a]););c=i.slice(f,l+1),t=n(c),fe(t)}o.push(t)}e.body=o}}}();var pe,he;!function(){he=function(n,e){return parser_error(n,t,o,e,"expr")},pe=function(n,t,r,o){var i,l,u,s,a,c=n,f=n.body;if("$c"===f){l=o;var d=c.next,p=null!=d&&d.body;if(null!=p&&null==l[p]){if(d.type===W&&"function"==typeof Compo.prototype[p])i=o,l=Compo.prototype[p],c=d;else for(;;){if(l=l.parent,null==l)break;if(null!=l[p]){i=l,l=l[p],c=d;break}}null==l&&(f="$c."+p,c=d)}}else if("$a"===f)l=o&&o.attr;else if("$u"===f)l=customUtil_$utils;else if("$ctx"===f)l=r;else if(null!=t&&(i=t,l=t[f]),null==l)for(;null!=o&&(i=o.scope,null!=i&&(l=i[f]),null==l);)o=o.parent;if(null==l)return(null==c||null!=c.next)&&log_warn("<mask:expression> Accessor error:",f),null;for(;;){if(c.type===W){for(u=[],s=-1,a=c.arguments.length;++s<a;)u[s]=e(c.arguments[s],t,r,o);l=l.apply(i,u)}if(null==l||null==c.next)break;if(c=c.next,f=c.type===G?e(c.body,t,r,o):c.body,i=l,l=l[f],null==l)break}return l}}();var ge,me,ve,ye,be;!function(){ge=function(){for(var n;i>o;){if(n=t.charCodeAt(o),n>32)return n;o++}return null},me=function(n){for(var e,r,i=!1,l=39===n?"'":'"',u=o;(e=t.indexOf(l,o))>-1&&(o=e,92===t.charCodeAt(e-1));)i=!0,o++;return r=t.substring(u,o),i===!0&&(r=r.replace(__rgxEscapedChar[l],l)),r},ve=function(){for(var n,e,r=o;;){if(n=t.charCodeAt(o),46===n){if(e===!0)return he("Invalid number",n),null;e=!0}if(!((n>=48&&57>=n||46===n)&&i>o))break;o++}return+t.substring(r,o)},ye=function(){var n,e=o,r=t.charCodeAt(o);if(34===r||39===r)return o++,n=me(r),o++,n;for(;;){if(o===i)break;if(r=t.charCodeAt(o),36!==r&&95!==r){if(!(r>=48&&57>=r||r>=65&&90>=r||r>=97&&122>=r))break;o++}else o++}return t.substring(e,o)},be=function(n){if(null==n&&o===i)return null;switch(n){case 40:return A;case 41:return N;case 123:return E;case 125:return O;case 91:return k;case 93:return j;case 44:return S;case 46:return T;case 59:return F;case 43:return s;case 45:return u;case 42:return c;case 47:return a;case 37:return f;case 61:return t.charCodeAt(++o)!==n?(he("Assignment violation: View can only access model/controllers","="),null):t.charCodeAt(o+1)===n?(o++,m):g;case 33:return 61===t.charCodeAt(o+1)?(o++,61===t.charCodeAt(o+1)?(o++,y):v):h;case 62:return 61===t.charCodeAt(o+1)?(o++,_):b;case 60:return 61===t.charCodeAt(o+1)?(o++,w):x;case 38:return t.charCodeAt(++o)!==n?(he("Not supported: Bitwise AND",n),null):p;case 124:return t.charCodeAt(++o)!==n?(he("Not supported: Bitwise OR",n),null):d;case 63:return D;case 58:return M}return n>=65&&90>=n||n>=97&&122>=n||95===n||36===n?I:n>=48&&57>=n?$:34===n||39===n?P:(he("Unexpected or unsupported directive",n),null)}}();var _e;return function(){function t(n,l,u,s){if(null==n)return null;var a,c,f=n.type;if(R===f)for(var d=n.body,p=d.length,h=-1;++h<p;)c=t(d[h],l,u,s),a=o(a,c);if(B===f||V===f||G===f){for(var g,m=n.body,v=n.next;null!=v;){if(g=v.type,W===g)return t(v,l,u,s);if(B!==g&&V!==g&&G!==g)return log_error("Ast Exception: next should be a symbol/function ref"),null;var y=g===G?e(v.body,l,u,s):v.body;if("string"!=typeof y)return log_warn("Can`t extract accessor name",m),null;m+="."+y,v=v.next}return m}switch(f){case H:case Y:case q:c=t(n.body,l,u,s),a=o(a,c)}if(q===f&&(c=t(r.case1,l,u,s),a=o(a,c),c=t(r.case2,l,u,s),a=o(a,c)),W===f){for(var b=n.arguments,p=b.length,h=-1;++h<p;)c=t(b[h],l,u,s),a=o(a,c);c=null;var _=n;n:for(;_=_.parent;)switch(_.type){case B:case V:case G:c=_.body+(null==c?"":"."+c);break;case R:case H:break n;default:c=null;break n}null!=c&&(a=o(a,c)),n.next&&(c=t(n.next,l,u,s),a=o(a,{accessor:i(n),ref:c}))}return a}function o(n,e){if(null==n)return e;if(null==e)return n;if(("object"!=typeof n||null==n.length)&&(n=[n]),"object"!=typeof e||null==e.length)return-1===n.indexOf(e)&&n.push(e),n;for(var t=0,r=e.length;r>t;t++)-1===n.indexOf(e[t])&&n.push(e[t]);return n}function i(n){var e=n;n:for(;e.parent;){switch(e.parent.type){case R:case H:break n}e=e.parent}return l(e,n.next)}function l(n,e){if(n===e||null==n)return null;if("object"!=typeof n)return n;if(null!=n.length&&"function"==typeof n.splice){for(var t=[],r=0,o=n.length;o>r;r++)t[r]=l(n[r],e);return t}var i={};for(var u in n)null!=n[u]&&"parent"!==u&&(i[u]=l(n[u],e));return i}_e=function(e,r,o,i){return"string"==typeof e&&(e=n(e)),t(e,r,o,i)}}(),{parse:n,eval:e,varRefs:_e,evalStatements:function(t,r,o,i){for(var l=n(t).body,u=[],s=l.length,a=-1,c=new ne;++a<s;)c.body.push(l[a]),null==l[a].join&&(u.push(e(c,r,o,i)),c.body.length=0);return u}}}(),Dom;!function(){function n(n){var e=this.nodes;if(null==e)return void(this.nodes=[n]);e.push(n);var t=e[e.length-2];t.nextSibling=n}function e(n,e){this.type=Dom.NODE,this.tagName=n,this.parent=e,this.attr={}}function t(n,e){this.content=n,this.parent=e}function r(n,e,t){this.tagName=n,this.parent=e,this.controller=t,this.attr={}}function o(){}var i=1,l=2,u=3,s=4,a=9,c=10,f=15;e.prototype={constructor:e,type:i,tagName:null,parent:null,attr:null,nodes:null,expression:null,appendChild:n,stringify:null,__single:null},t.prototype={type:l,content:null,parent:null},r.prototype={constructor:r,type:s,parent:null,attr:null,controller:null,nodes:null,components:null,model:null,modelRef:null},o.prototype={constructor:o,type:u,nodes:null,appendChild:n},Dom={NODE:i,TEXTNODE:l,FRAGMENT:u,COMPONENT:s,CONTROLLER:a,SET:c,STATEMENT:f,Node:e,TextNode:t,Fragment:o,Component:r}}(),function(){function n(n,e,t,r){function o(n){return ExpressionUtil.eval(n,e,t,r)}if(o(n.expression))return n.nodes;for(;;){if(n=n.nextSibling,null==n||"else"!==n.tagName)break;var i=n.expression;if(null==i||""===i||o(i))return n.nodes}return null}custom_Statements["if"]={getNodes:n,render:function(e,t,r,o,i,l){var u=n(e,t,r,i);null!=u&&builder_build(u,t,r,o,i,l)}}}(),function(){function n(n){var e=function(){};return e.prototype={type:Dom.COMPONENT,compoName:n,renderEnd:u,dispose:s},e}function e(n,e,r,o,i,l,u,s){builder_build(t(r,n,e[0],e[1],e[2]),o,i,l,u,s)}function t(n,e,t,i,l){return"of"===l?is_Array(e)===!1?(log_error("<ForStatement> Value is not enumerable",e),null):r(n,e,t,i):"in"===l?"object"!=typeof e?(log_warn("<ForStatement> Value is not an object",e),null):(is_Array(e)&&log_warn("<mask:for> Consider to use `for..of` for Arrays"),o(n,e,t,i)):void 0}function r(n,e,t,r){for(var o,l=-1,u=e.length,s=new Array(u);++l<u;)o={},o[t]=e[l],r&&(o[r]=l),s[l]=i(p,n,o);return s}function o(n,e,t,r){var o,l,u,s=[],a=0;for(l in e)u=e[l],o={},o[t]=l,r&&(o[r]=u),s[a++]=i(h,n,o);return s}function i(n,e,t){return{type:Dom.COMPONENT,tagName:n,nodes:e,controller:{compoName:n,scope:t,renderEnd:u,dispose:s}}}function l(n,e){return{compoName:n,scope:e,renderEnd:u,dispose:s}}function u(n){this.elements=n}function s(){this.elements&&(this.elements.length=0)}function a(n){g=n,v=n.length,m=0;var e,t,r,o,i;if(i=c(),40===i&&(o=!0,m++,c()),e=f(),i=c(),44===i){if(o!==!0)return d("Parenthese must be used in multiple var declarion");m++,c(),t=f()}if(o){if(i=c(),41!==i)return d("Closing parenthese expected");m++}i=c();var r;return 105===i&&110===g.charCodeAt(++m)&&(r="in"),111===i&&102===g.charCodeAt(++m)&&(r="of"),null==r?d("Invalid FOR statement. (in|of) expected"):(y[0]=e,y[1]=t,y[2]=r,y[3]=g.substring(++m),y)}function c(){for(var n;v>m;m++)if(n=g.charCodeAt(m),!(33>n))return n;return-1}function f(){for(var n,e=m;v>m;m++)if(n=g.charCodeAt(m),n>48&&57>n){if(e===m)return d("Variable name begins with a digit")}else if(!(36===n||95===n||n>=97&&122>=n||n>=65&&90>=n))break;return e===m?d("Variable declaration expected"):g.substring(e,m)}function d(n){throw new Error("<ForStatement parser> "+n+" `"+g.substring(m,20)+"`")}var p="for..of/item",h="for..in/item";custom_Statements["for"]={render:function(n,t,r,o,i,l){a(n.expression);var u=ExpressionUtil.eval(y[3],t,r,i);null!=u&&e(u,y,n.nodes,t,r,o,i,l)},build:e,parseFor:a,createForItem:i,getNodes:t,getHandler:function(n,e){return l(n,e)}},custom_Tags[p]=n(p),custom_Tags[h]=n(h);var g,m,v,y=["prop1","prop2","in|of","expression"]}(),function(){function n(n,t,r,o,i,l){for(var u,s=t.length,a=-1,c=n;++a<s;)if(u=e(a,c,i),builder_build(c,t[a],r,o,u,l),null!=u.components){var f=i.components;null==f&&(f=i.components=[]),arr_pushMany(i.components,u.components)}}function e(n,e,t){return{type:Dom.COMPONENT,compoName:"each::item",scope:{index:n},parent:t,nodes:e,model:null,attr:null,components:null,elements:null,ID:null}}custom_Statements.each={render:function(e,t,r,o,i,l){var u=ExpressionUtil.eval(e.expression,t,r,i);null!=u&&n(e.nodes,u,r,o,i,l)},createItem:e,build:n}}(),custom_Statements["with"]={render:function(n,e,t,r,o,i){var l=ExpressionUtil.eval(n.expression,e,t,o);builder_build(n.nodes,l,t,r,o,i)}},function(){function n(n,t,r,o,i){if(null==t)return null;for(var l,u,s,a,c=t.length,f=-1;++f<c;)if(l=t[f],"default"!==l.tagName)if("case"===l.tagName)if(u=l.expression){if(e(u,r,o,i)==n){s=l;break}}else log_warn("<mask:switch:case> Expression expected");else log_warn("<mask:switch> Case expected",l.tagName);else a=l;return null==s&&(s=a),null!=s?s.nodes:null}var e=ExpressionUtil.eval;custom_Statements["switch"]={render:function(t,r,o,i,l,u){var s=e(t.expression,r,o,l),a=n(s,t.nodes,r,o,l);null!=a&&builder_build(a,r,o,i,l,u)},getNodes:n}}(),function(){function n(n){this.parent=n,this.compoName="include",this.components=[],this.templates=null}custom_Statements.include={render:function(e,t,r,o,i,l){for(var u,s=ExpressionUtil.evalStatements(e.expression);null!=i&&(u=i.resource,null==u);)i=i.parent;var a=new n(i),c=Compo.pause(a,r);include.instance(u&&u.url).load.apply(u,s).done(function(n){a.templates=n.load,builder_build(e.nodes,t,r,o,a,l),c()})}}}(),custom_Statements["import"]={render:function(n,e,t,r,o,i){var l=n.expression,u=ExpressionUtil.evalStatements(l,e,t,o),s=u[0];if("string"!=typeof s)return void log_error("<mask:import> Invalid argument",l);for(;;){if("include"===o.compoName)break;if(o=o.parent,null==o)break}if(null!=o){var a=o.templates[s];null!=a&&builder_build(Parser.parse(a),e,t,r,o,i)}}},custom_Tags["var"]=VarStatement,VarStatement.prototype={renderStart:function(n,e){var t,r,o=this.parent,i=o.scope;null==i&&(i=o.scope={}),this.model={};for(t in this.attr)r=ExpressionUtil.eval(this.attr[t],n,e,o),this.model[t]=i[t]=r;this.attr={}},onRenderStartClient:function(){var n=this.parent,e=n.scope;null==e&&(e=n.scope={});for(var t in this.model)e[t]=this.model[t]}},function(){custom_Statements.visible={render:function(n,e,t,r,o,i){var l=[];builder_build(n.nodes,e,t,r,o,l),arr_pushMany(i,l);for(var u=ExpressionUtil.eval(n.expression,e,t,o),s=0;s<l.length;s++)l[s].style.display=u?"":"none"}}}();var parser_parse,parser_ensureTemplateFunction,parser_setInterpolationQuotes,parser_cleanObject,Parser;!function(n,e,t){function r(n){for(var e=-1;-1!==(e=n.indexOf(u,e))&&n.charCodeAt(e+1)!==f;)e++;if(-1===e)return n;for(var t,r=n.length,i=[],l=0,c=0;;){if(t=o(n,e+2,r,f,d),-1===t)break;for(i[c++]=l===e?"":n.substring(l,e),i[c++]=n.substring(e+2,t),l=e=t+1;-1!==(e=n.indexOf(u,e))&&n.charCodeAt(e+1)!==f;)e++;if(-1===e)break}return r>l&&(i[c]=n.substring(l)),n=null,function(n,e,t,r,o,l){if(null==n){for(var c,f="",d=i.length,p=-1;++p<d;)c=i[p],f+=p%2===1?u+s+c+a:c;return f}return util_interpolate(i,n,e,t,r,o,l)}}var o,i,l,u="~",s="[",a="]",c=126,f=91,d=93;!function(){o=function(n,e,t,r,o){for(var l,u=0,s=e;t>e;e++)if(l=n.charCodeAt(e),34!==l&&39!==l)if(l!==r){if(l===o&&-1===--u)return e}else u++;else e=i(n,e+1,t,34===l?'"':"'");return parser_warn("Group was not closed",n,s),t},l=function(n,e,t){for(var r;t>e;)if(r=n.charCodeAt(e),36!==r&&95!==r){if(!(r>=48&&57>=r||r>=65&&90>=r||r>=97&&122>=r))break;e++}else e++;return e},i=function(n,e,t,r){for(var o=e;-1!==(e=n.indexOf(r,e));){if(92!==n.charCodeAt(e-1))return e;e++}return parser_warn("Quote was not closed",n,o),t}}();var p;!function(){function e(){var n=this.attr,e="var ";for(var t in n)"var "!==e&&(e+=","),e+=t+"="+n[t];return e+";"}p=function(t,r,u,s){var a,c,f=new n("var",s);f.stringify=e;for(var d,p=1,h=2,g=3,m=4,v=p;;)if(u>r&&(c=t.charCodeAt(r))<33)r++;else if(v!==p)if(v!==h)if(v!==g){if(v===m){if(44===c){v=p,r++;continue}break}}else{switch(a=r,r++,c){case 123:case 91:r=o(t,r,u,c,c+2);break;case 39:case 34:r=i(t,r,u,39===c?"'":'"');break;default:for(;u>r&&(c=t.charCodeAt(r),44!==c&&59!==c);)r++;r--}r++,f.attr[d]=t.substring(a,r),v=m}else{if(61!==c)return parser_error("Assignment expected",t,r,c,"var"),[f,r];v=g,r++}else a=r,r=l(t,r,u),d=t.substring(a,r),v=h;return[f,r]}}();var h=2,g=3,m=5,v=6,y=7,b=8,_=9;Parser={parse:function(i){for(var l,u,s,a,x,w,C,A,N=new t,k=N,j=h,E=g,O=0,S=i.length;;)if(S>O&&(w=i.charCodeAt(O))<33)O++;else{if(47===w){if(A=i.charCodeAt(O+1),47===A){for(O++;10!==w&&13!==w&&S>O;)w=i.charCodeAt(++O);continue}if(42===A){O=i.indexOf("*/",O+2)+2,1===O&&(O=S);continue}}if(E===m&&(null!=l&&(N.attr["class"]=r(l),l=null),null!=s&&(N.attr[s]=s,s=null,u=null)),null!=u){if(j===m)null==s?s=u:a=u,null!=s&&null!=a&&("class"!==s?N.attr[s]=a:l=null==l?a:l+" "+a,s=null,a=null);else if(E===g){if("var"===u){var T=p(i,O,S,N);N.appendChild(T[0]),O=T[1],j=h,u=null;continue}x=new n(u,N),N.appendChild(x),N=x,j=m}else if(E===b){if(x=new e(u,N),N.appendChild(x),N.__single===!0)do N=N.parent;while(null!=N&&null!=N.__single);j=h}u=null}if(O>=S){j===m&&(null!=l&&(N.attr["class"]=r(l)),null!=s&&(N.attr[s]=s)),w=null;break}if(j===_){for(N=N.parent;null!=N&&null!=N.__single;)N=N.parent;j=h}switch(w){case 123:E=j,j=h,O++;continue;case 62:E=j,j=h,O++,N.__single=!0;continue;case 59:if(null!=N.nodes){O++;continue}case 125:O++,E=j,j=_;continue;case 39:case 34:j===v?j=m:E=j=b,O++;var D=!1,M=!1,F=39===w?"'":'"';for(C=O;(O=i.indexOf(F,O))>-1&&92===i.charCodeAt(O-1);)D=!0,O++;-1===O&&(parser_warn("Literal has no ending",i,C),O=S),O===C&&(A=i.charCodeAt(O+1),(124===A||A===w)&&(M=!0,C=O+2,O=i.indexOf((124===A?"|":F)+F+F,C),-1===O&&(O=S))),u=i.substring(C,O),D===!0&&(u=u.replace(__rgxEscapedChar[F],F)),(j!==m||"class"!==s)&&(u=r(u)),O+=M?3:1;continue}if(j===h){if(E=g,j=g,46===w||35===w){u="div";continue}}else if(j===m)if(46===w)O++,s="class",j=y;else if(35===w)O++,s="id",j=y;else{if(61===w){O++,j=v,E===g&&null==s&&parser_warn("Unexpected tag assignment",i,O,w,j);continue}if(40===w){C=1+O,O=1+o(i,C,S,w,41),N.expression=i.substring(C,O-1),N.type=Dom.STATEMENT;continue}if(null!=s){u=s;continue}}(j===v||j===y)&&(E=j,j=m);var I=null;for(C=O;S>O;){if(w=i.charCodeAt(O),w===c&&i.charCodeAt(O+1)===f){I=!0,++O;do w=i.charCodeAt(++O);while(w!==d&&S>O)}if(E!==v&&(46===w||35===w))break;if(33>w||61===w||62===w||59===w||40===w||123===w||125===w)break;O++}if(u=i.substring(C,O),""===u){parser_warn("String expected",i,O,w,j);break}if(I===!0){if(j===g){parser_warn("Invalid interpolation (in tag name)",i,O,u,j);break}if(j===m)if("id"===s||E===v)u=r(u);else if("class"!==s){parser_warn("Invalid interpolation (in attr name)",i,O,u,j);break}}}w!==w&&parser_warn("IndexOverflow",i,O,w,j);var U=k.nodes;return null!=U&&1===U.length?U[0]:k},cleanObject:function(n){if(n instanceof Array){for(var e=0;e<n.length;e++)this.cleanObject(n[e]);return n}return delete n.parent,delete n.__single,null!=n.nodes&&this.cleanObject(n.nodes),n},setInterpolationQuotes:function(n,e){return n&&2===n.length?e&&1===e.length?(c=n.charCodeAt(0),f=n.charCodeAt(1),d=e.charCodeAt(0),u=n[0],s=n[1],void(a=e)):void log_error("Interpolation End must be of 1 Character"):void log_error("Interpolation Start must contain 2 Characters")},ensureTemplateFunction:r},parser_parse=Parser.parse,parser_ensureTemplateFunction=Parser.ensureTemplateFunction,parser_cleanObject=Parser.cleanObject,parser_setInterpolationQuotes=Parser.setInterpolationQuotes}(Dom.Node,Dom.TextNode,Dom.Fragment,Dom.Component);var builder_componentID=0,builder_build;!function(n,e,t){function r(n,e,t,r,i){var l=r.appendChild(document.createComment(""));return function(){return o(n,e,t,l,i)}}function o(e,t,r,o,i){null!=e.tagName&&e.tagName!==e.compoName&&(e.nodes={tagName:e.tagName,attr:e.attr,nodes:e.nodes,type:1}),null!=e.model&&(t=e.model);var l=e.nodes,u=[];if(null!=l){for(var s=l instanceof Array,a=s===!0?l.length:1,c=0,f=null,d=document.createDocumentFragment();a>c;c++)f=s===!0?l[c]:l,builder_build(f,t,r,d,e,u);o.parentNode.insertBefore(d,o)}if(null==e.tagName){var p,h,g=e.handlers&&e.handlers.attr;for(h in e.attr)p=null,g&&is_Function(g[h])&&(p=g[h]),null==p&&is_Function(n[h])&&(p=n[h]),null!=p&&p(o,e.attr[h],t,r,u[0],e)}if(is_Function(e.renderEnd))try{e.renderEnd(u,t,r,o.parentNode)}catch(m){console.error("Custom Tag Handler:",e.tagName,m)}if(null!=i&&i!==u)for(var v=i.length,y=u.length,b=-1;++b<y;)i[v+b]=u[b]}function i(n,e){return null==n.components?void(n.components=[e]):void n.components.push(e)}var l,u=function(){var n=function(n){return function(e,t){e.appendChild(n.createTextNode(t))}}(document);return function(e,t,r,o,i){var l=e.content;if(is_Function(l)){var u=l("node",t,r,o,i);if("string"==typeof u)return void n(o,u);for(var s,a="",c=u.length,f=0;c>f;f++)if(s=u[f],"object"!=typeof s)a+=s;else{if(""!==a&&(n(o,a),a=""),null==s.nodeType){a+=s.toString();
continue}o.appendChild(s)}return void(""!==a&&n(o,a))}n(o,l)}}(),s=function(){var e=function(n){return function(e){return n.createElement(e)}}(document);return function(t,r,o,i,l,u){var s=t.tagName,a=t.attr,c=e(s);if(null!=c){null!=u&&(u.push(c),a["x-compo-id"]=l.ID),null!=i&&i.appendChild(c);var f,d;for(f in a)_Object_hasOwnProp.call(a,f)!==!1&&(is_Function(a[f])?(d=a[f]("attr",r,o,c,l,f),d instanceof Array&&(d=d.join(""))):d=a[f],d&&(is_Function(n[f])?n[f](t,d,r,o,c,l,i):c.setAttribute(f,d)));return c}}}();!function(){function n(n,e,t,o,l,u,s){var a,c;n.compoName=e.tagName,n.attr=a=attr_extend(n.attr,e.attr),n.parent=u,n.ID=++builder_componentID,null==n.model&&(n.model=t),null==n.nodes&&(n.nodes=e.nodes);for(c in a)"function"==typeof a[c]&&(a[c]=a[c]("attr",t,o,l,u,c));return listeners_emit("compoCreated",n,t,o,l),is_Function(n.renderStart)&&n.renderStart(t,o,l),i(u,n),n.async===!0?(n.await(r(n,t,o,l,s)),null):(null!=n.tagName&&(n.nodes={tagName:n.tagName,attr:n.attr,nodes:n.nodes,type:1}),"function"==typeof n.render?(n.render(n.model,o,l),null):n)}function t(n,e,t,r,o,l,u){var s,a,c,f=n.__Ctor,d=!1;if(f)c=new f(e,l);else{c=n;for(var p in e)c[p]=e[p];c.parent=l}var h=c.attr;if(null!=h)for(var p in h)"function"==typeof h[p]&&(h[p]=h[p]("attr",t,r,o,l,p));return is_Function(c.renderStart)&&c.renderStart(t,r,o,l,u),is_Function(c.render)&&(d=!0,s=c.render(t,r,o,l,u),arr_pushMany(u,s),is_Function(c.renderEnd)&&(a=c.renderEnd(s,t,r,o,l))),i(l,a||c),d?null:c}function o(n,e,t,r,o,l){n.ID=++builder_componentID,i(o,n),null==n.model&&(n.model=e);var u=n.elements=[];return builder_build(n.nodes,n.model,t,r,n,u),null!=l&&0!==u.length&&arr_pushMany(l,u),null}l=function(r,i,l,u,s,a){var c,f=r.tagName;if(null!=r.controller&&(c=r.controller),null==c&&(c=e[f]),null==c)return o(r,i,l,u,s,a);var d,p=!1;"function"==typeof c?d=new c(i):(d=c,p=!0);var h=p?t:n;return h(d,r,i,l,u,s,a)}}(),builder_build=function(r,o,i,a,c,f){if(null==r)return a;var d,p,h,g,m=r.type;if(null==c&&(c=new t),null==m&&(r instanceof Array?m=10:null!=r.tagName?m=1:null!=r.content&&(m=2)),1===m&&null!=e[r.tagName]&&(m=4),null==a&&1!==m&&(a=document.createDocumentFragment()),2===m)return u(r,o,i,a,c),a;if(10===m){for(h=0,g=r.length;g>h;h++)builder_build(r[h],o,i,a,c,f);return a}var v=r.tagName;if("else"===v)return a;if(15===m){var y=custom_Statements[v];if(null==y){if(null==e[v])return log_error("<mask: statement is undefined>",v),a;m=4}if(15===m)return y.render(r,o,i,a,c,f),a}if(1===m&&(a=s(r,o,i,a,c,f),f=null),4===m){if(c=l(r,o,i,a,c,f),null==c)return a;d=[],r=c,c.model!==o&&null!=c.model&&(o=c.model)}var b=r.nodes;if(null!=b){null!=f&&null==d&&(d=f);for(var _=b instanceof Array,x=_===!0?b.length:1,w=0,C=null;x>w;w++)C=_===!0?b[w]:b,builder_build(C,o,i,a,c,d)}if(4===m){if(null==r.tagName&&"%"!==r.compoName){var A,N,p,k=r.handlers&&r.handlers.attr;for(p in r.attr)N=r.attr[p],null!=N&&(A=null,null!=k&&is_Function(k[p])&&(A=k[p]),null==A&&null!=n[p]&&(A=n[p]),null!=A&&A(r,N,o,i,d[0],c))}is_Function(r.renderEnd)&&r.renderEnd(d,o,i,a)}return null!=f&&null!=d&&f!==d&&arr_pushMany(f,d),a}}(custom_Attributes,custom_Tags,Dom.Component);var mask_run;!function(){mask_run=function(){var n,e,t,r,o,i,l=_Array_slice.call(arguments);for(r=l.length,o=-1;++o<r;)i=l[o],i instanceof Node?n=i:is_Function(i)?t=i:is_Object(i)&&(e=i);null==n&&(n=document.body);var u=is_Function(t)?new t:new Compo;u.ID=++builder_componentID;var s,a=document.getElementsByTagName("script"),c=!1;for(r=a.length,o=-1;++o<r;)if(s=a[o],"text/mask"===s.getAttribute("type")&&"true"===s.getAttribute("data-run")){var f=builder_build(parser_parse(s.textContent),e,{},null,u);s.parentNode.insertBefore(f,s),c=!0}return c===!1&&log_warn("No blocks found: <script type='text/mask' data-run='true'>...</script>"),is_Function(u.renderEnd)&&u.renderEnd(n,e),Compo.signal.emitIn(u,"domInsert"),u}}();var mask_merge;!function(){function n(n,r,o,l){if(null==n)return null;if(is_Array(n))return e(n,r,o,l);switch(n.type){case x:return i(n,r,o);case _:case C:return t(n,r,o,l);case w:return e(n.nodes,r,o,l)}return log_warn("Uknown type",n.type),null}function e(e,t,r,o){for(var i,l,u=[],s=e.length,a=-1;++a<s;){if(l=e[a],l.tagName===m){if(null!=i)continue;if(l.expression&&!h(l.expression,t,r))continue;i=n(e[a].nodes,t,r,o)}else i=n(l,t,r,o);u=c(u,i)}return u}function t(e,t,i,l){var u=e.tagName;if(64!==u.charCodeAt(0))return o(e,t,i,l);var s=e.attr.id;if(u===b&&null==s)return i.nodes;if(y===u){var c,d=t[e.expression];if(null==d)return log_error("No template node: @"+e.expression),null;if(is_Array(d)===!1)return c=d,n(e.nodes,f(c.nodes,c.nodes,new g(t)),c,l);for(var m=new Dom.Fragment,x=d.length,w=-1;++w<x;)c=d[w],a(m,n(e.nodes,f(c.nodes,c.nodes,new g(t)),c,l));return m}if(v===u){var C=h(e.expression,t,i);return C?n(e.nodes,t,i,l):null}null==s&&(s=u.substring(1));var A=t.$getNode(s);if(null==A)return null;A.parent&&p(l,A.parent);var N,k=A.nodes;if(void 0!==e.attr.as){var j=e.attr.as;N={type:_,tagName:j,attr:r(e.attr,A.attr,t,i),parent:l,nodes:k},N.attr.as=null}if(null==e.nodes)return N||k;var E=n(e.nodes,f(k,k,new g(t)),A,N||l);return null!=N?(N.nodes=E,N):E}function r(n,e,t,r){if(null==n||null==e)return n||e;var o=l(n,t,r);for(var i in e)o[i]=u(e[i],t,r);return o}function o(e,t,r,o){var i=e.tagName||e.compoName;if(":template"===i){var s=u(e.attr.id,t,r);return Mask.templates.register(s,e.nodes),null}if(":import"===i){var s=u(e.attr.id,t,r),a=Mask.templates.resolve(e,s);return n(a,t,r,o)}var c={type:e.type,tagName:i,attr:l(e.attr,t,r),expression:u(e.expression,t,r),controller:e.controller,parent:o};return e.nodes&&(c.nodes=n(e.nodes,t,r,c)),c}function i(n,e,t,r){return{type:n.type,content:u(n.content,e,t),parent:r}}function l(n,e,t){var r,o=_Object_create(n);for(var i in o)r=o[i],null!=r&&(o[i]=u(r,e,t));return o}function u(n,e,t){var r=-1,o=!1,i=n;if("function"==typeof n&&(o=!0,i=n()),"string"!=typeof i||-1===(r=i.indexOf("@")))return n;for(var l,u=i.substring(0,r),a=i.length,c=91===i.charCodeAt(r+1),f=-1;a>r;){if(f=r,c===!0)r=i.indexOf("]",f),-1===r&&(r=a),f+=2;else for(;a>r&&(l=i.charCodeAt(++r),36===l||95===l||46===l||l>=48&&57>=l||l>=65&&90>=l||l>=97&&122>=l););var d=i.substring(f,r),p=c?h:s,g=p(d,e,t);null!=g&&(u+=g),f=c?r+1:r,r=i.indexOf("@",r),-1===r&&(r=a),u+=i.substring(f,r)}return o?parser_ensureTemplateFunction(u):u}function s(n,e,t){var r=n.indexOf(".");if(-1===r)return log_warn("Merge templates. Accessing node",n),"";var o=n.substring(0,r),i=o.substring(1),l=n.substring(r+1),u=null;return null!=t&&("@attr"===o?u=t.attr:o===t.tagName&&(u=t)),null==u&&(u=e.$getNode(i)),null==u?(log_error("Merge templates. Node not found",o),""):obj_getProperty(u,l)}function a(n,e){var t=n.nodes;return null==t&&(t=n.nodes=[]),n.nodes=c(t,e),n}function c(n,e){return null==e?n:is_Array(e)?n.concat(e):e.type===w?c(n,e.nodes):(n.push(e),n)}function f(n,e,t){if(null==e)return t;if(is_Array(e)){for(var r=e.length,o=-1;++o<r;)f(e===n?e[o]:n,e[o],t);return t}var i=e.type;if(i===x)return t;if(i===_){var l=e.tagName;if(null!=l&&64===l.charCodeAt(0)){var u=l.substring(1),s={tagName:e.tagName,parent:d(n,e),nodes:e.nodes,attr:e.attr,expression:e.expression};if(null==t[u])t[u]=s;else{var a=t[u];is_Array(a)?a.push(s):t[u]=[a,s]}return t}}return f(n,e.nodes,t)}function d(n,e){if(e===n)return null;for(var t,r,o=e.parent;;){if(null==o)break;if(o===n&&n.type!==_)break;var i={type:o.type,tagName:o.tagName,attr:o.attr,controller:o.controller,expression:o.expression,nodes:null,parent:null};null==r?t=r=i:(t.parent=i,t=i),o=o.parent}return r}function p(n,e){for(var t=n,r=e;null!=t&&null!=r;){r.tagName&&(t.tagName=r.tagName),r.expression&&(t.expression=r.expression);for(var o in r.attr)t.attr[o]=r.attr[o];t=t.parent,r=r.parent}}function h(n,e,t){return t&&(e.attr=t.attr),ExpressionUtil.eval(n,e,null,e)}function g(n){this.scope=this,this.parent=n}mask_merge=function(e,t,r){"string"==typeof e&&(e=parser_parse(e)),"string"==typeof t&&(t=parser_parse(t));var o=f(t,t,new g);return n(e,o,r)};var m="@else",v="@if",y="@each",b="@placeholder",_=Dom.NODE,x=Dom.TEXTNODE,w=Dom.FRAGMENT,C=Dom.STATEMENT;g.prototype={parent:null,attr:null,scope:null,$getNode:function(n){for(var e,t=this;null!=t;){if(e=t[n],null!=e)return e;t=t.parent}}}}();var cache={},Mask={render:function(n,e,t,r,o){return"string"==typeof n&&(n=_Object_hasOwnProp.call(cache,n)?cache[n]:cache[n]=parser_parse(n)),null==t&&(t={}),builder_build(n,e,t,r,o)},compile:parser_parse,parse:parser_parse,build:builder_build,run:mask_run,merge:mask_merge,registerHandler:customTag_register,getHandler:function(n){return null!=n?custom_Tags[n]:custom_Tags},registerStatement:function(n,e){custom_Statements[n]=is_Function(e)?{render:e}:e},getStatement:function(n){return null!=n?custom_Statements[n]:custom_Statements},registerAttrHandler:function(n,e,t){is_Function(e)&&(t=e),custom_Attributes[n]=t},getAttrHandler:function(n){return null!=n?custom_Attributes[n]:custom_Attributes},registerUtil:customUtil_register,getUtil:customUtil_get,$utils:customUtil_$utils,registerUtility:function(n,e){this.registerUtility=this.registerUtil,this.registerUtility(n,e)},getUtility:function(){return this.getUtility=this.getUtil,this.getUtility()},clearCache:function(n){"string"==typeof n?delete cache[n]:cache={}},Utils:{Expression:ExpressionUtil,getProperty:obj_getProperty,ensureTmplFn:Parser.ensureTemplateFunction},Dom:Dom,plugin:function(source){eval(source)},obj:{get:obj_getProperty,set:obj_setProperty,extend:obj_extend},is:{Function:is_Function,String:is_String,ArrayLike:is_ArrayLike},on:listeners_on,off:listeners_off,delegateReload:function(){},setInterpolationQuotes:Parser.setInterpolationQuotes,setCompoIndex:function(n){builder_componentID=n},cfg:function(){var n=arguments;if(0===n.length)return __cfg;var e;if(2===n.length)return e=n[0],void(__cfg[e]=n[1]);var t=n[0];if("object"==typeof t)for(e in t)__cfg[e]=t[e]}};Mask.renderDom=Mask.render,function(n){var e;!function(){function t(n){for(var e="";n--;)e+=" ";return e}function r(n,e,r){var i,l;null==e&&(e=0),null==r&&(i=!0,r=[]);var u=r.length;if(n.type===d.FRAGMENT&&(n=n.nodes),n instanceof Array)for(l=0;l<n.length;l++)o(n[l],e,r);else o(n,e,r);var s=t(e);for(l=u;l<r.length;l++)r[l]=s+r[l];return i?r.join(0===f?"":"\n"):void 0}function o(n,e,t){if("function"==typeof n.stringify)return void t.push(n.stringify(c));if("string"==typeof n.content)return void t.push(a(n.content));if("function"==typeof n.content)return void t.push(a(n.content()));if(l(n))return void t.push(i(n)+";");if(u(n)){var o=c?">":" > ";return t.push(i(n)+o),void r(s(n),f,t)}t.push(i(n)+"{"),r(n.nodes,f,t),t.push("}")}function i(n){var e=n.tagName,t=n.attr.id||"",r=n.attr["class"]||"";"function"==typeof t&&(t=t()),"function"==typeof r&&(r=r()),t&&(t=-1!==t.indexOf(" ")?"":"#"+t),r&&(r="."+r.split(" ").join("."));var o="";for(var i in n.attr)if("id"!==i&&"class"!==i){var l=n.attr[i];"function"==typeof l&&(l=l()),(c===!1||/[^\w_$\-\.]/.test(l))&&(l=a(l)),o+=" "+i,i!==l&&(o+="="+l)}"div"===e&&(t||r)&&(e="");var u="";return n.expression&&(u="("+n.expression+")"),e+t+r+o+u}function l(n){return null==n.nodes||n.nodes instanceof Array&&0===n.nodes.length}function u(n){return n.nodes&&(n.nodes instanceof Array==!1||1===n.nodes.length)}function s(n){return n.nodes instanceof Array?n.nodes[0]:n.nodes}function a(n){return-1===n.indexOf("'")?"'"+n.trim()+"'":-1===n.indexOf('"')?'"'+n.trim()+'"':'"'+n.replace(/"/g,'\\"').trim()+'"'}e=function(e,t){return null==e?"":("string"==typeof e&&(e=n.parse(e)),null==t?(f=0,c=!0):"number"==typeof t?(f=t,c=0===f):(f=t&&t.indent||4,c=0===f||t&&t.minimizeAttributes),r(e))};var c,f,d=n.Dom}(),n.stringify=e}(Mask),function(){Mask.registerHandler(":html",{$meta:{mode:"server:all"},render:function(n,e,t){if(this.html=jmask(this.nodes).text(n,e,this),t.insertAdjacentHTML)return void t.insertAdjacentHTML("beforeend",this.html);if(t.ownerDocument){var r,o=document.createElement("div"),i=document.createDocumentFragment();for(o.innerHTML=this.html,r=o.firstChild;null!=r;)i.appendChild(r),r=r.nextSibling}},toHtml:function(){return this.html||""},html:null})}(),function(n){function e(){}function t(){var e;for(e in this.attr)break;var t=this.nodes;n.registerHandler(e,Compo({renderStart:function(){this.nodes=n.merge(t,this.nodes||[],this)}}))}custom_Tags.define=e,e.prototype={$meta:{serializeNodes:!0},render:t,onRenderStartClient:t}}(Mask),function(){var n={},e={get:function(e){return n[e]},resolve:function(e,t){var r=n[t];if(null!=r)return r;for(var o=":template[id="+t+"]",i=e.parent,l=null;null!=i;){if(l=jmask(i.nodes).filter(o).get(0),null!=l)return l.nodes;i=i.parent}return log_warn("Template was not found",t),null},register:function(e,t){return null==e?void log_warn("`:template` must be define via id attr."):void(n[e]=t)}};Mask.templates=e,Mask.registerHandler(":template",{render:function(){e.register(this.attr.id,this.nodes)}}),Mask.registerHandler(":import",{renderStart:function(){var n=this.attr.id;return null==n?void log_error("`:import` shoud reference the template via id attr"):void(this.nodes=e.resolve(this,n))}})}(),function(){custom_Statements.log={render:function(n,e,t,r,o){var i=ExpressionUtil.evalStatements(n.expression,e,t,o);i.unshift("Mask::Log"),console.log.apply(console,i)}},customTag_register("debugger",{render:function(){}})}();var Compo=exports.Compo=function(n){function e(){null!=i&&null!=i.fn&&(i.fn.compo=function(n){if(0===this.length)return null;var e=P.resolveCompo(this[0]);return null==n?e:f(e,a(n,u.CONTROLLER,"up"))},i.fn.model=function(n){var e=this.compo(n);if(null==e)return null;for(var t=e.model;null==t&&e.parent;)e=e.parent,t=e.model;return t},function(){var e=["append","prepend","before","after"];["appendMask","prependMask","beforeMask","afterMask"].forEach(function(t,r){i.fn[t]=function(t,o,i,l){if(0===this.length)return this;this.length>1,null==i&&(i=2>r?this.compo():this.parent().compo());var u=!1;null==i&&(i={},u=!0),null==i.components&&(i.components=[]);for(var s=i.components,a=s.length,c=n.render(t,o,l,null,i),f=this[e[r]](c),d=s.length;d>a;a++)S.signal.emitIn(s[a],"domInsert");return f}})}(),function(){function n(n,e){p(e)}function e(n,e){h(e)}var t=i.fn.remove,r=i.fn.empty;i.fn.removeAndDispose=function(){return this.each(n),t.call(this)},i.fn.emptyAndDispose=function(){return this.each(e),r.call(this)}}())}function t(){}var r,o,i,l,u=n.Dom,s=n.Utils.ensureTmplFn;!function(){function n(){for(var n,e=arguments.length;--e>-1;)if(n=o(arguments[e]),null!=n)return n;return null}r=function(n){return"string"!=typeof n?n:s(n)},o=function(n){return e[n]||u[n]||t[n]};var e=global,t=global.atma||{},u=exports||{};i=n("jQuery","Zepto","$"),l=n("Class")}();var a,c;!function(){function n(n){return function(t){return e(t,n)}}function e(n,t,r){if("string"!=typeof n)return!1;if(null==r&&(r=0),r=n.indexOf(t,r),-1===r)return!1;if(r>0&&n.charCodeAt(r-1)>32)return e(n,t,r+1);var o=n.length,i=t.length;return o-i>r&&n.charCodeAt(r+i)>32?e(n,t,r+1):!0}a=function(e,t,r){if(null==e&&log_error("<compo>selector is undefined",t),"object"==typeof e)return e;var o,i,l;if(null==o)switch(e[0]){case"#":o="id",e=e.substring(1),i="attr";break;case".":o="class",e=n(e.substring(1)),i="attr";break;default:o=t===u.SET?"tagName":"compoName"}return l="up"===r?"parent":t===u.SET?"nodes":"components",{key:o,prop:i,selector:e,nextKey:l}},c=function(n,e,t){is_String(e)&&(null==t&&(t=u[n.compoName?"CONTROLLER":"SET"]),e=a(e,t));var r=e.prop?n[e.prop]:n;return null==r?!1:is_Function(e.selector)?e.selector(r[e.key]):null!=e.selector.test?e.selector.test(r[e.key]):r[e.key]==e.selector}}();var f;!function(){f=function(n,e){if(is_Array(n)){for(var t,r=n.length,o=-1;++o<r;)if(t=f(n[o],e),null!=t)return t;return null}return c(n,e)?n:(n=n[e.nextKey],null==n?null:f(n,e))}}();var d,p,h;!function(){d=function(n,e,t){return null!=F&&(e=F(e)),null!=i?i(n).on(e,t):null!=n.addEventListener?n.addEventListener(e,t,!1):void(n.attachEvent&&n.attachEvent("on"+e,t))},p=function(n){if(n.hasAttribute("x-compo-id")){var e=n.getAttribute("x-compo-id"),t=P.getByID(e);if(t){if(null==t.$||1===t.$.length)return v(t),void y(t);var r=_Array_indexOf.call(t.$,n);-1!==r&&_Array_splice.call(t.$,r,1)}}h(n)},h=function(n){for(var e=n.firstChild;null!=e;)1===e.nodeType&&p(e),e=e.nextSibling}}();var g,m;!function(){g=function(n,e){return n.filter(e).add(n.find(e))},m=function(n,e,t,r){return null==t?n.on(e,r):(n.on(e,t,r).filter(t).on(e,r),n)}}();var v,y,b,_,x,w,C,A,N;!function(){function e(e){var t=e.template;if(null==t){if(t=e.attr.template,null==t)return null;delete e.attr.template}if("object"==typeof t)return t;if(is_String(t)){if(35===t.charCodeAt(0)&&/^#[\w\d_-]+$/.test(t)){var r=document.getElementById(t.substring(1));if(null==r)return log_warn("Template not found by id:",t),null;t=r.innerHTML}return n.parse(t)}return log_warn("Invalid template",typeof t),null}v=function(n){null!=n.dispose&&n.dispose(),P.removeCompo(n);for(var e=n.components,t=null==e?0:e.length;--t>-1;)v(e[t])},y=function(n){var e=n.parent;if(null!=e){var t,r=n.$,o=e.$||e.elements;if(o&&r){var i,l,u=r.length;for(t=o.length;--t>-1;)for(i=o[t],l=u;--l>-1;)if(i===r[l]){o.splice(t,1);break}}var s=e.components;if(null!=s){for(t=s.length;--t>-1;)if(s[t]===n){s.splice(t,1);break}-1===t&&log_warn("<compo:remove> - i`m not in parents collection",n)}}},b=function(n){if(null==n.nodes)return void(n.nodes=e(n));var t=n.meta.template;if(null!=t&&"replace"!==t){var r=e(n);return"merge"===t?void(n.nodes=mask_merge(r,n.nodes,n)):"join"===t?void(n.nodes=[r,n.nodes]):void log_error("Invalid meta.nodes behaviour",t)}},_=function(n,e){if(null==n.dispose)return void(n.dispose=e);var t=n.dispose;n.dispose=function(){e.call(this),t.call(this)}},x=function(n){if(n.$)return void n.$.remove();var e=n.elements;if(e)for(var t=-1,r=e.length;++t<r;)e[t].parentNode&&e[t].parentNode.removeChild(e[t]);else{var o=n.components;if(o)for(var t=-1,r=o.length;++t<r;)x(o[t])}},w=function(n,e,t){var r=S.pause(e,t);n.then(r,function(n){C(e,n),r()})},C=function(e,t){e.nodes=n.parse('.-mask-compo-errored > "~[.]"'),e.model=t.message||String(t),e.renderEnd=fn_doNothing},function(){function n(n){return function(e){var t,o,i,l,u=e.attr;for(t in n)if(o=n[t],i=u[t],l=o(e,i),null!=l)return r(e,l,t,i),!1;return!0}}function e(n,e,r,l){var u=63===e.charCodeAt(0),s=u?e.substring(1):e,a=s.replace(/-(\w)/g,t),c=r;return"string"==typeof r?c=o[r]:r instanceof RegExp?c=i.regexp(r):"function"==typeof r?c=r:null==r&&(c=i.any()),null==c?void log_error("Function expected for the attr. handler",e):(n[a]=null,n=null,void(l[s]=function(n,e){if(null==e)return u?null:Error("Expected");var t=c.call(n,e,n);return t instanceof Error?t:(n[a]=t,null)}))}function t(n,e){return e.toUpperCase()}function r(n,e,t,r){e.message=n.compoName+" - attribute `"+t+"`: "+e.message,C(n,e),log_error(e.message,". Current: ",r)}A=function(t){null==t.meta&&(t.meta={attributes:null,cache:null,mode:null});var r=t.meta.attributes,o=null;if(r){var i={};for(var l in r)e(t,l,r[l],i);o=n(i)}t.meta.handleAttributes=o},N=function(n){var e=n.meta&&n.meta.handleAttributes;return null==e?!0:e(n)};var o={string:function(n){return"string"==typeof n?n:Error("String")},number:function(n){var e=Number(n);return e===e?e:Error("Number")},"boolean":function(n){return"true"===n||"1"===n?!0:"false"===n||"0"===n?!1:Error("Boolean")}},i={regexp:function(n){return function(e){return n.test(e)?e:Error("RegExp")}},any:function(){return function(n){return n}}}}()}();var k,j;!function(){k=function(n){var e,t,i=n.length,l=n[i-1];i>1&&E(l,_Array_slice.call(n,0,i-1)),null==l&&(l={});var u=o("include");null!=u&&(l.__resource=u.url);l.attr;for(t in l.attr)l.attr[t]=r(l.attr[t]);var s=l.slots;for(t in s)"string"==typeof s[t]&&(s[t]=l[s[t]]);A(l),e=l.hasOwnProperty("constructor")?l.constructor:function(){},e=j(e,l);for(t in T)null==l[t]&&(l[t]=T[t]);return e.prototype=l,l=null,e},j=function(n,e){var t=e.compos,r=e.pipes,o=e.attr;return null==t&&null==r&&null==e.attr?n:function(){null!=t&&(this.compos=obj_create(this.compos)),null!=r&&U.addController(this),null!=o&&(this.attr=obj_create(this.attr)),null!=n&&n.call(this)}}}();var E;!function(){function e(i,l,u){if(null!=i&&null!=l){if("node"===u){var s=i.template||i.nodes,a=l.template||l.nodes;null==s||null==a?i.template=s||a:i.nodes=n.merge(a,s,i)}var c,f,d,p=!1;for(var h in l)if(c=l[h],null!=c&&"constructor"!==h&&("node"!==u||"template"!==h&&"nodes"!==h))if(f=typeof c,null!=i[h]){if("node"===u){var g="renderStart"===h||"renderEnd"===h||"emitIn"===h||"emitOut"===h||"components"===h||"nodes"===h||"template"===h||"find"===h||"closest"===h||"on"===h||"remove"===h||"slotState"===h||"signalState"===h||"append"===h||"appendTo"===h;if(g===!0)continue}if("pipes"!==u)if("function"!==f){if("object"===f){switch(h){case"slots":case"pipes":case"events":case"attr":e(i[h],c,h);continue}r(i[h],c)}}else d=!1,"slots"===u||"events"===u||"pipe"===u?d=!0:"node"!==u||"onRenderStart"!==h&&"onRenderEnd"!==h||(d=!0),i[h]=o(i[h],c,d),p=!0;else e(i[h],c,"pipe")}else i[h]="object"===f?t(c):c;p===!0&&(null!=i.super&&log_error("`super` property is reserved. Dismissed. Current prototype",i),i.super=null)}}/*! Circular references are not handled */
function t(n){if(null==n)return null;if("object"!=typeof n)return n;if(is_Array(n)){for(var e=n.length,r=-1,o=new Array(e);++r<e;)o[r]=t(n[r]);return o}var i,l,u=obj_create(n);for(i in u)l=u[i],null!=l&&"object"==typeof l&&(u[i]=t(l));return u}function r(n,e){var t,o,i;for(var i in e)t=n[i],o=e[i],null!=t?is_rawObject(t)&&is_rawObject(o)&&r(t,o):n[i]=o}function o(n,e,t){function r(){var n=u._fn||(u._fn=o(u._fn_chain));return n.apply(this,arguments)}if("compoInheritanceWrapper"===n.name)return n._fn_chain.push(e),n;var o=t===!0?l:i,u=r;return u._fn_chain=[n,e],u._fn=null,u}function i(n){for(var e=n.length,t=n[--e];--e>-1;)t=u(n[e],t);return t}function l(n){var e=n.length;return function(){for(var t,r,o,i=e;--i>-1;)r=n[i],null!=r&&(o=fn_apply(r,this,arguments),void 0!==o&&(t=o));return t}}function u(n,e){return function(){this.super=e;var t=fn_apply(n,this,arguments);return this.super=null,t}}function s(n){var e=n.length;return function(){for(var t=e;--t>-1;)n[t].apply(this,arguments)}}E=function(n,t){for(var r,o=t.length,i=o,l=[];--i>-1;)r=t[i],"string"==typeof r&&(r=Mask.getHandler(r)),null!=r?("function"==typeof r&&(l.push(r),r=r.prototype),e(n,r,"node")):log_error("Base component not defined",t[i]);i=-1,o=l.length,o>0&&(n.hasOwnProperty("constructor")&&l.unshift(n.constructor),n.constructor=s(l))}}(n.merge);var O;!function(){O=function(n){return null==n||"function"!=typeof n.then?!1:is_Function(n.isBusy)?n.isBusy():is_Function(n.state)?"pending"===n.state():(log_warn("Class or jQuery deferred interface expected"),!1)}}();var S,T,D={select:function(n,e){for(var t in e){var r=e[t],o=null,i=null;if(r instanceof Array&&(i=r[0],o=r.splice(1)),"string"==typeof r&&(i=r),null==r||null==i)return log_error("Unknown component child",t,e[t]),void log_warn("Is this object shared within multiple compo classes? Define it in constructor!");var l=i.indexOf(":"),u=i.substring(0,l);u=S.config.selectors[u],null==u?n.compos[t]=n.$[0].querySelector(i):(i=i.substring(++l).trim(),n.compos[t]=u(n,i));var s=n.compos[t];null!=o&&(null!=s.$&&(s=s.$),M.on(n,o,s))}}},M={on:function(n,e,t){null==t&&(t=n.$);for(var r,o=e instanceof Array,i=o?e.length:1,l=0;o?i>l:1>l;l++)if(r=o?e[l]:e,r instanceof Array)null!=F&&(r[0]=F(r[0])),t.on.apply(t,r);else for(var u in r){var s,a,c="string"==typeof r[u]?n[r[u]]:r[u],f=u.indexOf(":");-1!==f?(s=u.substring(0,f),a=u.substring(f+1).trim()):s=u,null!=F&&(s=F(s)),m(t,s,a,fn_proxy(c,n))}}},F=null,I=function(){var n=function(){if(null==document)return!1;if("createTouch"in document)return!0;try{return!!document.createEvent("TouchEvent").initTouchEvent}catch(n){return!1}}();return{touch:function(e){return n===!1?e:"click"===e?"touchend":"mousedown"===e?"touchstart":"mouseup"===e?"touchend":"mousemove"===e?"touchmove":e}}}(),U=function(){function e(n,e){return function(t){new l(n).emit(e,t)}}function t(n,e){return null==e.pipes[n]?void log_error("Controller has no pipes to be added to collection",n,e):(null==u[n]&&(u[n]=[]),void u[n].push(e))}function r(n,e){for(var t=u[n],r=t.length;--r>-1;)t[r]===e&&t.splice(r,1)}function o(){var n=this,e=n.pipes;for(var t in e)r(t,n)}function i(n){var e=n.pipes;for(var r in e)t(r,n);S.attachDisposer(n,o.bind(n))}function l(n){return this instanceof l==!1?new l(n):(this.pipeName=n,this)}var u={};return n.registerAttrHandler("x-pipe-signal","client",function(n,t,r,o,i){for(var l,u=t.split(";"),s=u.length,a=-1;++a<s;)if(l=u[a].trim(),""!==l){var c,f,p=l.indexOf(":"),h=l.substring(0,p),g=l.substring(p+1).trim(),m=g.indexOf(".");if(-1===m)return void log_error('define pipeName "click: pipeName.pipeSignal"');c=g.substring(0,m),f=g.substring(++m);var v=e(c,f);d(i,h,v)}}),l.prototype={constructor:l,emit:function(n){var e,t=u[this.pipeName],r=this.pipeName;if(null!=t){2===arguments.length&&is_Array(arguments[1])?e=arguments[1]:arguments.length>1&&(e=_Array_slice.call(arguments,1));for(var o,i,l,s,a=t.length;-1!==--a;)o=t[a],i=o.pipes[r],null!=i&&(l=i[n],is_Function(l)&&(l.apply(o,e),s=!0))}}},l.addController=i,l.removeController=o,{addController:i,removeController:o,pipe:l}}(),P=function(){var n={};return{create:function(e){return null==e.ID?void log_warn("Component should have an ID"):void(n[e.ID]=e)},resolveCompo:function(e){if(null==e)return null;var t,r,o;do{if(r=e.getAttribute("x-compo-id"),r&&(null==t&&(t=r),o=n[r],null!=o&&(o=S.find(o,{key:"ID",selector:t,nextKey:"components"}),null!=o)))return o;e=e.parentNode}while(e&&1===e.nodeType);return null},removeCompo:function(e){null!=e.ID&&delete n[e.ID]},getByID:function(e){return n[e]}}}();!function(){S=function(){return this instanceof S?void 0:k(arguments)},obj_extend(S,{create:function(){return k(arguments)},createClass:function(){var n=k(arguments),e=n.prototype;return e.Construct=n,l(e)},render:function(e,t,r,o){b(e);var l=[];return n.render(null==e.tagName?e.nodes:e,t,r,o,e,l),e.$=i(l),null!=e.events&&M.on(e,e.events),null!=e.compos&&D.select(e,e.compos),e},initialize:function(e,t,r,o,i){var l;null==o&&(r&&null!=r.nodeType?(o=r,r=null):t&&null!=t.nodeType&&(o=t,t=null)),"string"==typeof e&&(l=e,e=n.getHandler(l),e||log_error("Compo not found:",e));var s={controller:e,type:u.COMPONENT,tagName:l};null==i&&null!=o&&(i=P.resolveCompo(o)),null==i&&(i=new u.Component);var a=n.render(s,t,r,null,i),c=i.components[i.components.length-1];return null!=o&&(o.appendChild(a),S.signal.emitIn(c,"domInsert")),c},find:function(n,e){return f(n,a(e,u.CONTROLLER,"down"))},closest:function(n,e){return f(n,a(e,u.CONTROLLER,"up"))},dispose:v,ensureTemplate:b,attachDisposer:_,config:{selectors:{$:function(n,e){var t=g(n.$,e);return t},compo:function(n,e){var t=S.find(n,e);return t}},setDOMLibrary:function(n){i!==n&&(i=n,e())},getDOMLibrary:function(){return i},eventDecorator:function(n){return"function"==typeof n?void(F=n):"string"==typeof n?void(F=I[n]):"boolean"==typeof n&&n===!1?void(F=null):void 0}},pipe:U.pipe,resource:function(n){for(var e=n;null!=e;){if(e.resource)return e.resource;e=e.parent}return include.instance()},plugin:function(){},Dom:{addEventListener:d}}),function(){function n(n,e,t){return null==n[e]&&(n[e]=[]),n[e].push(t),n}function e(n,e,t){var r=n[e];if(null!=r)for(var o,i=0,l=r.length;l>i;i++)o=r[i],null!=o&&(r[i]=null,null!=t?o.apply(this,t):o())}var t={done:function(e){return n(this,"_cbs_done",e)},fail:function(e){return n(this,"_cbs_fail",e)},always:function(e){return n(this,"_cbs_always",e)},resolve:function(){this.async=!1,e(this,"_cbs_done",arguments),e(this,"_cbs_always",arguments)},reject:function(){this.async=!1,e(this,"_cbs_fail",arguments),e(this,"_cbs_always")},_cbs_done:null,_cbs_fail:null,_cbs_always:null},r={async:!0,await:function(n){this.resume=n}};S.pause=function(n,e){return null==e.async&&(e.defers=[],obj_extend(e,t)),e.async=!0,e.defers.push(n),obj_extend(n,r),function(){S.resume(n,e)}},S.resume=function(n,e){n.resume&&n.resume(),n.async=!1;for(var t,r=!1,o=e.defers,i=o.length,l=-1;++l<i;)t=o[l],t!==n?r=r||null!=t:o[l]=null;r===!1&&e.resolve()}}(),T={type:u.CONTROLLER,__resource:null,tagName:null,compoName:null,nodes:null,components:null,attr:null,model:null,slots:null,pipes:null,compos:null,events:null,async:!1,await:null,meta:{mode:null,modelMode:null,attributes:null},onRenderStart:null,onRenderEnd:null,render:null,renderStart:function(n,e,t){if(1===arguments.length&&null!=n&&n instanceof Array==!1&&null!=n[0]){var r=arguments[0];n=r[0],e=r[1],t=r[2]}if(N(this)!==!1&&(b(this),is_Function(this.onRenderStart))){var o=this.onRenderStart(n,e,t);void 0!==o&&O(o)&&w(o,this,e)}},renderEnd:function(n,e,t,r){if(1===arguments.length&&n instanceof Array==!1){var o=arguments[0];n=o[0],e=o[1],t=o[2],r=o[3]}P.create(this,n),this.$=i(n),null!=this.events&&M.on(this,this.events),null!=this.compos&&D.select(this,this.compos),is_Function(this.onRenderEnd)&&this.onRenderEnd(n,e,t,r)},appendTo:function(n){var e="string"==typeof n?document.querySelector(n):n;if(null==e)return log_warn("Compo.appendTo: parent is undefined. Args:",arguments),this;for(var t=this.$,r=0,o=t.length;o>r;r++)e.appendChild(t[r]);return this.emitIn("domInsert"),this},append:function(e,t,r){var o;if(null==this.$){var i="string"==typeof e?n.compile(e):e;return o=r?f(this,a(r,u.CONTROLLER,"down")):this,null==o.nodes?(this.nodes=i,this):(o.nodes=[this.nodes,i],this)}var l=n.render(e,t,null,null,this);return o=r?this.$.find(r):this.$,o.append(l),this.emitIn("domInsert"),this},find:function(n){return f(this,a(n,u.CONTROLLER,"down"))},closest:function(n){return f(this,a(n,u.CONTROLLER,"up"))},on:function(){var n=_Array_slice.call(arguments);return arguments.length<3?(log_error("Invalid Arguments Exception @use .on(type,selector,fn)"),this):(null!=this.$&&M.on(this,[n]),null==this.events?this.events=[n]:is_Array(this.events)?this.events.push(n):this.events=[n,this.events],this)},remove:function(){return x(this),y(this),v(this),this.$=null,this},slotState:function(n,e){return S.slot.toggle(this,n,e),this},signalState:function(n,e){return S.signal.toggle(this,n,e),this},emitOut:function(n){return S.signal.emitOut(this,n,this,arguments.length>1?_Array_slice.call(arguments,1):null),this},emitIn:function(n){return S.signal.emitIn(this,n,this,arguments.length>1?_Array_slice.call(arguments,1):null),this}},S.prototype=T}(),function(){function e(n,t,r,o,i){if(null==n)return!1;var l=!1,u=null!=n.slots&&n.slots[t];if("string"==typeof u&&(u=n[u]),"function"==typeof u){l=!0;var s=null!=n.slots.__disabled&&n.slots.__disabled[t];if(s!==!0){var a=null==o?u.call(n,r):u.apply(n,[r].concat(o));if(a===!1)return!0;null!=a&&"object"==typeof a&&null!=a.length&&(o=a)}}if(-1===i&&null!=n.parent)return e(n.parent,t,r,o,i)||l;if(1===i&&null!=n.components)for(var c,f=n.components,d=f.length,p=0;d>p;p++)c=e(f[p],t,r,o,i),!l&&(l=c);return l}function t(n,e,r,o){if(null==n)return!1;var i=n.slots;if(null!=i&&null!=i[e]&&("string"==typeof i[e]&&(i[e]=n[i[e]]),"function"==typeof i[e])){if(o!==!0)return!0;if(null==i.__disabled||i.__disabled[e]!==!0)return!0}if(-1===r&&null!=n.parent)return t(n.parent,e,r);if(1===r&&null!=n.components)for(var l=0,u=n.components.length;u>l;l++)if(t(n.components[l],e,r))return!0;return!1}function r(n,r){return t(n,r,-1)===!1?null:function(t){var o=arguments.length>1?_Array_slice.call(arguments,1):null;e(n,r,t,o,-1)}}function o(n,e,t){var r=n.slots;null!=r&&r.hasOwnProperty(e)!==!1&&(null==r.__disabled&&(r.__disabled={}),r.__disabled[e]=t===!1)}function l(n,e,t){if(o(n,e,t),null!=n.components)for(var r=0,i=n.components.length;i>r;r++)l(n.components[r],e,t)}function u(n,e,t){return null==n.$?void log_warn("Controller has no elements to toggle state"):void i().add(n.$.filter("[data-signals]")).add(n.$.find("[data-signals]")).each(function(n,r){var o=r.getAttribute("data-signals");null!=o&&-1!==o.indexOf(e)&&r[t===!0?"removeAttribute":"setAttribute"]("disabled","disabled")})}function s(n,e,t){for(var r=n,i=n;null!=(r=r.parent);)o(r,e,t),null!=r.$&&0!==r.$.length&&(i=r);l(n,e,t),u(i,e,t)}function a(n,e,r){o(n,e,r),(r||!t(n,e,-1,!0)&&!t(n,e,1,!0))&&u(n,e,r)}n.registerAttrHandler("x-signal","client",function(n,e,t,o,i,l){for(var u,s=e.split(";"),a="",c=s.length,f=-1;++f<c;)if(u=s[f].trim(),""!==u){var p=u.indexOf(":"),h=u.substring(0,p),g=u.substring(p+1).trim(),m=r(l,g);m&&(a+=","+g+",",d(i,h,m))}""!==a&&i.setAttribute("data-signals",a)}),obj_extend(S,{signal:{toggle:s,emitOut:function(n,t,r,o){e(n,t,r,o,-1)},emitIn:function(n,t,r,o){e(n,t,r,o,1)},enable:function(n,e){s(n,e,!0)},disable:function(n,e){s(n,e,!1)}},slot:{toggle:a,enable:function(n,e){a(n,e,!0)},disable:function(n,e){a(n,e,!1)},invoke:function(n,e,t,r){var o=n.slots;return null==o||"function"!=typeof o[e]?(log_error("Slot not found",e,n),null):null==r?o[e].call(n,t):o[e].apply(n,[t].concat(r))}}})}();var $;return function(n){function t(n,e,t){if(null==n)return t||n;for(var r=n.length,o=-1;++o<r;)e.call(t||n,n[o],o);return t||n}function r(n,e,t){if(null==n)return-1;for(var r=n.length,o=-1;++o<r;)if(e.call(t||n,n[o],o)===!0)return o;return-1}if(null!=n){S.DomLite=$=function(n){return this instanceof $==!1?new $(n):this.add(n)},null==i&&(i=$);var o=$.fn={constructor:$,length:0,add:function(n){if(null==n)return this;if(is_Array(n)===!0)return t(n,this.add,this);var e=n.nodeType;return 11===e?t(n.childNodes,this.add,this):null==e?"number"==typeof n.length?t(n,this.add,this):(log_warn("Uknown domlite object"),this):(this[this.length++]=n,this)},on:function(){return l.call(this,u,a,arguments)},off:function(){return l.call(this,s,c,arguments)},find:function(n){return t(this,function(e){this.add(d.call(e,n))},new $)},filter:function(n){return t(this,function(e){p(e,n)===!0&&this.add(e)},new $)},parent:function(){var n=this[0];return new $(n&&n.parentNode)},children:function(n){var e=t(this,function(n){this.add(n.childNodes)},new $);return null==n?e:e.filter(n)},closest:function(n){for(var e=this[0],t=new $;null!=e&&null!=e.parentNode;)if(e=e.parentNode,p(e,n))return t.add(e);return t},remove:function(){return t(this,function(n){n.parentNode.removeChild(n)})}};!function(){function n(n,e,t){null!=n&&null!=t&&n.insertBefore(t,e)}function e(e,t,r){var o=null!=t?t.nextSibling:null;n(e,o,r)}var r={append:function(n,t){e(n,n.lastChild,t)},prepend:function(e,t){n(e,e.firstChild,t)},after:function(n,t){e(n.parentNode,n,t)},before:function(e,t){n(e.parentNode,e,t)}};t(["append","prepend","before","after"],function(n){var e=r[n];o[n]=function(n){var r=is_Array(n);return t(this,function(o){return r?void t(n,function(n){e(o,n)}):void e(o,n)})}})}();var l,u,s,a,c,f=n.documentElement,d=f.querySelectorAll,p=function(){var n=f.webkitMatchesSelector||f.mozMatchesSelector||f.msMatchesSelector||f.oMatchesSelector||f.matchesSelector;return function(e,t){return null==e||1!==e.nodeType?!1:n.call(e,t)}}();!function(){function n(n,e,r,o){return t(n,function(n){e.call(n,r,o,!1)})}l=function(n,e,r){var o,i=r.length;return 2===i&&(o=n),3===i&&(o=e),null!=o?t(this,function(n){o.apply($(n),r)}):(log_error("`DomLite.on|off` - invalid arguments count"),this)},u=function(t,r){return n(this,e,t,r)},s=function(e,t){return n(this,r,e,t)},a=function(n,e,t){function r(n){var r=n.target,o=n.currentTarget;if(o!==r)for(;null!=r&&r!==o;){if(p(r,e))return void t(n);r=r.parentNode}}return(t._guards||(t._guards=[])).push(r),u.call(this,n,r)},c=function(n,e,r){return t(r._quards,function(e){s.call(this,n,e)},this)};var e=f.addEventListener,r=f.removeEventListener}(),t(["add","remove","toggle","has"],function(n){var e,i="has"===n,l=null!=f.classList,u=l===!0?function(n,e){return-1!==_Array_indexOf.call(n.classList,e)}:function(n,e){return-1!==(" "+n.className+" ").indexOf(" "+e+" ")};if(i)e=function(n){return-1!==r(this,function(e){return u(e,n)})};else{var s=l===!0?function(e,t){var r=e.classList;r[n].call(r,t)}:function(){function e(n,e){n.className+=" "+e}function t(n,e){n.className=(" "+n.className+" ").replace(" "+e+" "," ")}return function(r,o){var i=u(r,o);if("add"===n)return void(!1===i&&e(r,o));if("remove"===n)return void(!0===i&&t(r,o));var l=i?t:e;l(r,o)}}();e=function(n){return t(this,function(e){s(e,n)})}}o[n+"Class"]=e}),function(){var e=function(e){var t=n.createEvent("Event");return t.initEvent(e,!0,!0),t},r=function(t,r){if(null==r)return e(t);var o=n.createEvent("CustomEvent");return o.initCustomEvent(t,!0,!0,r),o},i=function(n,e){n.dispatchEvent(e)};o.trigger=function(n,e){var o=r(n,e);return t(this,function(n){i(n,o)})}}(),function(){o.attr=function(n,e){return void 0===e?this[0]&&this[0].getAttribute(n):t(this,function(t){t.setAttribute(n,e)})},o.removeAttr=function(n){return t(this,function(e){e.removeAttribute(n)})}}(),Object.setPrototypeOf?Object.setPrototypeOf(o,Array.prototype):o.__proto__&&(o.__proto__=Array.prototype),$.prototype=o,e()}}(global.document),e(),n.registerHandler(":slot",t),t.prototype={constructor:t,renderEnd:function(){this.slots={},this.expression=this.attr.on,this.slots[this.attr.signal]=this.handle},handle:function(){var e=this.expression;n.Utils.Expression.eval(e,this.model,global,this)}},S}(Mask),jmask=exports.jmask=Mask.jmask=function(n){function e(n){return"string"!=typeof n?n:s(n)}function t(n){return this instanceof t==!1?new t(n):null==n?this:n.type===i.SET?n:this.add(n)}var r,o,i=n.Dom,l=n.render,u=n.parse,s=n.Utils.ensureTmplFn,a=(n.Compo||Compo).signal.emitIn;!function(){r=function(n,e){if(is_ArrayLike(n)===!1)return void e(n);for(var t=n.length,r=-1;++r<t;)e(n[r],r)},function(){function n(n,t){return n===t?(e=!0,0):1}o=function(t){if(e=!1,t.sort(n),e===!1)return t;for(var r=[],o=0,i=0,l=t.length-1;l>o;)t[o++]===t[o]&&(r[i++]=o);for(;i--;)t.splice(r[i],1);return t};var e=!1}()}();var c,f;!function(){function n(n){return function(t){return e(t,n)}}function e(n,t,r){if("string"!=typeof n)return!1;if(null==r&&(r=0),r=n.indexOf(t,r),-1===r)return!1;if(r>0&&n.charCodeAt(r-1)>32)return e(n,t,r+1);var o=n.length,i=t.length;return o-i>r&&n.charCodeAt(r+i)>32?e(n,t,r+1):!0}function t(n,e,t){for(var r,o=!1,i=!1;t>e&&(r=n.charCodeAt(e),(34===r||39===r)&&(o=!o),92===r&&(i=!i),!(46===r||35===r||91===r||93===r||62===r||33>r)||o===!0||i===!0);)e++;return e}c=function(e,s,a){if(null==e&&log_error("selector is null for the type",s),"object"==typeof e)return e;var c,f,d,p,h,g,m,v,y,b,_,x=0,w=e.length;for(c="up"===a?r:s===i.SET?o:l;w>x;)h=e.charCodeAt(x),33>h?x++:62!==h?(g=t(e,x+1,w),46===h?(f="class",d=u,p=n(e.substring(x+1,g))):35===h?(f="id",d=u,p=e.substring(x+1,g)):91===h?(b=e.indexOf("=",x),d=u,f=e.substring(x+1,b),h=e.charCodeAt(b+1),_=34===h||39===h?2:1,p=e.substring(b+_,g-_+1),g++):(null!=m&&(m.next={type:"any",matcher:null},y=m,m=null),d=null,f=s===i.SET?"tagName":"compoName",p=e.substring(x,g)),x=g,null!=m?(null==m.filters&&(m.filters=[]),m.filters.push({key:f,selector:p,prop:d})):(m={key:f,prop:d,selector:p,nextKey:c,filters:null},null==v&&(v=m),null!=y&&(y.next.matcher=m))):(null==m?v=m={selector:"__scope__",nextKey:c,filters:null,next:{type:"children",matcher:null}}:m.next={type:"children",matcher:null},y=m,m=null,x++);return y&&y.next&&(y.next.matcher=m),v},f=function(n,e,t){if("string"==typeof e&&(null==t&&(t=i[n.compoName?"CONTROLLER":"SET"]),e=c(e,t)),"*"===e.selector)return!0;var r=e.prop?n[e.prop]:n,o=!1;if(null==r)return!1;if("function"==typeof e.selector?o=e.selector(r[e.key]):null!=e.selector.test?e.selector.test(r[e.key])&&(o=!0):r[e.key]===e.selector&&(o=!0),o===!0&&null!=e.filters)for(var l,u=0,s=e.filters.length;s>u;u++)if(l=e.filters[u],f(n,l,t)===!1)return!1;return o};var r="parent",o="nodes",l="components",u="attr"}();var d,p,h,g,m;!function(){d=function(n,e){if(null==e)return n;var t=[];return r(n,function(n){f(n,e)&&t.push(n)}),t},p=function(n,e,t,o){return null==n?t:(null==t&&(t=[]),null==o&&("__scope__"===e.selector?(o=!1,e=e.next.matcher):o=!0),r(n,function(n){if(f(n,e)===!1)return void(null==e.next&&o!==!1&&p(n[e.nextKey],e,t,o));if(null==e.next)return t.push(n),void(o===!0&&p(n[e.nextKey],e,t,o));var r=e.next;o="children"!==r.type,p(n[e.nextKey],r.matcher,t,o)}),t)},h=function(n,e){var t={type:1,tagName:1,compoName:1,controller:1},r={parent:e};for(var o in n)1===t[o]&&(r[o]=n[o]);null!=n.attr&&(r.attr=obj_create(n.attr));var i=n.nodes;if(null!=i&&i.length>0)if(is_ArrayLike(i)===!1)r.nodes=[h(i,r)];else{r.nodes=[];for(var l=i.length,u=0;l>u;u++)r.nodes[u]=h(i[u],r)}return r},g=function(n){for(var e,t=n;null!=t;)e=t,t=t.nodes&&t.nodes[0];return e},m=function(n,e,t,r){if(i.TEXTNODE===n.type)return is_Function(n.content)?n.content("node",e,t,null,r):n.content;var o="";if(null!=n.nodes)for(var l,u=0,s=n.nodes.length;s>u;u++)l=n.nodes[u],o+=m(l,e,t,r);return o}}();var v=t.prototype={constructor:t,type:i.SET,length:0,components:null,add:function(n){var e,t;if("string"==typeof n&&(n=u(n)),is_ArrayLike(n)){for(e=0,t=n.length;t>e;e++)this.add(n[e]);return this}"function"==typeof n&&null!=n.prototype.type&&(n={controller:n,type:i.COMPONENT});var r=n.type;if(!r)return console.error("Only Mask Node/Component/NodeText/Fragment can be added to jmask set",n),this;if(r===i.FRAGMENT){var o=n.nodes;for(e=0,t=o.length;t>e;)this[this.length++]=o[e++];return this}if(r===i.CONTROLLER){if(null!=n.nodes&&n.nodes.length)for(e=n.nodes.length;0!==e;)n.nodes[--e].parent=n;null!=n.$&&(this.type=i.CONTROLLER)}return this[this.length++]=n,this},toArray:function(){return Array.prototype.slice.call(this)},render:function(n,e,t,r){if(this.components=[],1===this.length)return l(this[0],n,e,t,r||this);null==t&&(t=document.createDocumentFragment());for(var o=0,i=this.length;i>o;o++)l(this[o],n,e,t,r||this);return t},prevObject:null,end:function(){return this.prevObject||this},pushStack:function(n){var e;return e=t(n),e.prevObject=this,e},controllers:function(){return null==this.components&&console.warn("Set was not rendered"),this.pushStack(this.components||[])},mask:function(e){var t;if(null!=e)return this.empty().append(e);if(arguments.length)return this;if(0===this.length)t=new i.Node;else if(1===this.length)t=this[0];else{t=new i.Fragment,t.nodes=[];for(var r=-1;++r<this.length;)t.nodes[r]=this[r]}return n.stringify(t)},text:function(n,e,t){if("string"==typeof n&&1===arguments.length){for(var r,o=[new i.TextNode(n)],l=0,u=this.length;u>l;l++)r=this[l],r.nodes=o;return this}for(var r,s="",l=0,u=this.length;u>l;l++)r=this[l],s+=m(r,n,e,t);return s}};return arr_each(["append","prepend"],function(n){t.prototype[n]=function(e){for(var r,o,i=t(e),l=0,u=this.length;u>l;l++){o=this[l],r=i.toArray();for(var s=0,a=r.length;a>s;s++)r[s].parent=o;o.nodes=null!=o.nodes?"append"===n?o.nodes.concat(r):r.concat(o.nodes):r}return this}}),arr_each(["appendTo"],function(n){t.prototype[n]=function(n,e,r,o){return null==o&&(o=this),null!=n.nodeType&&"function"==typeof n.appendChild?(n.appendChild(this.render(e,r,null,o)),a(o,"domInsert"),this):(t(n).append(this),this)}}),function(){function n(n,e,t){n[e]=t}function t(n){var e={};return n.split(";").forEach(function(n){if(""!==n){var t=n.indexOf(":"),r=n.substring(0,t).trim(),o=n.substring(t+1).trim();e[r]=o}}),e}function r(n){var e,t="";for(e in n)t+=e+":"+n[e]+";";return t}function o(n,e){return n+":"+e+";"}v.removeAttr=v.removeProp=function(n){return coll_each(this,function(e){e.attr[n]=null})},v.attr=v.prop=function(n,t){function r(n,t,r){n.attr[t]=e(r)}function o(n,e){for(var t in e)r(n,t,e[t])}if(1===arguments.length)return this.length>0?this[0].attr[n]:null;var i=is_String(n)?r:o;return coll_each(this,function(e){i(e,n,t)})},v.tag=function(n){return 0===arguments.length?this[0]&&this[0].tagName:coll_each(this,function(e){e.tagName=n})},v.css=function(e,i){if(arguments.length<=1&&"string"==typeof e){if(null==this.length)return null;var l=this[0].attr.style;if(null==l)return null;var u=t(l);return null==e?u:u[e]}if(null==e)return this;var s="object"==typeof e?r:o,a="object"==typeof e?obj_extend:n;return coll_each(this,function(n){var o=n.attr.style;if(null==o)return void(n.attr.style=s(e,i));var l=t(o);a(l,e,i),n.attr.style=r(l)})}}(),function(){function n(n){var e=n.attr["class"];return"string"==typeof e?e:""}function e(e,t){return-1!==(" "+n(e)+" ").indexOf(" "+t+" ")}function t(e,t){e.attr["class"]=(n(e)+" "+t).trim()}function r(e,t){e.attr["class"]=(" "+n(e)+" ").replace(" "+t+" ","").trim()}v.hasClass=function(n){return coll_find(this,function(t){return e(t,n)})};var o={add:function(n,r){e(n,r)===!1&&t(n,r)},remove:function(n,t){e(n,t)===!0&&r(n,t)},toggle:function(n,o){var i=e(n,o)===!0?r:t;i(n,o)}};arr_each(["add","remove","toggle"],function(n){var e=o[n];v[n+"Class"]=function(n){return coll_each(this,function(t){e(t,n)})}})}(),obj_extend(t.prototype,{clone:function(){return t(coll_map(this,h))},wrap:function(n){var e=t(n);if(0===e.length)return log_warn("Not valid wrapper",n),this;var r=coll_map(this,function(n){var t=e.clone()[0];if(g(t).nodes=[n],null!=n.parent){var r=coll_indexOf(n.parent.nodes,n);-1!==r&&n.parent.nodes.splice(r,1,t)}return t});return t(r)},wrapAll:function(n){var e=t(n);return 0===e.length?(log_error("Not valid wrapper",n),this):(this.parent().mask(e),g(e[0]).nodes=this.toArray(),this.pushStack(e))}}),arr_each(["empty","remove"],function(n){t.prototype[n]=function(){return coll_each(this,e[n])};var e={remove:function(n){null!=n.parent&&coll_remove(n.parent.nodes,n)},empty:function(n){n.nodes=null}}}),obj_extend(t.prototype,{each:function(n,e){for(var t=0;t<this.length;t++)n.call(e||this,this[t],t);return this},eq:function(n){return-1===n?this.slice(n):this.slice(n,n+1)},get:function(n){return 0>n?this[this.length-n]:this[n]},slice:function(){return this.pushStack(Array.prototype.slice.apply(this,arguments))}}),arr_each(["filter","children","closest","parent","find","first","last"],function(n){t.prototype[n]=function(e){var r,l,u=[],s=null==e?null:c(e,this.type,"closest"===n?"up":"down");switch(n){case"filter":return t(d(this,s));case"children":for(r=0;r<this.length;r++)l=this[r],null!=l.nodes&&(u=u.concat(null==s?l.nodes:d(l.nodes,s)));break;case"parent":for(r=0;r<this.length;r++)l=this[r].parent,!l||l.type===i.FRAGMENT||s&&f(l,s)||u.push(l);o(u);break;case"closest":case"find":if(null==s)break;for(r=0;r<this.length;r++)p(this[r][s.nextKey],s,u);break;case"first":case"last":var a;for(r=0;r<this.length;r++)if(a="first"===n?r:this.length-r-1,l=this[a],null==s||f(l,s)){u[0]=l;break}}return this.pushStack(u)}}),t}(Mask);return function(n,e){function t(n){return n.parentNode.removeChild(n)}function r(n){if(null!=n)for(var e=n.length,r=-1;++r<e;)t(n[r])}function o(n,e){return e.parentNode.insertBefore(n,e.nextSibling)}function i(n,e){return e.parentNode.insertBefore(n,e)}function l(){}function u(){}function s(){}function a(n,e){if(null==e&&(e=[]),null==n.components)return e;for(var t,r=n.components,o=0,i=r.length;i>o;o++)t=r[o],"validate"!==t.compoName?a(t):e.push(t);return e}var c,f="undefined"!=typeof e?e:n.Compo||global.Compo,d=f.Dom.addEventListener,p=n.registerHandler,h=n.registerAttrHandler,g=n.registerUtil,m=f.config.getDOMLibrary();!function(){c=function(n,e){if(null==n)return!1;for(var t=e.split("."),r=t.length,o=-1;++o<r;)if(null==(n=n[t[o]]))return!1;return!0}}();var v,y,b,_,x,w,C,A;!function(){function n(n,e){for(var t,r=-1,o=e.length-1;++r<o;)t=e[r],null==n[t]&&(n[t]={}),n=n[t];return n}function e(n){return null==n||"object"!=typeof n?null:"number"==typeof n.length&&"function"==typeof n.slice?h.Array:"function"==typeof n.toUTCString?h.Date:null}function t(t,o,i,l){var s=l.length,c=s>1?n(t,l):t,f=l[s-1],h=c[f];if(s>1&&r(t,l),"length"===f){var g=e(c);if(null!=g)return u(c,g,function(){for(var n=i.length,e=-1;++e<n;)i[e].apply(null,arguments)}),h}return p(c,f,{get:function(){return h},set:function(n){if(n!==h){h=n;var r=0,l=i.length,s=e(n);if(null!=s)for(;l>r;r++)u(n,s,i[r]);if(null!=t[a][d])return void(t[a][d][o]=1);for(r=0;l>r;r++)i[r](n)}},configurable:!0,enumerable:!0}),h}function r(n,e){for(var t,r=i(n),l="",u=e.length-1,s=0;u>s;s++)t=e[s],l+=t+".",o(l,n,t,r),n=n[t]}function o(n,e,t,r){var o,i=e[t];p(e,t,{get:function(){return i},set:function(e){e!==i&&(o=i,i=e,r(n,o))},configurable:!0,enumerable:!0})}function i(n){return function(e,t){var r=n[a];if(null!=r)for(var o in r)if(0===o.indexOf(e)){var i=r[o].slice(0),l=i.length,u=0;if(0!==l){var s,c,f=obj_getProperty(n,o);for(u=0;l>u;u++)s=i[u],b(n,o,s),c=o.substring(e.length),b(t,c,s);for(u=0;l>u;u++)i[u](f);for(u=0;l>u;u++)v(n,o,i[u])}}}}function l(n,e,t){var r=w(n,e);return arr_contains(r,t)===!1&&r.push(t),r}v=function(n,r,o){for(var i=r.split("."),s=i.length,c=-1,f=n;++c<s&&(f=f[i[c]],null!=f);)if(null!=f[a]){var d=i.slice(c+1).join(".");if(null!=f[a][d]){l(f,d,o);var p=l(n,r,o);if(1===p.length){var h=i.splice(0,c);0!==h.length&&t(n,r,p,h,!0)}return}}var p=l(n,r,o);1===p.length&&t(n,r,p,i,!0);var g=obj_getProperty(n,r),m=e(g);null!=m&&u(g,m,o)},y=function(n,e,t){for(var r=e.split("."),o=r.length,i=-1,l=n;++i<o&&(l=l[r[i]],null!=l);)if(null!=l[a]){if(y(l,r.slice(i).join("."),t))return!0;break}var u=n[a];return null==u||null==u[e]?!1:arr_contains(u[e],t)},b=function(n,t,r){for(var o=t.split("."),i=o.length,l=-1,u=n;++l<i&&(u=u[o[l]],null!=u);)if(null!=u[a]){b(u,o.slice(l).join("."),r);break}var c=w(n,t),f=obj_getProperty(n,t);void 0===r?c.length=0:arr_remove(c,r);var d=e(f);null!=d&&s(f,d,r)},_=function(n){var e=n[a];null!=e&&(e[d]={})},x=function(n){var e=n[a],t=null==e?null:e[d];if(null!=t){e[d]=null;var r,o,i,l,u;for(r in t)if(o=n[a][r],l=null==o?0:o.length,0!==l)for(u=-1,i=r===c?n:obj_getProperty(n,r);++u<l;)o[u](i)}},w=function(n,e){var t=n[a];if(null==t&&(t={__dirty:null,__dfrTimeout:null,__mutators:null},p(n,"__observers",{value:t,enumerable:!1})),null==e)return t;var r=t[e];return null==r?t[e]=[]:r},C=function(n,t){var r=e(n);null!=r&&u(n,r,t)},A=function(n,e){s(n,null,e)};var u,s,a="__observers",c="__mutators",f="__dfrTimeout",d="__dirty",p=Object.defineProperty,h={Array:{throttle:!1,methods:["push","unshift","splice","pop","shift","reverse","sort","remove"]},Date:{throttle:!0,methods:["setDate","setFullYear","setHours","setMilliseconds","setMinutes","setMonth","setSeconds","setTime","setUTCDate","setUTCFullYear","setUTCHours","setUTCMilliseconds","setUTCMinutes","setUTCMonth","setUTCSeconds"]}};!function(){function n(n,r,o,i){var l=i===!0?t:e;return function(){return l(n,r,o,_Array_slice.call(arguments))}}function e(n,e,t,o){var i=w(n,c),l=e.apply(n,o);return r(n,i,t,o,l),l}function t(n,e,t,o){var i=w(n,c),l=e.apply(n,o),u=n[a];return null!=u[f]?l:(u[f]=setTimeout(function(){u[f]=null,r(n,i,t,o,l)}),l)}function r(n,e,t,r,o){if(0!==e.length){var i=n[a];if(null!=i[d])return void(i[d][c]=1);for(var l,u=e.length,s=-1;++s<u;)l=e[s],"function"==typeof l&&l(n,t,r,o)}}u=function(e,t,r){var o=t.methods,i=t.throttle,l=w(e,c);if(0===l.length)for(var u,s,a=o.length,f=-1;++f<a;)u=o[f],s=e[u],null!=s&&(e[u]=n(e,s,u,i));l[l.length++]=r},s=function(n,e,t){var r=w(n,c);return void 0===t?void(r.length=0):void arr_remove(r,t)}}()}();var N;!function(){N=function(n){return null==n||""===n?null:("string"==typeof n&&(n=new Date(n)),isNaN(n)===!1&&"function"==typeof n.getFullYear?n:null)}}();var k,j,E,O,S;!function(){k=function(n,e,t,r){if(null==n.components)return o(t,r||n.placeholder);var l,u=n.components,s=null,a=!0,c=u.length,f=e-1;if(null==s)for(;++f<c;)if(l=u[f].elements,l&&l.length){s=l[0];break}if(null==s)for(a=!1,f=c>e?e:c;--f>-1;)if(l=u[f].elements,l&&l.length){s=l[l.length-1];break}return null==s&&(s=r||n.placeholder),a?i(t,s):o(t,s)},j=function(e,t,r,o,i){return n.render(t,r,o,i,e)},E=function(n,e){if(null==n)return!1;null!=n.elements&&(r(n.elements),n.elements=null),f.dispose(n);var t=e&&e.components||n.parent&&n.parent.components;return null==t?(log_error("Parent Components Collection is undefined"),!1):arr_remove(t,n)},O=function(n){f.signal.emitIn(n,"domInsert")},S=function(n,e){if("function"==typeof n.dispose){var t=n.dispose;return void(n.dispose=function(){e.call(this),t.call(this)})}n.dispose=e}}();var T,D,M,F,I,U,P;!function(){function e(n,e,r,o,i){if(null!=o){var l=typeof o,u=t(e,r,o,l);if(null!=u){var s="object"===l?o.ref:o;n(u,s,i)}}}function t(n,e,t,r){if("object"===r){var i=o(t.accessor,n,null,e);return null==i||"object"!=typeof i?(log_error("Binding failed to an object over accessor",t),null):i}if(null==t||"$c"===t)return null;if(c(n,t))return n;if(c(e,t))return e;for(var l,u=e;null!=u;){if(l=u.scope,null!=l&&c(l,t))return l;u=u.parent}return n}var r=n.Utils.Expression,o=r.eval;U=r.parse,P=r.varRefs,T=function(n,e,t,r){if("."===n)return e;var i=o(n,e,t,r);return null==i?"":i},D=function(n,t,r,o,i){if("."===n)return void C(t,i);var l=U(n),u=P(l,t,r,o);if(null!=u){if("string"==typeof u)return void e(v,t,o,u,i);for(var s,a=null!=u.length&&"function"==typeof u.splice,c=a===!0?u.length:1,f=0;c>f;f++)s=a===!0?u[f]:u,e(v,t,o,s,i)}},M=function(n,t,r,o){if("function"==typeof r&&log_warn("[mask.binding] - expression unbind(expr, model, controller, callback)"),"."===n)return void A(t,o);var i,l=P(n,t,null,r);if(null!=l){if("string"==typeof l)return void e(b,t,r,l,o);for(var i,u=null!=l.length&&"function"==typeof l.splice,s=u===!0?l.length:1,a=0;s>a;a++)i=u===!0?l[a]:l,e(b,t,r,i,o)
}},F=function(n,e,t,r,o){var i=0;return function(){if(++i>1)return i=0,void log_warn("<mask:bind:expression> Concurent binder detected",n);var l=T(n,e,t,r);if(arguments.length>1){var u=_Array_slice.call(arguments);u[0]=l,o.apply(this,u)}else o(l);i--}},I=function(n){var e=0;return function(){return++e>1?(e=0,void log_warn("<mask:listener:expression> concurent binder")):(n(),void e--)}}}();var $,L;!function(){$=function(n,e,t){for(var r,o,i,l,u=n.split(";"),s=[],a=0,c=u.length;c>a;a++)r=u[a].split(":"),1===r.length||2===r.length?(i=2===r.length?r[0]:t,o=r[2===r.length?1:0],l=L(o.trim(),i,e),null!=l&&s.push(l)):log_error('Too much ":" in a signal def.',u[a]);return s},L=function(n,e,t){if(t!==!0)return{signal:n,type:e};var r=n.indexOf(".");return-1===r?(log_error("No pipe name in a signal",n),null):{signal:n.substring(r+1),pipe:n.substring(0,r),type:e}}}();var R;!function(){function n(n,e,t){return null==n||"function"!=typeof n[e]?(log_error("BindingProvider.",t,"should be a function. Property:",e),!1):!0}function e(n,e){var t=n.ctr.parent;if(null!=t[e])return t;var r=n.model;return null!=r[e]?r:(log_error("BindingProvider. Accessor `",e,"`should be a function"),null)}function t(n){var e=n.getFullYear(),t=n.getMonth()+1,r=n.getDate();return e+"-"+(10>t?"0":"")+t+"-"+(10>r?"0":"")+r}function r(n){var e=n.getHours(),t=n.getMinutes();return e+":"+(10>t?"0":"")+t}var o={get:function(n,t){var r=n.objGetter;if(null==r)return T(t,n.model,n.ctx,n.ctr);var o=e(n,r);return null==o?null:o[r](t,n.model,n.ctr.parent)},set:function(n,t,r,o){var i=o.objSetter;if(null==i)return void obj_setProperty(n,t,r);var l=e(o,i);null!=l&&l[i](t,r,o.model,o.ctr.parent)}},i={get:function(e){var t=e.domGetter;if(null==t)return obj_getProperty(e,e.property);var r=e.ctr.parent;return n(r,t,"Getter")===!1?null:r[t](e.element)},set:function(e,t){var r=e.domSetter;if(null==r)return void obj_setProperty(e,e.property,t);var o=e.ctr.parent;n(o,r,"Setter")!==!1&&o[r](t,e.element)}},l={domSet:function(n){return function(e,t){var r=N(t);e.element.value=null==r?"":n(r)}},objSet:function(n){return function(e,t,r){var o=N(r);if(null!=o){var i=N(obj_getProperty(e,t));return null==i?void obj_setProperty(e,t,o):void n(i,o)}}}};R={objectWay:o,domWay:i,SELECT:{get:function(n){var e=n.element,t=e.selectedIndex;return-1===t?"":e.options[t].getAttribute("name")},set:function(n,e){for(var t=n.element,r=t.options,o=r.length,i=-1;++i<o;)if(r[i].getAttribute("name")==e)return void(t.selectedIndex=i);log_warn("Value is not an option",e)}},DATE:{domWay:{get:i.get,set:function(n,e){var r=N(e);n.element.value=null==r?"":t(r)}},objectWay:{get:o.get,set:l.objSet(function(n,e){n.setFullYear(e.getFullYear()),n.setMonth(e.getMonth()),n.setDate(e.getDate())})}},TIME:{domWay:{get:i.get,set:l.domSet(r)},objectWay:{get:o.get,set:l.objSet(function(n,e){n.setHours(e.getHours()),n.setMinutes(e.getMinutes()),n.setSeconds(e.getSeconds())})}}}}();var H={};n.registerBinding=function(n,e){H[n]=e};var B;!function(){function e(n){var e=n.expression,t=n.model,r=n.objectChanged=n.objectChanged.bind(n);if(n.binder=F(e,t,n.ctx,n.ctr,r),D(e,t,n.ctx,n.ctr,n.binder),"dual"===n.bindingType){var o=n.ctr.attr;if(!o["change-slot"]&&!o["change-pipe-event"]){var i=n.element,l=o["change-event"]||o.changeEvent||"change",u=n.domChanged.bind(n);d(i,l,u)}if(!n.objectWay.get(n,n.expression))return setTimeout(function(){n.domWay.get(n)&&n.domChanged()}),n}return n.objectChanged(),n}function t(n,e,r){if(null!=n){var o=n.slots;(null==o||"function"!=typeof o[e]||o[e].apply(n,r)!==!1)&&t(n.parent,e,r)}}n.BindingProvider=B=function(n,e,t,r){null==r&&(r=":bind"===t.compoName?"single":"dual");var o,i=t.attr;if(this.node=t,this.ctr=t,this.ctx=null,this.model=n,this.element=e,this.value=i.value,this.property=i.property,this.domSetter=i.setter||i["dom-setter"],this.domGetter=i.getter||i["dom-getter"],this.objSetter=i["obj-setter"],this.objGetter=i["obj-getter"],this.dismiss=0,this.bindingType=r,this.log=!1,this.signal_domChanged=null,this.signal_objectChanged=null,this.locked=!1,null==this.property&&null==this.domGetter)switch(e.tagName){case"INPUT":if(o=e.getAttribute("type"),"checkbox"===o){this.property="element.checked";break}if("date"===o){var l=R.DATE;this.domWay=l.domWay,this.objectWay=l.objectWay}this.property="element.value";break;case"TEXTAREA":this.property="element.value";break;case"SELECT":this.domWay=R.DATE.SELECT;break;default:this.property="element.innerHTML"}if(i.log&&(this.log=!0,"log"!==i.log&&(this.logExpression=i.log)),i["x-signal"]){var u=$(i["x-signal"],null,"dom")[0],s=u&&u.type;switch(s){case"dom":case"object":this["signal_"+s+"Changed"]=u.signal;break;default:log_error("Signal typs is not supported",u)}}if(i["x-pipe-signal"]){var u=$(i["x-pipe-signal"],!0,"dom")[0],s=u&&u.type;switch(s){case"dom":case"object":this["pipe_"+s+"Changed"]=u;break;default:log_error("Pipe type is not supported")}}if(i["dom-slot"]){this.slots={};var a=t.parent,c=a.parent;a.parent=this,this.parent=c,this.slots[i["dom-slot"]]=function(n,e){this.domChanged(n,e)}}var d=i["object-pipe-slot"]||i["x-pipe-slot"];if(d){var p=d,h=p.indexOf("."),g=p.substring(0,h),u=p.substring(h+1);this.pipes={},this.pipes[g]={},this.pipes[g][u]=function(){this.objectChanged()},f.pipe.addController(this)}if(i.expression){if(this.expression=i.expression,null==this.value&&"single"!==r){var m=P(this.expression);"string"==typeof m?this.value=m:log_warn("Please set value attribute in DualBind Control.")}}else this.expression=this.value},B.create=function(n,e,t,r){var o,i=t.attr.bindingProvider,l=null==i?null:H[i];return"function"==typeof l?new l(n,e,t,r):(o=new B(n,e,t,r),null!=l&&obj_extend(o,l),o)},B.bind=function(n){return e(n)},B.prototype={constructor:B,dispose:function(){M(this.expression,this.model,this.ctr,this.binder)},objectChanged:function(n){if(!(this.dismiss-->0)){if(this.locked===!0)return void log_warn("Concurance change detected",this);if(this.locked=!0,null==n&&(n=this.objectWay.get(this,this.expression)),this.domWay.set(this,n),this.log&&console.log("[BindingProvider] objectChanged -",n),this.signal_objectChanged&&t(this.ctr,this.signal_objectChanged,[n]),this.pipe_objectChanged){var e=this.pipe_objectChanged;f.pipe(e.pipe).emit(e.signal)}this.locked=!1}},domChanged:function(n,e){if(this.locked===!0)return void log_warn("Concurance change detected",this);this.locked=!0,null==e&&(e=this.domWay.get(this));var r=!0,o=this.ctr.validations;if(o)for(var i,l=o.length,u=-1;++u<l;)if(i=o[u],i.validate(e,this.element,this.objectChanged.bind(this))===!1){r=!1;break}if(r&&(this.dismiss=1,this.objectWay.set(this.model,this.value,e,this),this.dismiss=0,this.log&&console.log("[BindingProvider] domChanged -",e),this.signal_domChanged&&t(this.ctr,this.signal_domChanged,[e]),this.pipe_domChanged)){var s=this.pipe_domChanged;f.pipe(s.pipe).emit(s.signal)}this.locked=!1},objectWay:R.objectWay,domWay:R.domWay},obj_extend(B,{addObserver:v,removeObserver:b})}(),p(":visible",l),l.prototype={constructor:l,refresh:function(n,e){e.style.display=T(this.attr.check,n)?"":"none"},renderStart:function(n,e,t){this.refresh(n,t),this.attr.bind&&v(n,this.attr.bind,this.refresh.bind(this,n,t))}},function(){function n(){}p(":bind",n),n.prototype={constructor:n,renderEnd:function(n,e,t,r){this.provider=B.create(e,r,this,"single"),B.bind(this.provider)},dispose:function(){this.provider&&"function"==typeof this.provider.dispose&&this.provider.dispose()}}}(),p(":dualbind",u),u.prototype={constructor:u,renderEnd:function(e,t,r,o){if(this.provider=B.create(t,o,this),this.components)for(var i,l=0,u=this.components.length;u>l;l++)i=this.components[l],":validate"===i.compoName&&(this.validations||(this.validations=[])).push(i);if(!this.attr["no-validation"]&&!this.validations){var s=t.Validate,a=this.provider.value;if(null==s&&-1!==a.indexOf(".")){for(var c=a.split("."),l=0,f=c.length,d=t[c[0]];null==s&&++l<f&&d;)s=d.Validate,d=d[c[l]];a=c.slice(l).join(".")}var p=s&&s[a];"function"==typeof p&&(p=n.getHandler(":validate").createCustom(o,p),(this.validations||(this.validations=[])).push(p))}B.bind(this.provider)},dispose:function(){this.provider&&"function"==typeof this.provider.dispose&&this.provider.dispose()},handlers:{attr:{"x-signal":function(){}}}},function(){function t(){}function r(n,e){this.fn=n,this.message=e}function o(n,e,t){log_warn("Validate Notification:",n,e);var r=m(n).next("."+l);return 0===r.length&&(r=m("<div>").addClass(l).html("<span></span><button>cancel</button>").insertAfter(n)),r.children("button").off().on("click",function(){r.hide(),t&&t()}).end().children("span").text(e).end().show()}function i(n){return m(n).next("."+l).hide()}var l="-validate-invalid";n.registerValidator=function(n,e){u[n]=e},p(":validate",t),t.prototype={constructor:t,attr:{},renderStart:function(n,e,o){if(this.element=o,this.attr.value){var i=t.resolveFromModel(n,this.attr.value);i&&(this.validators=[new r(i)])}},validate:function(n,e,t){null==e&&(e=this.element),this.attr&&(null==n&&this.attr.getter&&(n=obj_getProperty({node:this,element:e},this.attr.getter)),null==n&&this.attr.value&&(n=obj_getProperty(this.model,this.attr.value))),null==this.validators&&this.initValidators();for(var r,o=0,i=this.validators.length;i>o;o++)if(r=this.validators[o].validate(n),r&&!this.attr.silent)return this.notifyInvalid(e,r,t),!1;return this.makeValid(e),!0},notifyInvalid:function(n,e,t){return o(n,e,t)},makeValid:function(n){return i(n)},initValidators:function(){this.validators=[];for(var n in this.attr){switch(n){case"message":case"value":case"getter":continue}if(n in u!=!1){var e=u[n];this.validators.push(new r(e(this.attr[n],this),this.attr.message))}else log_error("Unknown Validator:",n,this)}}},t.resolveFromModel=function(n,e){return obj_getProperty(n.Validate,e)},t.createCustom=function(n,e){var o=new t;return o.element=n,o.validators=[new r(e)],o},r.prototype.validate=function(n){var e=this.fn(n);return e===!1?this.message||"Invalid - "+n:e},p(":validate:message",e({template:"div."+l+' { span > "~[bind:message]" button > "~[cancel]" }',onRenderStart:function(n){"string"==typeof n&&(n={message:n}),n.cancel||(n.cancel="cancel"),this.model=n},compos:{button:"$: button"},show:function(n,e){var t=this;this.model.message=n,this.compos.button.off().on(function(){t.hide(),e&&e()}),this.$.show()},hide:function(){this.$.hide()}}));var u={match:function(n){return function(e){return new RegExp(n).test(e)}},unmatch:function(n){return function(e){return!new RegExp(n).test(e)}},minLength:function(n){return function(e){return e.length>=parseInt(n,10)}},maxLength:function(n){return function(e){return e.length<=parseInt(n,10)}},check:function(n,e){return function(t){return T("x"+n,e.model,{x:t},e)}}}}(),p(":validate:group",s),s.prototype={constructor:s,validate:function(){for(var n,e=a(this),t=0,r=e.length;r>t;t++)if(n=e[t],!n.validate())return!1;return!0}},function(){function n(n,e,t){return n?null==e||""===e?n+" "+t:n.replace(e,t):t}function e(n){return function(e){n.textContent=e}}function t(e,t,r){return function(o){var i=e.getAttribute(t),l=n(i,r,o);e.setAttribute(t,l),r=o}}function r(e,t,r){return function(o){switch(typeof e[t]){case"boolean":return void(r=e[t]=!!o);case"number":return void(r=e[t]=Number(o));case"string":return void(r=e[t]=n(e[t],r,o));default:return void log_warn("Unsupported elements property type",t)}}}function o(n,o,i,l,u){if("node"===n)return e(i);if("attr"===n){switch(u){case"value":case"disabled":case"checked":case"selected":case"selectedIndex":return r(i,u,l)}return t(i,u,l)}throw Error("Unexpected binder type: "+n)}function i(n,e,t,r,i,l,u,s){var a=o(s,e,i,n,u),c=F(e,t,r,l,a);D(e,t,r,l,c),S(l,function(){M(e,t,l,c)})}g("bind",{mode:"partial",current:null,element:null,nodeRenderStart:function(n,e,t,r,o){var i=T(n,e,t,o);return this.element=document.createTextNode(i),this.current=i},node:function(n,e,t,r,o){return i(this.current,n,e,t,this.element,o,null,"node"),this.element},attrRenderStart:function(n,e,t,r,o){return this.current=T(n,e,t,o)},attr:function(n,e,t,r,o,l){return i(this.current,n,e,t,r,o,l,"attr"),this.current}})}(),h("xx-visible",function(n,e,t,r,o,i){var l=F(e,t,r,i,function(n){o.style.display=n?"":"none"});D(e,t,r,i,l),S(i,function(){M(e,t,i,l)}),T(e,t,r,i)||(o.style.display="none")}),h("x-toggle","client",function(n,e,t,r,o,i){var l=e.substring(0,e.indexOf(":")),u=e.substring(l.length+1),s=P(u);"string"!=typeof s&&(s=s[0]),d(o,l,function(){var n=T(u,t,r,i);obj_setProperty(t,s,n)})}),h("x-class-toggle","client",function(n,e,t,r,o){var i=e.substring(0,e.indexOf(":")),l=e.substring(i.length+1).trim();d(o,i,function(){m(o).toggleClass(l)})}),function(){var t,o,l,u,s,a=n.getStatement();!function(){t=function(n,e,t,r,o){return a[n].getNodes(e,t,r,o)},o=function(n,e,t,r,o,i){if(null==n)return null;var l=[];return builder_build(n,e,t,r,o,l),null==i?l:(arr_pushMany(i,l),l)},l=function(n,e){n.placeholder=document.createComment(""),e.appendChild(n.placeholder)},u=function(n,e,t,r,o,i){n.parent=i,n.model=t,n.refresh=fn_proxy(n.refresh,n),n.binder=F(n.expr,t,r,i,n.refresh),D(n.expr,t,r,i,n.binder)},s=function(n,e){if(null!=n)for(var t,r="function"==typeof n.splice,o=r?n.length:1,i=-1;++i<o;)t=r?n[i]:n,t.style.display=e?"":"none"}}(),function(){function e(){}function r(n,e,t,r,o,i,l,u){for(n.model=o,n.ctx=i,n.controller=u,n.refresh=fn_proxy(n.refresh,n),n.binder=I(n.refresh),n.index=t,n.Switch=[{node:e,elements:null}],D(e.expression,o,i,u,n.binder);;){if(e=e.nextSibling,null==e||"else"!==e.tagName)break;n.Switch.push({node:e,elements:null}),e.expression&&D(e.expression,o,i,u,n.binder)}null!=t&&(n.Switch[t].elements=r)}n.registerHandler("+if",{$meta:{serializeNodes:!0},render:function(n,e,r,i,l){for(var u=this,s=t("if",u,n,e,i),a=0,c=u;;){if(c.nodes===s)break;if(a++,c=u.nextSibling,null==c||"else"!==c.tagName){a=null;break}}return this.attr["switch-index"]=a,o(s,n,e,r,i,l)},renderEnd:function(n,t,o,i,l){var u=new e,s=this.attr["switch-index"];return u.placeholder=document.createComment(""),i.appendChild(u.placeholder),r(u,this,s,n,t,o,i,l),u},serializeNodes:function(e){for(var t=[e];;){if(e=e.nextSibling,null==e||"else"!==e.tagName)break;t.push(e)}return n.stringify(t)}}),e.prototype={compoName:"+if",ctx:null,model:null,controller:null,index:null,Switch:null,binder:null,refresh:function(){for(var e,t=this,r=t.Switch,o=r.length,l=-1,u=t.index,a=t.model,c=t.ctx,f=t.controller;++l<o&&(e=r[l].node.expression,null!=e)&&!T(e,a,c,f););if(u!==l){if(null!=u&&s(r[u].elements,!1),l===o)return void(t.index=null);this.index=l;var d=r[l];if(null!=d.elements)return void s(d.elements,!0);var p=n.render(d.node.nodes,a,c,null,f),h=p.nodeType===Node.DOCUMENT_FRAGMENT_NODE?_Array_slice.call(p.childNodes):p;i(p,t.placeholder),d.elements=h}},dispose:function(){for(var n,e,t=this.Switch,r=t.length,o=-1;++o<r;)n=t[o],e=n.node.expression,e&&M(e,this.model,this.controller,this.binder),n.node=null,n.elements=null;this.controller=null,this.model=null,this.ctx=null}}}(),function(){function e(){}function t(n,e,t,r,o){if(u=f.getNodes(n,e,t,r,o),c=null,null!=u){for(var i=e.length,l=-1;++l<i&&e[l].nodes!==u;);c=l===i?null:l}}function r(n,e,t,r,o,i,l,u){n.ctx=i,n.expr=e.expression,n.model=o,n.controller=u,n.index=t,n.nodes=e.nodes,n.refresh=fn_proxy(n.refresh,n),n.binder=F(n.expr,o,i,u,n.refresh),n.Switch=new Array(e.nodes.length),null!=t&&(n.Switch[t]=r),D(e.expression,o,i,u,n.binder)}var u,c,f=a["switch"],d="switch-index";n.registerHandler("+switch",{$meta:{serializeNodes:!0},serializeNodes:function(e){return n.stringify(e)},render:function(n,e,r,i,l){var s=T(this.expression,n,e,i);return t(s,this.nodes,n,e,i),null==u?null:(this.attr[d]=c,o(u,n,e,r,i,l))},renderEnd:function(n,t,o,i,u){var s=new e,a=this.attr[d];return l(s,i),r(s,this,a,n,t,o,i,u),s}}),e.prototype={compoName:"+switch",ctx:null,model:null,controller:null,index:null,nodes:null,Switch:null,binder:null,refresh:function(e){var r=this,o=r.Switch,l=(o.length,r.index),a=r.model,f=r.ctx,d=r.controller;if(t(e,r.nodes,a,f,d),c!==l){if(null!=l&&s(o[l],!1),null==c)return void(r.index=null);this.index=c;var p=o[c];if(null!=p)return void s(p,!0);var h=n.render(u,a,f,null,d),g=h.nodeType===Node.DOCUMENT_FRAGMENT_NODE?_Array_slice.call(h.childNodes):h;i(h,r.placeholder),o[c]=g}},dispose:function(){M(this.expr,this.model,this.controller,this.binder),this.controller=null,this.model=null,this.ctx=null;var n,e,t,r,o=this.Switch;for(n in o)if(e=o[n],null!=e)for(r=e.length,t=-1;++t<r;)null!=e[t].parentNode&&e[t].parentNode.removeChild(e[t])}}}(),function(){function t(n){this.expr=n.expression,this.nodes=n.nodes}function o(n,e,t,r,o){var i=[];return builder_build(n,e,t,r,o,i),i}a["with"];n.registerHandler("+with",{meta:{serializeNodes:!0},render:function(n,e,t,r){var i=T(this.expression,n,e,r);return o(this.nodes,i,e,t,r)},renderEnd:function(n,e,r,o,i){var u=new t(this);return u.elements=n,u.model=e,u.parent=i,u.refresh=fn_proxy(u.refresh,u),u.binder=F(u.expr,e,r,i,u.refresh),D(u.expr,e,r,i,u.binder),l(u,o),u}}),t.prototype={compoName:"+with",elements:null,binder:null,model:null,parent:null,refresh:function(n){if(r(this.elements),this.components){for(var t=this.components.length,l=-1;++l<t;)e.dispose(this.components[l]);this.components.length=0}var u=document.createDocumentFragment();this.elements=o(this.nodes,n,null,u,this),i(u,this.placeholder),O(this)},dispose:function(){M(this.expr,this.model,this.parent,this.binder),this.parent=null,this.model=null,this.ctx=null}}}(),function(){function e(n){for(var e,t=n.length,r=-1;++r<t;)switch(e=n[r],typeof e){case"string":case"number":case"boolean":n[r]=Object(e)}}function t(n,e){for(var t=n.node.components,r=0,o=t.length,l=0,u=null,s=null,a=null,c=document.createDocumentFragment(),f=[];o>r;r++)if(a=t[r],null!=a.elements&&0!==a.elements.length)for(l=0,u=a.elements.length;u>l;l++)s=a.elements[l],s.parentNode.removeChild(s);n:for(l=0,u=e.length;u>l;l++){for(r=0;o>r;r++)if(e[l]===n._getModel(t[r])){f[l]=t[r];continue n}log_warn("No Model Found for",e[l])}for(r=0,o=f.length;o>r;r++)if(a=f[r],null!=a.elements&&0!==a.elements.length)for(l=0,u=a.elements.length;u>l;l++)s=a.elements[l],c.appendChild(s);n.components=n.node.components=f,i(c,n.placeholder)}function r(n,e,t,r,o){var i=n.node,l=i.components;null==l&&(l=i.components=[]);var u=(n.prop1,n.prop2,n.type,n.ctx),s=n.node;if(null!=e&&null!=t){var a=e,c=e+t;for(c>l.length&&(c=l.length);c>a;a++)E(l[a],i)&&(a--,c--)}if(null!=r&&o&&o.length){var d,a=l.length,p=n._build(i,o,u,s),h=l.splice(a);for(k(i,r,p,n.placeholder),l.splice.apply(l,[r,0].concat(h)),a=0,d=h.length;d>a;a++)f.signal.emitIn(h[a],"domInsert")}}function o(n,e){for(var t,r=n.components,o=r.length;--o>-1;)t=r[o],-1!==e.indexOf(t.model)&&E(t,n.node)}var l={model:null,parent:null,refresh:function(n,l,u,s){var a,c=0,f=this.node,d=(this.model,this.ctx),p=this.node;if(null==l){var h=f.components;if(null!=h){for(var a=h.length,c=-1;++c<a;)E(h[c],f)&&(c--,a--);h.length=0}var g=this._build(f,n,d,p);return i(g,this.placeholder),void arr_each(f.components,O)}var m=n;switch(e(n),l){case"push":r(this,null,null,m.length-1,m.slice(m.length-1));break;case"pop":r(this,m.length,1);break;case"unshift":r(this,null,null,0,m.slice(0,1));break;case"shift":r(this,0,1);break;case"splice":var v=u[0],y=1===u.length?this.components.length:u[1],b=u.length>2?m.slice(u[0],u.length-2+u[0]):null;r(this,v,y,v,b);break;case"sort":case"reverse":t(this,m);break;case"remove":null!=s&&s.length&&o(this,s)}},dispose:function(){M(this.expr,this.model,this.parent,this.binder)}};!function(){function t(n,e){this.prop1=e[o],this.prop2=e[i],this.type=e[s],this.expr=e[c],null==n.components&&(n.components=[]),this.node=n,this.components=n.components}var r=a["for"],o="for-prop-1",i="for-prop-2",s="for-type",c="for-expr";n.registerHandler("+for",{$meta:{serializeNodes:!0},serializeNodes:function(e){return n.stringify(e)},render:function(n,t,l,u,a){var f=r.parseFor(this.expression),d=this.attr;d[o]=f[0],d[i]=f[1],d[s]=f[2],d[c]=f[3];var p=T(f[3],n,t,u);null!=p&&(is_Array(p)&&e(p),r.build(p,f,this.nodes,n,t,l,this,a))},renderEnd:function(n,e,r,o,i){var l=new t(this,this.attr);return l.placeholder=document.createComment(""),o.appendChild(l.placeholder),u(l,this,e,r,o,i),l},getHandler:function(n,e){return r.getHandler(n,e)}}),t.prototype={compoName:"+for",model:null,parent:null,refresh:l.refresh,dispose:l.dispose,_getModel:function(n){return n.scope[this.prop1]},_build:function(n,e,t,o){var i=r.getNodes(n.nodes,e,this.prop1,this.prop2,this.type);return builder_build(i,this.model,t,null,o)}}}(),function(){function t(n,e,t,r,i,l){for(var u,s=e.length,a=-1;++a<s;)u=o.createItem(a,n,i),builder_build(u,e[a],t,r,i,l)}function r(n){this.expr=n.expression,this.nodes=n.nodes,null==n.components&&(n.components=[]),this.node=n,this.components=n.components}var o=a.each;n.registerHandler("+each",{render:function(n,r,o,i,l){var u=this,s=T(u.expression,n,r,i);null!=s&&(e(s),t(u.nodes,s,r,o,u,l))},renderEnd:function(n,e,t,o,i){var l=new r(this,this.attr);return l.placeholder=document.createComment(""),o.appendChild(l.placeholder),u(l,this,e,t,o,i),l}}),r.prototype={compoName:"+each",refresh:l.refresh,dispose:l.dispose,_getModel:function(n){return n.model},_build:function(n,e,r,o){var i=document.createDocumentFragment();return t(n.nodes,e,r,i,o),i}}}()}()}()}(Mask,Compo),Mask.Compo=Compo,Mask.jmask=jmask,exports.mask=Mask});
//# sourceMappingURL=mask.min.js.map