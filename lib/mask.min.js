!function(e,t){"use strict";function f(e){this.template=e,this.index=0,this.length=e.length}function l(){this.attr={}}var n=/\s/g,r=/([!]?[A-Za-z0-9_\-\.]+)([!<>=]{1,2})?([^\|&]+)?([\|&]{2})?/g,i={"'":/\\'/g,'"':/\\"/g,"{":/\\\{/g,">":/\\>/g,";":/\\>/g},s=/[\t\n\r]{1,}/g,o=/ {2,}/g,u={}.hasOwnProperty,a={extend:function(e,t){var n;if(t==null)return e;e==null&&(e={});for(n in t)u.call(t,n)&&(e[n]=t[n]);return e},getProperty:function(e,t){var n=e,r,i,s,o;if(typeof e!="object"||t==null)return e;typeof t=="string"&&(r=t.split("."));for(s=0,o=r.length;s<o;s++){i=r[s],n=n[i];if(!n)return n}return n},templateFunction:function(e,t){var r="",i=!0,s,o,u,f,l,c;for(l=0,c=e.length;l<c;l++)i?r+=e[l]:(f=e[l],o=null,u=f.indexOf(":"),~u?(s=u>0?f.substring(0,u).replace(n,""):"",s===""&&(s="condition"),f=f.substring(u+1),o=typeof h[s]=="function"?h[s](f,t):null):o=a.getProperty(t,f),r+=o==null?"":o),i=!i;return r}};f.prototype={next:function(){return this.index++,this},skipWhitespace:function(){var e=this.template,t=this.index,n=this.length;for(;t<n;t++)if(e.charCodeAt(t)!==32)break;return this.index=t,this},skipToChar:function(e){var t=this.template,n;do n=t.indexOf(e,this.index);while(~n&&t.charCodeAt(n-1)!==92);return this.index=n,this},skipToAttributeBreak:function(){var e=this.template,t=this.index,n=this.length,r;do r=e.charCodeAt(++t),r===35&&e.charCodeAt(t+1)===123&&(t++,r=null);while(r!==46&&r!==35&&r!==62&&r!==123&&r!==32&&r!==59&&t<n);return this.index=t,this},sliceToChar:function(e){var t=this.template,n=this.index,r=n,s=!1,o;for(;;){n=t.indexOf(e,n);if(!~n||t.charCodeAt(n-1)!==92)break;s=!0,n++}return o=t.substring(r,n),this.index=n,s?o.replace(i[e],e):o}},l.prototype.render=function(e,t){return t instanceof Array?d.buildHtml(this.nodes,e,t):d.buildDom(this.nodes,e,t)};var c=function(){function n(){this.attr={}}function r(){this.attr={}}function i(){this.attr={}}var e=l.prototype.render;return n.prototype.render=function(e,n,r){var i=this.attr,s=i.template,o=a.getProperty(e,i.value),u,f,l,c,h;if(o instanceof Array){s!=null&&(f=t.querySelector(s).innerHTML,this.nodes=u=mask.compile(f));if(this.nodes==null)return n;l=d[n.buffer!=null?"buildHtml":"buildDom"];for(c=0,h=o.length;c<h;c++)l.call(d,this.nodes,o[c],n,r);return n}return n},r.prototype.render=function(t,n,r){return h.out.isCondition(this.attr.check,t)?e.call(this,t,n,r):n},i.prototype.render=function(){var e=Object.defineProperty,t=!1,n,r;if(e)try{t=Object.defineProperty({},"x",{get:function(){return!0}}).x}catch(s){t=!1}else Object.prototype.__defineGetter__&&(e=function(e,t,n){u.call(n,"get")&&e.__defineGetter__(t,n.get),u.call(n,"set")&&e.__defineSetter__(t,n.set)},t=!0);return t||(n=[],e=function(e,t,r){var i,s=!1,o,u;for(o=0,u=n.length;o<u;o++){i=n[o];if(i.obj===e){s=!0;break}}s||(i=n[o]={obj:e,props:{}}),i.props[t]={value:e[t],set:r.set}},r=function(){var e,t,i,s,o,a,f;for(t=0,i=n.length;t<i;t++){e=n[t],s=e.props;for(o in s)u.call(s,o)&&(a=s[o],f=e.obj[o],f!==a.value&&a.set.call(null,f))}setTimeout(r,16)},r()),(i.prototype.render=function(t,n){var r=this.attr.value,i=t[r];return e.call(Object,t,r,{get:function(){return i},set:function(e){n.innerHTML=i=e}}),n.innerHTML=i,n}).apply(this,arguments)},{all:{list:n,visible:r,bind:i}}}(),h=function(){var e=function(e){var i={assertions:[]},s={data:e.replace(n,"")},o,u;s.index=s.data.indexOf("?"),s.index===-1&&console.error('Invalid Linear Condition: "?" is not found'),u=s.data.substring(0,s.index);while((o=r.exec(u))!=null)i.assertions.push({join:o[4],left:o[1],sign:o[2],right:o[3]});return s.index++,t(s,i,"case1"),s.index++,t(s,i,"case2"),i},t=function(e,t,n){var r=e.data[e.index],i=null;if(r==null)return;r==='"'||r==="'"?(i=e.data.indexOf(r,++e.index),t[n]=e.data.substring(e.index,i)):(i=e.data.indexOf(":",e.index),i===-1&&(i=e.data.length),t[n]={value:e.data.substring(e.index,i)}),i!=null&&(e.index=++i)},i=function(t,n){typeof t=="string"&&(t=e(t));var r=!1,i,s,o,u,f,l;for(f=0,l=t.assertions.length;f<l;f++){i=t.assertions[f];if(i.right==null){r=i.left.charCodeAt(0)===33?!a.getProperty(n,i.left.substring(1)):!!a.getProperty(n,i.left);if(r===!0){if(i.join==="&&")continue;break}if(i.join==="||")continue;break}s=i.right.charCodeAt(0),s===34||s===39?u=i.right.substring(1,i.right.length-1):s>47&&s<58?u=i.right:u=a.getProperty(n,i.right),o=a.getProperty(n,i.left);switch(i.sign){case"<":r=o<u;break;case"<=":r=o<=u;break;case">":r=o>u;break;case">=":r=o>=u;break;case"!=":r=o!==u;break;case"==":r=o===u}if(r===!0){if(i.join==="&&")continue;break}if(i.join==="||")continue;break}return r};return{condition:function(t,n){var r=e(t),s=i(r,n)?r.case1:r.case2;return s==null?"":typeof s=="string"?s:a.getProperty(n,s.value)},out:{isCondition:i,parse:e}}}(),p={toFunction:function(e){var t=e.split("#{"),n=t.length;for(var r=1;r<n;r++){var i=t[r],s=i.indexOf("}");t.splice(r,0,i.substring(0,s)),r++,n++,t[r]=i.substring(s+1)}return e=null,function(e){return a.templateFunction(t,e)}},parseAttributes:function(e,t){var n,r,i,s,o,u;t.attr==null&&(t.attr={});for(;e.index<e.length;e.index++){n=null,r=null,o=e.template.charCodeAt(e.index);switch(o){case 32:continue;case 123:case 59:case 62:i!=null&&(t.attr["class"]=i.indexOf("#{")>-1?e.serialize!==!0?this.toFunction(i):{template:i}:i);return;case 46:u=e.index+1,e.skipToAttributeBreak(),r=e.template.substring(u,e.index),i=i!=null?i+" "+r:r,e.index--;break;case 35:n="id",u=e.index+1,e.skipToAttributeBreak(),r=e.template.substring(u,e.index),e.index--;break;default:n=e.sliceToChar("=");do s=e.template.charAt(++e.index);while(s===" ");e.index++,r=e.sliceToChar(s)}n!=null&&(r.indexOf("#{")>-1&&(r=e.serialize!==!0?this.toFunction(r):{template:r}),t.attr[n]=r)}},parse:function(e,t){var n=e;for(;e.index<e.length;e.index++){var r=e.template.charCodeAt(e.index);switch(r){case 32:continue;case 39:case 34:e.index++;var i=e.sliceToChar(r===39?"'":'"');i.indexOf("#{")>-1&&(i=e.serialize!==!0?this.toFunction(i):{template:i});var s={content:i};n.nodes==null?n.nodes=s:n.nodes.push==null?n.nodes=[n.nodes,s]:n.nodes.push(s);if(n.__single){if(n==null)continue;n=n.parent;while(n!=null&&n.__single!=null)n=n.parent}continue;case 62:n.__single=!0;continue;case 123:continue;case 59:if(n.nodes!=null)continue;case 125:if(n==null)continue;do n=n.parent;while(n!=null&&n.__single!=null);continue}var o=e.index;do r=e.template.charCodeAt(++e.index);while(r!==32&&r!==35&&r!==46&&r!==59&&r!==123&&r!==62&&e.index<=e.length);var u=e.template.substring(o,e.index);u===""&&console.error("Parse Error: Undefined tag Name %d/%d %s",e.index,e.length,e.template.substring(e.index,e.index+10));var a={tagName:u,parent:n};n==null&&console.log("T",e,"rest",e.template.substring(e.index)),n.nodes==null?n.nodes=a:n.nodes.push==null?n.nodes=[n.nodes,a]:n.nodes.push(a),n=a,this.parseAttributes(e,n),e.index--}return e.nodes},cleanObject:function(e){if(e instanceof Array){for(var t=0;t<e.length;t++)this.cleanObject(e[t]);return e}return delete e.parent,delete e.__single,e.nodes!=null&&this.cleanObject(e.nodes),e}},d=function(){var e={img:1,input:1,br:1,hr:1,link:1};return{buildDom:function(e,n,r,i){if(e==null)return r;r==null&&(r=t.createDocumentFragment()),i==null&&(i={});var s=e instanceof Array,o=s===!0?e.length:1;for(var u=0,f;s===!0?u<o:u<1;u++){f=s===!0?e[u]:e;if(c.all[f.tagName]!=null){var l=c.all[f.tagName],h=l instanceof Function?new l(n):l;h.compoName=f.tagName,h.nodes=f.nodes,h.attr=h.attr==null?f.attr:a.extend(h.attr,f.attr),(i.components||(i.components=[])).push(h),h.parent=i,h.render(n,r,h);continue}if(f.content!=null){r.appendChild(t.createTextNode(typeof f.content=="function"?f.content(n):f.content));continue}var p=t.createElement(f.tagName);for(var d in f.attr){var v=typeof f.attr[d]=="function"?f.attr[d](n):f.attr[d];v&&p.setAttribute(d,v)}f.nodes!=null&&this.buildDom(f.nodes,n,p,i),r.appendChild(p)}return r},buildHtml:function(t,n,r){r==null&&(r={buffer:""});var i=t instanceof Array,s=i?t.length:1,o=null;for(var u=0;o=i?t[u]:t,i?u<s:u<1;u++){if(c.all[o.tagName]!=null){var a=new c.all[o.tagName];for(var f in o)a[f]=o[f];return a.render(n,r),r}if(o.content!=null)return r.buffer+=typeof o.content=="function"?o.content(n):o.content,r;r.buffer+="<"+o.tagName;for(var f in o.attr){var l=typeof o.attr[f]=="function"?o.attr[f](n):o.attr[f];l&&(r.buffer+=" "+f+"='"+l+"'")}e[o.tagName]!=null?(r.buffer+="/>",o.nodes!=null&&console.error("Html could be invalid: Single Tag Contains children:",o)):(r.buffer+=">",o.nodes!=null&&this.buildHtml(o.nodes,n,r),r.buffer+="</"+o.tagName+">")}return r}}}();e.mask={renderHtml:function(e,t){return typeof e=="string"&&(e=this.compile(e)),d.buildHtml(e,t).buffer},renderDom:function(e,t,n,r){return typeof e=="string"&&(e=this.compile(e)),d.buildDom(e,t,n,r)},compile:function(e,t){e=e.replace(s,"").replace(o," ");var n=new f(e);return t==1&&(n.serialize=!0),p.parse(n,[])},registerHandler:function(e,t){c.all[e]=t},getHandler:function(e){return e!=null?c.all[e]:c.all},registerUtility:function(e,t){h[e]=t},serialize:function(e){return p.cleanObject(this.compile(e,!0))},deserialize:function(e){if(e instanceof Array){for(var t=0;t<e.length;t++)this.deserialize(e[t]);return e}if(e.content!=null)return e.content.template!=null&&(e.content=p.toFunction(e.content.template)),e;if(e.attr!=null)for(var n in e.attr){if(e.attr[n].template==null)continue;e.attr[n]=p.toFunction(e.attr[n].template)}return e.nodes!=null&&this.deserialize(e.nodes),e},ICustomTag:l,ValueUtils:h}}(this,document);