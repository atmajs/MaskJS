/*!
 * MaskJS v0.8.12
 * Part of the Atma.js Project
 * http://atmajs.com/
 *
 * MIT license
 * http://opensource.org/licenses/MIT
 *
 * (c) 2012, 2014 Atma.js and other contributors
 */
(function(e,n){"use strict";function t(){return n(i,r,o)}var r,o,i="undefined"==typeof window||null==window.navigator?global:window;return"undefined"==typeof exports||null!=e&&e!==exports&&e!==i||(e=exports),o=i.document,r=e||i,"function"==typeof define&&define.amd?define(t):t()})(this,function(global,exports,document){"use strict";function util_interpolate(e,n,t,r,o,i,l){for(var s,u,a,c,f,d=e.length,p=-1,h=null,m="",g=!0;d>++p;)g===!0?null==h?m+=e[p]:h.push(e[p]):(c=e[p],u=null,a=c.indexOf(":"),-1===a?u=obj_getPropertyEx(c,t,r,i):(s=a>0?str_trim(c.substring(0,a)):"",""===s&&(s="expression"),c=c.substring(a+1),f=custom_Utils[s],u=f(c,t,r,o,i,l,n)),null!=u&&("object"==typeof u&&null==h&&(h=[m]),null==h?m+=u:h.push(u))),g=!g;return null==h?m:h}function attr_extend(e,n){if(null==e&&(e={}),null==n)return e;for(var t in n)"class"!==t||"string"!=typeof e[t]?e[t]=n[t]:e[t]+=" "+n[t];return e}function Template(e){this.template=e,this.index=0,this.length=e.length}function str_trim(e){for(var n,t=e.length,r=0,o=t-1;t>r&&(n=e.charCodeAt(r),33>n);r++);for(;o>=r&&(n=e.charCodeAt(o),33>n);o--);return 0===r&&o===t-1?e:e.substring(r,o+1)}function fn_proxy(e,n){return function(){return fn_apply(e,n,arguments)}}function fn_apply(e,n,t){switch(t.length){case 0:return e.call(n);case 1:return e.call(n,t[0]);case 2:return e.call(n,t[0],t[1]);case 3:return e.call(n,t[0],t[1],t[2]);case 4:return e.call(n,t[0],t[1],t[2],t[3])}return e.apply(n,t)}function fn_doNothing(){}var regexpWhitespace=/\s/g,regexpEscapedChar={"'":/\\'/g,'"':/\\"/g,"{":/\\\{/g,">":/\\>/g,";":/\\>/g},hasOwnProp={}.hasOwnProperty,listeners=null,__cfg={allowCache:!0},_Array_slice=Array.prototype.slice,is_Function,is_Array;(function(){is_Function=function(e){return"function"==typeof e},is_Array=function(e){return null!=e&&"object"==typeof e&&"number"==typeof e.length&&"function"==typeof e.splice}})(),Template.prototype={skipWhitespace:function(){for(var e=this.template,n=this.index,t=this.length;t>n&&!(e.charCodeAt(n)>32);n++);return this.index=n,this},skipToAttributeBreak:function(){var e,n=this.template,t=this.index,r=this.length;do if(e=n.charCodeAt(++t),35===e&&123===n.charCodeAt(t+1))return this.index=t,this.sliceToChar("}"),this.index++,void 0;while(46!==e&&35!==e&&62!==e&&123!==e&&32!==e&&59!==e&&r>t);this.index=t},sliceToChar:function(e){for(var n,t,r=this.template,o=this.index,i=o,l=!1;(t=r.indexOf(e,o))>-1&&(o=t,92===r.charCodeAt(o-1));)l=!0,o++;return n=r.substring(i,o),this.index=o,l?n.replace(regexpEscapedChar[e],e):n}};var arr_pushMany;(function(){arr_pushMany=function(e,n){if(null!=n&&null!=e)for(var t=e.length,r=n.length,o=-1;r>++o;)e[t+o]=n[o]}})();var obj_extend,obj_getProperty,obj_getPropertyEx,obj_toDictionary;(function(){function e(e,n,t,r){for(var o=e;r>t&&null!=o;)o=o[n[t]],t++;return o}obj_extend=function(e,n){null==e&&(e={});for(var t in n)e[t]=n[t];return e},obj_getProperty=function(e,n){if("."===n)return e;for(var t=e,r=n.split("."),o=-1,i=r.length;null!=t&&i>++o;)t=t[r[o]];return t},obj_getPropertyEx=function(n,t,r,o){if("."===n)return t;var i,l=n.split("."),s=t,u=-1,a=l.length,c=l[0];for("$c"===c?(s=o,u++):"$a"===c?(s=o&&o.attr,u++):"$u"===c?(s=customUtil_$utils,u++):"$ctx"===c&&(s=r,u++),i=u;null!=s&&a>++u;)s=s[l[u]];if(null==s&&-1===i)for(var f;null!=o;){if(f=o.scope,null!=f&&(s=e(f,l,0,a),null!=s))return s;o=o.parent}return s},obj_toDictionary=function(e){var n,t=[],r=0;for(n in e)t[r++]={key:n,value:e[n]};return t}})();var custom_Utils,custom_Statements,custom_Attributes,custom_Tags,custom_Tags_defs,customUtil_get,customUtil_$utils,customUtil_register,customTag_register;(function(){function e(){custom_Utils={expression:function(e,n,t,r,o){return ExpressionUtil.eval(e,n,t,o)}},custom_Statements={},custom_Attributes={"class":null,id:null,style:null,name:null,type:null},custom_Tags={div:null,span:null,input:null,button:null,textarea:null,select:null,option:null,h1:null,h2:null,h3:null,h4:null,h5:null,h6:null,a:null,p:null,img:null,table:null,td:null,tr:null,pre:null,ul:null,li:null,ol:null,i:null,b:null,strong:null,form:null},custom_Tags_defs={}}e(),function(e){function n(e,n){function t(e){this.tagName=e.tagName,this.attr=e.attr,this.expression=e.expression,this.nodes=e.nodes,this.nextSibling=e.nextSibling,this.parent=n,this.components=null}return t.prototype=e,t}customTag_register=function(t,r){null!=r&&"object"==typeof r&&(r.__Ctor=n(r)),e[t]=r}}(custom_Tags),function(e){function n(e){return"parsed"!==e.arguments?fn_proxy(e.process||t,e):r(e.process)}function t(e,n,t,r,o,i,l){return"node"===l?(this.nodeRenderStart(e,n,t,r,o),this.node(e,n,t,r,o)):(this.attrRenderStart(e,n,t,r,o,i),this.attr(e,n,t,r,o,i))}function r(e){return function(n,t,r,o,i){var l=ExpressionUtil.evalStatements(n,t,r,i);return e.apply(null,l)}}customUtil_$utils={},customUtil_register=function(t,r){return is_Function(r)?(e[t]=r,void 0):(e[t]=n(r),"parsed"===r.arguments&&(customUtil_$utils[t]=r.process),void 0)},customUtil_get=function(n){return null!=n?e[n]:e}}(custom_Utils)})();var ExpressionUtil=function(){function e(e){for(var n,t,r=!1,o=39===e?"'":'"',i=u;(n=l.indexOf(o,u))>-1&&(u=n,92===l.charCodeAt(n-1));)r=!0,u++;return t=l.substring(i,u),r===!0&&(t=t.replace(regexpEscapedChar[o],o)),t}function n(){for(var e,n,t=u;;){if(e=l.charCodeAt(u),46===e){if(n===!0)return rn("Unexpected punc"),null;n=!0}if(!((e>=48&&57>=e||46===e)&&a>u))break;u++}return+l.substring(t,u)}function t(){var n,t=u,r=l.charCodeAt(u);if(34===r||39===r)return u++,n=e(r),u++,n;for(;u!==a;)if(r=l.charCodeAt(u),36!==r){if(!(r>47&&58!==r&&60!==r&&61!==r&&62!==r&&63!==r&&124!==r))break;u++}else u++;return l.substring(t,u)}function r(e){if(null==e&&u===a)return null;switch(e){case 40:return O;case 41:return j;case 44:return T;case 46:return S;case 43:return d;case 45:return f;case 42:return h;case 47:return p;case 37:return m;case 61:return l.charCodeAt(++u)!==e?(rn("Not supported (Apply directive) - view can only access model/controllers"),null):l.charCodeAt(u+1)===e?(u++,_):y;case 33:return 61===l.charCodeAt(u+1)?(u++,61===l.charCodeAt(u+1)?(u++,C):x):b;case 62:return 61===l.charCodeAt(u+1)?(u++,w):k;case 60:return 61===l.charCodeAt(u+1)?(u++,N):A;case 38:return l.charCodeAt(++u)!==e?(rn("Single Binary Operator AND"),null):v;case 124:return l.charCodeAt(++u)!==e?(rn("Single Binary Operator OR"),null):g;case 63:return D;case 58:return L}return e>=65&&90>=e||e>=97&&122>=e||95===e||36===e?F:e>=48&&57>=e?P:34===e||39===e?I:(rn("Unexpected / Unsupported directive"),null)}function o(o){l=o,u=0,a=o.length,s=new G;var i,c,E=s,$=W;e:for(;;)if(a>u&&33>(i=l.charCodeAt(u)))u++;else{if(u>=a)break;if(c=r(i),null==c&&a>u)break;switch(c){case O:E=tn(E,new z(E)),E=tn(E,new G(E)),u++;continue;case j:var H=U;$===K&&($=W,H=R);do E=E.parent;while(null!=E&&E.type!==H);if(H===U&&(E=E.parent),null==E){rn("OutOfAst Exception - body closed");break e}u++;continue;case T:if($!==K){$=W;do E=E.parent;while(null!=E&&E.type!==U);if(u++,null==E){rn("Unexpected punctuation, comma");break e}continue}do E=E.parent;while(null!=E&&E.type!==R);if(null==E){rn("OutOfAst Exception - next argument");break e}E=E.newArgument(),u++;continue;case D:s=new en(s),E=s.case1,u++;continue;case L:E=s.case2,u++;continue;case S:i=l.charCodeAt(u+1),i>=48&&57>=i?c=P:(c=F,u++)}if(E.type===U&&(E=tn(E,new z(E))),f!==c&&b!==c||null!=E.body)switch(c){case f:case d:case h:case p:case m:case v:case g:case y:case _:case x:case C:case k:case w:case A:case N:for(;E&&E.type!==M;)E=E.parent;if(null==E.body){rn("Unexpected operator",E);break e}E.join=c;do E=E.parent;while(null!=E&&E.type!==U);null==E&&console.error("Unexpected parent",E),u++;continue;case I:case P:if(null!=E.body&&null==E.join){rn("Directive Expected");break e}I===c&&(u++,tn(E,new q(e(i))),u++),P===c&&tn(E,new q(n(i)));continue;case F:var V=t();if("null"===V&&(V=null),"false"===V&&(V=!1),"true"===V&&(V=!0),"string"!=typeof V){tn(E,new q(V));continue}for(;a>u&&(i=l.charCodeAt(u),33>i);)u++;if(40===i){$=K,u++;var B=tn(E,new X(E,V));E=B.newArgument();continue}E=tn(E,new Z(E,V))}else E=tn(E,new Y(E,c)),u++}return null==E.body&&E.type===M&&rn("Unexpected end of expression"),nn(s),s}function i(e,n,t,r){var l,s;if(null==e)return null;if("."===e)return n;s="string"==typeof e?c.hasOwnProperty(e)===!0?c[e]:c[e]=o(e):e;var u,a,E,O=s.type;if(U===O){var j,T;e:for(u=0,E=s.body.length;E>u;u++)if(a=s.body[u],j=i(a,n,t,r),null!=T&&null!=T.join){if(T.join===v)if(l)l=j;else for(;E>u&&s.body[u].join!==g;u++);if(T.join===g){if(l)break e;if(j){l=j;break e}}switch(T.join){case f:l-=j;break;case d:l+=j;break;case p:l/=j;break;case h:l*=j;break;case m:l%=j;break;case x:l=l!=j;break;case C:l=l!==j;break;case y:l=l==j;break;case _:l=l===j;break;case k:l=l>j;break;case w:l=l>=j;break;case A:l=j>l;break;case N:l=j>=l}T=a}else T=a,l=j}if(M===O)return i(s.body,n,t,r);if(H===O)return s.body;if($===O||R===O)return on(s,n,t,r);if(V===O)switch(l=i(s.body,n,t,r),s.prefix){case f:l=-l;break;case b:l=!l}return B===O&&(l=i(s.body,n,t,r),l=i(l?s.case1:s.case2,n,t,r)),l}var l,s,u=0,a=0,c={},f="-",d="+",p="/",h="*",m="%",g="||",v="&&",b="!",y="==",_="===",x="!=",C="!==",k=">",w=">=",A="<",N="<=",E=".",O=20,j=21,T=22,S=23,D=24,L=25,F=30,I=31,P=32,U=1,M=2,$=3,R=4,H=6,V=9,B=10,W=1,K=2,Q={};Q[E]=1,Q[p]=2,Q[h]=2,Q[f]=3,Q[d]=3,Q[k]=4,Q[w]=4,Q[A]=4,Q[N]=4,Q[y]=5,Q[_]=5,Q[x]=5,Q[C]=5,Q[v]=6,Q[g]=6;var G,z,q,X,Z,J,Y,en;(function(){G=function(e){this.parent=e,this.type=U,this.body=[],this.join=null},z=function(e){this.parent=e},z.prototype={constructor:z,type:M,join:null,body:null},q=function(e){this.type=H,this.body=e,this.join=null},X=function(e,n){this.parent=e,this.type=R,this.body=n,this.arguments=[],this.next=null},X.prototype={constructor:X,newArgument:function(){var e=new G(this);return this.arguments.push(e),e}},Z=function(e,n){this.parent=e,this.type=$,this.body=n,this.next=null},J=function(e,n){this.parent=e,this.body=n,this.next=null},Y=function(e,n){this.parent=e,this.prefix=n},Y.prototype={constructor:Y,type:V,body:null},en=function(e){this.body=e,this.case1=new G(this),this.case2=new G(this)},en.prototype={constructor:en,type:B,case1:null,case2:null}})();var nn,tn;(function(){function e(e){if(0===e.length)return null;var n=new G(e[0].parent);return n.join=e[e.length-1].join,n.body=e,n}tn=function(e,n){null==e&&console.error("<Mask:Ast> Current undefined",n);var t=e.type;return U===t?(e.body.push(n),n):M===t||V===t?e.body=n:$===t||R===t?e.next=n:(console.error("Unsupported - append:",e,n),n)},nn=function(n){if(n.type!==U)return null!=n.body&&"object"==typeof n.body&&nn(n.body),void 0;for(var t,r,o,i=n.body,l=0,s=i.length;s>l;l++)nn(i[l]);for(l=1;s>l&&(t=i[l],r=i[l-1],!(Q[r.join]>Q[t.join]));l++);if(l!==s){for(o=[i[0]],l=1;s>l;l++){t=i[l],r=i[l-1];var u=Q[r.join];if(u>Q[t.join]&&s-1>l){for(var a,c,f=l;s>++l&&(a=i[l].join,null!=a)&&!(Q[a]>=u););c=i.slice(f,l+1),t=e(c),nn(t)}o.push(t)}n.body=o}}})();var rn,on;(function(){on=function(e,n,t,r){var o,l,s,u,a,c=e,f=e.body;if("$c"===f){l=r;var d=c.next,p=null!=d&&d.body;if(null!=p&&null==l[p])if(d.type===R&&"function"==typeof Compo.prototype[p])o=r,l=Compo.prototype[p],c=d;else for(;l=l.parent,null!=l;)if(null!=l[p]){o=l,l=l[p],c=d;break}}else if("$a"===f)l=r&&r.attr;else if("$u"===f)l=customUtil_$utils;else if("$ctx"===f)l=t;else if(null!=n&&(o=n,l=n[f]),null==l)for(;null!=r&&(o=r.scope,null!=o&&(l=o[f]),null==l);)r=r.parent;if(null!=l)for(;;){if(c.type===R){for(s=[],u=-1,a=c.arguments.length;a>++u;)s[u]=i(c.arguments[u],n,t,r);l=l.apply(o,s)}if(null==l||null==c.next)break;if(c=c.next,f=c.body,o=l,l=l[f],null==l)break}return null==l&&(null==c||null!=c.next)&&rn("Mask - Accessor error - ",f),l},rn=function(e,n){console.error("Expression parser:",e,n,l.substring(u))}})();var ln=function(){function e(r){if(null==r)return null;var o,i;if(U===r.type)for(var l=0,u=r.body.length;u>l;l++)i=e(r.body[l]),o=n(o,i);if($===r.type){for(var a=r.body,c=r.next;null!=c;){if(R===c.type)return e(c);if($!==c.type)return console.error("Ast Exception: next should be a symbol/function ref"),null;a+="."+c.body,c=c.next}return a}switch(r.type){case M:case V:case B:i=e(r.body),o=n(o,i)}if(B===r.type&&(i=e(s.case1),o=n(o,i),i=e(s.case2),o=n(o,i)),R===r.type){for(var l=0,u=r.arguments.length;u>l;l++)i=e(r.arguments[l]),o=n(o,i);i=null;var f=r;e:for(;f=f.parent;)switch(f.type){case $:i=f.body+(null==i?"":"."+i);break;case U:case M:break e;default:i=null;break e}null!=i&&(o=n(o,i)),r.next&&(i=e(r.next),o=n(o,{accessor:t(r),ref:i}))}return o}function n(e,n){if(null==e)return n;if(null==n)return e;if(("object"!=typeof e||null==e.length)&&(e=[e]),"object"!=typeof n||null==n.length)return-1===e.indexOf(n)&&e.push(n),e;for(var t=0,r=n.length;r>t;t++)-1===e.indexOf(n[t])&&e.push(n[t]);return e}function t(e){var n=e;e:for(;n.parent;){switch(n.parent.type){case U:case M:break e}n=n.parent}return r(n,e.next)}function r(e,n){if(e===n||null==e)return null;if("object"!=typeof e)return e;if(null!=e.length&&"function"==typeof e.splice){for(var t=[],o=0,i=e.length;i>o;o++)t[o]=r(e[o],n);return t}var l={};for(var s in e)null!=e[s]&&"parent"!==s&&(l[s]=r(e[s],n));return l}return function(n){return"string"==typeof n&&(n=o(n)),e(n)}}();return{parse:o,eval:i,varRefs:ln,evalStatements:function(e,n,t,r){for(var l=o(e).body,s=[],u=l.length,a=-1;u>++a;)s[a]=i(l[a],n,t,r);return s}}}();(function(){function e(e,n,t,r){function o(e){return ExpressionUtil.eval(e,n,t,r)}if(o(e.expression))return e.nodes;for(;e=e.nextSibling,null!=e&&"else"===e.tagName;){var i=e.expression;if(null==i||""===i||o(i))return e.nodes}return null}custom_Statements["if"]={getNodes:e,render:function(n,t,r,o,i,l){var s=e(n,t,r,i);null!=s&&builder_build(s,t,r,o,i,l)}}})(),function(){function e(e,t,r,o,i,l,s,u){builder_build(n(r,e,t[0],t[1],t[2]),o,i,l,s,u)}function n(e,n,o,i,l){return"of"===l?is_Array(n)===!1?(console.warn("<ForStatement> Value is not enumerable",n),null):t(e,n,o,i):"in"===l?"object"!=typeof n?(console.warn("<ForStatement> Value is not an object",n),null):(is_Array(n)&&console.log("<mask:for> Consider to use `for..of` for Arrays"),r(e,n,o,i)):void 0}function t(e,n,t,r){for(var i,l=-1,s=n.length,u=Array(s);s>++l;)i={},i[t]=n[l],r&&(i[r]=l),u[l]=o("for..of/item",e,i);return u}function r(e,n,t,r){var i,l,s,u=[],a=0;for(l in n)s=n[l],i={},i[t]=l,r&&(i[r]=s),u[a++]=o("for..in/item",e,i);return u}function o(e,n,t){return{type:Dom.COMPONENT,tagName:e,nodes:n,controller:{compoName:e,scope:t,renderEnd:function(e){this.elements=e}}}}function i(e){a=e,f=e.length,c=0;var n,t,r,o,i;if(i=l(),40===i&&(o=!0,c++,l()),n=s(),i=l(),44===i){if(o!==!0)return u("Parenthese must be used in multiple var declarion");c++,l(),t=s()}if(o){if(i=l(),41!==i)return u("Closing parenthese expected");c++}i=l();var r;return 105===i&&110===a.charCodeAt(++c)&&(r="in"),111===i&&102===a.charCodeAt(++c)&&(r="of"),null==r?u("Invalid FOR statement. (in|of) expected"):(d[0]=n,d[1]=t,d[2]=r,d[3]=a.substring(++c),d)}function l(){for(var e;f>c;c++)if(e=a.charCodeAt(c),!(33>e))return e;return-1}function s(){for(var e,n=c;f>c;c++)if(e=a.charCodeAt(c),e>48&&57>e){if(n===c)return u("Variable name begins with a digit")}else if(!(36===e||95===e||e>=97&&122>=e||e>=65&&90>=e))break;return n===c?u("Variable declaration expected"):a.substring(n,c)}function u(e){throw Error("<ForStatement parser> "+e+" `"+a.substring(c,20)+"`")}custom_Statements["for"]={render:function(n,t,r,o,l,s){i(n.expression);var u=ExpressionUtil.eval(d[3],t,r,l);null!=u&&e(u,d,n.nodes,t,r,o,l,s)},build:e,parseFor:i,createForItem:o,getNodes:n};var a,c,f,d=["prop1","prop2","in|of","expression"]}(),function(){function e(e,t,r,o,i,l){for(var s,u=t.length,a=-1,c=e;u>++a;)s=n(a,c,i),builder_build(c,t[a],r,o,s,l),null!=s.components&&arr_pushMany(i.components,s.components)}function n(e,n,t){return{type:Dom.COMPONENT,compoName:"each::item",scope:{index:e},parent:t,nodes:n,model:null,attr:null,components:null,elements:null,ID:null}}custom_Statements.each={render:function(n,t,r,o,i,l){var s=ExpressionUtil.eval(n.expression,t,r,i);null!=s&&e(n.nodes,s,r,o,i,l)},createItem:n,build:e}}(),custom_Statements["with"]={render:function(e,n,t,r,o,i){var l=ExpressionUtil.eval(e.expression,n,t,o);builder_build(e.nodes,l,t,r,o,i)}},function(){function e(e,t,r,o,i){if(null==t)return null;for(var l,s,u,a,c=t.length,f=-1;c>++f;)if(l=t[f],"default"!==l.tagName)if("case"===l.tagName)if(s=l.expression){if(n(s,r,o,i)==e){//! `==` comparison
u=l;break}}else console.warn("<mask:switch:case> Expression expected");else console.warn("<mask:switch> Case expected",l.tagName);else a=l;return null==u&&(u=a),null!=u?u.nodes:null}var n=ExpressionUtil.eval;custom_Statements["switch"]={render:function(t,r,o,i,l,s){var u=n(t.expression,r,o,l),a=e(u,t.nodes,r,o,l);null!=a&&builder_build(a,r,o,i,l,s)},getNodes:e}}(),function(){function e(e){this.parent=e,this.compoName="include",this.components=[],this.templates=null}custom_Statements.include={render:function(n,t,r,o,i,l){for(var s,u=ExpressionUtil.evalStatements(n.expression);null!=i&&(s=i.resource,null==s);)i=i.parent;var a=new e(i),c=Compo.pause(a,r);include.instance(s&&s.url).load.apply(s,u).done(function(e){a.templates=e.load,builder_build(n.nodes,t,r,o,a,l),c()})}}}(),custom_Statements["import"]={render:function(e,n,t,r,o,i){var l=e.expression,s=ExpressionUtil.evalStatements(l,n,t,o),u=s[0];if("string"!=typeof u)return console.error("<mask:import> Invalid argument",l),void 0;for(;"include"!=o.compoName&&(o=o.parent,null!=o););if(null!=o){var a=o.templates[u];null!=a&&builder_build(Parser.parse(a),n,t,r,o,i)}}};var Dom;(function(){function e(e){if(null==this.nodes)return this.nodes=[e],void 0;this.nodes.push(e);var n=this.nodes[this.nodes.length-2];n.nextSibling=e}function n(e,n){this.type=Dom.NODE,this.tagName=e,this.parent=n,this.attr={}}function t(e,n){this.content=e,this.parent=n}function r(e,n,t){this.tagName=e,this.parent=n,this.controller=t,this.attr={}}function o(){}var i=1,l=2,s=3,u=4,a=9,c=10,f=15;n.prototype={constructor:n,type:i,tagName:null,parent:null,attr:null,nodes:null,expression:null,appendChild:e,__single:null},t.prototype={type:l,content:null,parent:null},r.prototype={constructor:r,type:u,parent:null,attr:null,controller:null,nodes:null,components:null,model:null,modelRef:null},o.prototype={constructor:o,type:s,nodes:null,appendChild:e},Dom={NODE:i,TEXTNODE:l,FRAGMENT:s,COMPONENT:u,CONTROLLER:a,SET:c,STATEMENT:f,Node:n,TextNode:t,Fragment:o,Component:r}})();var parser_parse,parser_ensureTemplateFunction,parser_setInterpolationQuotes,parser_cleanObject,Parser;(function(e,n,t){function r(e){for(var n=-1;-1!==(n=e.indexOf(s,n))&&e.charCodeAt(n+1)!==f;)n++;if(-1===n)return e;for(var t,r=[],o=0,i=0;t=e.indexOf(a,n+2),-1!==t;){for(r[i++]=o===n?"":e.substring(o,n),r[i++]=e.substring(n+2,t),o=n=t+1;-1!==(n=e.indexOf(s,n))&&e.charCodeAt(n+1)!==f;)n++;if(-1===n)break}return e.length>o&&(r[i]=e.substring(o)),e=null,function(e,n,t,o,i,l){if(null==e){for(var c,f="",d=r.length,p=-1;d>++p;)c=r[p],f+=1===p%2?s+u+c+a:c;return f}return util_interpolate(r,e,n,t,o,i,l)}}function o(e,n,t,r){var o={2:"tag",3:"tag",5:"attribute key",6:"attribute value",8:"literal"}[t],i=e.substring(0,n).split("\n"),l=i.length,s=i[l-1].length,u=["Mask - Unexpected:",r,"at(",l,":",s,") [ in",o,"]"];console.error(u.join(" "),{stopped:e.substring(n),template:e})}var i,l,s="~",u="[",a="]",c=126,f=91,d=93;(function(){i=function(e,n,t,r,i){for(var s,u=0;t>n;n++)if(s=e.charCodeAt(n),34!==s)if(s!==r){if(s===i&&-1===--u)return n}else u++;else n=l(e,n+1,t,'"');return o(e,n,null,"Not closed brackets `"+String.fromCharCode(r)+"`"),n},l=function(e,n,t,r){for(var o;-1!==(o=e.indexOf(r,n))&&(n=o,92===e.charCodeAt(o-1));)n++;return n}})();var p=2,h=3,m=5,g=6,v=7,b=8,y=9;Parser={parse:function(o){for(var l,s,u,a,_,x,C,k,w=new t,A=w,N=p,E=h,O=0,j=o.length;;)if(j>O&&33>(x=o.charCodeAt(O)))O++;else{if(47===x){if(k=o.charCodeAt(O+1),47===k){for(O++;10!==x&&13!==x&&j>O;)x=o.charCodeAt(++O);continue}if(42===k){O=o.indexOf("*/",O+2)+2,1===O&&(O=j);continue}}if(E===m&&(null!=l&&(w.attr["class"]=r(l),l=null),null!=u&&(w.attr[u]=u,u=null,s=null)),null!=s){if(N===m)null==u?u=s:a=s,null!=u&&null!=a&&("class"!==u?w.attr[u]=a:l=null==l?a:l+" "+a,u=null,a=null);else if(E===h)_=new e(s,w),w.appendChild(_),w=_,N=m;else if(E===b){if(_=new n(s,w),w.appendChild(_),w.__single===!0)do w=w.parent;while(null!=w&&null!=w.__single);N=p}s=null}if(O>=j){N===m&&(null!=l&&(w.attr["class"]=r(l)),null!=u&&(w.attr[u]=u));break}if(N===y){for(w=w.parent;null!=w&&null!=w.__single;)w=w.parent;N=p}switch(x){case 123:E=N,N=p,O++;continue;case 62:E=N,N=p,O++,w.__single=!0;continue;case 59:if(null!=w.nodes){O++;continue}case 125:O++,E=N,N=y;continue;case 39:case 34:N===g?N=m:E=N=b,O++;var T,S=!1,D=!1,L=39===x?"'":'"';for(C=O;(T=o.indexOf(L,O))>-1&&(O=T,92===o.charCodeAt(T-1));)S=!0,O++;C===O&&(k=o.charCodeAt(O+1),(124===k||k===x)&&(D=!0,C=O+2,O=T=o.indexOf((124===k?"|":L)+L+L,C),-1===O&&(O=j))),s=o.substring(C,O),S===!0&&(s=s.replace(regexpEscapedChar[L],L)),s=r(s),O+=D?3:1;continue}if(N===p){if(E=h,N=h,46===x||35===x){s="div";continue}}else if(N===m)if(46===x)O++,u="class",N=v;else if(35===x)O++,u="id",N=v;else{if(61===x){O++,N=g;continue}if(40===x){C=1+O,O=1+i(o,C,j,x,41),w.expression=o.substring(C,O-1),w.type=Dom.STATEMENT;continue}if(null!=u){s=u;continue}}(N===g||N===v)&&(E=N,N=m);var F=null;for(C=O;j>O;){if(x=o.charCodeAt(O),x===c&&o.charCodeAt(O+1)===f){F=!0,++O;do x=o.charCodeAt(++O);while(x!==d&&j>O)}if(E!==g&&(46===x||35===x))break;if(61===x||62===x||123===x||33>x||59===x||40===x)break;O++}s=o.substring(C,O),F===!0&&(N===m&&"class"===u)==!1&&(s=r(s))}return null!=A.nodes&&1===A.nodes.length?A.nodes[0]:A},cleanObject:function(e){if(e instanceof Array){for(var n=0;e.length>n;n++)this.cleanObject(e[n]);return e}return delete e.parent,delete e.__single,null!=e.nodes&&this.cleanObject(e.nodes),e},setInterpolationQuotes:function(e,n){return e&&2===e.length?n&&1===n.length?(c=e.charCodeAt(0),f=e.charCodeAt(1),d=n.charCodeAt(0),s=e[0],u=e[1],a=n,void 0):(console.error("Interpolation End must be of 1 Character"),void 0):(console.error("Interpolation Start must contain 2 Characters"),void 0)},ensureTemplateFunction:r},parser_parse=Parser.parse,parser_ensureTemplateFunction=Parser.ensureTemplateFunction,parser_cleanObject=Parser.cleanObject,parser_setInterpolationQuotes=Parser.setInterpolationQuotes})(Dom.Node,Dom.TextNode,Dom.Fragment,Dom.Component);var builder_componentID=0,builder_build;(function(e,n,t){function r(e){if(null!=listeners&&null!=listeners[e])for(var n=listeners.compoCreated,t=n.length,r=-1,o=_Array_slice.call(arguments,1);t>++r;)n[r].apply(null,o)}function o(e,n,t,r,o){var l=r.appendChild(document.createComment(""));return function(){return i(e,n,t,l,o)}}function i(n,t,r,o,i){null!=n.tagName&&n.tagName!==n.compoName&&(n.nodes={tagName:n.tagName,attr:n.attr,nodes:n.nodes,type:1}),null!=n.model&&(t=n.model);var l=n.nodes,s=[];if(null!=l){for(var u=l instanceof Array,a=u===!0?l.length:1,c=0,f=null,d=document.createDocumentFragment();a>c;c++)f=u===!0?l[c]:l,builder_build(f,t,r,d,n,s);o.parentNode.insertBefore(d,o)}if(null==n.tagName){var p,h,m=n.handlers&&n.handlers.attr;for(h in n.attr)p=null,m&&is_Function(m[h])&&(p=m[h]),null==p&&is_Function(e[h])&&(p=e[h]),null!=p&&p(node,n.attr[h],t,r,s[0],n)}if(is_Function(n.renderEnd))try{n.renderEnd(s,t,r,o.parentNode)}catch(g){console.error("Custom Tag Handler:",n.tagName,g)}if(null!=i&&i!==s){var v=i.length,b=s.length;for(j=-1;b>++j;)i[v+j]=s[j]}}function l(e,n){return null==e.components?(e.components=[n],void 0):(e.components.push(n),void 0)}var s,u=function(){var e=function(e){return function(n,t){n.appendChild(e.createTextNode(t))}}(document);return function(n,t,r,o,i){var l=n.content;if(is_Function(l)){var s=l("node",t,r,o,i);if("string"==typeof s)return e(o,s),void 0;for(var u,a="",c=s.length,f=0;c>f;f++)if(u=s[f],"object"!=typeof u)a+=u;else{if(""!==a&&(e(o,a),a=""),null==u.nodeType){a+=""+u;continue}o.appendChild(u)}return""!==a&&e(o,a),void 0}e(o,l)}}(),a=function(){var n=function(e){return function(n){return e.createElement(n)}}(document);return function(t,r,o,i,l,s){var u=t.tagName,a=t.attr,c=n(u);if(null!=c){null!=s&&(s.push(c),a["x-compo-id"]=l.ID),null!=i&&i.appendChild(c);var f,d;for(f in a)hasOwnProp.call(a,f)!==!1&&(is_Function(a[f])?(d=a[f]("attr",r,o,c,l,f),d instanceof Array&&(d=d.join(""))):d=a[f],d&&(is_Function(e[f])?e[f](t,d,r,o,c,l,i):c.setAttribute(f,d)));return c}}}();(function(){function e(e,n,t,i,s,u,a){var c,f;e.compoName=n.tagName,e.attr=c=attr_extend(e.attr,n.attr),e.parent=u,e.ID=++builder_componentID,null==e.model&&(e.model=t),null==e.nodes&&(e.nodes=n.nodes);for(f in c)"function"==typeof c[f]&&(c[f]=c[f]("attr",t,i,s,u,f));return null!=listeners&&r("compoCreated",e,t,i,s),"function"==typeof e.renderStart&&e.renderStart(t,i,s),l(u,e),e.async===!0?(e.await(o(e,t,i,s,a)),null):(null!=e.tagName&&(e.nodes={tagName:e.tagName,attr:e.attr,nodes:e.nodes,type:1}),"function"==typeof e.render?(e.render(e.model,i,s),null):e)}function t(e,n,t,r,o,i,s){var u,a,c,f=e.__Ctor,d=!1;if(f)c=new f(n,i);else{c=e;for(var p in n)c[p]=n[p];c.parent=i}var h=c.attr;if(null!=h)for(var p in h)"function"==typeof h[p]&&(h[p]=h[p]("attr",t,r,o,i,p));return is_Function(c.renderStart)&&c.renderStart(t,r,o,i,s),is_Function(c.render)&&(d=!0,u=c.render(t,r,o,i,s),arr_pushMany(s,u),is_Function(c.renderEnd)&&(a=c.renderEnd(u,t,r,o,i))),l(i,a||c),d?null:c}function i(e,n,t,r,o,i){e.ID=++builder_componentID,l(o,e),null==e.model&&(e.model=n);var s=e.elements=[];return builder_build(e.nodes,e.model,t,r,e,s),null!=i&&0!==s.length&&arr_pushMany(i,s),null}s=function(r,o,l,s,u,a){var c,f=r.tagName;if(null!=r.controller&&(c=r.controller),null==c&&(c=n[f]),null==c)return i(r,o,l,s,u,a);var d,p=!1;"function"==typeof c?d=new c(o):(d=c,p=!0);var h=p?t:e;return h(d,r,o,l,s,u,a)}})(),builder_build=function(r,o,i,l,c,f){if(null==r)return l;var d,p,h,m,g=r.type;if(null==c&&(c=new t),null==g&&(r instanceof Array?g=10:null!=r.tagName?g=1:null!=r.content&&(g=2)),1==g&&null!=n[r.tagName]&&(g=4),null==l&&1!==g&&(l=document.createDocumentFragment()),10===g){for(h=0,m=r.length;m>h;h++)builder_build(r[h],o,i,l,c,f);return l}if(15===g){var v=custom_Statements[r.tagName];if(null==v){if(null==n[r.tagName])return console.error("<mask: statement is undefined",r.tagName),l;g=4}if(15===g)return v.render(r,o,i,l,c,f),l}if(1===g){if("else"===r.tagName)return l;l=a(r,o,i,l,c,f),f=null}if(2===g)return u(r,o,i,l,c),l;if(4===g){if(c=s(r,o,i,l,c,f),null==c)return l;d=[],r=c,c.model!==o&&null!=c.model&&(o=c.model)}var b=r.nodes;if(null!=b){null!=f&&null==d&&(d=f);for(var y=b instanceof Array,_=y===!0?b.length:1,x=0,C=null;_>x;x++)C=y===!0?b[x]:b,builder_build(C,o,i,l,c,d)}if(4===g){if(null==r.tagName&&"%"!==r.compoName){var k,w,p,A=r.handlers&&r.handlers.attr;for(p in r.attr)w=r.attr[p],null!=w&&(k=null,null!=A&&is_Function(A[p])&&(k=A[p]),null==k&&null!=e[p]&&(k=e[p]),null!=k&&k(r,w,o,i,d[0],c))}is_Function(r.renderEnd)&&r.renderEnd(d,o,i,l)}return null!=f&&null!=d&&f!==d&&arr_pushMany(f,d),l}})(custom_Attributes,custom_Tags,Dom.Component);var cache={},Mask={render:function(e,n,t,r,o){return"string"==typeof e&&(e=hasOwnProp.call(cache,e)?cache[e]:cache[e]=parser_parse(e)),null==t&&(t={}),builder_build(e,n,t,r,o)},compile:parser_parse,parse:parser_parse,build:builder_build,registerHandler:customTag_register,getHandler:function(e){return null!=e?custom_Tags[e]:custom_Tags},registerStatement:function(e,n){custom_Statements[e]=is_Function(n)?{render:n}:n},getStatement:function(e){return null!=e?custom_Statements[e]:custom_Statements},registerAttrHandler:function(e,n,t){is_Function(n)&&(t=n),custom_Attributes[e]=t},getAttrHandler:function(e){return null!=e?custom_Attributes[e]:custom_Attributes},registerUtil:customUtil_register,getUtil:customUtil_get,$utils:customUtil_$utils,registerUtility:function(e,n){this.registerUtility=this.registerUtil,this.registerUtility(e,n)},getUtility:function(){return this.getUtility=this.getUtil,this.getUtility()},clearCache:function(e){"string"==typeof e?delete cache[e]:cache={}},Utils:{Expression:ExpressionUtil,getProperty:obj_getProperty,ensureTmplFn:Parser.ensureTemplateFunction},Dom:Dom,plugin:function(source){eval(source)},on:function(e,n){null==listeners&&(listeners={}),(listeners[e]||(listeners[e]=[])).push(n)},delegateReload:function(){},setInterpolationQuotes:Parser.setInterpolationQuotes,setCompoIndex:function(e){builder_componentID=e},cfg:function(){var e=arguments;if(0===e.length)return __cfg;var n;if(2===e.length)return n=e[0],__cfg[n]=e[1],void 0;var t=e[0];if("object"==typeof t)for(n in t)__cfg[n]=t[n]}};Mask.renderDom=Mask.render,function(e){var n;(function(){function t(e){for(var n="";e--;)n+=" ";return n}function r(e,n,r){var i,l;null==n&&(n=0),null==r&&(i=!0,r=[]);var s=r.length;if(e.type===d.FRAGMENT&&(e=e.nodes),e instanceof Array)for(l=0;e.length>l;l++)o(e[l],n,r);else o(e,n,r);var u=t(n);for(l=s;r.length>l;l++)r[l]=u+r[l];return i?r.join(0===f?"":"\n"):void 0}function o(e,n,t){if("string"==typeof e.content)return t.push(a(e.content)),void 0;if("function"==typeof e.content)return t.push(a(e.content())),void 0;if(l(e))return t.push(i(e)+";"),void 0;if(s(e)){var o=c?">":" > ";return t.push(i(e)+o),r(u(e),f,t),void 0}t.push(i(e)+"{"),r(e.nodes,f,t),t.push("}")}function i(e){var n=e.tagName,t=e.attr.id||"",r=e.attr["class"]||"";"function"==typeof t&&(t=t()),"function"==typeof r&&(r=r()),t&&(t=-1!==t.indexOf(" ")?"":"#"+t),r&&(r="."+r.split(" ").join("."));var o="";for(var i in e.attr)if("id"!==i&&"class"!==i){var l=e.attr[i];"function"==typeof l&&(l=l()),(c===!1||/[^\w_$\-\.]/.test(l))&&(l=a(l)),o+=" "+i,i!==l&&(o+="="+l)}"div"===n&&(t||r)&&(n="");var s="";return e.expression&&(s="("+e.expression+")"),n+t+r+o+s}function l(e){return null==e.nodes||e.nodes instanceof Array&&0===e.nodes.length}function s(e){return e.nodes&&(e.nodes instanceof Array==!1||1===e.nodes.length)}function u(e){return e.nodes instanceof Array?e.nodes[0]:e.nodes}function a(e){return-1===e.indexOf("'")?"'"+e.trim()+"'":-1===e.indexOf('"')?'"'+e.trim()+'"':'"'+e.replace(/"/g,'\\"').trim()+'"'}n=function(n,t){return null==n?"":("string"==typeof n&&(n=e.parse(n)),null==t?(f=0,c=!0):"number"==typeof t?(f=t,c=0===f):(f=t&&t.indent||4,c=0===f||t&&t.minimizeAttributes),r(n))};var c,f,d=e.Dom})(),e.stringify=n}(Mask),function(e){function n(){this.attr={"debugger":null,use:null,repeat:null,"if":null,"else":null,each:null,log:null,visible:null,model:null},this.model=null,this.modelRef=null,this.nodes=null,this.parent=null,this.container=null,this.template=null}function t(e,n,t,r){null==e.nodes&&Compo.ensureTemplate(e);var l=e.attr.each||e.attr.foreach,s=ExpressionUtil.eval(l,n,t,e),u=e.nodes;if(e.nodes=null,null!=s){"number"!=typeof s.length&&(s=obj_toDictionary(s)),e.nodes=[],e.model=s,e.modelRef=l,e.template=u,e.container=r;var a=s.length,c=-1;if(null!=a){for(;a>++c;)e.nodes[c]=o("%.each.item",u,s[c],c,r,e);e.append=i.append}}}function r(e,n,t,r){var i=e.attr.repeat.split(".."),l=(+i[0],+i[1]),s=e.nodes;e.nodes=[];for(var u=-1;l>++u;)e.nodes[u]=o("%.repeat.item",s,n,u,r,e)}function o(e,n,t,r,o,i){return{type:Dom.COMPONENT,compoName:e,attr:{},nodes:n,model:t,container:o,parent:i,index:r}}e.registerHandler("%",n),n.prototype={renderStart:function(e,n,o){var i=this.attr;if(null!=i.each||null!=i.foreach)return t(this,e,n,o),void 0;if(null!=i["if"])return this.state=ExpressionUtil.eval(i["if"],e,n,this.parent),this.state||(this.nodes=null),void 0;if(null!=i["else"]){var l=this.parent.components,s=l&&l[l.length-1];return null!=s&&"%"===s.compoName&&null!=s.attr["if"]?(s.state&&(this.nodes=null),void 0):(console.error("Previous Node should be \"% if='condition'\"",s,this.parent),void 0)}if(null!=i.use){var u=i.use;return this.model=obj_getProperty(e,u),this.modelRef=u,void 0}if(null==i["debugger"]){if(null!=i.visible){var a=ExpressionUtil.eval(i.visible,e,n,this.parent);return a||(this.nodes=null),void 0}if(null!=i.log){var c=i.log,f=obj_getProperty(e,c);return console.log("Key: %s, Value: %s",c,f),void 0}null!=i.repeat&&r(this,e,n,o)}},render:null,renderEnd:null,append:null};var i={append:function(n){var t=new Component;t.nodes=this.template,t.model=n,e.render(t,n,null,this.container,this)}}}(Mask),function(e){function n(){}function t(){}function r(){}var o={};e.templates=o,e.registerHandler(":template",n),n.prototype.render=function(){return null==this.attr.id?(console.warn("Template Should be defined with ID attribute for future lookup"),void 0):(o[this.attr.id]=this.nodes,void 0)},e.registerHandler(":import",t),t.prototype={constructor:t,attr:null,template:null,renderStart:function(){if(this.attr.id){if(this.nodes=this.template,null==this.nodes&&(this.nodes=o[this.attr.id]),null==this.nodes){for(var e,n=this,t=":template[id="+this.attr.id+"]";null==e&&null!=(n=n.parent);)null!=n.nodes&&(e=jmask(n.nodes).filter(t).get(0));null!=e&&(this.nodes=e.nodes)}null==this.nodes&&console.warn("Template could be not imported",this.attr.id)}}},e.registerHandler(":html",r),r.prototype={mode:"server:all",render:function(e,n,t){var r=jmask(this.nodes).text(e,n,this);return r?t.insertAdjacentHTML?(t.insertAdjacentHTML("beforeend",r),void 0):(this.toHtml=function(){return r},void 0):(console.warn("No HTML for node",this),void 0)}}}(Mask);var Compo=exports.Compo=function(mask){function _mask_ensureTmplFn(e){return"string"!=typeof e?e:_mask_ensureTmplFnOrig(e)}function is_Function(e){return"function"==typeof e}function is_Object(e){return null!=e&&"object"==typeof e}function is_Array(e){return null!=e&&"object"==typeof e&&"number"==typeof e.length&&"function"==typeof e.splice}function is_String(e){return"string"==typeof e}function is_notEmptyString(e){return"string"==typeof e&&""!==e}function is_rawObject(e){return null==e?!1:"object"!=typeof e?!1:e.constructor===Object}function domLib_initialize(){null!=domLib&&null!=domLib.fn&&(domLib.fn.compo=function(e){if(0===this.length)return null;var n=Anchor.resolveCompo(this[0]);return null==e?n:find_findSingle(n,selector_parse(e,Dom.CONTROLLER,"up"))},domLib.fn.model=function(e){var n=this.compo(e);if(null==n)return null;for(var t=n.model;null==t&&n.parent;)n=n.parent,t=n.model;return t},function(){var e=["append","prepend","before","after"];arr_each(["appendMask","prependMask","beforeMask","afterMask"],function(n,t){domLib.fn[n]=function(n,r,o,i){if(0===this.length)return this;this.length>1,null==o&&(o=2>t?this.compo():this.parent().compo()),null==o&&(o={}),null==o.components&&(o.components=[]);for(var l=o.components,s=l.length,u=mask.render(n,r,i,null,o),a=this[e[t]](u),c=l.length;c>s;s++)Compo.signal.emitIn(l[s],"domInsert");return a}})}(),function(){function e(e,n){node_tryDispose(n)}function n(e,n){node_tryDisposeChildren(n)}var t=domLib.fn.remove,r=domLib.fn.empty;domLib.fn.removeAndDispose=function(){return this.each(e),t.call(this)},domLib.fn.emptyAndDispose=function(){return this.each(n),r.call(this)}}())}function SlotHandler(){}var Dom=mask.Dom,_array_slice=Array.prototype.slice,_Array_splice=Array.prototype.splice,_Array_indexOf=Array.prototype.indexOf,_mask_ensureTmplFnOrig=mask.Utils.ensureTmplFn,domLib,Class;(function(){function e(){for(var e,t,r,o=arguments,i=n.length;--i>-1;)if(e=n[i],null!=e)for(r=o.length;--r>-1;)if(t=e[o[r]],null!=t)return t}var n=[global.atma,exports,global];domLib=e("jQuery","Zepto","$"),Class=e("Class")})(),Array.prototype.indexOf||(Array.prototype.indexOf=function(e){for(var n=0,t=this.length;t>n;n++)if(this[n]===e)return n;return-1});var obj_extend,obj_copy;(function(){obj_extend=function(e,n){if(null==e&&(e={}),null==n)return e;for(var t in n)e[t]=n[t];return e},obj_copy=function(e){var n,t={};for(n in e)t[n]=e[n];return t}})();var arr_each,arr_remove;(function(){arr_each=function(e,n){for(var t=e.length,r=-1;t>++r;)n(e[r],r)},arr_remove=function(e,n){if(null==e)return console.error("Can not remove myself from parent",n),void 0;var t=e.indexOf(n);return-1===t?(console.error("Can not remove myself from parent",n,t),void 0):(e.splice(t,1),void 0)}})();var fn_proxy,fn_apply;(function(){fn_proxy=function(e,n){return function(){return fn_apply(e,n,arguments)}},fn_apply=function(e,n,t){switch(t.length){case 0:return e.call(n);case 1:return e.call(n,t[0]);case 2:return e.call(n,t[0],t[1]);case 3:return e.call(n,t[0],t[1],t[2]);case 4:return e.call(n,t[0],t[1],t[2],t[3])}return e.apply(n,t)}})();var selector_parse,selector_match;(function(){function e(e){return function(t){return n(t,e)}}function n(e,t,r){if("string"!=typeof e)return!1;if(null==r&&(r=0),r=e.indexOf(t,r),-1===r)return!1;if(r>0&&e.charCodeAt(r-1)>32)return n(e,t,r+1);var o=e.length,i=t.length;return o-i>r&&e.charCodeAt(r+i)>32?n(e,t,r+1):!0}selector_parse=function(n,t,r){if(null==n&&console.error("<compo>selector is undefined",t),"object"==typeof n)return n;var o,i,l;if(null==o)switch(n[0]){case"#":o="id",n=n.substring(1),i="attr";break;case".":o="class",n=e(n.substring(1)),i="attr";break;default:o=t===Dom.SET?"tagName":"compoName"}return l="up"===r?"parent":t===Dom.SET?"nodes":"components",{key:o,prop:i,selector:n,nextKey:l}},selector_match=function(e,n,t){is_String(n)&&(null==t&&(t=Dom[e.compoName?"CONTROLLER":"SET"]),n=selector_parse(n,t));var r=n.prop?e[n.prop]:e;return null==r?!1:is_Function(n.selector)?n.selector(r[n.key]):null!=n.selector.test?n.selector.test(r[n.key]):r[n.key]==n.selector}})();var find_findSingle;(function(){find_findSingle=function(e,n){if(is_Array(e)){for(var t,r=e.length,o=-1;r>++o;)if(t=find_findSingle(e[o],n),null!=t)return t;return null}return selector_match(e,n)?e:(e=e[n.nextKey],null==e?null:find_findSingle(e,n))}})();var dom_addEventListener,node_tryDispose,node_tryDisposeChildren;(function(){dom_addEventListener=function(e,n,t){return null!=EventDecorator&&(n=EventDecorator(n)),null!=domLib?domLib(e).on(n,t):null!=e.addEventListener?e.addEventListener(n,t,!1):(e.attachEvent&&e.attachEvent("on"+n,t),void 0)},node_tryDispose=function(e){if(e.hasAttribute("x-compo-id")){var n=e.getAttribute("x-compo-id"),t=Anchor.getByID(n);if(t){if(null==t.$||1===t.$.length)return compo_dispose(t),compo_detachChild(t),void 0;var r=_Array_indexOf.call(t.$,e);-1!==r&&_Array_splice.call(t.$,r,1)}}node_tryDisposeChildren(e)},node_tryDisposeChildren=function(e){for(var n=e.firstChild;null!=n;)1===n.nodeType&&node_tryDispose(n),n=n.nextSibling}})();var domLib_find,domLib_on;(function(){domLib_find=function(e,n){return e.filter(n).add(e.find(n))},domLib_on=function(e,n,t,r){return null==t?e.on(n,r):(e.on(n,t,r).filter(t).on(n,r),e)}})();var Children_={select:function(e,n){for(var t in n){var r=n[t],o=null,i=null;if(r instanceof Array&&(i=r[0],o=r.splice(1)),"string"==typeof r&&(i=r),null==r||null==i)return console.error("Unknown component child",t,n[t]),console.warn("Is this object shared within multiple compo classes? Define it in constructor!"),void 0;var l=i.indexOf(":"),s=i.substring(0,l);s=Compo.config.selectors[s],null==s?e.compos[t]=e.$[0].querySelector(i):(i=i.substring(++l).trim(),e.compos[t]=s(e,i));var u=e.compos[t];null!=o&&(null!=u.$&&(u=u.$),Events_.on(e,o,u))}}},Events_={on:function(e,n,t){null==t&&(t=e.$);for(var r,o=n instanceof Array,i=o?n.length:1,l=0;o?i>l:1>l;l++)if(r=o?n[l]:n,r instanceof Array)null!=EventDecorator&&(r[0]=EventDecorator(r[0])),t.on.apply(t,r);else for(var s in r){var u,a,c="string"==typeof r[s]?e[r[s]]:r[s],f=s.indexOf(":");-1!==f?(u=s.substring(0,f),a=s.substring(f+1).trim()):u=s,null!=EventDecorator&&(u=EventDecorator(u)),domLib_on(t,u,a,fn_proxy(c,e))}}},EventDecorator=null,EventDecos=function(){var e=function(){if(null==document)return!1;if("createTouch"in document)return!0;try{return!!document.createEvent("TouchEvent").initTouchEvent}catch(e){return!1}}();return{touch:function(n){return e===!1?n:"click"===n?"touchend":"mousedown"===n?"touchstart":"mouseup"===n?"touchend":"mousemove"===n?"touchmove":n}}}(),Pipes=function(){function e(e,n){return function(t){new i(e).emit(n,t)}}function n(e,n){return null==n.pipes[e]?(console.error("Controller has no pipes to be added to collection",e,n),void 0):(null==l[e]&&(l[e]=[]),l[e].push(n),void 0)}function t(e,n){for(var t=l[e],r=t.length;--r>-1;)t[r]===n&&t.splice(r,1)}function r(){var e=this,n=e.pipes;for(var r in n)t(r,e)}function o(e){var t=e.pipes;for(var o in t)n(o,e);Compo.attachDisposer(e,r.bind(e))}function i(e){return this instanceof i==!1?new i(e):(this.pipeName=e,this)}var l={};return mask.registerAttrHandler("x-pipe-signal","client",function(n,t,r,o,i){for(var l,s=t.split(";"),u=s.length,a=-1;u>++a;)if(l=s[a].trim(),""!==l){var c,f,d=l.indexOf(":"),p=l.substring(0,d),h=l.substring(d+1).trim(),m=h.indexOf(".");if(-1===m)return console.error('define pipeName "click: pipeName.pipeSignal"'),void 0;c=h.substring(0,m),f=h.substring(++m);var g=e(c,f);dom_addEventListener(i,p,g)}}),i.prototype={constructor:i,emit:function(e){var n,t=l[this.pipeName],r=this.pipeName;if(null!=t){2===arguments.length&&is_Array(arguments[1])?n=arguments[1]:arguments.length>1&&(n=_array_slice.call(arguments,1));for(var o,i,s,u,a=t.length;-1!==--a;)o=t[a],i=o.pipes[r],null!=i&&(s=i[e],is_Function(s)&&(s.apply(o,n),u=!0))}}},i.addController=o,i.removeController=r,{addController:o,removeController:r,pipe:i}}(),Anchor=function(){var e={};return{create:function(n){return null==n.ID?(console.warn("Component should have an ID"),void 0):(e[n.ID]=n,void 0)},resolveCompo:function(n){if(null==n)return null;var t,r,o;do{if(r=n.getAttribute("x-compo-id"),r&&(null==t&&(t=r),o=e[r],null!=o&&(o=Compo.find(o,{key:"ID",selector:t,nextKey:"components"}),null!=o)))return o;n=n.parentNode}while(n&&1===n.nodeType);return null},removeCompo:function(n){null!=n.ID&&delete e[n.ID]},getByID:function(n){return e[n]}}}(),Compo=function(){function Compo(e){if(this instanceof Compo)return null;var n;if(null==e&&(e={}),hasInclude&&global.include&&(e.__resource=global.include.url),null!=e.attr)for(var t in e.attr)e.attr[t]=_mask_ensureTmplFn(e.attr[t]);var r=e.slots;if(null!=r)for(var t in r)"string"==typeof r[t]&&(r[t]=e[r[t]]);e.hasOwnProperty("constructor")&&(n=e.constructor),n=compo_createConstructor(n,e),null==n&&(n=function(){});for(var t in Proto)null==e[t]&&(e[t]=Proto[t]);return n.prototype=e,e=null,n}var hasInclude=!!(global.include||void 0!==global.atma&&global.atma.include||void 0!==exports&&exports.include),compo_dispose,compo_detachChild,compo_ensureTemplate,compo_attachDisposer,compo_createConstructor;(function(){compo_dispose=function(e){null!=e.dispose&&e.dispose(),Anchor.removeCompo(e);for(var n=e.components,t=n&&n.length||0;--t>-1;)compo_dispose(n[t])},compo_detachChild=function(e){var n=e.parent;if(null!=n){var t,r=e.$,o=n.$||n.elements;if(o&&r){var i,l,s=r.length;for(t=o.length;--t>-1;)for(i=o[t],l=s;--l>-1;)if(i===r[l]){o.splice(t,1);break}}var u=n.components;if(null!=u){for(t=u.length;--t>-1;)if(u[t]===e){u.splice(t,1);break}-1===t&&console.warn("<compo:remove> - i`m not in parents collection",e)}}},compo_ensureTemplate=function(e){if(null==e.nodes){null!=e.attr.template&&(e.template=e.attr.template,delete e.attr.template);var n=e.template;if(null!=n){if(is_String(n)){if(35===n.charCodeAt(0)&&/^#[\w\d_-]+$/.test(n)){var t=document.getElementById(n.substring(1));if(null==t)return console.error("<compo> Template holder not found by id:",n),void 0;n=t.innerHTML}n=mask.parse(n)}"object"==typeof n&&(e.nodes=n)}}},compo_attachDisposer=function(e,n){if(null==e.dispose)return e.dispose=n,void 0;var t=e.dispose;e.dispose=function(){n.call(this),t.call(this)}},compo_createConstructor=function(e,n){var t=n.compos,r=n.pipes,o=n.attr;return null==t&&null==r&&null==n.attr?e:function(){null!=t&&(this.compos=obj_copy(this.compos)),null!=r&&Pipes.addController(this),null!=o&&(this.attr=obj_copy(this.attr)),is_Function(e)&&e.call(this)}}})(),obj_extend(Compo,{create:function(e){var n;null==e&&(e={}),e.hasOwnProperty("constructor")&&(n=e.constructor),null==n&&(n=function(){});for(var t in Proto)null==e[t]&&(e[t]=Proto[t]);return n.prototype=e,n},createClass:function(e){if(null!=e.attr)for(var n in e.attr)e.attr[n]=_mask_ensureTmplFn(e.attr[n]);hasInclude&&global.include&&(e.__resource=global.include.url);var t=e.slots;if(null!=t)for(var n in t)"string"==typeof t[n]&&(t[n]=e[t[n]]);var r;e.hasOwnProperty("constructor")&&(r=e.constructor),null==r&&(r=e.Construct),e.Construct=compo_createConstructor(r,e);var o=e.Extends;return null==o?e.Extends=Proto:is_Array(o)?o.unshift(Proto):e.Extends=[Proto,o],Class(e)},render:function(e,n,t,r){compo_ensureTemplate(e);var o=[];return mask.render(null==e.tagName?e.nodes:e,n,t,r,e,o),e.$=domLib(o),null!=e.events&&Events_.on(e,e.events),null!=e.compos&&Children_.select(e,e.compos),e},initialize:function(e,n,t,r,o){var i;null==r&&(t&&null!=t.nodeType?(r=t,t=null):n&&null!=n.nodeType&&(r=n,n=null)),"string"==typeof e&&(i=e,e=mask.getHandler(i),e||console.error("Compo not found:",e));var l={controller:e,type:Dom.COMPONENT,tagName:i};null==o&&null!=r&&(o=Anchor.resolveCompo(r)),null==o&&(o=new Dom.Component);var s=mask.render(l,n,t,null,o),u=o.components[o.components.length-1];return null!=r&&(r.appendChild(s),Compo.signal.emitIn(u,"domInsert")),u},find:function(e,n){return find_findSingle(e,selector_parse(n,Dom.CONTROLLER,"down"))},closest:function(e,n){return find_findSingle(e,selector_parse(n,Dom.CONTROLLER,"up"))},dispose:compo_dispose,ensureTemplate:compo_ensureTemplate,attachDisposer:compo_attachDisposer,config:{selectors:{$:function(e,n){var t=domLib_find(e.$,n);return t},compo:function(e,n){var t=Compo.find(e,n);return t}},setDOMLibrary:function(e){domLib!==e&&(domLib=e,domLib_initialize())},eventDecorator:function(e){return"function"==typeof e?(EventDecorator=e,void 0):"string"==typeof e?(EventDecorator=EventDecos[e],void 0):"boolean"==typeof e&&e===!1?(EventDecorator=null,void 0):void 0}},pipe:Pipes.pipe,resource:function(e){for(var n=e;null!=n;){if(n.resource)return n.resource;n=n.parent}return include.instance()},plugin:function(source){eval(source)},Dom:{addEventListener:dom_addEventListener}}),function(){function e(e,n,t){return null==e[n]&&(e[n]=[]),e[n].push(t),e}function n(e,n,t){var r=e[n];if(null!=r)for(var o,i=0,l=r.length;l>i;i++)o=r[i],null!=o&&(r[i]=null,null!=t?o.apply(this,t):o())}var t={done:function(n){return e(this,"_cbs_done",n)},fail:function(n){return e(this,"_cbs_fail",n)},always:function(n){return e(this,"_cbs_always",n)},resolve:function(){this.async=!1,n(this,"_cbs_done",arguments),n(this,"_cbs_always",arguments)},reject:function(){this.async=!1,n(this,"_cbs_fail",arguments),n(this,"_cbs_always")}},r={async:!0,await:function(e){this.resume=e}};Compo.pause=function(e,n){if(null==n.async){n.defers=[],n._cbs_done=null,n._cbs_fail=null,n._cbs_always=null;for(var o in t)n[o]=t[o]}n.async=!0;for(var o in r)e[o]=r[o];return n.defers.push(e),function(){Compo.resume(e,n)}},Compo.resume=function(e,n){e.resume&&e.resume(),e.async=!1;for(var t,r=!1,o=0,i=n.defers.length;i>o;o++)t=n.defers[o],t!==e?r===!1&&(r=null!=t):n.defers[o]=null;r===!1&&n.resolve()}}();var Proto={type:Dom.CONTROLLER,tagName:null,compoName:null,nodes:null,attr:null,model:null,slots:null,pipes:null,compos:null,events:null,async:!1,onRenderStart:null,onRenderEnd:null,render:null,renderStart:function(e,n,t){if(1===arguments.length&&null!=e&&e instanceof Array==!1&&null!=e[0]){var r=arguments[0];e=r[0],n=r[1],t=r[2]}null==this.nodes&&compo_ensureTemplate(this),is_Function(this.onRenderStart)&&this.onRenderStart(e,n,t)},renderEnd:function(e,n,t,r){if(1===arguments.length&&e instanceof Array==!1){var o=arguments[0];e=o[0],n=o[1],t=o[2],r=o[3]}Anchor.create(this,e),this.$=domLib(e),null!=this.events&&Events_.on(this,this.events),null!=this.compos&&Children_.select(this,this.compos),is_Function(this.onRenderEnd)&&this.onRenderEnd(e,n,t,r)},appendTo:function(e){var n="string"==typeof e?document.querySelector(e):e;if(null==n)return console.warn("Compo.appendTo: parent is undefined. Args:",arguments),this;for(var t=this.$,r=0,o=t.length;o>r;r++)n.appendChild(t[r]);return this.emitIn("domInsert"),this},append:function(e,n,t){var r;if(null==this.$){var o="string"==typeof e?mask.compile(e):e;return r=t?find_findSingle(this,selector_parse(t,Dom.CONTROLLER,"down")):this,null==r.nodes?(this.nodes=o,this):(r.nodes=[this.nodes,o],this)}var i=mask.render(e,n,null,null,this);return r=t?this.$.find(t):this.$,r.append(i),this.emitIn("domInsert"),this},find:function(e){return find_findSingle(this,selector_parse(e,Dom.CONTROLLER,"down"))
},closest:function(e){return find_findSingle(this,selector_parse(e,Dom.CONTROLLER,"up"))},on:function(){var e=_array_slice.call(arguments);return 3>arguments.length?(console.error("Invalid Arguments Exception @use .on(type,selector,fn)"),this):(null!=this.$&&Events_.on(this,[e]),null==this.events?this.events=[e]:is_Array(this.events)?this.events.push(e):this.events=[e,this.events],this)},remove:function(){return null!=this.$&&this.$.remove(),compo_detachChild(this),compo_dispose(this),this.$=null,this},slotState:function(e,n){return Compo.slot.toggle(this,e,n),this},signalState:function(e,n){return Compo.signal.toggle(this,e,n),this},emitOut:function(e){return Compo.signal.emitOut(this,e,this,arguments.length>1?_array_slice.call(arguments,1):null),this},emitIn:function(e){return Compo.signal.emitIn(this,e,this,arguments.length>1?_array_slice.call(arguments,1):null),this}};return Compo.prototype=Proto,Compo}();return function(){function e(n,t,r,o,i){if(null==n)return!1;var l=!1,s=null!=n.slots&&n.slots[t];if("string"==typeof s&&(s=n[s]),"function"==typeof s){l=!0;var u=null!=n.slots.__disabled&&n.slots.__disabled[t];if(u!==!0){var a=null==o?s.call(n,r):s.apply(n,[r].concat(o));if(a===!1)return!0;null!=a&&"object"==typeof a&&null!=a.length&&(o=a)}}if(-1===i&&null!=n.parent)return e(n.parent,t,r,o,i)||l;if(1===i&&null!=n.components)for(var c,f=n.components,d=f.length,p=0;d>p;p++)c=e(f[p],t,r,o,i),!l&&(l=c);return l}function n(e,t,r,o){if(null==e)return!1;var i=e.slots;if(null!=i&&null!=i[t]&&("string"==typeof i[t]&&(i[t]=e[i[t]]),"function"==typeof i[t])){if(o!==!0)return!0;if(null==i.__disabled||i.__disabled[t]!==!0)return!0}if(-1===r&&null!=e.parent)return n(e.parent,t,r);if(1===r&&null!=e.components)for(var l=0,s=e.components.length;s>l;l++)if(n(e.components[l],t,r))return!0;return!1}function t(t,r){return n(t,r,-1)===!1?null:function(n){var o=arguments.length>1?_array_slice.call(arguments,1):null;e(t,r,n,o,-1)}}function r(e,n,t){var r=e.slots;null!=r&&r.hasOwnProperty(n)!==!1&&(null==r.__disabled&&(r.__disabled={}),r.__disabled[n]=t===!1)}function o(e,n,t){if(r(e,n,t),null!=e.components)for(var i=0,l=e.components.length;l>i;i++)o(e.components[i],n,t)}function i(e,n,t){return null==e.$?(console.warn("Controller has no elements to toggle state"),void 0):(domLib().add(e.$.filter("[data-signals]")).add(e.$.find("[data-signals]")).each(function(e,r){var o=r.getAttribute("data-signals");null!=o&&-1!==o.indexOf(n)&&r[t===!0?"removeAttribute":"setAttribute"]("disabled","disabled")}),void 0)}function l(e,n,t){for(var l=e,s=e;null!=(l=l.parent);)r(l,n,t),null!=l.$&&0!==l.$.length&&(s=l);o(e,n,t),i(s,n,t)}function s(e,t,o){r(e,t,o),(o||!n(e,t,-1,!0)&&!n(e,t,1,!0))&&i(e,t,o)}mask.registerAttrHandler("x-signal","client",function(e,n,r,o,i,l){for(var s,u=n.split(";"),a="",c=u.length,f=-1;c>++f;)if(s=u[f].trim(),""!==s){var d=s.indexOf(":"),p=s.substring(0,d),h=s.substring(d+1).trim(),m=t(l,h);m&&(a+=","+h+",",dom_addEventListener(i,p,m))}""!==a&&i.setAttribute("data-signals",a)}),obj_extend(Compo,{signal:{toggle:l,emitOut:function(n,t,r,o){e(n,t,r,o,-1)},emitIn:function(n,t,r,o){e(n,t,r,o,1)},enable:function(e,n){l(e,n,!0)},disable:function(e,n){l(e,n,!1)}},slot:{toggle:s,enable:function(e,n){s(e,n,!0)},disable:function(e,n){s(e,n,!1)},invoke:function(e,n,t,r){var o=e.slots;return null==o||"function"!=typeof o[n]?(console.error("Slot not found",n,e),null):null==r?o[n].call(e,t):o[n].apply(e,[t].concat(r))}}})}(),domLib_initialize(),mask.registerHandler(":slot",SlotHandler),SlotHandler.prototype={constructor:SlotHandler,renderEnd:function(){this.slots={},this.expression=this.attr.on,this.slots[this.attr.signal]=this.handle},handle:function(){var e=this.expression;mask.Utils.Expression.eval(e,this.model,global,this)}},Compo}(Mask),jmask=exports.jmask=function(e){function n(e){return"string"!=typeof e?e:_(e)}function t(e,n){if(null==e&&(e={}),null==n)return e;for(var t in n)e[t]=n[t];return e}function r(e,n){for(var t=0,r=e.length;r>t;t++)n(e[t],t)}function o(e,n){if(null==e)return console.error("Can not remove myself from parent",n),void 0;var t=e.indexOf(n);return-1===t?(console.error("Can not remove myself from parent",n,t),void 0):(e.splice(t,1),void 0)}function i(e){return null!=e&&"object"==typeof e&&null!=e.length&&"function"==typeof e.slice}function l(e,n,t){if(null==e&&console.warn("selector is null for type",n),"object"==typeof e)return e;var r,o,i,l,u,c,f,d,p,h=0,m=e.length;for(r="up"===t?k:n===v.SET?w:A;m>h;)u=e.charCodeAt(h),33>u||(c=a(e,h+1,m),46===u?(o="class",i=N,l=s(e.substring(h+1,c))):35===u?(o="id",i=N,l=e.substring(h+1,c)):91===u?(d=e.indexOf("=",h),i=N,o=e.substring(h+1,d),u=e.charCodeAt(d+1),p=34===u||39===u?2:1,l=e.substring(d+p,c-p+1),c++):(i=null,o=n===v.SET?"tagName":"compoName",l=e.substring(h,c)),h=c,null!=f?(null==f.filters&&(f.filters=[]),f.filters.push({key:o,selector:l,prop:i})):f={key:o,prop:i,selector:l,nextKey:r,filters:null});return f}function s(e){return function(n){return u(n,e)}}function u(e,n,t){if("string"!=typeof e)return!1;if(null==t&&(t=0),t=e.indexOf(n,t),-1===t)return!1;if(t>0&&e.charCodeAt(t-1)>32)return u(e,n,t+1);var r=e.length,o=n.length;return r-o>t&&e.charCodeAt(t+o)>32?u(e,n,t+1):!0}function a(e,n,t){for(var r,o=!1,i=!1;t>n&&(r=e.charCodeAt(n),(34===r||39===r)&&(o=!o),92===r&&(i=!i),!(46===r||35===r||91===r||93===r||33>r)||o===!0||i===!0);)n++;return n}function c(e,n,t){"string"==typeof n&&(null==t&&(t=v[e.compoName?"CONTROLLER":"SET"]),n=l(n,t));var r=n.prop?e[n.prop]:e,o=!1;if(null==r)return!1;if("function"==typeof n.selector?o=n.selector(r[n.key]):null!=n.selector.test?n.selector.test(r[n.key])&&(o=!0):r[n.key]===n.selector&&(o=!0),o===!0&&null!=n.filters)for(var i,s=0,u=n.filters.length;u>s;s++)if(i=n.filters[s],c(e,i,t)===!1)return!1;return o}function f(e,n){if(null==n)return e;for(var t,r=[],o=0,i=e.length;i>o;o++)t=e[o],c(t,n)&&r.push(t);return r}function d(e,n,t){if(null==e)return t;if(null==t&&(t=[]),e instanceof Array){for(var r=0,o=e.length;o>r;r++)d(e[r],n,t);return t}c(e,n)&&t.push(e);var i=e[n.nextKey];return null!=i&&d(i,n,t),t}function p(e,n){var r={type:1,tagName:1,compoName:1,controller:1},o={parent:n};for(var i in e)1===r[i]&&(o[i]=e[i]);e.attr&&(o.attr=t({},e.attr));var l=e.nodes;if(null!=l&&l.length>0){o.nodes=[];for(var s=l instanceof Array,u=s===!0?l.length:1,a=0;u>a;a++)o.nodes[a]=p(s===!0?l[a]:l,o)}return o}function h(e){for(var n,t=e;null!=t;)n=t,t=t.nodes&&t.nodes[0];return n}function m(e,n,t,r){if(v.TEXTNODE===e.type)return"function"==typeof e.content?e.content("node",n,t,null,r):e.content;var o="";if(null!=e.nodes)for(var i,l=0,s=e.nodes.length;s>l;l++)i=e.nodes[l],o+=m(i,n,t,r);return o}function g(e){return this instanceof g==!1?new g(e):null==e?this:e.type===v.SET?e:this.add(e)}var v=e.Dom,b=e.render,y=e.parse,_=e.Utils.ensureTmplFn,x=(global.Compo||e.Compo||Compo).signal.emitIn,C=function(){function e(e,t){return e===t?(n=!0,0):1}var n=!1;return function(t){var r,o,i,l;if(n=!1,t.sort(e),n===!1)return t;for(r=[],o=0,i=0,l=t.length-1;l>o;)t[o++]===t[o]&&(r[i++]=o);for(;i--;)t.splice(r[i],1);return t}}(),k="parent",w="nodes",A="components",N="attr";return g.prototype={constructor:g,type:v.SET,length:0,components:null,add:function(e){var n,t;if("string"==typeof e&&(e=y(e)),i(e)){for(n=0,t=e.length;t>n;n++)this.add(e[n]);return this}"function"==typeof e&&null!=e.prototype.type&&(e={controller:e,type:v.COMPONENT});var r=e.type;if(!r)return console.error("Only Mask Node/Component/NodeText/Fragment can be added to jmask set",e),this;if(r===v.FRAGMENT){var o=e.nodes;for(n=0,t=o.length;t>n;)this[this.length++]=o[n++];return this}if(r===v.CONTROLLER){if(null!=e.nodes&&e.nodes.length)for(n=e.nodes.length;0!==n;)e.nodes[--n].parent=e;null!=e.$&&(this.type=v.CONTROLLER)}return this[this.length++]=e,this},toArray:function(){return Array.prototype.slice.call(this)},render:function(e,n,t,r){if(this.components=[],1===this.length)return b(this[0],e,n,t,r||this);null==t&&(t=document.createDocumentFragment());for(var o=0,i=this.length;i>o;o++)b(this[o],e,n,t,r||this);return t},prevObject:null,end:function(){return this.prevObject||this},pushStack:function(e){var n;return n=g(e),n.prevObject=this,n},controllers:function(){return null==this.components&&console.warn("Set was not rendered"),this.pushStack(this.components||[])},mask:function(n){if(null!=n)return this.empty().append(n);if(arguments.length)return this;var t;if(0===this.length)t=new v.Node;else if(1===this.length)t=this[0];else{t=new v.Fragment;for(var r=0,o=this.length;o>r;r++)t.nodes[r]=this[r]}return e.stringify(t)},text:function(e,n,t){if("string"==typeof e&&1===arguments.length){for(var r,o=[new v.TextNode(e)],i=0,l=this.length;l>i;i++)r=this[i],r.nodes=o;return this}for(var r,s="",i=0,l=this.length;l>i;i++)r=this[i],s+=m(r,e,n,t);return s}},r(["append","prepend"],function(e){g.prototype[e]=function(n){for(var t,r,o=g(n),i=0,l=this.length;l>i;i++){r=this[i],t=o.toArray();for(var s=0,u=t.length;u>s;s++)t[s].parent=r;r.nodes=null!=r.nodes?"append"===e?r.nodes.concat(t):t.concat(r.nodes):t}return this}}),r(["appendTo"],function(e){g.prototype[e]=function(e,n,t,r){return null==r&&(r=this),null!=e.nodeType&&"function"==typeof e.appendChild?(e.appendChild(this.render(n,t,null,r)),x(r,"domInsert"),this):(g(e).append(this),this)}}),function(){function e(e){for(var n,t,r=e.split(";"),o={},i=0,l=r.length;l>i;i++)t=r[i],n=t.indexOf(":"),o[t.substring(0,n).trim()]=t.substring(n+1).trim();return o}function o(e){var n=[],t=0;for(var r in e)n[t++]=r+":"+e[r];return n.join(";")}r(["add","remove","toggle","has"],function(e){g.prototype[e+"Class"]=function(n){var t,r,o,i,l,s=this.length,u=0;if("string"!=typeof n){if("remove"===e)for(;s>u;u++)this[0].attr["class"]=null;return this}for(;s>u;u++)if(i=this[u],null!=i.attr){if(l=i.attr["class"],null==l)l=n;else{for(l=" "+l+" ",null==t&&(t=n.split(" "),o=t.length),r=0;o>r;r++)if(t[r]){var a=l.indexOf(" "+t[r]+" ")>-1;if("has"!==e)a!==!1||"add"!==e&&"toggle"!==e?a!==!0||"remove"!==e&&"toggle"!==e||(l=l.replace(" "+t[r]+" "," ")):l+=t[r]+" ";else if(a)return!0}l=l.trim()}"has"!==e&&(i.attr["class"]=l)}return"has"===e?!1:this}}),r(["attr","removeAttr","prop","removeProp"],function(e){g.prototype[e]=function(t,r){if(!t)return this;for(var o,i=this.length,l=0,s=arguments.length;i>l;l++)switch(o=this[l],e){case"attr":case"prop":if(1===s){if("string"==typeof t)return o.attr[t];for(var u in t)o.attr[u]=n(t[u])}else 2===s&&(o.attr[t]=n(r));break;case"removeAttr":case"removeProp":o.attr[t]=null}return this}}),t(g.prototype,{tag:function(e){if("string"==typeof e){for(var n=0,t=this.length;t>n;n++)this[n].tagName=e;return this}return this[0]&&this[0].tagName},css:function(n,t){var r,i,l,s=arguments.length,u=this.length,a=0;if(1===s&&"string"==typeof n)return 0===u?null:"string"==typeof this[0].attr.style?e(this[0].attr.style)[n]:null;for(;u>a;a++)if(l=this[a].attr.style,"function"!=typeof l){if(1===s&&"object"==typeof n){if(null==l){this[a].attr.style=o(n);continue}r=e(l);for(i in n)r[i]=n[i];this[a].attr.style=o(r)}if(2===s){if(null==l){this[a].attr.style=n+":"+t;continue}r=e(l),r[n]=t,this[a].attr.style=o(r)}}return this}})}(),t(g.prototype,{clone:function(){for(var e=[],n=0,t=this.length;t>n;n++)e[n]=p(this[0]);return g(e)},wrap:function(e){var n,t=g(e),r=[];if(0===t.length)return console.log("Not valid wrapper",e),this;for(var o=0,i=this.length;i>o;o++){n=i>0?t.clone():t,h(n[0]).nodes=[this[o]],r[o]=n[0];var l=this[o].parent&&this[o].parent.nodes;if(null!=l)for(var s=0,u=l.length;u>s;s++)if(l[s]===this[o]){l.splice(s,1,r[o]);break}}return g(r)},wrapAll:function(e){var n=g(e);return 0===n.length?(console.error("Not valid wrapper",e),this):(this.parent().mask(n),h(n[0]).nodes=this.toArray(),this.pushStack(n))}}),r(["empty","remove"],function(e){g.prototype[e]=function(){for(var n,t=0,r=this.length;r>t;t++)n=this[t],"empty"!==e?"remove"!==e||null!=n.parent&&o(n.parent.nodes,n):n.nodes=null;return this}}),t(g.prototype,{each:function(e,n){for(var t=0;this.length>t;t++)e.call(n||this,this[t],t);return this},eq:function(e){return-1===e?this.slice(e):this.slice(e,e+1)},get:function(e){return 0>e?this[this.length-e]:this[e]},slice:function(){return this.pushStack(Array.prototype.slice.apply(this,arguments))}}),r(["filter","children","closest","parent","find","first","last"],function(e){g.prototype[e]=function(n){var t,r,o=[],i=null==n?null:l(n,this.type,"closest"===e?"up":"down");switch(e){case"filter":return g(f(this,i));case"children":for(t=0;this.length>t;t++)r=this[t],null!=r.nodes&&(o=o.concat(null==i?r.nodes:f(r.nodes,i)));break;case"parent":for(t=0;this.length>t;t++)r=this[t].parent,!r||r.type===v.FRAGMENT||i&&c(r,i)||o.push(r);C(o);break;case"closest":case"find":if(null==i)break;for(t=0;this.length>t;t++)d(this[t][i.nextKey],i,o);break;case"first":case"last":var s;for(t=0;this.length>t;t++)if(s="first"===e?t:this.length-t-1,r=this[s],null==i||c(r,i)){o[0]=r;break}}return this.pushStack(o)}}),g}(Mask);return function(e,n){function t(e,n){return function(){return e.apply(n,arguments)}}function r(e){return e.parentNode.removeChild(e)}function o(e){if(null!=e)for(var n=0,t=e.length;t>n;n++)r(e[n])}function i(e,n){return n.parentNode.insertBefore(e,n.nextSibling)}function l(e,n){return n.parentNode.insertBefore(e,n)}function s(e,n,t,r){if(null==e.components)return i(t,r||e.placeholder);for(var o,s=e.components,u=null,a=!0,c=s.length,f=n;c>f;f++)if(o=s[f].elements,o&&o.length){u=o[0];break}if(null==u)for(a=!1,f=c>n?n:c;--f>-1;)if(o=s[f].elements,o&&o.length){u=o[o.length-1];break}return null==u&&(u=r||e.placeholder),a?l(t,u):i(t,u)}function u(n,t,r,o,i){return e.render(t,r,o,i,n)}function a(e,n){if(null==e)return!1;null!=e.elements&&(o(e.elements),e.elements=null),N.dispose(e);var t=n&&n.components||e.parent&&e.parent.components;return null==t?(console.error("Parent Components Collection is undefined"),!1):L(t,e)}function c(e){N.signal.emitIn(e,"domInsert")}function f(e,n){if("function"==typeof e.dispose){var t=e.dispose;return e.dispose=function(){n.call(this),t.call(this)},void 0}e.dispose=n}function d(){}function p(){}function h(){}function m(e,n){if(null==n&&(n=[]),null==e.components)return n;for(var t,r=e.components,o=0,i=r.length;i>o;o++)t=r[o],"validate"!==t.compoName?m(t):n.push(t);return n}var g,v,b,y,_,x,C,k,w,A=global.jQuery||global.Zepto||global.$,N=void 0!==n?n:e.Compo||global.Compo,E=N.Dom.addEventListener,O=e.registerHandler,j=e.registerAttrHandler,T=e.registerUtil,S=Array.prototype.slice;(function(){function e(e,n){for(var t,r=-1,o=n.length-1;o>++r;)t=n[r],null==e[t]&&(e[t]={}),e=e[t];return e}function n(n,r,o,i){var l=i.length,s=l>1?e(n,i):n,u=i[l-1],a=s[u];return l>1&&t(n,i),"length"===u&&D(s)?(P(s,function(e,n,t,r){for(var i=o.length,l=-1;i>++l;)o[l](e,n,t,r)}),a):(Object.defineProperty(s,u,{get:function(){return a},set:function(e){var n=0,t=o.length;if(e!==a){if(a=e,D(e))for(n=0;t>n;n++)P(e,o[n]);if(null!=o.__dirties)return o.__dirties[r]=1,void 0;for(n=0;t>n;n++)o[n](e)}},configurable:!0}),a)}function t(e,n){for(var t,i=o(e),l="",s=0,u=n.length-1;u>s;s++)t=n[s],l+=t+".",r(l,e,t,i),e=e[t]}function r(e,n,t,r){var o,i=n[t];Object.defineProperty(n,t,{get:function(){return i},set:function(n){n!==i&&(o=i,i=n,r(e,o))},configurable:!0})}function o(e){return function(n,t){var r=e.__observers;if(null!=r)for(var o in r)if(0===o.indexOf(n)){var i=r[o].slice(0),l=i.length,s=0;if(0!==l){var u,a,c=g(e,o);for(s=0;l>s;s++)u=i[s],_(e,o,u),a=o.substring(n.length),_(t,a,u);for(s=0;l>s;s++)i[s](c);for(s=0;l>s;s++)b(e,o,i[s])}}}}function i(e,n,t){null==e.__observers&&Object.defineProperty(e,"__observers",{value:{__dirty:null},enumerable:!1});var r=e.__observers;return null!=r[n]?-1===I(r[n],t)&&r[n].push(t):r[n]=[t],r[n]}g=function(e,n){for(var t=n.split("."),r=t.length,o=-1;r>++o;){if(null==e)return null;e=e[t[o]]}return e},v=function(e,n,t){for(var r,o=n.split("."),i=o.length-1,l=-1;i>++l;)r=o[l],null==e[r]&&(e[r]={}),e=e[r];e[o[l]]=t},b=function(e,t,r){for(var o=t.split("."),l=o.length,s=-1,u=e;l>++s&&(u=u[o[s]],null!=u);)if(null!=u.__observers){var a=o.slice(s+1).join(".");if(u.__observers[a]){i(u,a,r);var c=i(e,t,r);if(1===c.length){var f=o.splice(0,s);0!==f.length&&n(e,t,c,f,!0)}return}}var c=i(e,t,r);1===c.length&&n(e,t,c,o,!0);var d=g(e,t);D(d)&&P(d,r)},y=function(e,n,t){for(var r=n.split("."),o=r.length,i=-1,l=e;o>++i&&(l=l[r[i]],null!=l);)if(null!=l.__observers){if(y(l,r.slice(i).join("."),t))return!0;break}var s=e.__observers;return null==s||null==s[n]?!1:-1!==I(s[n],t)},_=function(e,n,t){for(var r=n.split("."),o=r.length,i=-1,l=e;o>++i&&(l=l[r[i]],null!=l);)if(null!=l.__observers){_(l,r.slice(i).join("."),t);break}var s=e.__observers;if(null!=s&&null!=s[n]){var u=g(e,n);if(2===arguments.length)return s[n].length=0,void 0;L(s[n],t),D(u)&&U(u,t)}},x=function(e){if(D(e))return M(e),void 0;var n=e.__observers;null!=n&&(n.__dirties={})},C=function(e){if(D(e))return $(e),void 0;var n=e.__observers,t=null==n?null:n.__dirties;if(null!=t){for(var r in t){var o=e.__observers[r],i=g(e,r);if(null!=o)for(var l=0,s=o.length;s>l;l++)o[l](i)}n.__dirties=null}},k=function(e,n){if(null==n)return e;null==e&&(e={});for(var t in n)e[t]=n[t];return e},w=function(e,n){if(null==e)return!1;for(var t=n.split("."),r=t.length,o=-1;r>++o;)if(null==(e=e[t[o]]))return!1;return!0}})();var D,L,F,I,P,U,M,$;(function(){function e(e,t,r){return function(){return n(e,t,r,S.call(arguments))}}function n(e,n,t,r){var o=e.__observers&&e.__observers.__array,i=n.apply(e,r);if(null==o||0===o.length)return i;if(null!=e.__observers.__dirty)return e.__observers.__dirty=!0,i;for(var l,s=0,u=o.length;u>s;s++)l=o[s],"function"==typeof l&&l(e,t,r,i);return i}D=function(e){return null!=e&&"object"==typeof e&&null!=e.length&&"function"==typeof e.splice},L=function(e){if(null==e)return!1;for(var n,t=0,r=e.length,o=1,i=arguments.length,l=0;r>t;t++)for(n=e[t],o=1;i>o;o++)if(arguments[o]===n){e.splice(t,1),t--,r--,l++;break}return l+1===i},P=function(n,t){null==n.__observers&&Object.defineProperty(n,"__observers",{value:{__dirty:null},enumerable:!1});var r=n.__observers.__array;if(null==r&&(r=n.__observers.__array=[]),0===r.length)for(var o,i,l=0,s=["push","unshift","splice","pop","shift","reverse","sort","remove"],u=s.length;u>l;l++)i=s[l],o=n[i],null!=o&&(n[i]=e(n,o,i));r[r.length++]=t},U=function(e,n){var t=e.__observers&&e.__observers.__array;if(null!=t)for(var r=0,o=t.length;o>r;r++)if(t[r]===n){t[r]=null;for(var i=r;o>i;i++)t[i]=t[i+1];o--,t.length--}},M=function(e){null!=e.__observers&&(e.__observers.__dirty=!1)},$=function(e){var n=e.__observers,t=n&&n.__array;if(null!=t&&n.__dirty===!0){for(var r,o=0,i=t.length;i>o;o++)r=t[o],"function"==typeof r&&r(e);n.__dirty=null}},F=function(e,n){for(var t=0,r=e.length;r>t;t++)n(e[t])},I=function(e,n){return e.indexOf(n)}})();var R,H,V,B,W,K,Q;(function(){var n=e.Utils.Expression,t=n.eval;K=n.parse,Q=n.varRefs,R=function(e,n,r,o){if("."===e)return n;var i=t(e,n,r,o);return null==i?"":i},H=function(e,n,r,o,i){if("."===e)return D(n)&&P(n,i),void 0;var l,s=K(e),u=Q(s);if(null!=u){if("string"==typeof u)return w(n,u)&&(l=n),null==l&&w(o,u)&&(l=o),null==l&&(l=n),b(l,u,i),void 0;for(var a,c=null!=u.length&&"function"==typeof u.splice,f=c===!0?u.length:1,d=0;f>d;d++)if(a=c?u[d]:u,null!=a){if("object"==typeof a){if(l=t(a.accessor,n,r,o),null==l||"object"!=typeof l){console.error("Binding failed to an object over accessor",a);continue}a=a.ref}else l=w(n,a)?n:w(o,a)?o:n;null!=a&&"$c"!==a&&b(l,a,i)}}},V=function(e,n,r,o){if("function"==typeof r&&console.warn("[mask.binding] - expression unbind(expr, model, controller, callback)"),"."===e)return U(n,o),void 0;var i,l=Q(e);if(null!=l){if("string"==typeof l)return w(n,l)&&_(n,l,o),w(r,l)&&_(r,l,o),void 0;for(var i,s=null!=l.length&&"function"==typeof l.splice,u=s===!0?l.length:1,a=0;u>a;a++)if(i=s?l[a]:l,null!=i)if("object"!=typeof i)w(n,i)&&_(n,i,o),w(r,i)&&_(r,i,o);else{var c=t(i.accessor,n,null,r);c&&_(c,i.ref,o)}}},B=function(e,n,t,r,o){var i=0;return function(){if(++i>1)return i=0,console.warn("<mask:bind:expression> Concurent binder detected",e),void 0;var l=R(e,n,t,r);if(arguments.length>1){var s=S.call(arguments);s[0]=l,o.apply(this,s)}else o(l);i--}},W=function(e){var n=0;return function(){return++n>1?(n=0,console.warn("<mask:listener:expression> concurent binder"),void 0):(e(),n--,void 0)}}})();var G,z;(function(){G=function(e,n,t){for(var r,o,i,l,s=e.split(";"),u=[],a=0,c=s.length;c>a;a++)r=s[a].split(":"),1===r.length||2===r.length?(i=2==r.length?r[0]:t,o=r[2==r.length?1:0],l=z(o.trim(),i,n),null!=l&&u.push(l)):console.error('Too much ":" in a signal def.',s[a]);return u},z=function(e,n,t){if(t!==!0)return{signal:e,type:n};var r=e.indexOf(".");return-1===r?(console.error("No pipe name in a signal",e),null):{signal:e.substring(r+1),pipe:e.substring(0,r),type:n}}})();var q=function(){function n(e,n,t,r){null==r&&(r=":bind"===t.compoName?"single":"dual");var o,l=t.attr;if(this.node=t,this.controller=t,this.model=e,this.element=n,this.value=l.value,this.property=l.property,this.setter=l.setter,this.getter=l.getter,this.dismiss=0,this.bindingType=r,this.log=!1,this.signal_domChanged=null,this.signal_objectChanged=null,this.locked=!1,null==this.property&&null==this.getter)switch(n.tagName){case"INPUT":if(o=n.getAttribute("type"),"checkbox"===o){this.property="element.checked";break}this.property="element.value";break;case"TEXTAREA":this.property="element.value";break;case"SELECT":this.domWay=i.SELECT;break;default:this.property="element.innerHTML"}if(l.log&&(this.log=!0,"log"!==l.log&&(this.logExpression=l.log)),l["x-signal"]){var s=G(l["x-signal"],null,"dom")[0],u=s&&s.type;switch(u){case"dom":case"object":this["signal_"+u+"Changed"]=s.signal;break;default:console.error("Signal typs is not supported",s)}}if(l["x-pipe-signal"]){var s=G(l["x-pipe-signal"],!0,"dom")[0],u=s&&s.type;switch(u){case"dom":case"object":this["pipe_"+u+"Changed"]=s;break;default:console.error("Pipe type is not supported")}}if(l["dom-slot"]){this.slots={};var a=t.parent,c=a.parent;a.parent=this,this.parent=c,this.slots[l["dom-slot"]]=function(e,n){this.domChanged(e,n)}}var f=l["object-pipe-slot"]||l["x-pipe-slot"];if(f){var d=f,p=d.indexOf("."),h=d.substring(0,p),s=d.substring(p+1);this.pipes={},this.pipes[h]={},this.pipes[h][s]=function(){this.objectChanged()},N.pipe.addController(this)}if(l.expression){if(this.expression=l.expression,null==this.value&&"single"!==r){var m=Q(this.expression);"string"==typeof m?this.value=m:console.warn("Please set value attribute in DualBind Control.")}}else this.expression=this.value}function t(e){var n=e.expression,t=e.model,r=e.objectChanged=e.objectChanged.bind(e);if(e.binder=B(n,t,e.cntx,e.node,r),H(n,t,e.cntx,e.node,e.binder),"dual"===e.bindingType){var o=e.node.attr;if(!o["change-slot"]&&!o["change-pipe-event"]){var i=e.element,l=o["change-event"]||o.changeEvent||"change",s=e.domChanged.bind(e);E(i,l,s)}if(!e.objectWay.get(e,e.expression))return setTimeout(function(){e.domWay.get(e)&&e.domChanged()}),e}return e.objectChanged(),e}function r(e,n,t){var o=e.slots;(null==o||"function"!=typeof o[n]||o[n].apply(e,t)!==!1)&&null!=e.parent&&r(e.parent,n,t)}var o={};e.registerBinding=function(e,n){o[e]=n},e.BindingProvider=n,n.create=function(e,t,r,i){var l,s=r.attr.bindingProvider,u=null==s?null:o[s];return"function"==typeof u?new u(e,t,r,i):(l=new n(e,t,r,i),null!=u&&k(l,u),l)},n.bind=function(e){return t(e)},n.prototype={constructor:n,dispose:function(){V(this.expression,this.model,this.controller,this.binder)},objectChanged:function(e){if(!(this.dismiss-->0)){if(this.locked===!0)return console.warn("Concurance change detected",this),void 0;if(this.locked=!0,null==e&&(e=this.objectWay.get(this,this.expression)),this.domWay.set(this,e),this.log&&console.log("[BindingProvider] objectChanged -",e),this.signal_objectChanged&&r(this.node,this.signal_objectChanged,[e]),this.pipe_objectChanged){var n=this.pipe_objectChanged;N.pipe(n.pipe).emit(n.signal)}this.locked=!1}},domChanged:function(e,n){if(this.locked===!0)return console.warn("Concurance change detected",this),void 0;this.locked=!0;var t=n||this.domWay.get(this),o=!0;if(this.node.validations)for(var i,l=0,s=this.node.validations.length;s>l;l++)if(i=this.node.validations[l],i.validate(t,this.element,this.objectChanged.bind(this))===!1){o=!1;break}if(o&&(this.dismiss=1,this.objectWay.set(this.model,this.value,t),this.dismiss=0,this.log&&console.log("[BindingProvider] domChanged -",t),this.signal_domChanged&&r(this.node,this.signal_domChanged,[t]),this.pipe_domChanged)){var u=this.pipe_domChanged;N.pipe(u.pipe).emit(u.signal)}this.locked=!1},objectWay:{get:function(e,n){return R(n,e.model,e.cntx,e.controller)},set:function(e,n,t){v(e,n,t)}},domWay:{get:function(e){if(e.getter){var n=e.node.parent;return n[e.getter]()}return g(e,e.property)},set:function(e,n){if(e.setter){var t=e.node.parent;t[e.setter](n)}else v(e,e.property,n)}}};var i={SELECT:{get:function(e){var n=e.element;return-1===n.selectedIndex?"":n.options[n.selectedIndex].getAttribute("name")},set:function(e,n){for(var t,r=e.element,o=0,i=r.options.length;i>o;o++)if(t=r.options[o],t.getAttribute("name")==n)return r.selectedIndex=o,void 0}}};return k(n,{addObserver:b,removeObserver:_}),n}();O(":visible",d),d.prototype={constructor:d,refresh:function(e,n){n.style.display=R(this.attr.check,e)?"":"none"},renderStart:function(e,n,t){this.refresh(e,t),this.attr.bind&&b(e,this.attr.bind,this.refresh.bind(this,e,t))}},function(){function e(){}O(":bind",e),e.prototype={constructor:e,renderEnd:function(e,n,t,r){this.provider=q.create(n,r,this,"single"),q.bind(this.provider)},dispose:function(){this.provider&&"function"==typeof this.provider.dispose&&this.provider.dispose()}}}(),O(":dualbind",p),p.prototype={constructor:p,renderEnd:function(n,t,r,o){if(this.provider=q.create(t,o,this),this.components)for(var i,l=0,s=this.components.length;s>l;l++)i=this.components[l],":validate"===i.compoName&&(this.validations||(this.validations=[])).push(i);if(!this.attr["no-validation"]&&!this.validations){var u=t.Validate,a=this.provider.value;if(null==u&&-1!==a.indexOf(".")){for(var c=a.split("."),l=0,f=c.length,d=t[c[0]];null==u&&f>++l&&d;)u=d.Validate,d=d[c[l]];a=c.slice(l).join(".")}var p=u&&u[a];"function"==typeof p&&(p=e.getHandler(":validate").createCustom(o,p),(this.validations||(this.validations=[])).push(p))}q.bind(this.provider)},dispose:function(){this.provider&&"function"==typeof this.provider.dispose&&this.provider.dispose()},handlers:{attr:{"x-signal":function(){}}}},function(){function t(){}function r(e,n){this.fn=e,this.message=n}function o(e,n,t){console.warn("Validate Notification:",e,n);var r=A(e).next("."+l);return 0===r.length&&(r=A("<div>").addClass(l).html("<span></span><button>cancel</button>").insertAfter(e)),r.children("button").off().on("click",function(){r.hide(),t&&t()}).end().children("span").text(n).end().show()}function i(e){return A(e).next("."+l).hide()}var l="-validate-invalid";e.registerValidator=function(e,n){s[e]=n},O(":validate",t),t.prototype={constructor:t,attr:{},renderStart:function(e,n,o){if(this.element=o,this.attr.value){var i=t.resolveFromModel(e,this.attr.value);i&&(this.validators=[new r(i)])}},validate:function(e,n,t){null==n&&(n=this.element),this.attr&&(null==e&&this.attr.getter&&(e=g({node:this,element:n},this.attr.getter)),null==e&&this.attr.value&&(e=g(this.model,this.attr.value))),null==this.validators&&this.initValidators();for(var r,o=0,i=this.validators.length;i>o;o++)if(r=this.validators[o].validate(e),r&&!this.attr.silent)return this.notifyInvalid(n,r,t),!1;return this.makeValid(n),!0},notifyInvalid:function(e,n,t){return o(e,n,t)},makeValid:function(e){return i(e)},initValidators:function(){this.validators=[];for(var e in this.attr){switch(e){case"message":case"value":case"getter":continue}if(e in s!=!1){var n=s[e];this.validators.push(new r(n(this.attr[e],this),this.attr.message))}else console.error("Unknown Validator:",e,this)}}},t.resolveFromModel=function(e,n){return g(e.Validate,n)},t.createCustom=function(e,n){var o=new t;return o.element=e,o.validators=[new r(n)],o},r.prototype.validate=function(e){var n=this.fn(e);return n===!1?this.message||"Invalid - "+e:n},O(":validate:message",n({template:"div."+l+' { span > "~[bind:message]" button > "~[cancel]" }',onRenderStart:function(e){"string"==typeof e&&(e={message:e}),e.cancel||(e.cancel="cancel"),this.model=e},compos:{button:"$: button"},show:function(e,n){var t=this;this.model.message=e,this.compos.button.off().on(function(){t.hide(),n&&n()}),this.$.show()},hide:function(){this.$.hide()}}));var s={match:function(e){return function(n){return RegExp(e).test(n)}},unmatch:function(e){return function(n){return!RegExp(e).test(n)}},minLength:function(e){return function(n){return n.length>=parseInt(e,10)}},maxLength:function(e){return function(n){return n.length<=parseInt(e,10)}},check:function(e,n){return function(t){return R("x"+e,n.model,{x:t},n)}}}}(),O(":validate:group",h),h.prototype={constructor:h,validate:function(){for(var e,n=m(this),t=0,r=n.length;r>t;t++)if(e=n[t],!e.validate())return!1;return!0}},function(){function e(e,n,t){return e?null==n||""===n?e+" "+t:e.replace(n,t):t}function n(n,t,r,o,i){return function(t){switch(n){case"node":r.textContent=t;break;case"attr":var l,s,u=typeof r[i];if("boolean"===u)return o=r[i]=!!t,void 0;if("string"===u)return o=r[i]=e(r[i],o,t),void 0;l=r.getAttribute(i),s=e(l,o,t),r.setAttribute(i,s),o=t}}}function t(e,t,r,o,i,l,s,u){var a=n(u,t,i,e,s),c=B(t,r,o,l,a);H(t,r,o,l,c),f(l,function(){V(t,r,l,c)})}T("bind",{mode:"partial",current:null,element:null,nodeRenderStart:function(e,n,t,r,o){var i=R(e,n,t,o);return this.element=document.createTextNode(i),this.current=i},node:function(e,n,r,o,i){return t(this.current,e,n,r,this.element,i,null,"node"),this.element},attrRenderStart:function(e,n,t,r,o){return this.current=R(e,n,t,o)},attr:function(e,n,r,o,i,l){return t(this.current,e,n,r,o,i,l,"attr"),this.current}})}(),j("xx-visible",function(e,n,t,r,o,i){var l=B(n,t,r,i,function(e){o.style.display=e?"":"none"});H(n,t,r,i,l),f(i,function(){V(n,t,i,l)}),R(n,t,r,i)||(o.style.display="none")}),j("x-toggle","client",function(e,n,t,r,o,i){var l=n.substring(0,n.indexOf(":")),s=n.substring(l.length+1),u=Q(s);"string"!=typeof u&&(u=u[0]),E(o,l,function(){var e=R(s,t,r,i);v(t,u,e)})}),j("x-class-toggle","client",function(e,n,t,r,o){var i=n.substring(0,n.indexOf(":")),l=n.substring(i.length+1).trim();E(o,i,function(){A(o).toggleClass(l)})}),function(e){function t(){this.attr={"debugger":null,use:null,log:null,"if":null,each:null,visible:null}}e.registerHandler("%%",t);var r=function(){var e={refresh:function(e){this.model=e,this.elements&&(o(this.elements),this.elements=[]),null!=N&&N.dispose(this),l(u(this,this.nodes,this.model,this.cntx),this.placeholder)},dispose:function(){V(this.expr,this.originalModel,this,this.binder)}};return function(n,t,r,o){var i=n.attr.use;k(n,{expr:i,placeholder:document.createComment(""),binder:B(i,t,r,n,e.refresh.bind(n)),originalModel:t,model:R(i,t,r,n),dispose:e.dispose}),H(i,t,r,n,n.binder),o.appendChild(n.placeholder)}}(),i=function(){return function(e,n,t){function r(e){console.log("Logger > Key: %s, Value: %s",o,e)}var o=e.attr.log,i=B(o,n,t,e,r),l=R(o,n,t,e);H(o,n,t,e,i),f(e,function(){V(o,n,e,i)}),r(l)}}(),d=function(){function e(e,n){return function(){return e.apply(n,arguments)}}var n={refresh:function(e){(null!=this.elements||e)&&(null==this.elements?(l(u(this,this.template,this.model,this.cntx),this.placeholder),this.$=A(this.elements)):(null==this.$&&(this.$=A(this.elements)),this.$[e?"show":"hide"]()),this.onchange&&this.onchange(e))},dispose:function(){V(this.expr,this.model,this,this.binder),this.onchange=null,this.elements=null}};return function(t,r,o,i){var l=t.attr["if"];k(t,{expr:l,template:t.nodes,placeholder:document.createComment(""),binder:B(l,r,o,t,e(n.refresh,t)),state:!!R(l,r,o,t)}),t.state||(t.nodes=null),H(l,r,o,t,t.binder),i.appendChild(t.placeholder)
}}(),p=function(){var e={refresh:function(e){if(null!=this.elements||!e){if(null==this.elements)return l(u(this,this.template,this.model,this.cntx)),this.$=A(this.elements),void 0;null==this.$&&(this.$=A(this.elements)),this.$[e?"hide":"show"]()}}};return function(n,t,r,o){var i=n.parent.components,l=i&&i[i.length-1];n.template=n.nodes,n.placeholder=document.createComment(""),l.onchange=e.refresh.bind(n),l.state&&(n.nodes=null),o.appendChild(n.placeholder)}}(),h=function(){function t(e,n){var t=[];if(null==n||"object"!=typeof n||null==n.length)return t;for(var r,o=0,i=n.length;i>o;o++){switch(r=n[o],typeof r){case"string":case"number":case"boolean":r=n[o]=Object(r)}t[o]=new d(e.template,r,e)}return t}function r(e,n){for(var t=e.components,r=0,o=t.length,i=0,s=null,u=null,a=null,c=document.createDocumentFragment(),f=[];o>r;r++)if(a=t[r],null!=a.elements&&0!==a.elements.length)for(i=0,s=a.elements.length;s>i;i++)u=a.elements[i],u.parentNode.removeChild(u);e:for(i=0,s=n.length;s>i;i++){for(r=0;o>r;r++)if(n[i]===t[r].model){f[i]=t[r];continue e}console.warn("No Model Found for",n[i])}for(r=0,o=f.length;o>r;r++)if(a=f[r],null!=a.elements&&0!==a.elements.length)for(i=0,s=a.elements.length;s>i;i++)u=a.elements[i],c.appendChild(u);e.components=f,l(c,e.placeholder)}function o(e,n,r,o,i){if(null!=n&&null!=r){var l=n,d=n+r;for(d>e.components.length&&(d=e.components.length);d>l;l++)a(e.components[l],e)&&(l--,d--)}if(null!=o&&i&&i.length){var p=new f,h=t(e,i),m=u(p,h),g=p.components;s(e,o,m),c(p),null==e.components&&(e.components=[]),e.components.splice.apply(e.components,[o,0].concat(g))}}function i(e,n){for(var t,r=e.components,o=r.length;--o>-1;)t=r[o],-1!==n.indexOf(t.model)&&a(t,e)}var f=e.Dom.Component,d=function(){function e(e,n,t){this.nodes=e,this.model=n,this.parent=t}var n=f.prototype;e.prototype={compoName:"%%.each.item",constructor:p,renderEnd:function(e){this.elements=e}};for(var t in n)e.prototype[t]=n[t];return e}(),p={append:function(n){var t=new d(this.template,n,this);e.render(t,n,null,this.container,this)}},h={refresh:function(e,n,s,f){var d,p,h=0;if(null==n){if(null!=this.components)for(h=0,p=this.components.length;p>h;h++)d=this.components[h],a(d,this)&&(h--,p--);return this.components=[],this.nodes=t(this,e),l(u(this,this.nodes),this.placeholder),F(this.components,c),void 0}for(p=e.length;p>h;h++)switch(d=e[h],typeof d){case"string":case"number":case"boolean":e[h]=Object(d)}switch(n){case"push":o(this,null,null,e.length,e.slice(e.length-1));break;case"pop":o(this,e.length,1);break;case"unshift":o(this,null,null,0,e.slice(0,1));break;case"shift":o(this,0,1);break;case"splice":var m=s[0],g=1===s.length?this.components.length:s[1],v=s.length>2?e.slice(s[0],s.length-2+s[0]):null;o(this,m,g,m,v);break;case"sort":case"reverse":r(this,e);break;case"remove":null!=f&&f.length&&i(this,f)}},dispose:function(){V(this.expr,this.model,this,this.refresh)}};return function(e,r,o,i){null==e.nodes&&void 0!==n&&n.ensureTemplate(e);var l=e.attr.each||e.attr.foreach,s=R(l,r,o,e);k(e,{expr:l,binder:B(l,r,o,e,h.refresh.bind(e)),template:e.nodes,container:i,placeholder:document.createComment(""),dispose:h.dispose}),i.appendChild(e.placeholder),H(e.expr,r,o,e,e.binder);for(var u in p)e[u]=p[u];e.nodes=t(e,s)}}(),m=function(){var e={refresh:function(){if(this.refreshing!==!0){this.refreshing=!0;for(var e=R(this.expr,this.model,this.cntx,this),n=0,t=this.elements.length;t>n;n++)this.elements[n].style.display=e?"":"none";this.refreshing=!1}},dispose:function(){V(this.expr,this.model,this,this.binder)}};return function(n,t,r){var o=n.attr.visible;k(n,{expr:o,binder:B(o,t,r,n,e.refresh.bind(n)),dispose:e.dispose}),H(o,t,r,n,n.binder),e.refresh.call(n)}}();t.prototype={constructor:t,elements:null,renderStart:function(e,n,t){var o=this.attr;return null==o["debugger"]?null!=o.use?(r(this,e,n,t),void 0):null!=o.log?(i(this,e,n,t),void 0):(this.model=e,null!=o["if"]?(d(this,e,n,t),void 0):null!=o["else"]?(p(this,e,n,t),void 0):((null!=o.each||null!=o.foreach)&&h(this,e,n,t),void 0)):void 0},render:null,renderEnd:function(e){this.elements=e,null!=this.attr.visible&&m(this,this.model,this.cntx)}}}(e),function(){var n,r,o,i,u,f=e.getStatement();(function(){n=function(e,n,t,r,o){return f[e].getNodes(n,t,r,o)},r=function(e,n,t,r,o,i){var l=[];return builder_build(e,n,t,r,o,l),null==i?l:(arr_pushMany(i,l),l)},o=function(e,n){e.placeholder=document.createComment(""),n.appendChild(e.placeholder)},i=function(e,n,r,o,i,l){e.parent=l,e.model=r,e.refresh=t(e.refresh,e),e.binder=B(e.expr,r,o,l,e.refresh),H(e.expr,r,o,l,e.binder)},u=function(e,n){if(null!=e)for(var t,r="function"==typeof e.splice,o=r?e.length:1,i=-1;o>++i;)t=r?e[i]:e,t.style.display=n?"":"none"}})(),function(){function o(){}function i(e,n,r,o,i,l,s,u){for(e.model=i,e.ctx=l,e.controller=u,e.refresh=t(e.refresh,e),e.binder=W(e.refresh),e.index=r,e.Switch=[{node:n,elements:null}],H(n.expression,i,l,u,e.binder);n=n.nextSibling,null!=n&&"else"===n.tagName;)e.Switch.push({node:n,elements:null}),n.expression&&H(n.expression,i,l,u,e.binder);e.Switch[r].elements=o}e.registerHandler("+if",{render:function(e,t,o,i,l){for(var s=this,u=n("if",s,e,t,i),a=0,c=s;null!=c&&c.nodes!==u;)a++,c=s.nextSibling;return this.attr["switch-index"]=a,r(u,e,t,o,i,l)},renderEnd:function(e,n,t,r,l){var s=new o,u=this.attr["switch-index"];return s.placeholder=document.createComment(""),r.appendChild(s.placeholder),i(s,this,u,e,n,t,r,l),s}}),o.prototype={ctx:null,model:null,controller:null,index:null,Switch:null,binder:null,refresh:function(){for(var n,t=this,r=t.Switch,o=r.length,i=-1,s=t.index,a=t.model,c=t.ctx,f=t.controller;o>++i&&(n=r[i].node.expression,null!=n)&&!R(n,a,c,f););if(s!==i){if(null!=s&&u(r[s].elements,!1),i===o)return t.index=null,void 0;this.index=i;var d=r[i];if(null!=d.elements)return u(d.elements,!0),void 0;var p=e.render(d.node.nodes,a,c,null,f),h=p.nodeType===Node.DOCUMENT_FRAGMENT_NODE?S.call(p.childNodes):p;l(p,t.placeholder),d.elements=h}},dispose:function(){for(var e,n,t=this.Switch,r=t.length,o=-1;r>++o;)e=t[o],n=e.node.expression,n&&V(n,this.model,this.controller,this.binder),e.node=null,e.elements=null;this.controller=null,this.model=null,this.ctx=null}}}(),function(){function n(e){for(var n,t=e.length,r=-1;t>++r;)switch(n=e[r],typeof n){case"string":case"number":case"boolean":e[r]=Object(n)}}function t(e,n){for(var t=e.node.components,r=0,o=t.length,i=0,s=null,u=null,a=null,c=document.createDocumentFragment(),f=[];o>r;r++)if(a=t[r],null!=a.elements&&0!==a.elements.length)for(i=0,s=a.elements.length;s>i;i++)u=a.elements[i],u.parentNode.removeChild(u);e:for(i=0,s=n.length;s>i;i++){for(r=0;o>r;r++)if(n[i]===e._getModel(t[r])){f[i]=t[r];continue e}console.warn("No Model Found for",n[i])}for(r=0,o=f.length;o>r;r++)if(a=f[r],null!=a.elements&&0!==a.elements.length)for(i=0,s=a.elements.length;s>i;i++)u=a.elements[i],c.appendChild(u);e.components=e.node.components=f,l(c,e.placeholder)}function r(n,t,r,o,i){var l=n.node,u=l.components;null==u&&(u=l.components=[]);var f=(n.prop1,n.prop2,n.type,n.ctx);if(n.node,null!=t&&null!=r){var d=t,p=t+r;for(p>u.length&&(p=u.length);p>d;d++)a(u[d],l)&&(d--,p--)}if(null!=o&&i&&i.length){var h=new e.Dom.Component,m=n._build(l,i,f,h);s(l,o,m,n.placeholder),c(h),u.splice.apply(u,[o,0].concat(h.components))}}function o(e,n){for(var t,r=e.components,o=r.length;--o>-1;)t=r[o],-1!==n.indexOf(t.model)&&a(t,e.node)}var u={model:null,parent:null,refresh:function(e,i,s,u){var f,d=0,p=this.node,h=(this.model,this.ctx),m=this.node;if(null==i){var g=p.components;if(null!=g){for(var f=g.length,d=-1;f>++d;)a(g[d],p)&&(d--,f--);g.length=0}var v=this._build(p,e,h,m);return l(v,this.placeholder),F(p.components,c),void 0}var b=e;switch(n(e),i){case"push":r(this,null,null,b.length,b.slice(b.length-1));break;case"pop":r(this,b.length,1);break;case"unshift":r(this,null,null,0,b.slice(0,1));break;case"shift":r(this,0,1);break;case"splice":var y=s[0],_=1===s.length?this.components.length:s[1],x=s.length>2?b.slice(s[0],s.length-2+s[0]):null;r(this,y,_,y,x);break;case"sort":case"reverse":t(this,b);break;case"remove":null!=u&&u.length&&o(this,u)}},dispose:function(){V(this.expr,this.model,this.parent,this.binder)}};(function(){function n(e,n){this.prop1=n[h],this.prop2=n[m],this.type=n[g],this.expr=n[v],null==e.components&&(e.components=[]),this.node=e,this.components=e.components}function t(e){for(var n,t=e.length,r=-1;t>++r;)switch(n=e[r],typeof n){case"string":case"number":case"boolean":e[r]=Object(n)}}function r(e,n){for(var t=e.node.components,r=0,o=t.length,i=0,s=null,u=null,a=null,c=document.createDocumentFragment(),f=[];o>r;r++)if(a=t[r],null!=a.elements&&0!==a.elements.length)for(i=0,s=a.elements.length;s>i;i++)u=a.elements[i],u.parentNode.removeChild(u);e:for(i=0,s=n.length;s>i;i++){for(r=0;o>r;r++)if(n[i]===t[r].scope[e.prop1]){f[i]=t[r];continue e}console.warn("No Model Found for",n[i])}for(r=0,o=f.length;o>r;r++)if(a=f[r],null!=a.elements&&0!==a.elements.length)for(i=0,s=a.elements.length;s>i;i++)u=a.elements[i],c.appendChild(u);e.components=e.node.components=f,l(c,e.placeholder)}function o(n,t,r,o,i){var l=n.node,u=l.components;null==u&&(u=l.components=[]);var f=n.prop1,d=n.prop2,h=n.type,m=n.ctx;if(n.node,null!=t&&null!=r){var g=t,v=t+r;for(v>u.length&&(v=u.length);v>g;g++)a(u[g],l)&&(g--,v--)}if(null!=o&&i&&i.length){var b=new e.Dom.Component,y=p.getNodes(l.nodes,i,f,d,h),_=builder_build(y,i,m,null,b);s(l,o,_,n.placeholder),c(b),u.splice.apply(u,[o,0].concat(b.components))}}function d(e,n){for(var t,r=e.components,o=r.length;--o>-1;)t=r[o],-1!==n.indexOf(t.model)&&a(t,e.node)}var p=f["for"],h="for-prop-1",m="for-prop-2",g="for-type",v="for-expr";e.registerHandler("+for",{render:function(e,n,r,o,i){var l=p.parseFor(this.expression),s=this.attr;s[h]=l[0],s[m]=l[1],s[g]=l[2],s[v]=l[3];var u=R(l[3],e,n,o);null!=u&&(D(u)&&t(u),p.build(u,l,this.nodes,e,n,r,this,i))},renderEnd:function(e,t,r,o,l){var s=new n(this,this.attr);return s.placeholder=document.createComment(""),o.appendChild(s.placeholder),i(s,this,t,r,o,l),s}}),n.prototype={compoName:"+for",model:null,parent:null,refresh:u.refresh,dispose:u.dispose,_getModel:function(e){return e.scope[this.prop1]},_build:function(e,n,t,r){var o=p.getNodes(e.nodes,n,this.prop1,this.prop2,this.type);return builder_build(o,n,t,null,r)},_refresh:function(e,n,i,s){var u,f=0,h=this.node,m=this.prop1,g=this.prop2,v=this.type,b=this.model,y=this.ctx,_=this.node;if(null==n){var x=h.components;if(null!=x){for(var u=x.length,f=-1;u>++f;)a(x[f],h)&&(f--,u--);x.length=0}var C=builder_build(p.getNodes(h.nodes,e,m,g,v),b,y,null,_);return l(C,this.placeholder),F(h.components,c),void 0}var k=e;switch(t(e),n){case"push":o(this,null,null,k.length,k.slice(k.length-1));break;case"pop":o(this,k.length,1);break;case"unshift":o(this,null,null,0,k.slice(0,1));break;case"shift":o(this,0,1);break;case"splice":var w=i[0],A=1===i.length?this.components.length:i[1],N=i.length>2?k.slice(i[0],i.length-2+i[0]):null;o(this,w,A,w,N);break;case"sort":case"reverse":r(this,k);break;case"remove":null!=s&&s.length&&d(this,s)}},_dispose:function(){V(this.expr,this.model,this.parent,this.binder)}}})(),function(){function t(e,n,t,r,i,l){for(var s,u=n.length,a=-1;u>++a;)s=o.createItem(a,e,i),builder_build(s,n[a],t,r,i,l)}function r(e){this.expr=e.expression,this.nodes=e.nodes,null==e.components&&(e.components=[]),this.node=e,this.components=e.components}var o=f.each;e.registerHandler("+each",{render:function(e,r,o,i,l){var s=this,u=R(s.expression,e,r,i);null!=u&&(n(u),t(s.nodes,u,r,o,s,l))},renderEnd:function(e,n,t,o,l){var s=new r(this,this.attr);return s.placeholder=document.createComment(""),o.appendChild(s.placeholder),i(s,this,n,t,o,l),s}}),r.prototype={compoName:"+each",refresh:u.refresh,dispose:u.dispose,_getModel:function(e){return e.model},_build:function(e,n,r,o){var i=document.createDocumentFragment();return t(e.nodes,n,r,i,o),i}}}()}(),function(){function n(){}function i(e,n,t,r,o){if(a=d.getNodes(value,n,t,r,o),c=null,null!=a){for(var i=n.length,l=-1;i>++l&&n[l]!==n;);c=l===i?null:l}}function s(e,n,r,o,i,l,s,u){e.ctx=l,e.expr=n.expression,e.model=i,e.controller=u,e.refresh=t(e.refresh,e),e.binder=W(e.refresh),e.index=r,e.Switch=Array(n.nodes.length),null!=r&&(e.Switch[r]=o),H(n.expression,i,l,u,e.binder)}var a,c,d=f["switch"],p="switch-index";e.registerHandler("+switch",{render:function(e,n,t,o,l){var s=R(this.expression,e,n,controller);return i(s,this.nodes,e,n,o),null==a?null:(this.attr[p]=c,r(a,e,n,t,controller,l))},renderEnd:function(e,t,r,i,l){var u=new n,a=this.attr[p];return o(u,i),s(u,this,a,e,t,r,i,l),u}}),n.prototype={ctx:null,model:null,controller:null,index:null,Switch:null,binder:null,refresh:function(n){var t=this,r=t.Switch;r.length;var o=t.index,s=t.model,f=t.ctx,d=t.controller;if(i(n,t.nodes,s,f,d),c!==o){if(null!=o&&u(r[o],!1),null==c)return t.index=null,void 0;this.index=c;var p=r[c];if(null!=p)return u(p,!0),void 0;var h=e.render(a,s,f,null,d),m=h.nodeType===Node.DOCUMENT_FRAGMENT_NODE?S.call(h.childNodes):h;l(h,t.placeholder),r[c]=m}},dispose:function(){V(this.expr,this.model,this.controller,this.binder),this.controller=null,this.model=null,this.ctx=null}}}()}()}(Mask,Compo),Mask.Compo=Compo,Mask.jmask=jmask,exports.mask=Mask});