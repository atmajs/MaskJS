/*!
 * MaskJS v0.9.4
 * Part of the Atma.js Project
 * http://atmajs.com/
 *
 * MIT license
 * http://opensource.org/licenses/MIT
 *
 * (c) 2012, 2014 Atma.js and other contributors
 */
!function(e,n){"use strict";function t(){return n(i,r,o)}var r,o,i="undefined"==typeof window||null==window.navigator?global:window;return"undefined"==typeof exports||null!=e&&e!==exports&&e!==i||(e=exports),o=i.document,r=e||i,"function"==typeof define&&define.amd?define(t):t()}(this,function(global,exports,document){"use strict";function util_interpolate(e,n,t,r,o,i,l){for(var s,u,a,c,f,p=e.length,d=-1,h=null,m="",g=!0;++d<p;){if(g===!0)null==h?m+=e[d]:h.push(e[d]);else{if(c=e[d],u=null,a=c.indexOf(":"),-1===a)u=obj_getPropertyEx(c,t,r,i);else{if(s=a>0?str_trim(c.substring(0,a)):"",""===s&&(s="expression"),c=c.substring(a+1),f=custom_Utils[s],null==f){log_error("Undefined custom util `%s`",s);continue}u=f(c,t,r,o,i,l,n)}null!=u&&("object"==typeof u&&null==h&&(h=[m]),null==h?m+=u:h.push(u))}g=!g}return null==h?m:h}function attr_extend(e,n){if(null==e&&(e={}),null==n)return e;for(var t in n)"class"!==t||"string"!=typeof e[t]?e[t]=n[t]:e[t]+=" "+n[t];return e}function Template(e){this.template=e,this.index=0,this.length=e.length}function str_trim(e){for(var n,t=e.length,r=0,o=t-1;t>r&&(n=e.charCodeAt(r),33>n);r++);for(;o>=r&&(n=e.charCodeAt(o),33>n);o--);return 0===r&&o===t-1?e:e.substring(r,o+1)}function VarStatement(){}var regexpWhitespace=/\s/g,regexpEscapedChar={"'":/\\'/g,'"':/\\"/g,"{":/\\\{/g,">":/\\>/g,";":/\\>/g},hasOwnProp={}.hasOwnProperty,__cfg={allowCache:!0},_Array_slice=Array.prototype.slice,is_Function,is_Array,is_Object;!function(){is_Function=function(e){return"function"==typeof e},is_Array=function(e){return null!=e&&"object"==typeof e&&"number"==typeof e.length&&"function"==typeof e.splice},is_Object=function(e){return null!=e&&"object"==typeof e}}(),Template.prototype={skipWhitespace:function(){for(var e=this.template,n=this.index,t=this.length;t>n&&!(e.charCodeAt(n)>32);n++);return this.index=n,this},skipToAttributeBreak:function(){var e,n=this.template,t=this.index,r=this.length;do if(e=n.charCodeAt(++t),35===e&&123===n.charCodeAt(t+1))return this.index=t,this.sliceToChar("}"),void this.index++;while(46!==e&&35!==e&&62!==e&&123!==e&&32!==e&&59!==e&&r>t);this.index=t},sliceToChar:function(e){for(var n,t,r=this.template,o=this.index,i=o,l=!1;(t=r.indexOf(e,o))>-1&&(o=t,92===r.charCodeAt(o-1));)l=!0,o++;return n=r.substring(i,o),this.index=o,l?n.replace(regexpEscapedChar[e],e):n}};var arr_pushMany,arr_remove;!function(){arr_pushMany=function(e,n){if(null!=n&&null!=e)for(var t=e.length,r=n.length,o=-1;++o<r;)e[t+o]=n[o]},arr_remove=function(e,n){if(null!=e)for(var t=e.length,r=-1;++r<t;)if(e[r]===n)return void e.splice(r,1)}}();var obj_extend,obj_getProperty,obj_getPropertyEx,obj_toDictionary;!function(){function e(e,n,t,r){for(var o=e;r>t&&null!=o;)o=o[n[t]],t++;return o}obj_extend=function(e,n){null==e&&(e={});for(var t in n)e[t]=n[t];return e},obj_getProperty=function(e,n){if("."===n)return e;for(var t=e,r=n.split("."),o=-1,i=r.length;null!=t&&++o<i;)t=t[r[o]];return t},obj_getPropertyEx=function(n,t,r,o){if("."===n)return t;var i,l=n.split("."),s=t,u=-1,a=l.length,c=l[0];for("$c"===c?(s=o,u++):"$a"===c?(s=o&&o.attr,u++):"$u"===c?(s=customUtil_$utils,u++):"$ctx"===c&&(s=r,u++),i=u;null!=s&&++u<a;)s=s[l[u]];if(null==s&&-1===i)for(var f;;){if(null==o)break;if(f=o.scope,null!=f&&(s=e(f,l,0,a),null!=s))return s;o=o.parent}return s},obj_toDictionary=function(e){var n,t=[],r=0;for(n in e)t[r++]={key:n,value:e[n]};return t}}();var fn_proxy,fn_apply,fn_doNothing;!function(){fn_proxy=function(e,n){return function(){return fn_apply(e,n,arguments)}},fn_apply=function(e,n,t){switch(t.length){case 0:return e.call(n);case 1:return e.call(n,t[0]);case 2:return e.call(n,t[0],t[1]);case 3:return e.call(n,t[0],t[1],t[2]);case 4:return e.call(n,t[0],t[1],t[2],t[3])}return e.apply(n,t)},fn_doNothing=function(){}}();var listeners_on,listeners_off,listeners_emit;!function(){listeners_on=function(n,t){(e[n]||(e[n]=[])).push(t)},listeners_off=function(n,t){return null==t?void(e[n]=[]):void arr_remove(e[n],t)},listeners_emit=function(n){var t=e[n];if(null!=t)for(var r=t.length,o=-1,i=_Array_slice.call(arguments,1);++o<r;)t[o].apply(null,i)};var e={compoCreated:null,error:null}}();var throw_,parser_error,parser_warn,log_warn,log_error;!function(){function e(e,n){var t=_Array_slice.call(n);t.unshift("<maskjs:"+e.toUpperCase()+">"),console[e].apply(console,t)}function n(e){function n(n,r,o){this.type="Parser"+e,this.message=n,this.original=r,this.index=o,this.stack=t()}return r(n,Error),n}function t(){var e=(new Error).stack;return null==e?null:e.split("\n").slice(6).join("\n")}function r(e,n){Object.create&&(e.prototype=Object.create(n.prototype))}function o(e,n,t,r,o,f,p){n+=i(o)+l(t,r,p)+u(e,t,r)+s(f);var d="error"===e?a:c;return new d(n,t,r)}function i(e){return null==e?"":("number"==typeof e&&(e=String.fromCharCode(e))," Invalid token: `"+e+"`")}function l(e,n,t){if(null==n&&!t)return"";var r=e.substring(0,n).split("\n"),o=r.length,i=n+1-r.slice(0,o-2).join("\n").length;return" at "+(t||"")+"("+o+":"+i+")"}function s(e){var n={2:"tag",3:"tag",5:"attribute key",6:"attribute value",8:"literal","var":"VarStatement",expr:"Expression"};return null==e||null==n[e]?"":"\n    , when parsing "+n[e]}function u(e,n,t){if(null==t)return"";var r=n.substring(t);return r.length>30&&(r=r.substring(0,30)+"..."),"\n    Parser "+e+" at: "+r}throw_=function(e){log_error(e),listeners_emit("error",e)},parser_error=function(e,n,t,r,i,l){var s=o("error",e,n,t,r,i,l);log_error(s.message),log_warn(s.stack),listeners_emit("error",s)},parser_warn=function(e,n,t,r,i,l){var s=o("warn",e,n,t,r,i,l);log_warn(s.message),log_warn(s.stack),listeners_emit("error",s)},log_error=function(){e("error",arguments)},log_warn=function(){e("warn",arguments)};var a=n("Error"),c=n("Warning")}();var custom_Utils,custom_Statements,custom_Attributes,custom_Tags,custom_Tags_defs,customUtil_get,customUtil_$utils,customUtil_register,customTag_register;!function(){function e(){custom_Utils={expression:function(e,n,t,r,o){return ExpressionUtil.eval(e,n,t,o)}},custom_Statements={},custom_Attributes={"class":null,id:null,style:null,name:null,type:null},custom_Tags={div:null,span:null,input:null,button:null,textarea:null,select:null,option:null,h1:null,h2:null,h3:null,h4:null,h5:null,h6:null,a:null,p:null,img:null,table:null,td:null,tr:null,pre:null,ul:null,li:null,ol:null,i:null,em:null,b:null,strong:null,form:null,audio:null,video:null,canvas:null,svg:null},custom_Tags_defs={}}e(),function(e){function n(e){function n(e,n){this.tagName=e.tagName,this.attr=e.attr,this.expression=e.expression,this.nodes=e.nodes,this.nextSibling=e.nextSibling,this.parent=n,this.components=null}return n.prototype=e,n}customTag_register=function(t,r){null!=r&&"object"==typeof r&&(r.__Ctor=n(r)),e[t]=r}}(custom_Tags),function(e){function n(e){if("parsed"===e.arguments)return r(e.process);var n=fn_proxy(e.process||t,e);return n.util=e,n}function t(e,n,t,r,o,i,l){return"node"===l?(this.nodeRenderStart(e,n,t,r,o),this.node(e,n,t,r,o)):(this.attrRenderStart(e,n,t,r,o,i),this.attr(e,n,t,r,o,i))}function r(e){return function(n,t,r,o,i){var l=ExpressionUtil.evalStatements(n,t,r,i);return e.apply(null,l)}}customUtil_$utils={},customUtil_register=function(t,r){return is_Function(r)?void(e[t]=r):(e[t]=n(r),void("parsed"===r.arguments&&(customUtil_$utils[t]=r.process)))},customUtil_get=function(n){return null!=n?e[n]:e}}(custom_Utils)}();var ExpressionUtil=function(){function e(e,n){null==n&&(n=!1),t=e,o=0,i=e.length,r=new en;var l,w,K=r,X=Z;e:for(;;)if(i>o&&(l=t.charCodeAt(o))<33)o++;else{if(o>=i)break;if(w=bn(l),null==w&&i>o)break;if(w===I){if(n===!0)return[r,o];break}if(n===!0){var q=K.parent;if(null!=q&&q.type===P&&null==q.parent&&w===F)return[r,o]}if(w===I)break;switch(w){case k:K=dn(K,new nn(K)),K=dn(K,new en(K)),o++;continue;case N:var Y=P;X===J&&(X=Z,Y=V);do K=K.parent;while(null!=K&&K.type!==Y);if(Y===P&&(K=K.parent),null==K){mn("OutOfAst Exception",l);break e}o++;continue;case j:K=dn(K,new on(K)),w=R,o++;break;case O:for(;null!=K&&K.type!==Q;)K=K.parent;o++;continue;case T:if(X!==J){X=Z;do K=K.parent;while(null!=K&&K.type!==P&&K.type!==Q);if(o++,null==K){mn("Unexpected comma",l);break e}if(K.type===Q){w=R;break}continue}do K=K.parent;while(null!=K&&K.type!==V);if(null==K){mn("OutOfAst Exception",l);break e}K=K.newArgument(),o++;continue;case D:r=new fn(r),K=r.case1,o++;continue;case L:K=r.case2,o++;continue;case S:l=t.charCodeAt(o+1),l>=48&&57>=l?w=M:(w=K.type===P?F:U,o++);break;case A:if(K.type===B||K.type===z||K.type===W){K=dn(K,new an(K)),K=K.getBody(),o++;continue}K=dn(K,new rn(K)),K=K.body,o++;continue;case E:do K=K.parent;while(null!=K&&K.type!==z&&K.type!==G);o++;continue}if(K.type===P&&(K=dn(K,new nn(K))),s!==w&&h!==w||null!=K.body)switch(w){case s:case u:case c:case a:case f:case d:case p:case m:case g:case v:case _:case y:case b:case x:case C:for(;K&&K.type!==H;)K=K.parent;if(null==K.body)return mn("Unexpected operator",l);K.join=w;do K=K.parent;while(null!=K&&K.type!==P);if(null==K)return mn("Unexpected operator",l);o++;continue;case $:case M:if(null!=K.body&&null==K.join)return mn("Directive expected",l);$===w&&(o++,dn(K,new tn(vn(l))),o++),M===w&&dn(K,new tn(_n(l)));continue;case F:case U:var hn=yn();if(w===F&&("null"===hn&&(hn=null),"false"===hn&&(hn=!1),"true"===hn&&(hn=!0),"string"!=typeof hn)){dn(K,new tn(hn));continue}for(;i>o;){l=t.charCodeAt(o);{if(!(33>l))break;o++}}if(40===l){X=J,o++;var xn=dn(K,new ln(K,hn));K=xn.newArgument();continue}var Cn=w===F?sn:un;K=dn(K,new Cn(K,hn));break;case R:if(125===gn())continue;var wn=yn();if(58!==gn())return mn("Object parser. Semicolon expeted",l);o++,K=K.nextProp(wn),w=F;continue}else K=dn(K,new cn(K,w)),o++}return null==K.body&&K.type===H?mn("Unexpected end of expression",l):(pn(r),r)}function n(t,r,o,i){var w,k;if(null==t)return null;if("."===t)return r;if(k="string"==typeof t?l.hasOwnProperty(t)===!0?l[t]:l[t]=e(t):t,null==k)return null;var N,A,E,j=k.type;if(P===j){var O,T;e:for(N=0,E=k.body.length;E>N;N++)if(A=k.body[N],O=n(A,r,o,i),null!=T&&null!=T.join){if(T.join===d)if(w)w=O;else for(;E>N&&k.body[N].join!==p;N++);if(T.join===p){if(w)break e;if(O){w=O;break e}}switch(T.join){case s:w-=O;break;case u:w+=O;break;case a:w/=O;break;case c:w*=O;break;case f:w%=O;break;case v:w=w!=O;break;case _:w=w!==O;break;case m:w=w==O;break;case g:w=w===O;break;case y:w=w>O;break;case b:w=w>=O;break;case x:w=O>w;break;case C:w=O>=w}T=A}else T=A,w=O}if(H===j)return w=n(k.body,r,o,i),null==k.next?w:hn(k.next,w);if(K===j)return k.body;if(G===j){var S=k.body.body,D=S.length,N=-1;for(w=new Array(D);++N<D;)w[N]=n(S[N],r,o,i);return w}if(Q===j){w={};var L=k.props;for(var I in L)w[I]=n(L[I],r,o,i);return w}if(B===j||V===j||z===j||W===j)return hn(k,r,o,i);if(X===j)switch(w=n(k.body,r,o,i),k.prefix){case s:w=-w;break;case h:w=!w}return q===j&&(w=n(k.body,r,o,i),w=n(w?k.case1:k.case2,r,o,i)),w}var t,r,o=0,i=0,l={},s="-",u="+",a="/",c="*",f="%",p="||",d="&&",h="!",m="==",g="===",v="!=",_="!==",y=">",b=">=",x="<",C="<=",w=".",k=20,N=21,A=22,E=23,j=24,O=25,T=26,S=27,D=28,L=29,I=30,F=31,U=32,$=33,M=34,R=35,P=1,H=2,B=3,V=4,W=5,z=6,K=7,Q=10,G=11,X=12,q=13,Z=1,J=2,Y={};Y[w]=1,Y[a]=2,Y[c]=2,Y[s]=3,Y[u]=3,Y[y]=4,Y[b]=4,Y[x]=4,Y[C]=4,Y[m]=5,Y[g]=5,Y[v]=5,Y[_]=5,Y[d]=6,Y[p]=6;var en,nn,tn,rn,on,ln,sn,un,an,cn,fn;!function(){en=function(e){this.parent=e,this.type=P,this.body=[],this.join=null},nn=function(e){this.parent=e},nn.prototype={constructor:nn,type:H,join:null,body:null},tn=function(e){this.type=K,this.body=e,this.join=null},rn=function(e){this.type=G,this.parent=e,this.body=new en(this)},on=function(e){this.type=Q,this.parent=e,this.props={}},on.prototype={nextProp:function(e){var n=new nn(this);return this.props[e]=n,n}},ln=function(e,n){this.parent=e,this.type=V,this.body=n,this.arguments=[],this.next=null},ln.prototype={constructor:ln,newArgument:function(){var e=new en(this);return this.arguments.push(e),e}},sn=function(e,n){this.type=B,this.parent=e,this.body=n,this.next=null},un=function(e,n){this.type=W,this.parent=e,this.body=n,this.next=null},an=function(e){this.parent=e,this.body=new nn(this),this.body.body=new en(this.body),this.next=null},an.prototype={type:z,getBody:function(){return this.body.body}},cn=function(e,n){this.parent=e,this.prefix=n},cn.prototype={constructor:cn,type:X,body:null},fn=function(e){this.body=e,this.case1=new en(this),this.case2=new en(this)},fn.prototype={constructor:fn,type:q,case1:null,case2:null}}();var pn,dn;!function(){function e(e){if(0===e.length)return null;var n=new en(e[0].parent);return n.join=e[e.length-1].join,n.body=e,n}dn=function(e,n){switch(e.type){case P:return e.body.push(n),n;case H:if(n.type===W||n.type===z)return e.next=n;case X:return e.body=n;case B:case V:case W:case z:return e.next=n}return mn("Invalid expression")},pn=function(n){if(n.type!==P)return void(null!=n.body&&"object"==typeof n.body&&pn(n.body));for(var t,r,o,i=n.body,l=0,s=i.length;s>l;l++)pn(i[l]);for(l=1;s>l&&(t=i[l],r=i[l-1],!(Y[r.join]>Y[t.join]));l++);if(l!==s){for(o=[i[0]],l=1;s>l;l++){t=i[l],r=i[l-1];var u=Y[r.join];if(u>Y[t.join]&&s-1>l){for(var a,c,f=l;++l<s&&(a=i[l].join,null!=a)&&!(u<=Y[a]););c=i.slice(f,l+1),t=e(c),pn(t)}o.push(t)}n.body=o}}}();var hn,mn;!function(){mn=function(e,n){return parser_error(e,t,o,n,"expr")},hn=function(e,t,r,o){var i,l,s,u,a,c=e,f=e.body;if("$c"===f){l=o;var p=c.next,d=null!=p&&p.body;if(null!=d&&null==l[d]){if(p.type===V&&"function"==typeof Compo.prototype[d])i=o,l=Compo.prototype[d],c=p;else for(;;){if(l=l.parent,null==l)break;if(null!=l[d]){i=l,l=l[d],c=p;break}}null==l&&(f="$c."+d,c=p)}}else if("$a"===f)l=o&&o.attr;else if("$u"===f)l=customUtil_$utils;else if("$ctx"===f)l=r;else if(null!=t&&(i=t,l=t[f]),null==l)for(;null!=o&&(i=o.scope,null!=i&&(l=i[f]),null==l);)o=o.parent;if(null==l)return(null==c||null!=c.next)&&log_warn("<mask:expression> Accessor error:",f),null;for(;;){if(c.type===V){for(s=[],u=-1,a=c.arguments.length;++u<a;)s[u]=n(c.arguments[u],t,r,o);l=l.apply(i,s)}if(null==l||null==c.next)break;if(c=c.next,f=c.type===z?n(c.body,t,r,o):c.body,i=l,l=l[f],null==l)break}return l}}();var gn,vn,_n,yn,bn;!function(){gn=function(){for(var e;i>o;){if(e=t.charCodeAt(o),e>32)return e;o++}return null},vn=function(e){for(var n,r,i=!1,l=39===e?"'":'"',s=o;(n=t.indexOf(l,o))>-1&&(o=n,92===t.charCodeAt(n-1));)i=!0,o++;return r=t.substring(s,o),i===!0&&(r=r.replace(regexpEscapedChar[l],l)),r},_n=function(){for(var e,n,r=o;;){if(e=t.charCodeAt(o),46===e){if(n===!0)return mn("Invalid number",e),null;n=!0}if(!((e>=48&&57>=e||46===e)&&i>o))break;o++}return+t.substring(r,o)},yn=function(){var e,n=o,r=t.charCodeAt(o);if(34===r||39===r)return o++,e=vn(r),o++,e;for(;;){if(o===i)break;if(r=t.charCodeAt(o),36!==r&&95!==r){if(!(r>=48&&57>=r||r>=65&&90>=r||r>=97&&122>=r))break;o++}else o++}return t.substring(n,o)},bn=function(e){if(null==e&&o===i)return null;switch(e){case 40:return k;case 41:return N;case 123:return j;case 125:return O;case 91:return A;case 93:return E;case 44:return T;case 46:return S;case 59:return I;case 43:return u;case 45:return s;case 42:return c;case 47:return a;case 37:return f;case 61:return t.charCodeAt(++o)!==e?(mn("Assignment violation: View can only access model/controllers","="),null):t.charCodeAt(o+1)===e?(o++,g):m;case 33:return 61===t.charCodeAt(o+1)?(o++,61===t.charCodeAt(o+1)?(o++,_):v):h;case 62:return 61===t.charCodeAt(o+1)?(o++,b):y;case 60:return 61===t.charCodeAt(o+1)?(o++,C):x;case 38:return t.charCodeAt(++o)!==e?(mn("Not supported: Bitwise AND",e),null):d;case 124:return t.charCodeAt(++o)!==e?(mn("Not supported: Bitwise OR",e),null):p;case 63:return D;case 58:return L}return e>=65&&90>=e||e>=97&&122>=e||95===e||36===e?F:e>=48&&57>=e?M:34===e||39===e?$:(mn("Unexpected or unsupported directive",e),null)}}();var xn;return function(){function t(e,l,s,u){if(null==e)return null;var a,c,f=e.type;if(P===f)for(var p=e.body,d=p.length,h=-1;++h<d;)c=t(p[h],l,s,u),a=o(a,c);if(B===f||W===f||z===f){for(var m,g=e.body,v=e.next;null!=v;){if(m=v.type,V===m)return t(v,l,s,u);if(B!==m&&W!==m&&z!==m)return log_error("Ast Exception: next should be a symbol/function ref"),null;var _=m===z?n(v.body,l,s,u):v.body;if("string"!=typeof _)return log_warn("Can`t extract accessor name",g),null;g+="."+_,v=v.next}return g}switch(f){case H:case X:case q:c=t(e.body,l,s,u),a=o(a,c)}if(q===f&&(c=t(r.case1,l,s,u),a=o(a,c),c=t(r.case2,l,s,u),a=o(a,c)),V===f){for(var y=e.arguments,d=y.length,h=-1;++h<d;)c=t(y[h],l,s,u),a=o(a,c);c=null;var b=e;e:for(;b=b.parent;)switch(b.type){case B:case W:case z:c=b.body+(null==c?"":"."+c);break;case P:case H:break e;default:c=null;break e}null!=c&&(a=o(a,c)),e.next&&(c=t(e.next,l,s,u),a=o(a,{accessor:i(e),ref:c}))}return a}function o(e,n){if(null==e)return n;if(null==n)return e;if(("object"!=typeof e||null==e.length)&&(e=[e]),"object"!=typeof n||null==n.length)return-1===e.indexOf(n)&&e.push(n),e;for(var t=0,r=n.length;r>t;t++)-1===e.indexOf(n[t])&&e.push(n[t]);return e}function i(e){var n=e;e:for(;n.parent;){switch(n.parent.type){case P:case H:break e}n=n.parent}return l(n,e.next)}function l(e,n){if(e===n||null==e)return null;if("object"!=typeof e)return e;if(null!=e.length&&"function"==typeof e.splice){for(var t=[],r=0,o=e.length;o>r;r++)t[r]=l(e[r],n);return t}var i={};for(var s in e)null!=e[s]&&"parent"!==s&&(i[s]=l(e[s],n));return i}xn=function(n,r,o,i){return"string"==typeof n&&(n=e(n)),t(n,r,o,i)}}(),{parse:e,eval:n,varRefs:xn,evalStatements:function(t,r,o,i){for(var l=e(t).body,s=[],u=l.length,a=-1,c=new en;++a<u;)c.body.push(l[a]),null==l[a].join&&(s.push(n(c,r,o,i)),c.body.length=0);return s}}}(),Dom;!function(){function e(e){if(null==this.nodes)return void(this.nodes=[e]);this.nodes.push(e);var n=this.nodes[this.nodes.length-2];n.nextSibling=e}function n(e,n){this.type=Dom.NODE,this.tagName=e,this.parent=n,this.attr={}}function t(e,n){this.content=e,this.parent=n}function r(e,n,t){this.tagName=e,this.parent=n,this.controller=t,this.attr={}}function o(){}var i=1,l=2,s=3,u=4,a=9,c=10,f=15;n.prototype={constructor:n,type:i,tagName:null,parent:null,attr:null,nodes:null,expression:null,appendChild:e,stringify:null,__single:null},t.prototype={type:l,content:null,parent:null},r.prototype={constructor:r,type:u,parent:null,attr:null,controller:null,nodes:null,components:null,model:null,modelRef:null},o.prototype={constructor:o,type:s,nodes:null,appendChild:e},Dom={NODE:i,TEXTNODE:l,FRAGMENT:s,COMPONENT:u,CONTROLLER:a,SET:c,STATEMENT:f,Node:n,TextNode:t,Fragment:o,Component:r}}(),function(){function e(e,n,t,r){function o(e){return ExpressionUtil.eval(e,n,t,r)}if(o(e.expression))return e.nodes;for(;;){if(e=e.nextSibling,null==e||"else"!==e.tagName)break;var i=e.expression;if(null==i||""===i||o(i))return e.nodes}return null}custom_Statements["if"]={getNodes:e,render:function(n,t,r,o,i,l){var s=e(n,t,r,i);null!=s&&builder_build(s,t,r,o,i,l)}}}(),function(){function e(e){var n=function(){};return n.prototype={type:Dom.COMPONENT,compoName:e,renderEnd:s,dispose:u},n}function n(e,n,r,o,i,l,s,u){builder_build(t(r,e,n[0],n[1],n[2]),o,i,l,s,u)}function t(e,n,t,i,l){return"of"===l?is_Array(n)===!1?(log_error("<ForStatement> Value is not enumerable",n),null):r(e,n,t,i):"in"===l?"object"!=typeof n?(log_warn("<ForStatement> Value is not an object",n),null):(is_Array(n)&&log_warn("<mask:for> Consider to use `for..of` for Arrays"),o(e,n,t,i)):void 0}function r(e,n,t,r){for(var o,l=-1,s=n.length,u=new Array(s);++l<s;)o={},o[t]=n[l],r&&(o[r]=l),u[l]=i(d,e,o);return u}function o(e,n,t,r){var o,l,s,u=[],a=0;for(l in n)s=n[l],o={},o[t]=l,r&&(o[r]=s),u[a++]=i(h,e,o);return u}function i(e,n,t){return{type:Dom.COMPONENT,tagName:e,nodes:n,controller:{compoName:e,scope:t,renderEnd:s,dispose:u}}}function l(e,n){return{compoName:e,scope:n,renderEnd:s,dispose:u}}function s(e){this.elements=e}function u(){this.elements&&(this.elements.length=0)}function a(e){m=e,v=e.length,g=0;var n,t,r,o,i;if(i=c(),40===i&&(o=!0,g++,c()),n=f(),i=c(),44===i){if(o!==!0)return p("Parenthese must be used in multiple var declarion");g++,c(),t=f()}if(o){if(i=c(),41!==i)return p("Closing parenthese expected");g++}i=c();var r;return 105===i&&110===m.charCodeAt(++g)&&(r="in"),111===i&&102===m.charCodeAt(++g)&&(r="of"),null==r?p("Invalid FOR statement. (in|of) expected"):(_[0]=n,_[1]=t,_[2]=r,_[3]=m.substring(++g),_)}function c(){for(var e;v>g;g++)if(e=m.charCodeAt(g),!(33>e))return e;return-1}function f(){for(var e,n=g;v>g;g++)if(e=m.charCodeAt(g),e>48&&57>e){if(n===g)return p("Variable name begins with a digit")}else if(!(36===e||95===e||e>=97&&122>=e||e>=65&&90>=e))break;return n===g?p("Variable declaration expected"):m.substring(n,g)}function p(e){throw new Error("<ForStatement parser> "+e+" `"+m.substring(g,20)+"`")}var d="for..of/item",h="for..in/item";custom_Statements["for"]={render:function(e,t,r,o,i,l){a(e.expression);var s=ExpressionUtil.eval(_[3],t,r,i);null!=s&&n(s,_,e.nodes,t,r,o,i,l)},build:n,parseFor:a,createForItem:i,getNodes:t,getHandler:function(e,n){return l(e,n)}},custom_Tags[d]=e(d),custom_Tags[h]=e(h);var m,g,v,_=["prop1","prop2","in|of","expression"]}(),function(){function e(e,t,r,o,i,l){for(var s,u=t.length,a=-1,c=e;++a<u;)if(s=n(a,c,i),builder_build(c,t[a],r,o,s,l),null!=s.components){var f=i.components;null==f&&(f=i.components=[]),arr_pushMany(i.components,s.components)}}function n(e,n,t){return{type:Dom.COMPONENT,compoName:"each::item",scope:{index:e},parent:t,nodes:n,model:null,attr:null,components:null,elements:null,ID:null}}custom_Statements.each={render:function(n,t,r,o,i,l){var s=ExpressionUtil.eval(n.expression,t,r,i);null!=s&&e(n.nodes,s,r,o,i,l)},createItem:n,build:e}}(),custom_Statements["with"]={render:function(e,n,t,r,o,i){var l=ExpressionUtil.eval(e.expression,n,t,o);builder_build(e.nodes,l,t,r,o,i)}},function(){function e(e,t,r,o,i){if(null==t)return null;for(var l,s,u,a,c=t.length,f=-1;++f<c;)if(l=t[f],"default"!==l.tagName)if("case"===l.tagName)if(s=l.expression){if(n(s,r,o,i)==e){//! `==` comparison
u=l;break}}else log_warn("<mask:switch:case> Expression expected");else log_warn("<mask:switch> Case expected",l.tagName);else a=l;return null==u&&(u=a),null!=u?u.nodes:null}var n=ExpressionUtil.eval;custom_Statements["switch"]={render:function(t,r,o,i,l,s){var u=n(t.expression,r,o,l),a=e(u,t.nodes,r,o,l);null!=a&&builder_build(a,r,o,i,l,s)},getNodes:e}}(),function(){function e(e){this.parent=e,this.compoName="include",this.components=[],this.templates=null}custom_Statements.include={render:function(n,t,r,o,i,l){for(var s,u=ExpressionUtil.evalStatements(n.expression);null!=i&&(s=i.resource,null==s);)i=i.parent;var a=new e(i),c=Compo.pause(a,r);include.instance(s&&s.url).load.apply(s,u).done(function(e){a.templates=e.load,builder_build(n.nodes,t,r,o,a,l),c()})}}}(),custom_Statements["import"]={render:function(e,n,t,r,o,i){var l=e.expression,s=ExpressionUtil.evalStatements(l,n,t,o),u=s[0];if("string"!=typeof u)return void log_error("<mask:import> Invalid argument",l);for(;;){if("include"===o.compoName)break;if(o=o.parent,null==o)break}if(null!=o){var a=o.templates[u];null!=a&&builder_build(Parser.parse(a),n,t,r,o,i)}}},custom_Tags["var"]=VarStatement,VarStatement.prototype={renderStart:function(e,n){var t,r,o=this.parent,i=o.scope;null==i&&(i=o.scope={}),this.model={};for(t in this.attr)r=ExpressionUtil.eval(this.attr[t],e,n,o),this.model[t]=i[t]=r;this.attr={}},onRenderStartClient:function(){var e=this.parent,n=e.scope;null==n&&(n=e.scope={});for(var t in this.model)n[t]=this.model[t]}};var parser_parse,parser_ensureTemplateFunction,parser_setInterpolationQuotes,parser_cleanObject,Parser;!function(e,n,t){function r(e){for(var n=-1;-1!==(n=e.indexOf(s,n))&&e.charCodeAt(n+1)!==f;)n++;if(-1===n)return e;for(var t,r=e.length,i=[],l=0,c=0;;){if(t=o(e,n+2,r,f,p),-1===t)break;for(i[c++]=l===n?"":e.substring(l,n),i[c++]=e.substring(n+2,t),l=n=t+1;-1!==(n=e.indexOf(s,n))&&e.charCodeAt(n+1)!==f;)n++;if(-1===n)break}return r>l&&(i[c]=e.substring(l)),e=null,function(e,n,t,r,o,l){if(null==e){for(var c,f="",p=i.length,d=-1;++d<p;)c=i[d],f+=d%2===1?s+u+c+a:c;return f}return util_interpolate(i,e,n,t,r,o,l)}}var o,i,l,s="~",u="[",a="]",c=126,f=91,p=93;!function(){o=function(e,n,t,r,o){for(var l,s=0,u=n;t>n;n++)if(l=e.charCodeAt(n),34!==l&&39!==l)if(l!==r){if(l===o&&-1===--s)return n}else s++;else n=i(e,n+1,t,34===l?'"':"'");return parser_warn("Group was not closed",e,u),t},l=function(e,n,t){for(var r;t>n;)if(r=e.charCodeAt(n),36!==r&&95!==r){if(!(r>=48&&57>=r||r>=65&&90>=r||r>=97&&122>=r))break;n++}else n++;return n},i=function(e,n,t,r){for(var o=n;-1!==(n=e.indexOf(r,n));){if(92!==e.charCodeAt(n-1))return n;n++}return parser_warn("Quote was not closed",e,o),t}}();var d;!function(){function n(){var e=this.attr,n="var ";for(var t in e)"var "!==n&&(n+=","),n+=t+"="+e[t];return n+";"}d=function(t,r,s,u){var a,c,f=new e("var",u);f.stringify=n;for(var p,d=1,h=2,m=3,g=4,v=d;;)if(s>r&&(c=t.charCodeAt(r))<33)r++;else if(v!==d)if(v!==h)if(v!==m){if(v===g){if(44===c){v=d,r++;continue}break}}else{switch(a=r,r++,c){case 123:case 91:r=o(t,r,s,c,c+2);break;case 39:case 34:r=i(t,r,s,39===c?"'":'"');break;default:for(;s>r&&(c=t.charCodeAt(r),44!==c&&59!==c);)r++;r--}r++,f.attr[p]=t.substring(a,r),v=g}else{if(61!==c)return parser_error("Assignment expected",t,r,c,"var"),[f,r];v=m,r++}else a=r,r=l(t,r,s),p=t.substring(a,r),v=h;return[f,r]}}();var h=2,m=3,g=5,v=6,_=7,y=8,b=9;Parser={parse:function(i){for(var l,s,u,a,x,C,w,k,N=new t,A=N,E=h,j=m,O=0,T=i.length;;)if(T>O&&(C=i.charCodeAt(O))<33)O++;else{if(47===C){if(k=i.charCodeAt(O+1),47===k){for(O++;10!==C&&13!==C&&T>O;)C=i.charCodeAt(++O);continue}if(42===k){O=i.indexOf("*/",O+2)+2,1===O&&(O=T);continue}}if(j===g&&(null!=l&&(N.attr["class"]=r(l),l=null),null!=u&&(N.attr[u]=u,u=null,s=null)),null!=s){if(E===g)null==u?u=s:a=s,null!=u&&null!=a&&("class"!==u?N.attr[u]=a:l=null==l?a:l+" "+a,u=null,a=null);else if(j===m){if("var"===s){var S=d(i,O,T,N);N.appendChild(S[0]),O=S[1],E=h,s=null;continue}x=new e(s,N),N.appendChild(x),N=x,E=g}else if(j===y){if(x=new n(s,N),N.appendChild(x),N.__single===!0)do N=N.parent;while(null!=N&&null!=N.__single);E=h}s=null}if(O>=T){E===g&&(null!=l&&(N.attr["class"]=r(l)),null!=u&&(N.attr[u]=u)),C=null;break}if(E===b){for(N=N.parent;null!=N&&null!=N.__single;)N=N.parent;E=h}switch(C){case 123:j=E,E=h,O++;continue;case 62:j=E,E=h,O++,N.__single=!0;continue;case 59:if(null!=N.nodes){O++;continue}case 125:O++,j=E,E=b;continue;case 39:case 34:E===v?E=g:j=E=y,O++;var D=!1,L=!1,I=39===C?"'":'"';for(w=O;(O=i.indexOf(I,O))>-1&&92===i.charCodeAt(O-1);)D=!0,O++;-1===O&&(parser_warn("Literal has no ending",i,w),O=T),O===w&&(k=i.charCodeAt(O+1),(124===k||k===C)&&(L=!0,w=O+2,O=i.indexOf((124===k?"|":I)+I+I,w),-1===O&&(O=T))),s=i.substring(w,O),D===!0&&(s=s.replace(regexpEscapedChar[I],I)),s=r(s),O+=L?3:1;continue}if(E===h){if(j=m,E=m,46===C||35===C){s="div";continue}}else if(E===g)if(46===C)O++,u="class",E=_;else if(35===C)O++,u="id",E=_;else{if(61===C){O++,E=v,j===m&&null==u&&parser_warn("Unexpected tag assignment",i,O,C,E);continue}if(40===C){w=1+O,O=1+o(i,w,T,C,41),N.expression=i.substring(w,O-1),N.type=Dom.STATEMENT;continue}if(null!=u){s=u;continue}}(E===v||E===_)&&(j=E,E=g);var F=null;for(w=O;T>O;){if(C=i.charCodeAt(O),C===c&&i.charCodeAt(O+1)===f){F=!0,++O;do C=i.charCodeAt(++O);while(C!==p&&T>O)}if(j!==v&&(46===C||35===C))break;if(33>C||61===C||62===C||59===C||40===C||123===C||125===C)break;O++}if(s=i.substring(w,O),""===s){parser_warn("String expected",i,O,C,E);break}if(F===!0){if(E===m){parser_warn("Invalid interpolation (in tag name)",i,O,s,E);break}if(E===g)if("id"===u||j===v)s=r(s);else if("class"!==u){parser_warn("Invalid interpolation (in attr name)",i,O,s,E);break}}}C!==C&&parser_warn("IndexOverflow",i,O,C,E);var U=A.nodes;return null!=U&&1===U.length?U[0]:A},cleanObject:function(e){if(e instanceof Array){for(var n=0;n<e.length;n++)this.cleanObject(e[n]);return e}return delete e.parent,delete e.__single,null!=e.nodes&&this.cleanObject(e.nodes),e},setInterpolationQuotes:function(e,n){return e&&2===e.length?n&&1===n.length?(c=e.charCodeAt(0),f=e.charCodeAt(1),p=n.charCodeAt(0),s=e[0],u=e[1],void(a=n)):void log_error("Interpolation End must be of 1 Character"):void log_error("Interpolation Start must contain 2 Characters")},ensureTemplateFunction:r},parser_parse=Parser.parse,parser_ensureTemplateFunction=Parser.ensureTemplateFunction,parser_cleanObject=Parser.cleanObject,parser_setInterpolationQuotes=Parser.setInterpolationQuotes}(Dom.Node,Dom.TextNode,Dom.Fragment,Dom.Component);var builder_componentID=0,builder_build;!function(e,n,t){function r(e,n,t,r,i){var l=r.appendChild(document.createComment(""));return function(){return o(e,n,t,l,i)}}function o(n,t,r,o,i){null!=n.tagName&&n.tagName!==n.compoName&&(n.nodes={tagName:n.tagName,attr:n.attr,nodes:n.nodes,type:1}),null!=n.model&&(t=n.model);var l=n.nodes,s=[];if(null!=l){for(var u=l instanceof Array,a=u===!0?l.length:1,c=0,f=null,p=document.createDocumentFragment();a>c;c++)f=u===!0?l[c]:l,builder_build(f,t,r,p,n,s);o.parentNode.insertBefore(p,o)}if(null==n.tagName){var d,h,m=n.handlers&&n.handlers.attr;for(h in n.attr)d=null,m&&is_Function(m[h])&&(d=m[h]),null==d&&is_Function(e[h])&&(d=e[h]),null!=d&&d(o,n.attr[h],t,r,s[0],n)}if(is_Function(n.renderEnd))try{n.renderEnd(s,t,r,o.parentNode)}catch(g){console.error("Custom Tag Handler:",n.tagName,g)}if(null!=i&&i!==s)for(var v=i.length,_=s.length,y=-1;++y<_;)i[v+y]=s[y]}function i(e,n){return null==e.components?void(e.components=[n]):void e.components.push(n)}var l,s=function(){var e=function(e){return function(n,t){n.appendChild(e.createTextNode(t))}}(document);return function(n,t,r,o,i){var l=n.content;if(is_Function(l)){var s=l("node",t,r,o,i);if("string"==typeof s)return void e(o,s);for(var u,a="",c=s.length,f=0;c>f;f++)if(u=s[f],"object"!=typeof u)a+=u;else{if(""!==a&&(e(o,a),a=""),null==u.nodeType){a+=u.toString();continue}o.appendChild(u)}return void(""!==a&&e(o,a))}e(o,l)}}(),u=function(){var n=function(e){return function(n){return e.createElement(n)}}(document);return function(t,r,o,i,l,s){var u=t.tagName,a=t.attr,c=n(u);if(null!=c){null!=s&&(s.push(c),a["x-compo-id"]=l.ID),null!=i&&i.appendChild(c);var f,p;for(f in a)hasOwnProp.call(a,f)!==!1&&(is_Function(a[f])?(p=a[f]("attr",r,o,c,l,f),p instanceof Array&&(p=p.join(""))):p=a[f],p&&(is_Function(e[f])?e[f](t,p,r,o,c,l,i):c.setAttribute(f,p)));return c}}}();!function(){function e(e,n,t,o,l,s,u){var a,c;e.compoName=n.tagName,e.attr=a=attr_extend(e.attr,n.attr),e.parent=s,e.ID=++builder_componentID,null==e.model&&(e.model=t),null==e.nodes&&(e.nodes=n.nodes);for(c in a)"function"==typeof a[c]&&(a[c]=a[c]("attr",t,o,l,s,c));return listeners_emit("compoCreated",e,t,o,l),is_Function(e.renderStart)&&e.renderStart(t,o,l),i(s,e),e.async===!0?(e.await(r(e,t,o,l,u)),null):(null!=e.tagName&&(e.nodes={tagName:e.tagName,attr:e.attr,nodes:e.nodes,type:1}),"function"==typeof e.render?(e.render(e.model,o,l),null):e)}function t(e,n,t,r,o,l,s){var u,a,c,f=e.__Ctor,p=!1;if(f)c=new f(n,l);else{c=e;for(var d in n)c[d]=n[d];c.parent=l}var h=c.attr;if(null!=h)for(var d in h)"function"==typeof h[d]&&(h[d]=h[d]("attr",t,r,o,l,d));return is_Function(c.renderStart)&&c.renderStart(t,r,o,l,s),is_Function(c.render)&&(p=!0,u=c.render(t,r,o,l,s),arr_pushMany(s,u),is_Function(c.renderEnd)&&(a=c.renderEnd(u,t,r,o,l))),i(l,a||c),p?null:c}function o(e,n,t,r,o,l){e.ID=++builder_componentID,i(o,e),null==e.model&&(e.model=n);var s=e.elements=[];return builder_build(e.nodes,e.model,t,r,e,s),null!=l&&0!==s.length&&arr_pushMany(l,s),null}l=function(r,i,l,s,u,a){var c,f=r.tagName;if(null!=r.controller&&(c=r.controller),null==c&&(c=n[f]),null==c)return o(r,i,l,s,u,a);var p,d=!1;"function"==typeof c?p=new c(i):(p=c,d=!0);var h=d?t:e;return h(p,r,i,l,s,u,a)}}(),builder_build=function(r,o,i,a,c,f){if(null==r)return a;var p,d,h,m,g=r.type;if(null==c&&(c=new t),null==g&&(r instanceof Array?g=10:null!=r.tagName?g=1:null!=r.content&&(g=2)),1==g&&null!=n[r.tagName]&&(g=4),null==a&&1!==g&&(a=document.createDocumentFragment()),2===g)return s(r,o,i,a,c),a;if(10===g){for(h=0,m=r.length;m>h;h++)builder_build(r[h],o,i,a,c,f);return a}var v=r.tagName;if("else"===v)return a;if(15===g){var _=custom_Statements[v];if(null==_){if(null==n[v])return log_error("<mask: statement is undefined>",v),a;g=4}if(15===g)return _.render(r,o,i,a,c,f),a}if(1===g&&(a=u(r,o,i,a,c,f),f=null),4===g){if(c=l(r,o,i,a,c,f),null==c)return a;p=[],r=c,c.model!==o&&null!=c.model&&(o=c.model)}var y=r.nodes;if(null!=y){null!=f&&null==p&&(p=f);for(var b=y instanceof Array,x=b===!0?y.length:1,C=0,w=null;x>C;C++)w=b===!0?y[C]:y,builder_build(w,o,i,a,c,p)}if(4===g){if(null==r.tagName&&"%"!==r.compoName){var k,N,d,A=r.handlers&&r.handlers.attr;for(d in r.attr)N=r.attr[d],null!=N&&(k=null,null!=A&&is_Function(A[d])&&(k=A[d]),null==k&&null!=e[d]&&(k=e[d]),null!=k&&k(r,N,o,i,p[0],c))}is_Function(r.renderEnd)&&r.renderEnd(p,o,i,a)}return null!=f&&null!=p&&f!==p&&arr_pushMany(f,p),a}}(custom_Attributes,custom_Tags,Dom.Component);var mask_run;!function(){mask_run=function(){var e,n,t,r,o,i,l=_Array_slice.call(arguments);for(r=l.length,o=-1;++o<r;)i=l[o],i instanceof Node?e=i:is_Function(i)?t=i:is_Object(i)&&(n=i);null==e&&(e=document.body);var s=is_Function(t)?new t:new Dom.Component;s.ID=++builder_componentID;var u,a=document.getElementsByTagName("script"),c=!1;for(r=a.length,o=-1;++o<r;)if(u=a[o],"text/mask"===u.getAttribute("type")&&"true"===u.getAttribute("data-run")){var f=builder_build(parser_parse(u.textContent),n,{},null,s);u.parentNode.insertBefore(f,u),c=!0}return c===!1&&log_warn("No blocks found: <script type='text/mask' data-run='true'>...</script>"),is_Function(s.renderEnd)&&s.renderEnd(e,n),Compo.signal.emitIn(s,"domInsert"),s}}();var mask_merge;!function(){function e(e,r,o,i){if(is_Array(e))return n(e,r,o,i);switch(e.type){case a:return e;case u:return t(e,r,o,i);case c:return{type:e.type,nodes:n(e.nodes,r,o,i)}}return log_warn("Uknown type",e.type),null}function n(n,t,r,o){for(var i,l,a=[],c=n.length,f=-1;++f<c;)l=n[f],l.type===u&&l.tagName===s?null==i&&(i=e(n[f].nodes,t,r,o)):i=e(l,t,r,o),null!=i&&(is_Array(i)?a=a.concat(i):a.push(i));return a}function t(n,t,o,i){var s=n.tagName;if(64!==s.charCodeAt(0))return r(n,t,o,i);var u=n.attr.id;if("@placeholder"===s&&null==u)return o;null==u&&(u=s.substring(1));var a=t[u];return null==a?null:(a.parent&&l(i,a.parent),null==n.nodes?a.nodes:e(n.nodes,t.nodes,a,i))}function r(n,t,r,o){var i={tagName:n.tagName||n.compoName,attr:n.attr,type:n.type,controller:n.controller,parent:o};return n.nodes&&(i.nodes=e(n.nodes,t,r,i)),i}function o(e,n,t){if(null==n)return t;if(is_Array(n)){for(var r=n.length,l=-1;++l<r;)o(n===e?n[l]:e,n[l],t);return t}var s=n.type;if(s===a)return t;if(s===u){var c=n.tagName;if(null!=c&&64===c.charCodeAt(0)){var f=c.substring(1);t[f]={nodes:n.nodes,parent:i(e,n)}}}return o(e,n.nodes,t)}function i(e,n){if(n===e)return null;for(var t,r,o=n.parent;;){if(null==o)break;if(o===e&&e.type!==u)break;var i={type:o.type,tagName:o.tagName,attr:o.attr,controller:o.controller,expression:o.expression,nodes:null,parent:null};null==r?t=r=i:(t.parent=i,t=i),o=o.parent}return r}function l(e,n){for(var t=e,r=n;null!=t&&null!=r;){r.tagName&&(t.tagName=r.tagName),r.expression&&(t.expression=r.expression);for(var o in r.attr)t.attr[o]=r.attr[o];t=t.parent,r=r.parent}}mask_merge=function(n,t){"string"==typeof n&&(n=parser_parse(n)),"string"==typeof t&&(t=parser_parse(t));var r=o(t,t,{});return e(n,r)};var s="@else",u=Dom.NODE,a=Dom.TEXTNODE,c=Dom.FRAGMENT}();var cache={},Mask={render:function(e,n,t,r,o){return"string"==typeof e&&(e=hasOwnProp.call(cache,e)?cache[e]:cache[e]=parser_parse(e)),null==t&&(t={}),builder_build(e,n,t,r,o)},compile:parser_parse,parse:parser_parse,build:builder_build,run:mask_run,merge:mask_merge,registerHandler:customTag_register,getHandler:function(e){return null!=e?custom_Tags[e]:custom_Tags},registerStatement:function(e,n){custom_Statements[e]=is_Function(n)?{render:n}:n},getStatement:function(e){return null!=e?custom_Statements[e]:custom_Statements},registerAttrHandler:function(e,n,t){is_Function(n)&&(t=n),custom_Attributes[e]=t},getAttrHandler:function(e){return null!=e?custom_Attributes[e]:custom_Attributes},registerUtil:customUtil_register,getUtil:customUtil_get,$utils:customUtil_$utils,registerUtility:function(e,n){this.registerUtility=this.registerUtil,this.registerUtility(e,n)},getUtility:function(){return this.getUtility=this.getUtil,this.getUtility()},clearCache:function(e){"string"==typeof e?delete cache[e]:cache={}},Utils:{Expression:ExpressionUtil,getProperty:obj_getProperty,ensureTmplFn:Parser.ensureTemplateFunction},Dom:Dom,plugin:function(source){eval(source)},on:listeners_on,off:listeners_off,delegateReload:function(){},setInterpolationQuotes:Parser.setInterpolationQuotes,setCompoIndex:function(e){builder_componentID=e},cfg:function(){var e=arguments;if(0===e.length)return __cfg;var n;if(2===e.length)return n=e[0],void(__cfg[n]=e[1]);var t=e[0];if("object"==typeof t)for(n in t)__cfg[n]=t[n]}};Mask.renderDom=Mask.render,function(e){var n;!function(){function t(e){for(var n="";e--;)n+=" ";return n}function r(e,n,r){var i,l;null==n&&(n=0),null==r&&(i=!0,r=[]);var s=r.length;if(e.type===p.FRAGMENT&&(e=e.nodes),e instanceof Array)for(l=0;l<e.length;l++)o(e[l],n,r);else o(e,n,r);var u=t(n);for(l=s;l<r.length;l++)r[l]=u+r[l];return i?r.join(0===f?"":"\n"):void 0}function o(e,n,t){if("function"==typeof e.stringify)return void t.push(e.stringify(c));if("string"==typeof e.content)return void t.push(a(e.content));if("function"==typeof e.content)return void t.push(a(e.content()));if(l(e))return void t.push(i(e)+";");if(s(e)){var o=c?">":" > ";return t.push(i(e)+o),void r(u(e),f,t)}t.push(i(e)+"{"),r(e.nodes,f,t),t.push("}")}function i(e){var n=e.tagName,t=e.attr.id||"",r=e.attr["class"]||"";"function"==typeof t&&(t=t()),"function"==typeof r&&(r=r()),t&&(t=-1!==t.indexOf(" ")?"":"#"+t),r&&(r="."+r.split(" ").join("."));var o="";for(var i in e.attr)if("id"!==i&&"class"!==i){var l=e.attr[i];"function"==typeof l&&(l=l()),(c===!1||/[^\w_$\-\.]/.test(l))&&(l=a(l)),o+=" "+i,i!==l&&(o+="="+l)}"div"===n&&(t||r)&&(n="");var s="";return e.expression&&(s="("+e.expression+")"),n+t+r+o+s}function l(e){return null==e.nodes||e.nodes instanceof Array&&0===e.nodes.length}function s(e){return e.nodes&&(e.nodes instanceof Array==!1||1===e.nodes.length)}function u(e){return e.nodes instanceof Array?e.nodes[0]:e.nodes}function a(e){return-1===e.indexOf("'")?"'"+e.trim()+"'":-1===e.indexOf('"')?'"'+e.trim()+'"':'"'+e.replace(/"/g,'\\"').trim()+'"'}n=function(n,t){return null==n?"":("string"==typeof n&&(n=e.parse(n)),null==t?(f=0,c=!0):"number"==typeof t?(f=t,c=0===f):(f=t&&t.indent||4,c=0===f||t&&t.minimizeAttributes),r(n))};var c,f,p=e.Dom}(),e.stringify=n}(Mask),function(e){function n(){this.attr={"debugger":null,use:null,repeat:null,"if":null,"else":null,each:null,log:null,visible:null,model:null},this.model=null,this.modelRef=null,this.nodes=null,this.parent=null,this.container=null,this.template=null}function t(e,n,t,r){null==e.nodes&&Compo.ensureTemplate(e);var l=e.attr.each||e.attr.foreach,s=ExpressionUtil.eval(l,n,t,e),u=e.nodes;if(e.nodes=null,null!=s){"number"!=typeof s.length&&(s=obj_toDictionary(s)),e.nodes=[],e.model=s,e.modelRef=l,e.template=u,e.container=r;var a=s.length,c=-1;if(null!=a){for(;++c<a;)e.nodes[c]=o("%.each.item",u,s[c],c,r,e);e.append=i.append}}}function r(e,n,t,r){var i=e.attr.repeat.split(".."),l=(+i[0],+i[1]),s=e.nodes;e.nodes=[];for(var u=-1;++u<l;)e.nodes[u]=o("%.repeat.item",s,n,u,r,e)}function o(e,n,t,r,o,i){return{type:Dom.COMPONENT,compoName:e,attr:{},nodes:n,model:t,container:o,parent:i,index:r}}e.registerHandler("%",n),n.prototype={renderStart:function(e,n,o){var i=this.attr;if(null!=i.each||null!=i.foreach)return void t(this,e,n,o);if(null!=i["if"])return this.state=ExpressionUtil.eval(i["if"],e,n,this.parent),void(this.state||(this.nodes=null));if(null!=i["else"]){var l=this.parent.components,s=l&&l[l.length-1];return null!=s&&"%"===s.compoName&&null!=s.attr["if"]?void(s.state&&(this.nodes=null)):void throw_("`% else` should be after `% if='condition'`, got: "+(s&&(s.compoName||s.tagName)))}if(null!=i.use){var u=i.use;return this.model=obj_getProperty(e,u),void(this.modelRef=u)}if(null==i["debugger"]){if(null!=i.visible){var a=ExpressionUtil.eval(i.visible,e,n,this.parent);return void(a||(this.nodes=null))}if(null!=i.log){var c=i.log,f=obj_getProperty(e,c);return void console.log("Key: %s, Value: %s",c,f)}null!=i.repeat&&r(this,e,n,o)}},render:null,renderEnd:null,append:null};var i={append:function(n){var t=new Dom.Component;t.nodes=this.template,t.model=n,e.render(t,n,null,this.container,this)}}}(Mask),function(e){function n(){}function t(){}function r(){}var o={};e.templates=o,e.registerHandler(":template",n),n.prototype.render=function(){return null==this.attr.id?void log_warn("Template Should be defined with ID attribute for future lookup"):void(o[this.attr.id]=this.nodes)},e.registerHandler(":import",t),t.prototype={constructor:t,attr:null,template:null,renderStart:function(){if(this.attr.id){if(this.nodes=this.template,null==this.nodes&&(this.nodes=o[this.attr.id]),null==this.nodes){for(var e,n=this,t=":template[id="+this.attr.id+"]";null==e&&null!=(n=n.parent);)null!=n.nodes&&(e=jmask(n.nodes).filter(t).get(0));null!=e&&(this.nodes=e.nodes)}null==this.nodes&&log_warn("Template could be not imported",this.attr.id)}}},e.registerHandler(":html",r),r.prototype={mode:"server:all",render:function(e,n,t){var r=jmask(this.nodes).text(e,n,this);return r?t.insertAdjacentHTML?void t.insertAdjacentHTML("beforeend",r):void(this.toHtml=function(){return r}):void log_warn("No HTML for node",this)}}}(Mask),function(e){function n(){}custom_Tags.define=n,n.prototype={render:function(){var n;for(n in this.attr)break;var t=this.nodes;e.registerHandler(n,Compo({renderStart:function(){this.nodes=null==this.nodes?t:e.merge(t,this.nodes)}}))}}}(Mask);var Compo=exports.Compo=function(mask){function is_Function(e){return"function"==typeof e}function is_Object(e){return null!=e&&"object"==typeof e}function is_Array(e){return null!=e&&"object"==typeof e&&"number"==typeof e.length&&"function"==typeof e.splice}function is_String(e){return"string"==typeof e}function is_notEmptyString(e){return"string"==typeof e&&""!==e}function is_rawObject(e){return null==e?!1:"object"!=typeof e?!1:e.constructor===Object}function domLib_initialize(){null!=domLib&&null!=domLib.fn&&(domLib.fn.compo=function(e){if(0===this.length)return null;var n=Anchor.resolveCompo(this[0]);return null==e?n:find_findSingle(n,selector_parse(e,Dom.CONTROLLER,"up"))},domLib.fn.model=function(e){var n=this.compo(e);if(null==n)return null;for(var t=n.model;null==t&&n.parent;)n=n.parent,t=n.model;return t},function(){var e=["append","prepend","before","after"];arr_each(["appendMask","prependMask","beforeMask","afterMask"],function(n,t){domLib.fn[n]=function(n,r,o,i){if(0===this.length)return this;this.length>1,null==o&&(o=2>t?this.compo():this.parent().compo());var l=!1;null==o&&(o={},l=!0),null==o.components&&(o.components=[]);for(var s=o.components,u=s.length,a=mask.render(n,r,i,null,o),c=this[e[t]](a),f=s.length;f>u;u++)Compo.signal.emitIn(s[u],"domInsert");return c}})}(),function(){function e(e,n){node_tryDispose(n)}function n(e,n){node_tryDisposeChildren(n)}var t=domLib.fn.remove,r=domLib.fn.empty;domLib.fn.removeAndDispose=function(){return this.each(e),t.call(this)},domLib.fn.emptyAndDispose=function(){return this.each(n),r.call(this)}}())}function SlotHandler(){}var Dom=mask.Dom,_array_slice=Array.prototype.slice,_Array_slice=Array.prototype.slice,_Array_splice=Array.prototype.splice,_Array_indexOf=Array.prototype.indexOf,_mask_ensureTmplFnOrig=mask.Utils.ensureTmplFn,_mask_ensureTmplFn,_resolve_Ref,domLib,Class;!function(){function e(){for(var e,n=arguments.length;--n>-1;)if(e=_resolve_Ref(arguments[n]),null!=e)return e;return null}_mask_ensureTmplFn=function(e){return"string"!=typeof e?e:_mask_ensureTmplFnOrig(e)},_resolve_Ref=function(e){return n[e]||r[e]||t[e]};var n=global,t=global.atma||{},r=exports||{};domLib=e("jQuery","Zepto","$"),Class=e("Class")}(),Array.prototype.indexOf||(Array.prototype.indexOf=function(e){for(var n=0,t=this.length;t>n;n++)if(this[n]===e)return n;return-1});var obj_extend,obj_copy;!function(){obj_extend=function(e,n){if(null==e&&(e={}),null==n)return e;for(var t in n)e[t]=n[t];return e},obj_copy=function(e){var n,t={};for(n in e)t[n]=e[n];return t}}();var arr_each,arr_remove;!function(){arr_each=function(e,n){for(var t=e.length,r=-1;++r<t;)n(e[r],r)},arr_remove=function(e,n){if(null==e)return void log_error("Can not remove myself from parent",n);var t=e.indexOf(n);return-1===t?void log_error("Can not remove myself from parent",n):void e.splice(t,1)}}();var fn_proxy,fn_apply,fn_doNothing;!function(){fn_proxy=function(e,n){return function(){return fn_apply(e,n,arguments)}},fn_apply=function(e,n,t){switch(t.length){case 0:return e.call(n);case 1:return e.call(n,t[0]);case 2:return e.call(n,t[0],t[1]);case 3:return e.call(n,t[0],t[1],t[2]);case 4:return e.call(n,t[0],t[1],t[2],t[3])}return e.apply(n,t)},fn_doNothing=function(){return!1}}();var selector_parse,selector_match;!function(){function e(e){return function(t){return n(t,e)}}function n(e,t,r){if("string"!=typeof e)return!1;if(null==r&&(r=0),r=e.indexOf(t,r),-1===r)return!1;if(r>0&&e.charCodeAt(r-1)>32)return n(e,t,r+1);var o=e.length,i=t.length;return o-i>r&&e.charCodeAt(r+i)>32?n(e,t,r+1):!0}selector_parse=function(n,t,r){if(null==n&&log_error("<compo>selector is undefined",t),"object"==typeof n)return n;var o,i,l;if(null==o)switch(n[0]){case"#":o="id",n=n.substring(1),i="attr";break;case".":o="class",n=e(n.substring(1)),i="attr";break;default:o=t===Dom.SET?"tagName":"compoName"}return l="up"===r?"parent":t===Dom.SET?"nodes":"components",{key:o,prop:i,selector:n,nextKey:l}},selector_match=function(e,n,t){is_String(n)&&(null==t&&(t=Dom[e.compoName?"CONTROLLER":"SET"]),n=selector_parse(n,t));var r=n.prop?e[n.prop]:e;return null==r?!1:is_Function(n.selector)?n.selector(r[n.key]):null!=n.selector.test?n.selector.test(r[n.key]):r[n.key]==n.selector}}();var find_findSingle;!function(){find_findSingle=function(e,n){if(is_Array(e)){for(var t,r=e.length,o=-1;++o<r;)if(t=find_findSingle(e[o],n),null!=t)return t;return null}return selector_match(e,n)?e:(e=e[n.nextKey],null==e?null:find_findSingle(e,n))}}();var dom_addEventListener,node_tryDispose,node_tryDisposeChildren;!function(){dom_addEventListener=function(e,n,t){return null!=EventDecorator&&(n=EventDecorator(n)),null!=domLib?domLib(e).on(n,t):null!=e.addEventListener?e.addEventListener(n,t,!1):void(e.attachEvent&&e.attachEvent("on"+n,t))},node_tryDispose=function(e){if(e.hasAttribute("x-compo-id")){var n=e.getAttribute("x-compo-id"),t=Anchor.getByID(n);if(t){if(null==t.$||1===t.$.length)return compo_dispose(t),void compo_detachChild(t);var r=_Array_indexOf.call(t.$,e);-1!==r&&_Array_splice.call(t.$,r,1)}}node_tryDisposeChildren(e)},node_tryDisposeChildren=function(e){for(var n=e.firstChild;null!=n;)1===n.nodeType&&node_tryDispose(n),n=n.nextSibling}}();var domLib_find,domLib_on;!function(){domLib_find=function(e,n){return e.filter(n).add(e.find(n))},domLib_on=function(e,n,t,r){return null==t?e.on(n,r):(e.on(n,t,r).filter(t).on(n,r),e)}}();var compo_dispose,compo_detachChild,compo_ensureTemplate,compo_ensureAttributes,compo_attachDisposer,compo_removeElements,compo_prepairAsync,compo_errored,compo_meta_prepairAttributeHandler,compo_meta_executeAttributeHandler;!function(){compo_dispose=function(e){null!=e.dispose&&e.dispose(),Anchor.removeCompo(e);for(var n=e.components,t=n&&n.length||0;--t>-1;)compo_dispose(n[t])},compo_detachChild=function(e){var n=e.parent;if(null!=n){var t,r=e.$,o=n.$||n.elements;if(o&&r){var i,l,s=r.length;for(t=o.length;--t>-1;)for(i=o[t],l=s;--l>-1;)if(i===r[l]){o.splice(t,1);break}}var u=n.components;if(null!=u){for(t=u.length;--t>-1;)if(u[t]===e){u.splice(t,1);break}-1===t&&log_warn("<compo:remove> - i`m not in parents collection",e)}}},compo_ensureTemplate=function(e){if(null==e.nodes){null!=e.attr.template&&(e.template=e.attr.template,delete e.attr.template);var n=e.template;if(null!=n){if(is_String(n)){if(35===n.charCodeAt(0)&&/^#[\w\d_-]+$/.test(n)){var t=document.getElementById(n.substring(1));if(null==t)return void log_error("<compo> Template holder not found by id:",n);n=t.innerHTML}n=mask.parse(n)}"object"==typeof n&&(e.nodes=n)}}},compo_attachDisposer=function(e,n){if(null==e.dispose)return void(e.dispose=n);var t=e.dispose;e.dispose=function(){n.call(this),t.call(this)}},compo_removeElements=function(e){if(e.$)return void e.$.remove();var n=e.elements;if(n)for(var t=-1,r=n.length;++t<r;)n[t].parentNode&&n[t].parentNode.removeChild(n[t]);else{var o=e.components;if(o)for(var t=-1,r=o.length;++t<r;)compo_removeElements(o[t])}},compo_prepairAsync=function(e,n,t){var r=Compo.pause(n,t);e.then(r,function(e){compo_errored(n,e),r()})},compo_errored=function(e,n){e.nodes=mask.parse('.-mask-compo-errored > "~[.]"'),e.model=n.message||String(n),e.renderEnd=fn_doNothing},function(){function e(e){return function(n){var t,o,i,l,s=n.attr;for(t in e)if(o=e[t],i=s[t],l=o(n,i),null!=l)return r(n,l,t,i),!1;return!0}}function n(e,n,r,l){var s=63===n.charCodeAt(0),u=s?n.substring(1):n,a=u.replace(/-(\w)/g,t),c=r;return"string"==typeof r?c=o[r]:r instanceof RegExp?c=i.regexp(r):"function"==typeof r?c=r:null==r&&(c=i.any()),null==c?void log_error("Function expected for the attr. handler",n):(e[a]=null,e=null,void(l[u]=function(e,n){if(null==n)return s?null:Error("Expected");var t=c.call(e,n,e);return t instanceof Error?t:(e[a]=t,null)}))}function t(e,n){return n.toUpperCase()}function r(e,n,t,r){n.message=e.compoName+" - attribute `"+t+"`: "+n.message,compo_errored(e,n),log_error(n.message,". Current: ",r)}compo_meta_prepairAttributeHandler=function(t){null==t.meta&&(t.meta={});var r=t.meta.attributes,o=null;if(r){var i={};for(var l in r)n(t,l,r[l],i);o=e(i)}t.meta.handleAttributes=o},compo_meta_executeAttributeHandler=function(e){var n=e.meta&&e.meta.handleAttributes;return null==n?!0:n(e)};var o={string:function(e){return"string"==typeof e?e:Error("String")},number:function(e){var n=Number(e);return n===n?n:Error("Number")},"boolean":function(e){return"true"===e||"1"===e?!0:"false"===e||"0"===e?!1:Error("Boolean")}},i={regexp:function(e){return function(n){return e.test(n)?n:Error("RegExp")}},any:function(){return function(e){return e}}}}()}();var compo_create,compo_createConstructor;!function(){compo_create=function(e){var n,t,r=e.length,o=e[r-1];r>1&&compo_inherit(o,_Array_slice.call(e,0,r-1)),null==o&&(o={});var i=_resolve_Ref("include");null!=i&&(o.__resource=i.url);o.attr;for(t in o.attr)o.attr[t]=_mask_ensureTmplFn(o.attr[t]);var l=o.slots;for(t in l)"string"==typeof l[t]&&(l[t]=o[l[t]]);compo_meta_prepairAttributeHandler(o),n=o.hasOwnProperty("constructor")?o.constructor:function(){},n=compo_createConstructor(n,o);for(t in CompoProto)null==o[t]&&(o[t]=CompoProto[t]);return n.prototype=o,o=null,n},compo_createConstructor=function(e,n){var t=n.compos,r=n.pipes,o=n.attr;return null==t&&null==r&&null==n.attr?e:function(){null!=t&&(this.compos=obj_copy(this.compos)),null!=r&&Pipes.addController(this),null!=o&&(this.attr=obj_copy(this.attr)),null!=e&&e.call(this)}}}();var compo_inherit;!function(e){function n(i,l){var s,u;for(var a in l)if(s=l[a],null!=s&&"constructor"!==a)if(u=typeof s,null!=i[a])if("function"!==u)if("object"===u){switch(a){case"slots":case"pipes":case"events":case"attr":n(i[a],s);continue;case"nodes":i.nodes=s;continue}r(i[a],s)}else"template"===a&&(i[a]=e(s,i[a]));else i[a]=o(i[a],s);else i[a]="object"===u?t(s):s;null!=i.super&&log_error("`super` property is reserved. Dismissed. Current prototype",i),i.super=null}/*! Circular references are not handled */
function t(e){if(null==e)return null;if("object"!=typeof e)return e;if(is_Array(e)){for(var n=e.length,r=-1,o=new Array(n);++r<n;)o[r]=t(e[r]);return o}var i={};for(var l in e)i[l]=t(e[l]);return i}function r(e,n){var t,o,i;for(var i in n)t=e[i],o=n[i],null!=t?is_rawObject(t)&&is_rawObject(o)&&r(t,o):e[i]=o}function o(e,n){function t(){var e=r._fn||(r._fn=i(r._fn_chain));return e.apply(this,arguments)}if("compoInheritanceWrapper"===e.name)return e._fn_chain.push(n),e;var r=t;return r._fn_chain=[e,n],r._fn=null,r}function i(e){for(var n=e.length,t=e[--n];--n>-1;)t=l(e[n],t);return t}function l(e,n){return function(){this.super=n;var t=fn_apply(e,this,arguments);return this.super=null,t}}function s(e){var n=e.length;return function(){for(var t=n;--t>-1;)e[t].apply(this,arguments)}}compo_inherit=function(e,t){for(var r,o=t.length,i=o,l=[];--i>-1;)r=t[i],"string"==typeof r&&(r=Mask.getHandler(r)),null!=r?("function"==typeof r&&(l.push(r),r=r.prototype),n(e,r)):log_error("Base component not defined",t[i]);i=-1,o=l.length,o>0&&(e.hasOwnProperty("constructor")&&l.unshift(e.constructor),e.constructor=s(l))}}(mask.merge);var dfr_isBusy;!function(){dfr_isBusy=function(e){return null==e||"function"!=typeof e.then?!1:null!=this._resolved||null!=this._rejected}}();var Children_={select:function(e,n){for(var t in n){var r=n[t],o=null,i=null;if(r instanceof Array&&(i=r[0],o=r.splice(1)),"string"==typeof r&&(i=r),null==r||null==i)return log_error("Unknown component child",t,n[t]),void log_warn("Is this object shared within multiple compo classes? Define it in constructor!");var l=i.indexOf(":"),s=i.substring(0,l);s=Compo.config.selectors[s],null==s?e.compos[t]=e.$[0].querySelector(i):(i=i.substring(++l).trim(),e.compos[t]=s(e,i));var u=e.compos[t];null!=o&&(null!=u.$&&(u=u.$),Events_.on(e,o,u))}}},Events_={on:function(e,n,t){null==t&&(t=e.$);for(var r,o=n instanceof Array,i=o?n.length:1,l=0;o?i>l:1>l;l++)if(r=o?n[l]:n,r instanceof Array)null!=EventDecorator&&(r[0]=EventDecorator(r[0])),t.on.apply(t,r);else for(var s in r){var u,a,c="string"==typeof r[s]?e[r[s]]:r[s],f=s.indexOf(":");-1!==f?(u=s.substring(0,f),a=s.substring(f+1).trim()):u=s,null!=EventDecorator&&(u=EventDecorator(u)),domLib_on(t,u,a,fn_proxy(c,e))}}},EventDecorator=null,EventDecos=function(){var e=function(){if(null==document)return!1;if("createTouch"in document)return!0;try{return!!document.createEvent("TouchEvent").initTouchEvent}catch(e){return!1}}();return{touch:function(n){return e===!1?n:"click"===n?"touchend":"mousedown"===n?"touchstart":"mouseup"===n?"touchend":"mousemove"===n?"touchmove":n}}}(),Pipes=function(){function e(e,n){return function(t){new i(e).emit(n,t)}}function n(e,n){return null==n.pipes[e]?void log_error("Controller has no pipes to be added to collection",e,n):(null==l[e]&&(l[e]=[]),void l[e].push(n))}function t(e,n){for(var t=l[e],r=t.length;--r>-1;)t[r]===n&&t.splice(r,1)}function r(){var e=this,n=e.pipes;for(var r in n)t(r,e)}function o(e){var t=e.pipes;for(var o in t)n(o,e);Compo.attachDisposer(e,r.bind(e))}function i(e){return this instanceof i==!1?new i(e):(this.pipeName=e,this)}var l={};return mask.registerAttrHandler("x-pipe-signal","client",function(n,t,r,o,i){for(var l,s=t.split(";"),u=s.length,a=-1;++a<u;)if(l=s[a].trim(),""!==l){var c,f,p=l.indexOf(":"),d=l.substring(0,p),h=l.substring(p+1).trim(),m=h.indexOf(".");if(-1===m)return void log_error('define pipeName "click: pipeName.pipeSignal"');c=h.substring(0,m),f=h.substring(++m);var g=e(c,f);dom_addEventListener(i,d,g)}}),i.prototype={constructor:i,emit:function(e){var n,t=l[this.pipeName],r=this.pipeName;if(null!=t){2===arguments.length&&is_Array(arguments[1])?n=arguments[1]:arguments.length>1&&(n=_array_slice.call(arguments,1));for(var o,i,s,u,a=t.length;-1!==--a;)o=t[a],i=o.pipes[r],null!=i&&(s=i[e],is_Function(s)&&(s.apply(o,n),u=!0))}}},i.addController=o,i.removeController=r,{addController:o,removeController:r,pipe:i}}(),Anchor=function(){var e={};return{create:function(n){return null==n.ID?void log_warn("Component should have an ID"):void(e[n.ID]=n)},resolveCompo:function(n){if(null==n)return null;var t,r,o;do{if(r=n.getAttribute("x-compo-id"),r&&(null==t&&(t=r),o=e[r],null!=o&&(o=Compo.find(o,{key:"ID",selector:t,nextKey:"components"}),null!=o)))return o;n=n.parentNode}while(n&&1===n.nodeType);return null},removeCompo:function(n){null!=n.ID&&delete e[n.ID]},getByID:function(n){return e[n]}}}(),Compo,CompoProto;return function(){Compo=function(){return this instanceof Compo?void 0:compo_create(arguments)},obj_extend(Compo,{create:function(){return compo_create(arguments)},createClass:function(){var e=compo_create(arguments),n=e.prototype;return n.Construct=e,Class(n)},render:function(e,n,t,r){compo_ensureTemplate(e);var o=[];return mask.render(null==e.tagName?e.nodes:e,n,t,r,e,o),e.$=domLib(o),null!=e.events&&Events_.on(e,e.events),null!=e.compos&&Children_.select(e,e.compos),e},initialize:function(e,n,t,r,o){var i;null==r&&(t&&null!=t.nodeType?(r=t,t=null):n&&null!=n.nodeType&&(r=n,n=null)),"string"==typeof e&&(i=e,e=mask.getHandler(i),e||log_error("Compo not found:",e));var l={controller:e,type:Dom.COMPONENT,tagName:i};null==o&&null!=r&&(o=Anchor.resolveCompo(r)),null==o&&(o=new Dom.Component);var s=mask.render(l,n,t,null,o),u=o.components[o.components.length-1];return null!=r&&(r.appendChild(s),Compo.signal.emitIn(u,"domInsert")),u},find:function(e,n){return find_findSingle(e,selector_parse(n,Dom.CONTROLLER,"down"))},closest:function(e,n){return find_findSingle(e,selector_parse(n,Dom.CONTROLLER,"up"))},dispose:compo_dispose,ensureTemplate:compo_ensureTemplate,attachDisposer:compo_attachDisposer,config:{selectors:{$:function(e,n){var t=domLib_find(e.$,n);return t},compo:function(e,n){var t=Compo.find(e,n);return t}},setDOMLibrary:function(e){domLib!==e&&(domLib=e,domLib_initialize())},eventDecorator:function(e){return"function"==typeof e?void(EventDecorator=e):"string"==typeof e?void(EventDecorator=EventDecos[e]):"boolean"==typeof e&&e===!1?void(EventDecorator=null):void 0}},pipe:Pipes.pipe,resource:function(e){for(var n=e;null!=n;){if(n.resource)return n.resource;n=n.parent}return include.instance()},plugin:function(source){eval(source)},Dom:{addEventListener:dom_addEventListener}}),function(){function e(e,n,t){return null==e[n]&&(e[n]=[]),e[n].push(t),e}function n(e,n,t){var r=e[n];if(null!=r)for(var o,i=0,l=r.length;l>i;i++)o=r[i],null!=o&&(r[i]=null,null!=t?o.apply(this,t):o())}var t={done:function(n){return e(this,"_cbs_done",n)},fail:function(n){return e(this,"_cbs_fail",n)},always:function(n){return e(this,"_cbs_always",n)},resolve:function(){this.async=!1,n(this,"_cbs_done",arguments),n(this,"_cbs_always",arguments)},reject:function(){this.async=!1,n(this,"_cbs_fail",arguments),n(this,"_cbs_always")},_cbs_done:null,_cbs_fail:null,_cbs_always:null},r={async:!0,await:function(e){this.resume=e}};Compo.pause=function(e,n){return null==n.async&&(n.defers=[],obj_extend(n,t)),n.async=!0,n.defers.push(e),obj_extend(e,r),function(){Compo.resume(e,n)}},Compo.resume=function(e,n){e.resume&&e.resume(),e.async=!1;for(var t,r=!1,o=n.defers,i=o.length,l=-1;++l<i;)t=o[l],t!==e?r=r||null!=t:o[l]=null;r===!1&&n.resolve()}}(),CompoProto={type:Dom.CONTROLLER,__resource:null,tagName:null,compoName:null,nodes:null,components:null,attr:null,model:null,slots:null,pipes:null,compos:null,events:null,async:!1,await:null,meta:{mode:null,modelMode:null,attributes:null},onRenderStart:null,onRenderEnd:null,render:null,renderStart:function(e,n,t){if(1===arguments.length&&null!=e&&e instanceof Array==!1&&null!=e[0]){var r=arguments[0];e=r[0],n=r[1],t=r[2]}if(null==this.nodes&&compo_ensureTemplate(this),compo_meta_executeAttributeHandler(this)!==!1&&is_Function(this.onRenderStart)){var o=this.onRenderStart(e,n,t);void 0!==o&&dfr_isBusy(o)&&compo_prepairAsync(o,this,n)}},renderEnd:function(e,n,t,r){if(1===arguments.length&&e instanceof Array==!1){var o=arguments[0];e=o[0],n=o[1],t=o[2],r=o[3]}Anchor.create(this,e),this.$=domLib(e),null!=this.events&&Events_.on(this,this.events),null!=this.compos&&Children_.select(this,this.compos),is_Function(this.onRenderEnd)&&this.onRenderEnd(e,n,t,r)},appendTo:function(e){var n="string"==typeof e?document.querySelector(e):e;if(null==n)return log_warn("Compo.appendTo: parent is undefined. Args:",arguments),this;for(var t=this.$,r=0,o=t.length;o>r;r++)n.appendChild(t[r]);return this.emitIn("domInsert"),this},append:function(e,n,t){var r;if(null==this.$){var o="string"==typeof e?mask.compile(e):e;return r=t?find_findSingle(this,selector_parse(t,Dom.CONTROLLER,"down")):this,null==r.nodes?(this.nodes=o,this):(r.nodes=[this.nodes,o],this)}var i=mask.render(e,n,null,null,this);return r=t?this.$.find(t):this.$,r.append(i),this.emitIn("domInsert"),this},find:function(e){return find_findSingle(this,selector_parse(e,Dom.CONTROLLER,"down"))},closest:function(e){return find_findSingle(this,selector_parse(e,Dom.CONTROLLER,"up"))},on:function(){var e=_array_slice.call(arguments);return arguments.length<3?(log_error("Invalid Arguments Exception @use .on(type,selector,fn)"),this):(null!=this.$&&Events_.on(this,[e]),null==this.events?this.events=[e]:is_Array(this.events)?this.events.push(e):this.events=[e,this.events],this)},remove:function(){return compo_removeElements(this),compo_detachChild(this),compo_dispose(this),this.$=null,this},slotState:function(e,n){return Compo.slot.toggle(this,e,n),this},signalState:function(e,n){return Compo.signal.toggle(this,e,n),this},emitOut:function(e){return Compo.signal.emitOut(this,e,this,arguments.length>1?_array_slice.call(arguments,1):null),this},emitIn:function(e){return Compo.signal.emitIn(this,e,this,arguments.length>1?_array_slice.call(arguments,1):null),this}},Compo.prototype=CompoProto}(),function(){function e(n,t,r,o,i){if(null==n)return!1;var l=!1,s=null!=n.slots&&n.slots[t];if("string"==typeof s&&(s=n[s]),"function"==typeof s){l=!0;var u=null!=n.slots.__disabled&&n.slots.__disabled[t];if(u!==!0){var a=null==o?s.call(n,r):s.apply(n,[r].concat(o));if(a===!1)return!0;null!=a&&"object"==typeof a&&null!=a.length&&(o=a)}}if(-1===i&&null!=n.parent)return e(n.parent,t,r,o,i)||l;if(1===i&&null!=n.components)for(var c,f=n.components,p=f.length,d=0;p>d;d++)c=e(f[d],t,r,o,i),!l&&(l=c);return l}function n(e,t,r,o){if(null==e)return!1;var i=e.slots;if(null!=i&&null!=i[t]&&("string"==typeof i[t]&&(i[t]=e[i[t]]),"function"==typeof i[t])){if(o!==!0)return!0;if(null==i.__disabled||i.__disabled[t]!==!0)return!0}if(-1===r&&null!=e.parent)return n(e.parent,t,r);if(1===r&&null!=e.components)for(var l=0,s=e.components.length;s>l;l++)if(n(e.components[l],t,r))return!0;return!1}function t(t,r){return n(t,r,-1)===!1?null:function(n){var o=arguments.length>1?_array_slice.call(arguments,1):null;e(t,r,n,o,-1)}}function r(e,n,t){var r=e.slots;null!=r&&r.hasOwnProperty(n)!==!1&&(null==r.__disabled&&(r.__disabled={}),r.__disabled[n]=t===!1)}function o(e,n,t){if(r(e,n,t),null!=e.components)for(var i=0,l=e.components.length;l>i;i++)o(e.components[i],n,t)}function i(e,n,t){return null==e.$?void log_warn("Controller has no elements to toggle state"):void domLib().add(e.$.filter("[data-signals]")).add(e.$.find("[data-signals]")).each(function(e,r){var o=r.getAttribute("data-signals");null!=o&&-1!==o.indexOf(n)&&r[t===!0?"removeAttribute":"setAttribute"]("disabled","disabled")})}function l(e,n,t){for(var l=e,s=e;null!=(l=l.parent);)r(l,n,t),null!=l.$&&0!==l.$.length&&(s=l);o(e,n,t),i(s,n,t)}function s(e,t,o){r(e,t,o),(o||!n(e,t,-1,!0)&&!n(e,t,1,!0))&&i(e,t,o)}mask.registerAttrHandler("x-signal","client",function(e,n,r,o,i,l){for(var s,u=n.split(";"),a="",c=u.length,f=-1;++f<c;)if(s=u[f].trim(),""!==s){var p=s.indexOf(":"),d=s.substring(0,p),h=s.substring(p+1).trim(),m=t(l,h);m&&(a+=","+h+",",dom_addEventListener(i,d,m))}""!==a&&i.setAttribute("data-signals",a)}),obj_extend(Compo,{signal:{toggle:l,emitOut:function(n,t,r,o){e(n,t,r,o,-1)},emitIn:function(n,t,r,o){e(n,t,r,o,1)},enable:function(e,n){l(e,n,!0)},disable:function(e,n){l(e,n,!1)}},slot:{toggle:s,enable:function(e,n){s(e,n,!0)},disable:function(e,n){s(e,n,!1)},invoke:function(e,n,t,r){var o=e.slots;return null==o||"function"!=typeof o[n]?(log_error("Slot not found",n,e),null):null==r?o[n].call(e,t):o[n].apply(e,[t].concat(r))}}})}(),domLib_initialize(),mask.registerHandler(":slot",SlotHandler),SlotHandler.prototype={constructor:SlotHandler,renderEnd:function(){this.slots={},this.expression=this.attr.on,this.slots[this.attr.signal]=this.handle},handle:function(){var e=this.expression;mask.Utils.Expression.eval(e,this.model,global,this)}},Compo}(Mask),jmask=exports.jmask=Mask.jmask=function(e){function n(e){return"string"!=typeof e?e:p(e)}function t(e,n){if(null==e&&(e={}),null==n)return e;for(var t in n)e[t]=n[t];return e}function r(e,n){for(var t,r=i(e),o=-1,l=r?e.length:1;++o<l;)t=r?e[o]:e,n(t,o)}function o(e,n){if(null==e)return void console.error("Can not remove myself from parent",n);var t=e.indexOf(n);return-1===t?void console.error("Can not remove myself from parent",n,t):void e.splice(t,1)}function i(e){return null!=e&&"object"==typeof e&&null!=e.length&&"function"==typeof e.slice}function l(e){return this instanceof l==!1?new l(e):null==e?this:e.type===a.SET?e:this.add(e)}var s,u,a=e.Dom,c=e.render,f=e.parse,p=e.Utils.ensureTmplFn,d=(global.Compo||e.Compo||Compo).signal.emitIn,h=function(){function e(e,t){return e===t?(n=!0,0):1}var n=!1;return function(t){var r,o,i,l;if(n=!1,t.sort(e),n===!1)return t;for(r=[],o=0,i=0,l=t.length-1;l>o;)t[o++]===t[o]&&(r[i++]=o);for(;i--;)t.splice(r[i],1);return t}}();!function(){function e(e){return function(t){return n(t,e)}}function n(e,t,r){if("string"!=typeof e)return!1;if(null==r&&(r=0),r=e.indexOf(t,r),-1===r)return!1;if(r>0&&e.charCodeAt(r-1)>32)return n(e,t,r+1);var o=e.length,i=t.length;return o-i>r&&e.charCodeAt(r+i)>32?n(e,t,r+1):!0}function t(e,n,t){for(var r,o=!1,i=!1;t>n&&(r=e.charCodeAt(n),(34===r||39===r)&&(o=!o),92===r&&(i=!i),!(46===r||35===r||91===r||93===r||62===r||33>r)||o===!0||i===!0);)n++;return n}s=function(n,s,u){if(null==n&&log_error("selector is null for the type",s),"object"==typeof n)return n;var c,f,p,d,h,m,g,v,_,y,b,x=0,C=n.length;for(c="up"===u?r:s===a.SET?o:i;C>x;)h=n.charCodeAt(x),33>h?x++:62!==h?(m=t(n,x+1,C),46===h?(f="class",p=l,d=e(n.substring(x+1,m))):35===h?(f="id",p=l,d=n.substring(x+1,m)):91===h?(y=n.indexOf("=",x),p=l,f=n.substring(x+1,y),h=n.charCodeAt(y+1),b=34===h||39===h?2:1,d=n.substring(y+b,m-b+1),m++):(null!=g&&(g.next={type:"any",matcher:null},_=g,g=null),p=null,f=s===a.SET?"tagName":"compoName",d=n.substring(x,m)),x=m,null!=g?(null==g.filters&&(g.filters=[]),g.filters.push({key:f,selector:d,prop:p})):(g={key:f,prop:p,selector:d,nextKey:c,filters:null},null==v&&(v=g),null!=_&&(_.next.matcher=g))):(null==g?v=g={selector:"__scope__",nextKey:c,filters:null,next:{type:"children",matcher:null}}:g.next={type:"children",matcher:null},_=g,g=null,x++);return _&&_.next&&(_.next.matcher=g),v},u=function(e,n,t){if("string"==typeof n&&(null==t&&(t=a[e.compoName?"CONTROLLER":"SET"]),n=s(n,t)),"*"===n.selector)return!0;var r=n.prop?e[n.prop]:e,o=!1;if(null==r)return!1;if("function"==typeof n.selector?o=n.selector(r[n.key]):null!=n.selector.test?n.selector.test(r[n.key])&&(o=!0):r[n.key]===n.selector&&(o=!0),o===!0&&null!=n.filters)for(var i,l=0,c=n.filters.length;c>l;l++)if(i=n.filters[l],u(e,i,t)===!1)return!1;return o};var r="parent",o="nodes",i="components",l="attr"}();var m,g,v,_,y;return function(){m=function(e,n){if(null==n)return e;var t=[];return r(e,function(e){u(e,n)&&t.push(e)}),t},g=function(e,n,t,o){return null==e?t:(null==t&&(t=[]),null==o&&("__scope__"===n.selector?(o=!1,n=n.next.matcher):o=!0),r(e,function(e){if(u(e,n)===!1)return void(null==n.next&&o!==!1&&g(e[n.nextKey],n,t,o));if(null==n.next)return t.push(e),void(o===!0&&g(e[n.nextKey],n,t,o));var r=n.next;o="children"!==r.type,g(e[n.nextKey],r.matcher,t,o)}),t)},v=function(e,n){var r={type:1,tagName:1,compoName:1,controller:1},o={parent:n};for(var i in e)1===r[i]&&(o[i]=e[i]);e.attr&&(o.attr=t({},e.attr));var l=e.nodes;if(null!=l&&l.length>0){o.nodes=[];for(var s=l instanceof Array,u=s===!0?l.length:1,a=0;u>a;a++)o.nodes[a]=v(s===!0?l[a]:l,o)}return o},_=function(e){for(var n,t=e;null!=t;)n=t,t=t.nodes&&t.nodes[0];return n},y=function(e,n,t,r){if(a.TEXTNODE===e.type)return"function"==typeof e.content?e.content("node",n,t,null,r):e.content;var o="";if(null!=e.nodes)for(var i,l=0,s=e.nodes.length;s>l;l++)i=e.nodes[l],o+=y(i,n,t,r);return o}}(),l.prototype={constructor:l,type:a.SET,length:0,components:null,add:function(e){var n,t;if("string"==typeof e&&(e=f(e)),i(e)){for(n=0,t=e.length;t>n;n++)this.add(e[n]);return this}"function"==typeof e&&null!=e.prototype.type&&(e={controller:e,type:a.COMPONENT});var r=e.type;if(!r)return console.error("Only Mask Node/Component/NodeText/Fragment can be added to jmask set",e),this;if(r===a.FRAGMENT){var o=e.nodes;for(n=0,t=o.length;t>n;)this[this.length++]=o[n++];return this}if(r===a.CONTROLLER){if(null!=e.nodes&&e.nodes.length)for(n=e.nodes.length;0!==n;)e.nodes[--n].parent=e;null!=e.$&&(this.type=a.CONTROLLER)}return this[this.length++]=e,this},toArray:function(){return Array.prototype.slice.call(this)},render:function(e,n,t,r){if(this.components=[],1===this.length)return c(this[0],e,n,t,r||this);null==t&&(t=document.createDocumentFragment());for(var o=0,i=this.length;i>o;o++)c(this[o],e,n,t,r||this);return t},prevObject:null,end:function(){return this.prevObject||this},pushStack:function(e){var n;return n=l(e),n.prevObject=this,n},controllers:function(){return null==this.components&&console.warn("Set was not rendered"),this.pushStack(this.components||[])},mask:function(n){var t;if(null!=n)return this.empty().append(n);if(arguments.length)return this;if(0===this.length)t=new a.Node;else if(1===this.length)t=this[0];else{t=new a.Fragment,t.nodes=[];for(var r=-1;++r<this.length;)t.nodes[r]=this[r]}return e.stringify(t)},text:function(e,n,t){if("string"==typeof e&&1===arguments.length){for(var r,o=[new a.TextNode(e)],i=0,l=this.length;l>i;i++)r=this[i],r.nodes=o;return this}for(var r,s="",i=0,l=this.length;l>i;i++)r=this[i],s+=y(r,e,n,t);return s}},r(["append","prepend"],function(e){l.prototype[e]=function(n){for(var t,r,o=l(n),i=0,s=this.length;s>i;i++){r=this[i],t=o.toArray();for(var u=0,a=t.length;a>u;u++)t[u].parent=r;r.nodes=null!=r.nodes?"append"===e?r.nodes.concat(t):t.concat(r.nodes):t}return this}}),r(["appendTo"],function(e){l.prototype[e]=function(e,n,t,r){return null==r&&(r=this),null!=e.nodeType&&"function"==typeof e.appendChild?(e.appendChild(this.render(n,t,null,r)),d(r,"domInsert"),this):(l(e).append(this),this)}}),function(){function e(e){for(var n,t,r=e.split(";"),o={},i=0,l=r.length;l>i;i++)t=r[i],n=t.indexOf(":"),o[t.substring(0,n).trim()]=t.substring(n+1).trim();return o}function o(e){var n=[],t=0;for(var r in e)n[t++]=r+":"+e[r];return n.join(";")}r(["add","remove","toggle","has"],function(e){l.prototype[e+"Class"]=function(n){var t,r,o,i,l,s=this.length,u=0;if("string"!=typeof n){if("remove"===e)for(;s>u;u++)this[0].attr["class"]=null;return this}for(;s>u;u++)if(i=this[u],null!=i.attr){if(l=i.attr["class"],null==l)l=n;else{for(l=" "+l+" ",null==t&&(t=n.split(" "),o=t.length),r=0;o>r;r++)if(t[r]){var a=l.indexOf(" "+t[r]+" ")>-1;if("has"!==e)a!==!1||"add"!==e&&"toggle"!==e?a!==!0||"remove"!==e&&"toggle"!==e||(l=l.replace(" "+t[r]+" "," ")):l+=t[r]+" ";else if(a)return!0}l=l.trim()}"has"!==e&&(i.attr["class"]=l)}return"has"===e?!1:this}}),r(["attr","removeAttr","prop","removeProp"],function(e){l.prototype[e]=function(t,r){if(!t)return this;for(var o,i=this.length,l=0,s=arguments.length;i>l;l++)switch(o=this[l],e){case"attr":case"prop":if(1===s){if("string"==typeof t)return o.attr[t];for(var u in t)o.attr[u]=n(t[u])}else 2===s&&(o.attr[t]=n(r));break;case"removeAttr":case"removeProp":o.attr[t]=null}return this}}),t(l.prototype,{tag:function(e){if("string"==typeof e){for(var n=0,t=this.length;t>n;n++)this[n].tagName=e;return this}return this[0]&&this[0].tagName},css:function(n,t){var r,i,l,s=arguments.length,u=this.length,a=0;if(1===s&&"string"==typeof n)return 0===u?null:"string"==typeof this[0].attr.style?e(this[0].attr.style)[n]:null;for(;u>a;a++)if(l=this[a].attr.style,"function"!=typeof l){if(1===s&&"object"==typeof n){if(null==l){this[a].attr.style=o(n);continue}r=e(l);for(i in n)r[i]=n[i];this[a].attr.style=o(r)}if(2===s){if(null==l){this[a].attr.style=n+":"+t;continue}r=e(l),r[n]=t,this[a].attr.style=o(r)}}return this}})}(),t(l.prototype,{clone:function(){for(var e=[],n=0,t=this.length;t>n;n++)e[n]=v(this[0]);return l(e)},wrap:function(e){var n,t=l(e),r=[];if(0===t.length)return console.log("Not valid wrapper",e),this;for(var o=0,i=this.length;i>o;o++){n=i>0?t.clone():t,_(n[0]).nodes=[this[o]],r[o]=n[0];var s=this[o].parent&&this[o].parent.nodes;if(null!=s)for(var u=0,a=s.length;a>u;u++)if(s[u]===this[o]){s.splice(u,1,r[o]);break}}return l(r)},wrapAll:function(e){var n=l(e);return 0===n.length?(console.error("Not valid wrapper",e),this):(this.parent().mask(n),_(n[0]).nodes=this.toArray(),this.pushStack(n))}}),r(["empty","remove"],function(e){l.prototype[e]=function(){for(var n,t=0,r=this.length;r>t;t++)n=this[t],"empty"!==e?"remove"!==e||null!=n.parent&&o(n.parent.nodes,n):n.nodes=null;return this}}),t(l.prototype,{each:function(e,n){for(var t=0;t<this.length;t++)e.call(n||this,this[t],t);return this},eq:function(e){return-1===e?this.slice(e):this.slice(e,e+1)},get:function(e){return 0>e?this[this.length-e]:this[e]},slice:function(){return this.pushStack(Array.prototype.slice.apply(this,arguments))}}),r(["filter","children","closest","parent","find","first","last"],function(e){l.prototype[e]=function(n){var t,r,o=[],i=null==n?null:s(n,this.type,"closest"===e?"up":"down");switch(e){case"filter":return l(m(this,i));case"children":for(t=0;t<this.length;t++)r=this[t],null!=r.nodes&&(o=o.concat(null==i?r.nodes:m(r.nodes,i)));break;case"parent":for(t=0;t<this.length;t++)r=this[t].parent,!r||r.type===a.FRAGMENT||i&&u(r,i)||o.push(r);h(o);break;case"closest":case"find":if(null==i)break;for(t=0;t<this.length;t++)g(this[t][i.nextKey],i,o);break;case"first":case"last":var c;for(t=0;t<this.length;t++)if(c="first"===e?t:this.length-t-1,r=this[c],null==i||u(r,i)){o[0]=r;break}}return this.pushStack(o)}}),l}(Mask);return function(e,n){function t(e,n){return function(){return e.apply(n,arguments)}}function r(e){return e.parentNode.removeChild(e)}function o(e){if(null!=e)for(var n=e.length,t=-1;++t<n;)r(e[t])}function i(e,n){return n.parentNode.insertBefore(e,n.nextSibling)}function l(e,n){return n.parentNode.insertBefore(e,n)}function s(e,n,t,r){if(null==e.components)return i(t,r||e.placeholder);var o,s=e.components,u=null,a=!0,c=s.length,f=n-1;if(null==u)for(;++f<c;)if(o=s[f].elements,o&&o.length){u=o[0];break}if(null==u)for(a=!1,f=c>n?n:c;--f>-1;)if(o=s[f].elements,o&&o.length){u=o[o.length-1];break}return null==u&&(u=r||e.placeholder),a?l(t,u):i(t,u)}function u(n,t,r,o,i){return e.render(t,r,o,i,n)}function a(e,n){if(null==e)return!1;null!=e.elements&&(o(e.elements),e.elements=null),A.dispose(e);var t=n&&n.components||e.parent&&e.parent.components;return null==t?(console.error("Parent Components Collection is undefined"),!1):L(t,e)}function c(e){A.signal.emitIn(e,"domInsert")}function f(e,n){if("function"==typeof e.dispose){var t=e.dispose;return void(e.dispose=function(){n.call(this),t.call(this)})}e.dispose=n}function p(){}function d(){}function h(){}function m(e,n){if(null==n&&(n=[]),null==e.components)return n;for(var t,r=e.components,o=0,i=r.length;i>o;o++)t=r[o],"validate"!==t.compoName?m(t):n.push(t);return n}var g,v,_,y,b,x,C,w,k,N=global.jQuery||global.Zepto||global.$,A="undefined"!=typeof n?n:e.Compo||global.Compo,E=A.Dom.addEventListener,j=e.registerHandler,O=e.registerAttrHandler,T=e.registerUtil,S=Array.prototype.slice;!function(){function e(e,n){for(var t,r=-1,o=n.length-1;++r<o;)t=n[r],null==e[t]&&(e[t]={}),e=e[t];return e}function n(n,r,o,i){var l=i.length,s=l>1?e(n,i):n,u=i[l-1],a=s[u];return l>1&&t(n,i),"length"===u&&D(s)?(U(s,function(e,n,t,r){for(var i=o.length,l=-1;++l<i;)o[l](e,n,t,r)}),a):(Object.defineProperty(s,u,{get:function(){return a},set:function(e){var n=0,t=o.length;if(e!==a){if(a=e,D(e))for(n=0;t>n;n++)U(e,o[n]);if(null!=o.__dirties)return void(o.__dirties[r]=1);for(n=0;t>n;n++)o[n](e)}},configurable:!0,enumerable:!0}),a)}function t(e,n){for(var t,i=o(e),l="",s=0,u=n.length-1;u>s;s++)t=n[s],l+=t+".",r(l,e,t,i),e=e[t]}function r(e,n,t,r){var o,i=n[t];Object.defineProperty(n,t,{get:function(){return i},set:function(n){n!==i&&(o=i,i=n,r(e,o))},configurable:!0,enumerable:!0})}function o(e){return function(n,t){var r=e.__observers;if(null!=r)for(var o in r)if(0===o.indexOf(n)){var i=r[o].slice(0),l=i.length,s=0;if(0!==l){var u,a,c=g(e,o);for(s=0;l>s;s++)u=i[s],b(e,o,u),a=o.substring(n.length),b(t,a,u);for(s=0;l>s;s++)i[s](c);for(s=0;l>s;s++)_(e,o,i[s])}}}}function i(e,n,t){null==e.__observers&&Object.defineProperty(e,"__observers",{value:{__dirty:null},enumerable:!1});var r=e.__observers;return null!=r[n]?-1===F(r[n],t)&&r[n].push(t):r[n]=[t],r[n]}g=function(e,n){for(var t=n.split("."),r=t.length,o=-1;++o<r;){if(null==e)return null;e=e[t[o]]}return e},v=function(e,n,t){for(var r,o=n.split("."),i=o.length-1,l=-1;++l<i;)r=o[l],null==e[r]&&(e[r]={}),e=e[r];e[o[l]]=t},_=function(e,t,r){for(var o=t.split("."),l=o.length,s=-1,u=e;++s<l&&(u=u[o[s]],null!=u);)if(null!=u.__observers){var a=o.slice(s+1).join(".");if(u.__observers[a]){i(u,a,r);var c=i(e,t,r);if(1===c.length){var f=o.splice(0,s);0!==f.length&&n(e,t,c,f,!0)}return}}var c=i(e,t,r);1===c.length&&n(e,t,c,o,!0);var p=g(e,t);D(p)&&U(p,r)},y=function(e,n,t){for(var r=n.split("."),o=r.length,i=-1,l=e;++i<o&&(l=l[r[i]],null!=l);)if(null!=l.__observers){if(y(l,r.slice(i).join("."),t))return!0;break}var s=e.__observers;return null==s||null==s[n]?!1:-1!==F(s[n],t)},b=function(e,n,t){for(var r=n.split("."),o=r.length,i=-1,l=e;++i<o&&(l=l[r[i]],null!=l);)if(null!=l.__observers){b(l,r.slice(i).join("."),t);break}var s=e.__observers;if(null!=s&&null!=s[n]){var u=g(e,n);if(2===arguments.length)return void(s[n].length=0);L(s[n],t),D(u)&&$(u,t)}},x=function(e){if(D(e))return void M(e);var n=e.__observers;null!=n&&(n.__dirties={})},C=function(e){if(D(e))return void R(e);var n=e.__observers,t=null==n?null:n.__dirties;if(null!=t){for(var r in t){var o=e.__observers[r],i=g(e,r);if(null!=o)for(var l=0,s=o.length;s>l;l++)o[l](i)}n.__dirties=null}},w=function(e,n){if(null==n)return e;null==e&&(e={});for(var t in n)e[t]=n[t];return e},k=function(e,n){if(null==e)return!1;for(var t=n.split("."),r=t.length,o=-1;++o<r;)if(null==(e=e[t[o]]))return!1;return!0}}();var D,L,I,F,U,$,M,R;!function(){function e(e,t,r){return function(){return n(e,t,r,S.call(arguments))}}function n(e,n,t,r){var o=e.__observers&&e.__observers.__array,i=n.apply(e,r);if(null==o||0===o.length)return i;if(null!=e.__observers.__dirty)return e.__observers.__dirty=!0,i;for(var l,s=0,u=o.length;u>s;s++)l=o[s],"function"==typeof l&&l(e,t,r,i);return i}D=function(e){return null!=e&&"object"==typeof e&&null!=e.length&&"function"==typeof e.splice},L=function(e){if(null==e)return!1;for(var n,t=0,r=e.length,o=1,i=arguments.length,l=0;r>t;t++)for(n=e[t],o=1;i>o;o++)if(arguments[o]===n){e.splice(t,1),t--,r--,l++;break}return l+1===i},U=function(n,t){null==n.__observers&&Object.defineProperty(n,"__observers",{value:{__dirty:null},enumerable:!1});var r=n.__observers.__array;if(null==r&&(r=n.__observers.__array=[]),0===r.length)for(var o,i,l=0,s=["push","unshift","splice","pop","shift","reverse","sort","remove"],u=s.length;u>l;l++)i=s[l],o=n[i],null!=o&&(n[i]=e(n,o,i));r[r.length++]=t},$=function(e,n){var t=e.__observers&&e.__observers.__array;if(null!=t)for(var r=0,o=t.length;o>r;r++)if(t[r]===n){t[r]=null;for(var i=r;o>i;i++)t[i]=t[i+1];o--,t.length--}},M=function(e){null!=e.__observers&&(e.__observers.__dirty=!1)},R=function(e){var n=e.__observers,t=n&&n.__array;if(null!=t&&n.__dirty===!0){for(var r,o=0,i=t.length;i>o;o++)r=t[o],"function"==typeof r&&r(e);n.__dirty=null}},I=function(e,n){for(var t=0,r=e.length;r>t;t++)n(e[t])},F=function(e,n){return e.indexOf(n)}}();var P,H,B,V,W,z,K;!function(){function n(e,n,r,o,i){if(null!=o){var l=typeof o,s=t(n,r,o,l);if(null!=s){var u="object"===l?o.ref:o;e(s,u,i)}}}function t(e,n,t,r){if("object"===r){var i=o(t.accessor,e,null,n);return null==i||"object"!=typeof i?(log_error("Binding failed to an object over accessor",t),null):i}if(null==t||"$c"===t)return null;if(k(e,t))return e;if(k(n,t))return n;for(var l,s=n;null!=s;){if(l=s.scope,null!=l&&k(l,t))return l;s=s.parent}return e}var r=e.Utils.Expression,o=r.eval;z=r.parse,K=r.varRefs,P=function(e,n,t,r){if("."===e)return n;var i=o(e,n,t,r);return null==i?"":i},H=function(e,t,r,o,i){if("."===e)return void(D(t)&&U(t,i));var l=z(e),s=K(l,t,r,o);if(null!=s){if("string"==typeof s)return void n(_,t,o,s,i);for(var u,a=null!=s.length&&"function"==typeof s.splice,c=a===!0?s.length:1,f=0;c>f;f++)u=a===!0?s[f]:s,n(_,t,o,u,i)}},B=function(e,t,r,o){if("function"==typeof r&&log_warn("[mask.binding] - expression unbind(expr, model, controller, callback)"),"."===e)return void $(t,o);var i,l=K(e,t,null,r);if(null!=l){if("string"==typeof l)return void n(b,t,r,l,o);for(var i,s=null!=l.length&&"function"==typeof l.splice,u=s===!0?l.length:1,a=0;u>a;a++)i=s===!0?l[a]:l,n(b,t,r,i,o)}},V=function(e,n,t,r,o){var i=0;return function(){if(++i>1)return i=0,void log_warn("<mask:bind:expression> Concurent binder detected",e);var l=P(e,n,t,r);if(arguments.length>1){var s=S.call(arguments);s[0]=l,o.apply(this,s)}else o(l);i--}},W=function(e){var n=0;return function(){return++n>1?(n=0,void log_warn("<mask:listener:expression> concurent binder")):(e(),void n--)}}}();var Q,G;!function(){Q=function(e,n,t){for(var r,o,i,l,s=e.split(";"),u=[],a=0,c=s.length;c>a;a++)r=s[a].split(":"),1===r.length||2===r.length?(i=2==r.length?r[0]:t,o=r[2==r.length?1:0],l=G(o.trim(),i,n),null!=l&&u.push(l)):console.error('Too much ":" in a signal def.',s[a]);return u},G=function(e,n,t){if(t!==!0)return{signal:e,type:n};var r=e.indexOf(".");return-1===r?(console.error("No pipe name in a signal",e),null):{signal:e.substring(r+1),pipe:e.substring(0,r),type:n}}}();var X=function(){function n(e,n,t,r){null==r&&(r=":bind"===t.compoName?"single":"dual");var o,l=t.attr;if(this.node=t,this.controller=t,this.model=e,this.element=n,this.value=l.value,this.property=l.property,this.setter=l.setter,this.getter=l.getter,this.dismiss=0,this.bindingType=r,this.log=!1,this.signal_domChanged=null,this.signal_objectChanged=null,this.locked=!1,null==this.property&&null==this.getter)switch(n.tagName){case"INPUT":if(o=n.getAttribute("type"),"checkbox"===o){this.property="element.checked";break}this.property="element.value";break;case"TEXTAREA":this.property="element.value";break;case"SELECT":this.domWay=i.SELECT;break;default:this.property="element.innerHTML"}if(l.log&&(this.log=!0,"log"!==l.log&&(this.logExpression=l.log)),l["x-signal"]){var s=Q(l["x-signal"],null,"dom")[0],u=s&&s.type;switch(u){case"dom":case"object":this["signal_"+u+"Changed"]=s.signal;break;default:console.error("Signal typs is not supported",s)}}if(l["x-pipe-signal"]){var s=Q(l["x-pipe-signal"],!0,"dom")[0],u=s&&s.type;switch(u){case"dom":case"object":this["pipe_"+u+"Changed"]=s;break;default:console.error("Pipe type is not supported")}}if(l["dom-slot"]){this.slots={};var a=t.parent,c=a.parent;a.parent=this,this.parent=c,this.slots[l["dom-slot"]]=function(e,n){this.domChanged(e,n)}}var f=l["object-pipe-slot"]||l["x-pipe-slot"];if(f){var p=f,d=p.indexOf("."),h=p.substring(0,d),s=p.substring(d+1);this.pipes={},this.pipes[h]={},this.pipes[h][s]=function(){this.objectChanged()},A.pipe.addController(this)}if(l.expression){if(this.expression=l.expression,null==this.value&&"single"!==r){var m=K(this.expression);"string"==typeof m?this.value=m:console.warn("Please set value attribute in DualBind Control.")
}}else this.expression=this.value}function t(e){var n=e.expression,t=e.model,r=e.objectChanged=e.objectChanged.bind(e);if(e.binder=V(n,t,e.cntx,e.node,r),H(n,t,e.cntx,e.node,e.binder),"dual"===e.bindingType){var o=e.node.attr;if(!o["change-slot"]&&!o["change-pipe-event"]){var i=e.element,l=o["change-event"]||o.changeEvent||"change",s=e.domChanged.bind(e);E(i,l,s)}if(!e.objectWay.get(e,e.expression))return setTimeout(function(){e.domWay.get(e)&&e.domChanged()}),e}return e.objectChanged(),e}function r(e,n,t){var o=e.slots;(null==o||"function"!=typeof o[n]||o[n].apply(e,t)!==!1)&&null!=e.parent&&r(e.parent,n,t)}var o={};e.registerBinding=function(e,n){o[e]=n},e.BindingProvider=n,n.create=function(e,t,r,i){var l,s=r.attr.bindingProvider,u=null==s?null:o[s];return"function"==typeof u?new u(e,t,r,i):(l=new n(e,t,r,i),null!=u&&w(l,u),l)},n.bind=function(e){return t(e)},n.prototype={constructor:n,dispose:function(){B(this.expression,this.model,this.controller,this.binder)},objectChanged:function(e){if(!(this.dismiss-->0)){if(this.locked===!0)return void console.warn("Concurance change detected",this);if(this.locked=!0,null==e&&(e=this.objectWay.get(this,this.expression)),this.domWay.set(this,e),this.log&&console.log("[BindingProvider] objectChanged -",e),this.signal_objectChanged&&r(this.node,this.signal_objectChanged,[e]),this.pipe_objectChanged){var n=this.pipe_objectChanged;A.pipe(n.pipe).emit(n.signal)}this.locked=!1}},domChanged:function(e,n){if(this.locked===!0)return void console.warn("Concurance change detected",this);this.locked=!0;var t=n||this.domWay.get(this),o=!0;if(this.node.validations)for(var i,l=0,s=this.node.validations.length;s>l;l++)if(i=this.node.validations[l],i.validate(t,this.element,this.objectChanged.bind(this))===!1){o=!1;break}if(o&&(this.dismiss=1,this.objectWay.set(this.model,this.value,t),this.dismiss=0,this.log&&console.log("[BindingProvider] domChanged -",t),this.signal_domChanged&&r(this.node,this.signal_domChanged,[t]),this.pipe_domChanged)){var u=this.pipe_domChanged;A.pipe(u.pipe).emit(u.signal)}this.locked=!1},objectWay:{get:function(e,n){return P(n,e.model,e.cntx,e.controller)},set:function(e,n,t){v(e,n,t)}},domWay:{get:function(e){if(e.getter){var n=e.node.parent;return n[e.getter]()}return g(e,e.property)},set:function(e,n){if(e.setter){var t=e.node.parent;t[e.setter](n)}else v(e,e.property,n)}}};var i={SELECT:{get:function(e){var n=e.element;return-1===n.selectedIndex?"":n.options[n.selectedIndex].getAttribute("name")},set:function(e,n){for(var t,r=e.element,o=0,i=r.options.length;i>o;o++)if(t=r.options[o],t.getAttribute("name")==n)return void(r.selectedIndex=o)}}};return w(n,{addObserver:_,removeObserver:b}),n}();j(":visible",p),p.prototype={constructor:p,refresh:function(e,n){n.style.display=P(this.attr.check,e)?"":"none"},renderStart:function(e,n,t){this.refresh(e,t),this.attr.bind&&_(e,this.attr.bind,this.refresh.bind(this,e,t))}},function(){function e(){}j(":bind",e),e.prototype={constructor:e,renderEnd:function(e,n,t,r){this.provider=X.create(n,r,this,"single"),X.bind(this.provider)},dispose:function(){this.provider&&"function"==typeof this.provider.dispose&&this.provider.dispose()}}}(),j(":dualbind",d),d.prototype={constructor:d,renderEnd:function(n,t,r,o){if(this.provider=X.create(t,o,this),this.components)for(var i,l=0,s=this.components.length;s>l;l++)i=this.components[l],":validate"===i.compoName&&(this.validations||(this.validations=[])).push(i);if(!this.attr["no-validation"]&&!this.validations){var u=t.Validate,a=this.provider.value;if(null==u&&-1!==a.indexOf(".")){for(var c=a.split("."),l=0,f=c.length,p=t[c[0]];null==u&&++l<f&&p;)u=p.Validate,p=p[c[l]];a=c.slice(l).join(".")}var d=u&&u[a];"function"==typeof d&&(d=e.getHandler(":validate").createCustom(o,d),(this.validations||(this.validations=[])).push(d))}X.bind(this.provider)},dispose:function(){this.provider&&"function"==typeof this.provider.dispose&&this.provider.dispose()},handlers:{attr:{"x-signal":function(){}}}},function(){function t(){}function r(e,n){this.fn=e,this.message=n}function o(e,n,t){console.warn("Validate Notification:",e,n);var r=N(e).next("."+l);return 0===r.length&&(r=N("<div>").addClass(l).html("<span></span><button>cancel</button>").insertAfter(e)),r.children("button").off().on("click",function(){r.hide(),t&&t()}).end().children("span").text(n).end().show()}function i(e){return N(e).next("."+l).hide()}var l="-validate-invalid";e.registerValidator=function(e,n){s[e]=n},j(":validate",t),t.prototype={constructor:t,attr:{},renderStart:function(e,n,o){if(this.element=o,this.attr.value){var i=t.resolveFromModel(e,this.attr.value);i&&(this.validators=[new r(i)])}},validate:function(e,n,t){null==n&&(n=this.element),this.attr&&(null==e&&this.attr.getter&&(e=g({node:this,element:n},this.attr.getter)),null==e&&this.attr.value&&(e=g(this.model,this.attr.value))),null==this.validators&&this.initValidators();for(var r,o=0,i=this.validators.length;i>o;o++)if(r=this.validators[o].validate(e),r&&!this.attr.silent)return this.notifyInvalid(n,r,t),!1;return this.makeValid(n),!0},notifyInvalid:function(e,n,t){return o(e,n,t)},makeValid:function(e){return i(e)},initValidators:function(){this.validators=[];for(var e in this.attr){switch(e){case"message":case"value":case"getter":continue}if(e in s!=!1){var n=s[e];this.validators.push(new r(n(this.attr[e],this),this.attr.message))}else console.error("Unknown Validator:",e,this)}}},t.resolveFromModel=function(e,n){return g(e.Validate,n)},t.createCustom=function(e,n){var o=new t;return o.element=e,o.validators=[new r(n)],o},r.prototype.validate=function(e){var n=this.fn(e);return n===!1?this.message||"Invalid - "+e:n},j(":validate:message",n({template:"div."+l+' { span > "~[bind:message]" button > "~[cancel]" }',onRenderStart:function(e){"string"==typeof e&&(e={message:e}),e.cancel||(e.cancel="cancel"),this.model=e},compos:{button:"$: button"},show:function(e,n){var t=this;this.model.message=e,this.compos.button.off().on(function(){t.hide(),n&&n()}),this.$.show()},hide:function(){this.$.hide()}}));var s={match:function(e){return function(n){return new RegExp(e).test(n)}},unmatch:function(e){return function(n){return!new RegExp(e).test(n)}},minLength:function(e){return function(n){return n.length>=parseInt(e,10)}},maxLength:function(e){return function(n){return n.length<=parseInt(e,10)}},check:function(e,n){return function(t){return P("x"+e,n.model,{x:t},n)}}}}(),j(":validate:group",h),h.prototype={constructor:h,validate:function(){for(var e,n=m(this),t=0,r=n.length;r>t;t++)if(e=n[t],!e.validate())return!1;return!0}},function(){function e(e,n,t){return e?null==n||""===n?e+" "+t:e.replace(n,t):t}function n(e){return function(n){e.textContent=n}}function t(n,t,r){return function(o){var i=n.getAttribute(t),l=e(i,r,o);n.setAttribute(t,l),r=o}}function r(n,t,r){return function(o){switch(typeof n[t]){case"boolean":return void(r=n[t]=!!o);case"number":return void(r=n[t]=Number(o));case"string":return void(r=n[t]=e(n[t],r,o));default:return void console.warn("Unsupported elements property type",t)}}}function o(e,o,i,l,s){if("node"===e)return n(i);if("attr"===e){switch(s){case"value":case"disabled":case"checked":case"selected":case"selectedIndex":return r(i,s,l)}return t(i,s,l)}throw Error("Unexpected binder type: "+e)}function i(e,n,t,r,i,l,s,u){var a=o(u,n,i,e,s),c=V(n,t,r,l,a);H(n,t,r,l,c),f(l,function(){B(n,t,l,c)})}T("bind",{mode:"partial",current:null,element:null,nodeRenderStart:function(e,n,t,r,o){var i=P(e,n,t,o);return this.element=document.createTextNode(i),this.current=i},node:function(e,n,t,r,o){return i(this.current,e,n,t,this.element,o,null,"node"),this.element},attrRenderStart:function(e,n,t,r,o){return this.current=P(e,n,t,o)},attr:function(e,n,t,r,o,l){return i(this.current,e,n,t,r,o,l,"attr"),this.current}})}(),O("xx-visible",function(e,n,t,r,o,i){var l=V(n,t,r,i,function(e){o.style.display=e?"":"none"});H(n,t,r,i,l),f(i,function(){B(n,t,i,l)}),P(n,t,r,i)||(o.style.display="none")}),O("x-toggle","client",function(e,n,t,r,o,i){var l=n.substring(0,n.indexOf(":")),s=n.substring(l.length+1),u=K(s);"string"!=typeof u&&(u=u[0]),E(o,l,function(){var e=P(s,t,r,i);v(t,u,e)})}),O("x-class-toggle","client",function(e,n,t,r,o){var i=n.substring(0,n.indexOf(":")),l=n.substring(i.length+1).trim();E(o,i,function(){N(o).toggleClass(l)})}),function(e){function t(){this.attr={"debugger":null,use:null,log:null,"if":null,each:null,visible:null}}e.registerHandler("%%",t);var r=function(){var e={refresh:function(e){this.model=e,this.elements&&(o(this.elements),this.elements=[]),null!=A&&A.dispose(this),l(u(this,this.nodes,this.model,this.cntx),this.placeholder)},dispose:function(){B(this.expr,this.originalModel,this,this.binder)}};return function(n,t,r,o){var i=n.attr.use;w(n,{expr:i,placeholder:document.createComment(""),binder:V(i,t,r,n,e.refresh.bind(n)),originalModel:t,model:P(i,t,r,n),dispose:e.dispose}),H(i,t,r,n,n.binder),o.appendChild(n.placeholder)}}(),i=function(){return function(e,n,t){function r(e){console.log("Logger > Key: %s, Value: %s",o,e)}var o=e.attr.log,i=V(o,n,t,e,r),l=P(o,n,t,e);H(o,n,t,e,i),f(e,function(){B(o,n,e,i)}),r(l)}}(),p=function(){function e(e,n){return function(){return e.apply(n,arguments)}}var n={refresh:function(e){(null!=this.elements||e)&&(null==this.elements?(l(u(this,this.template,this.model,this.cntx),this.placeholder),this.$=N(this.elements)):(null==this.$&&(this.$=N(this.elements)),this.$[e?"show":"hide"]()),this.onchange&&this.onchange(e))},dispose:function(){B(this.expr,this.model,this,this.binder),this.onchange=null,this.elements=null}};return function(t,r,o,i){var l=t.attr["if"];w(t,{expr:l,template:t.nodes,placeholder:document.createComment(""),binder:V(l,r,o,t,e(n.refresh,t)),state:!!P(l,r,o,t)}),t.state||(t.nodes=null),H(l,r,o,t,t.binder),i.appendChild(t.placeholder)}}(),d=function(){var e={refresh:function(e){if(null!=this.elements||!e){if(null==this.elements)return l(u(this,this.template,this.model,this.cntx)),void(this.$=N(this.elements));null==this.$&&(this.$=N(this.elements)),this.$[e?"hide":"show"]()}}};return function(n,t,r,o){var i=n.parent.components,l=i&&i[i.length-1];n.template=n.nodes,n.placeholder=document.createComment(""),l.onchange=e.refresh.bind(n),l.state&&(n.nodes=null),o.appendChild(n.placeholder)}}(),h=function(){function t(e,n){var t=[];if(null==n||"object"!=typeof n||null==n.length)return t;for(var r,o=0,i=n.length;i>o;o++){switch(r=n[o],typeof r){case"string":case"number":case"boolean":r=n[o]=Object(r)}t[o]=new p(e.template,r,e)}return t}function r(e,n){for(var t=e.components,r=0,o=t.length,i=0,s=null,u=null,a=null,c=document.createDocumentFragment(),f=[];o>r;r++)if(a=t[r],null!=a.elements&&0!==a.elements.length)for(i=0,s=a.elements.length;s>i;i++)u=a.elements[i],u.parentNode.removeChild(u);e:for(i=0,s=n.length;s>i;i++){for(r=0;o>r;r++)if(n[i]===t[r].model){f[i]=t[r];continue e}console.warn("No Model Found for",n[i])}for(r=0,o=f.length;o>r;r++)if(a=f[r],null!=a.elements&&0!==a.elements.length)for(i=0,s=a.elements.length;s>i;i++)u=a.elements[i],c.appendChild(u);e.components=f,l(c,e.placeholder)}function o(e,n,r,o,i){if(null!=n&&null!=r){var l=n,p=n+r;for(p>e.components.length&&(p=e.components.length);p>l;l++)a(e.components[l],e)&&(l--,p--)}if(null!=o&&i&&i.length){var d=new f,h=t(e,i),m=u(d,h),g=d.components;s(e,o,m),c(d),null==e.components&&(e.components=[]),e.components.splice.apply(e.components,[o,0].concat(g))}}function i(e,n){for(var t,r=e.components,o=r.length;--o>-1;)t=r[o],-1!==n.indexOf(t.model)&&a(t,e)}var f=e.Dom.Component,p=function(){function e(e,n,t){this.nodes=e,this.model=n,this.parent=t}var n=f.prototype;e.prototype={compoName:"%%.each.item",constructor:d,renderEnd:function(e){this.elements=e}};for(var t in n)e.prototype[t]=n[t];return e}(),d={append:function(n){var t=new p(this.template,n,this);e.render(t,n,null,this.container,this)}},h={refresh:function(e,n,s,f){var p,d,h=0;if(null==n){if(null!=this.components)for(h=0,d=this.components.length;d>h;h++)p=this.components[h],a(p,this)&&(h--,d--);return this.components=[],this.nodes=t(this,e),l(u(this,this.nodes),this.placeholder),void I(this.components,c)}for(d=e.length;d>h;h++)switch(p=e[h],typeof p){case"string":case"number":case"boolean":e[h]=Object(p)}switch(n){case"push":o(this,null,null,e.length,e.slice(e.length-1));break;case"pop":o(this,e.length,1);break;case"unshift":o(this,null,null,0,e.slice(0,1));break;case"shift":o(this,0,1);break;case"splice":var m=s[0],g=1===s.length?this.components.length:s[1],v=s.length>2?e.slice(s[0],s.length-2+s[0]):null;o(this,m,g,m,v);break;case"sort":case"reverse":r(this,e);break;case"remove":null!=f&&f.length&&i(this,f)}},dispose:function(){B(this.expr,this.model,this,this.refresh)}};return function(e,r,o,i){null==e.nodes&&"undefined"!=typeof n&&n.ensureTemplate(e);var l=e.attr.each||e.attr.foreach,s=P(l,r,o,e);w(e,{expr:l,binder:V(l,r,o,e,h.refresh.bind(e)),template:e.nodes,container:i,placeholder:document.createComment(""),dispose:h.dispose}),i.appendChild(e.placeholder),H(e.expr,r,o,e,e.binder);for(var u in d)e[u]=d[u];e.nodes=t(e,s)}}(),m=function(){var e={refresh:function(){if(this.refreshing!==!0){this.refreshing=!0;for(var e=P(this.expr,this.model,this.cntx,this),n=0,t=this.elements.length;t>n;n++)this.elements[n].style.display=e?"":"none";this.refreshing=!1}},dispose:function(){B(this.expr,this.model,this,this.binder)}};return function(n,t,r){var o=n.attr.visible;w(n,{expr:o,binder:V(o,t,r,n,e.refresh.bind(n)),dispose:e.dispose}),H(o,t,r,n,n.binder),e.refresh.call(n)}}();t.prototype={constructor:t,elements:null,renderStart:function(e,n,t){var o=this.attr;if(null==o["debugger"])return null!=o.use?void r(this,e,n,t):null!=o.log?void i(this,e,n,t):(this.model=e,null!=o["if"]?void p(this,e,n,t):null!=o["else"]?void d(this,e,n,t):void((null!=o.each||null!=o.foreach)&&h(this,e,n,t)))},render:null,renderEnd:function(e){this.elements=e,null!=this.attr.visible&&m(this,this.model,this.cntx)}}}(e),function(){var r,i,u,f,p,d=e.getStatement();!function(){r=function(e,n,t,r,o){return d[e].getNodes(n,t,r,o)},i=function(e,n,t,r,o,i){if(null==e)return null;var l=[];return builder_build(e,n,t,r,o,l),null==i?l:(arr_pushMany(i,l),l)},u=function(e,n){e.placeholder=document.createComment(""),n.appendChild(e.placeholder)},f=function(e,n,r,o,i,l){e.parent=l,e.model=r,e.refresh=t(e.refresh,e),e.binder=V(e.expr,r,o,l,e.refresh),H(e.expr,r,o,l,e.binder)},p=function(e,n){if(null!=e)for(var t,r="function"==typeof e.splice,o=r?e.length:1,i=-1;++i<o;)t=r?e[i]:e,t.style.display=n?"":"none"}}(),function(){function n(){}function o(e,n,r,o,i,l,s,u){for(e.model=i,e.ctx=l,e.controller=u,e.refresh=t(e.refresh,e),e.binder=W(e.refresh),e.index=r,e.Switch=[{node:n,elements:null}],H(n.expression,i,l,u,e.binder);;){if(n=n.nextSibling,null==n||"else"!==n.tagName)break;e.Switch.push({node:n,elements:null}),n.expression&&H(n.expression,i,l,u,e.binder)}null!=r&&(e.Switch[r].elements=o)}e.registerHandler("+if",{$meta:{serializeNodes:!0},render:function(e,n,t,o,l){for(var s=this,u=r("if",s,e,n,o),a=0,c=s;;){if(c.nodes===u)break;if(a++,c=s.nextSibling,null==c||"else"!==c.tagName){a=null;break}}return this.attr["switch-index"]=a,i(u,e,n,t,o,l)},renderEnd:function(e,t,r,i,l){var s=new n,u=this.attr["switch-index"];return s.placeholder=document.createComment(""),i.appendChild(s.placeholder),o(s,this,u,e,t,r,i,l),s},serializeNodes:function(n){for(var t=[n];;){if(n=n.nextSibling,null==n||"else"!==n.tagName)break;t.push(n)}return e.stringify(t)}}),n.prototype={compoName:"+if",ctx:null,model:null,controller:null,index:null,Switch:null,binder:null,refresh:function(){for(var n,t=this,r=t.Switch,o=r.length,i=-1,s=t.index,u=t.model,a=t.ctx,c=t.controller;++i<o&&(n=r[i].node.expression,null!=n)&&!P(n,u,a,c););if(s!==i){if(null!=s&&p(r[s].elements,!1),i===o)return void(t.index=null);this.index=i;var f=r[i];if(null!=f.elements)return void p(f.elements,!0);var d=e.render(f.node.nodes,u,a,null,c),h=d.nodeType===Node.DOCUMENT_FRAGMENT_NODE?S.call(d.childNodes):d;l(d,t.placeholder),f.elements=h}},dispose:function(){for(var e,n,t=this.Switch,r=t.length,o=-1;++o<r;)e=t[o],n=e.node.expression,n&&B(n,this.model,this.controller,this.binder),e.node=null,e.elements=null;this.controller=null,this.model=null,this.ctx=null}}}(),function(){function n(){}function r(e,n,t,r,o){if(s=c.getNodes(e,n,t,r,o),a=null,null!=s){for(var i=n.length,l=-1;++l<i&&n[l].nodes!==s;);a=l===i?null:l}}function o(e,n,r,o,i,l,s,u){e.ctx=l,e.expr=n.expression,e.model=i,e.controller=u,e.index=r,e.nodes=n.nodes,e.refresh=t(e.refresh,e),e.binder=V(e.expr,i,l,u,e.refresh),e.Switch=new Array(n.nodes.length),null!=r&&(e.Switch[r]=o),H(n.expression,i,l,u,e.binder)}var s,a,c=d["switch"],f="switch-index";e.registerHandler("+switch",{$meta:{serializeNodes:!0},serializeNodes:function(n){return e.stringify(n)},render:function(e,n,t,o,l){var u=P(this.expression,e,n,o);return r(u,this.nodes,e,n,o),null==s?null:(this.attr[f]=a,i(s,e,n,t,o,l))},renderEnd:function(e,t,r,i,l){var s=new n,a=this.attr[f];return u(s,i),o(s,this,a,e,t,r,i,l),s}}),n.prototype={compoName:"+switch",ctx:null,model:null,controller:null,index:null,nodes:null,Switch:null,binder:null,refresh:function(n){var t=this,o=t.Switch,i=(o.length,t.index),u=t.model,c=t.ctx,f=t.controller;if(r(n,t.nodes,u,c,f),a!==i){if(null!=i&&p(o[i],!1),null==a)return void(t.index=null);this.index=a;var d=o[a];if(null!=d)return void p(d,!0);var h=e.render(s,u,c,null,f),m=h.nodeType===Node.DOCUMENT_FRAGMENT_NODE?S.call(h.childNodes):h;l(h,t.placeholder),o[a]=m}},dispose:function(){B(this.expr,this.model,this.controller,this.binder),this.controller=null,this.model=null,this.ctx=null;var e,n,t,r,o=this.Switch;for(e in o)if(n=o[e],null!=n)for(r=n.length,t=-1;++t<r;)null!=n[t].parentNode&&n[t].parentNode.removeChild(n[t])}}}(),function(){function r(e){this.expr=e.expression,this.nodes=e.nodes}function i(e,n,t,r,o){var i=[];return builder_build(e,n,t,r,o,i),i}d["with"];e.registerHandler("+with",{$meta:{serializeNodes:!0},render:function(e,n,t,r){var o=P(this.expression,e,n,r);return i(this.nodes,o,n,t,r)},renderEnd:function(e,n,o,i,l){var s=new r(this);return s.elements=e,s.model=n,s.parent=l,s.refresh=t(s.refresh,s),s.binder=V(s.expr,n,o,l,s.refresh),H(s.expr,n,o,l,s.binder),u(s,i),s}}),r.prototype={compoName:"+with",elements:null,binder:null,model:null,parent:null,refresh:function(e){if(o(this.elements),this.components){for(var t=this.components.length,r=-1;++r<t;)n.dispose(this.components[r]);this.components.length=0}var s=document.createDocumentFragment();this.elements=i(this.nodes,e,null,s,this),l(s,this.placeholder),c(this)},dispose:function(){B(this.expr,this.model,this.parent,this.binder),this.parent=null,this.model=null,this.ctx=null}}}(),function(){function n(e){for(var n,t=e.length,r=-1;++r<t;)switch(n=e[r],typeof n){case"string":case"number":case"boolean":e[r]=Object(n)}}function t(e,n){for(var t=e.node.components,r=0,o=t.length,i=0,s=null,u=null,a=null,c=document.createDocumentFragment(),f=[];o>r;r++)if(a=t[r],null!=a.elements&&0!==a.elements.length)for(i=0,s=a.elements.length;s>i;i++)u=a.elements[i],u.parentNode.removeChild(u);e:for(i=0,s=n.length;s>i;i++){for(r=0;o>r;r++)if(n[i]===e._getModel(t[r])){f[i]=t[r];continue e}console.warn("No Model Found for",n[i])}for(r=0,o=f.length;o>r;r++)if(a=f[r],null!=a.elements&&0!==a.elements.length)for(i=0,s=a.elements.length;s>i;i++)u=a.elements[i],c.appendChild(u);e.components=e.node.components=f,l(c,e.placeholder)}function r(e,n,t,r,o){var i=e.node,l=i.components;null==l&&(l=i.components=[]);var u=(e.prop1,e.prop2,e.type,e.ctx),c=e.node;if(null!=n&&null!=t){var f=n,p=n+t;for(p>l.length&&(p=l.length);p>f;f++)a(l[f],i)&&(f--,p--)}if(null!=r&&o&&o.length){var d,f=l.length,h=e._build(i,o,u,c),m=l.splice(f);for(s(i,r,h,e.placeholder),l.splice.apply(l,[r,0].concat(m)),f=0,d=m.length;d>f;f++)A.signal.emitIn(m[f],"domInsert")}}function o(e,n){for(var t,r=e.components,o=r.length;--o>-1;)t=r[o],-1!==n.indexOf(t.model)&&a(t,e.node)}var i={model:null,parent:null,refresh:function(e,i,s,u){var f,p=0,d=this.node,h=(this.model,this.ctx),m=this.node;if(null==i){var g=d.components;if(null!=g){for(var f=g.length,p=-1;++p<f;)a(g[p],d)&&(p--,f--);g.length=0}var v=this._build(d,e,h,m);return l(v,this.placeholder),void I(d.components,c)}var _=e;switch(n(e),i){case"push":r(this,null,null,_.length-1,_.slice(_.length-1));break;case"pop":r(this,_.length,1);break;case"unshift":r(this,null,null,0,_.slice(0,1));break;case"shift":r(this,0,1);break;case"splice":var y=s[0],b=1===s.length?this.components.length:s[1],x=s.length>2?_.slice(s[0],s.length-2+s[0]):null;r(this,y,b,y,x);break;case"sort":case"reverse":t(this,_);break;case"remove":null!=u&&u.length&&o(this,u)}},dispose:function(){B(this.expr,this.model,this.parent,this.binder)}};!function(){function t(e,n){this.prop1=n[o],this.prop2=n[l],this.type=n[s],this.expr=n[u],null==e.components&&(e.components=[]),this.node=e,this.components=e.components}var r=d["for"],o="for-prop-1",l="for-prop-2",s="for-type",u="for-expr";e.registerHandler("+for",{$meta:{serializeNodes:!0},serializeNodes:function(n){return e.stringify(n)},render:function(e,t,i,a,c){var f=r.parseFor(this.expression),p=this.attr;p[o]=f[0],p[l]=f[1],p[s]=f[2],p[u]=f[3];var d=P(f[3],e,t,a);null!=d&&(D(d)&&n(d),r.build(d,f,this.nodes,e,t,i,this,c))},renderEnd:function(e,n,r,o,i){var l=new t(this,this.attr);return l.placeholder=document.createComment(""),o.appendChild(l.placeholder),f(l,this,n,r,o,i),l},getHandler:function(e,n){return r.getHandler(e,n)}}),t.prototype={compoName:"+for",model:null,parent:null,refresh:i.refresh,dispose:i.dispose,_getModel:function(e){return e.scope[this.prop1]},_build:function(e,n,t,o){var i=r.getNodes(e.nodes,n,this.prop1,this.prop2,this.type);return builder_build(i,n,t,null,o)}}}(),function(){function t(e,n,t,r,i,l){for(var s,u=n.length,a=-1;++a<u;)s=o.createItem(a,e,i),builder_build(s,n[a],t,r,i,l)}function r(e){this.expr=e.expression,this.nodes=e.nodes,null==e.components&&(e.components=[]),this.node=e,this.components=e.components}var o=d.each;e.registerHandler("+each",{render:function(e,r,o,i,l){var s=this,u=P(s.expression,e,r,i);null!=u&&(n(u),t(s.nodes,u,r,o,s,l))},renderEnd:function(e,n,t,o,i){var l=new r(this,this.attr);return l.placeholder=document.createComment(""),o.appendChild(l.placeholder),f(l,this,n,t,o,i),l}}),r.prototype={compoName:"+each",refresh:i.refresh,dispose:i.dispose,_getModel:function(e){return e.model},_build:function(e,n,r,o){var i=document.createDocumentFragment();return t(e.nodes,n,r,i,o),i}}}()}()}()}(Mask,Compo),Mask.Compo=Compo,Mask.jmask=jmask,exports.mask=Mask});
//# sourceMappingURL=mask.min.js.map