(function(e,t){"use strict";var n="undefined"==typeof document?null:document,r=function(){return t(n)};"object"==typeof exports?module.exports=r():"function"==typeof define&&define.amd?define(r):e.mask=r()})(this,function(document){"use strict";function util_extend(e,t){null==e&&(e={});for(var n in t)hasOwnProp.call(t,n)!==!1&&(e[n]=t[n]);return e}function util_getProperty(e,t){if("."===t)return e;for(var n=e,r=t.split("."),i=-1,o=r.length;null!=n&&o>++i;)n=n[r[i]];return n}function util_interpolate(e,t,n,r,i,o,l){for(var a,s,u,c,d=e.length,f=0,p=null,h="",g=!0;d>f;f++)g===!0?null==p?h+=e[f]:p.push(e[f]):(c=e[f],s=null,u=c.indexOf(":"),-1===u?s=util_getProperty(n,c):(a=u>0?c.substring(0,u).replace(regexpWhitespace,""):"",""===a&&(a="expression"),c=c.substring(u+1),"function"==typeof ModelUtils[a]&&(s=ModelUtils[a](c,n,r,i,o,l,t))),null!=s&&("object"==typeof s&&null==p&&(p=[h]),null==p?h+=s:p.push(s))),g=!g;return null==p?h:p}function Template(e){this.template=e,this.index=0,this.length=e.length}function Node(e,t){this.type=Dom.NODE,this.tagName=e,this.parent=t,this.attr={}}function TextNode(e,t){this.content=e,this.parent=t,this.type=Dom.TEXTNODE}function Fragment(){this.nodes=[]}function Component(e,t,n){this.tagName=e,this.parent=t,this.controller=n,this.attr={}}function builder_build(e,t,n,r,i,o){if(null==e)return r;var l,a=e.type;if(null==r&&1!==a&&(r=document.createDocumentFragment()),null==i&&(i=new Component),10===a||e instanceof Array){for(var s=0,u=e.length;u>s;s++)builder_build(e[s],t,n,r,i,o);return r}if(null==a&&(null!=e.tagName?a=1:null!=e.content&&(a=2)),1===a){var c,d,f=e.tagName,p=e.attr,h=document.createElement(f);for(c in p)"function"==typeof p[c]?(d=p[c]("attr",t,n,h,i,c),d instanceof Array&&(d=d.join(""))):d=p[c],d&&("function"==typeof CustomAttributes[c]?CustomAttributes[c](e,d,t,n,h,i):h.setAttribute(c,d));null!=r&&r.appendChild(h),null!=o&&(o.push(h),o=null),r=h}if(2===a){var s,u,g,m,v,y;if(m=e.content,"function"==typeof m)if(v=m("node",t,n,r,i),"string"==typeof v)r.appendChild(document.createTextNode(v));else{for(y="",s=0,u=v.length;u>s;s++)if(g=v[s],"object"!=typeof g)y+=g;else{if(""!==y&&(r.appendChild(document.createTextNode(y)),y=""),null==g.nodeType){console.warn("Not a HTMLElement",g,e,t),y+=""+g;continue}r.appendChild(g)}""!==y&&r.appendChild(document.createTextNode(y))}else r.appendChild(document.createTextNode(m));return r}if(4===a){var b=e.controller,C="function"==typeof b?new b(t):b;if(null!=C){C.compoName=e.tagName,C.attr=util_extend(C.attr,e.attr),C.ID=++_controllerID;for(var c in C.attr)"function"==typeof C.attr[c]&&(C.attr[c]=C.attr[c]("attr",t,n,r,i,c));if(C.nodes=e.nodes,C.parent=i,null!=listeners&&null!=listeners.compoCreated)for(var x=listeners.compoCreated,u=x.length,s=0;u>s;s++)x[s](C,t,n,r);"function"==typeof C.renderStart&&C.renderStart(t,n,r),null!=C.tagName&&C.tagName!==e.compoName&&(C.nodes={tagName:C.tagName,attr:C.attr,nodes:C.nodes,type:1}),e=C}if(null==i.components?i.components=[e]:i.components.push(e),i=e,l=[],null!=i.model&&(t=i.model),"function"==typeof i.render)return i.render(t,n,r),r}var w=e.nodes;if(null!=w){null!=o&&null==l&&(l=o);for(var k=w instanceof Array,A=k===!0?w.length:1,N=0,j=null;A>N;N++)j=k===!0?w[N]:w,4===a&&1===j.type&&(j.attr["x-compo-id"]=e.ID),builder_build(j,t,n,r,i,l)}if(4===a&&"function"==typeof e.renderEnd&&e.renderEnd(l,t,n,r),null!=o&&o!==l)for(var T=o.length,_=l.length,s=-1;_>++s;)o[T+s]=l[s];return r}var regexpWhitespace=/\s/g,regexpEscapedChar={"'":/\\'/g,'"':/\\"/g,"{":/\\\{/g,">":/\\>/g,";":/\\>/g},hasOwnProp={}.hasOwnProperty,listeners=null;Template.prototype={skipWhitespace:function(){for(var e=this.template,t=this.index,n=this.length;n>t&&!(e.charCodeAt(t)>32);t++);return this.index=t,this},skipToAttributeBreak:function(){var e,t=this.template,n=this.index,r=this.length;do if(e=t.charCodeAt(++n),35===e&&123===t.charCodeAt(n+1))return this.index=n,this.sliceToChar("}"),this.index++,void 0;while(46!==e&&35!==e&&62!==e&&123!==e&&32!==e&&59!==e&&r>n);this.index=n},sliceToChar:function(e){for(var t,n,r=this.template,i=this.index,o=i,l=!1;(n=r.indexOf(e,i))>-1&&(i=n,92===r.charCodeAt(i-1));)l=!0,i++;return t=r.substring(o,i),this.index=i,l?t.replace(regexpEscapedChar[e],e):t}};var ConditionUtil=function(){function e(e,t){var n,r=t,i=e.index;if(null==r&&(e.skipWhitespace(),i=e.index,t=r=e.template.charCodeAt(e.index)),34===r||39===r)return e.index++,n=e.sliceToChar(39===r?"'":'"'),e.index++,n;do r=e.template.charCodeAt(++e.index);while(e.index<e.length&&32!==r&&33!==r&&60!==r&&61!==r&&62!==r&&40!==r&&41!==r&&38!==r&&124!==r);return n=e.template.substring(i,e.index),r=t,45===r||r>47&&58>r?n-0:116===r&&"true"===n?!0:102===r&&"false"===n?!1:{value:n}}function t(n,r){var i,o={assertions:null,join:null,left:null,right:null};null==r&&(r=[]),"string"==typeof n&&(n=new Template(n));e:for(;;){if(n.skipWhitespace(),n.index>=n.length)break;switch(i=n.template.charCodeAt(n.index)){case 61:case 60:case 62:case 33:var l=n.index;do i=n.template.charCodeAt(++n.index);while(n.index<n.length&&(60===i||61===i||62===i));o.sign=n.template.substring(l,n.index);continue;case 38:case 124:n.template.charCodeAt(++n.index)!==i&&console.error("Unary operation not valid"),o.join=38===i?"&&":"||",r.push(o),o={assertions:null,join:null,left:null,right:null},++n.index;continue;case 40:n.index++,t(n,o.assertions=[]);break;case 41:n.index++;break e;default:o[null==o.left?"left":"right"]=e(n,i);continue}}return(o.left||o.assertions)&&r.push(o),r}function n(n){if(null!=i[n])return i[n];var r=n.length,o={assertions:null,case1:null,case2:null},l=n.indexOf("?"),a=new Template(n);return-1!==l&&(a.length=l),o.assertions=t(a),-1!==l&&(a.length=r,a.index=l+1,o.case1=e(a),a.skipWhitespace(),58===a.template.charCodeAt(a.index)&&(a.index++,o.case2=e(a))),i[n]=o}function r(e,t){"string"==typeof e&&(e=n(e).assertions),null!=e.assertions&&(e=e.assertions);var i,o,l,a,s,u=!1;for(a=0,s=e.length;s>a;a++){if(i=e[a],i.assertions)u=r(i.assertions,t);else if(o="object"==typeof i.left?util_getProperty(t,i.left.value):i.left,null==i.right)u=o,"!"===i.sign&&(u=!u);else switch(l="object"==typeof i.right?util_getProperty(t,i.right.value):i.right,i.sign){case"<":u=l>o;break;case"<=":u=l>=o;break;case">":u=o>l;break;case">=":u=o>=l;break;case"!=":u=o!==l;break;case"==":u=o===l}if(u){if("&&"===i.join)continue;break}if("||"!==i.join&&"&&"===i.join)for(++a;s>a&&"||"!==e[a].join;a++);}return u}var i=[];return{condition:function(e,t){var i=n(e),o=r(i.assertions,t);return null!=i.case1&&(o=o?i.case1:i.case2),null==o?"":"object"==typeof o&&o.value?util_getProperty(t,o.value):o},isCondition:r,parse:n,out:{isCondition:r,parse:n}}}(),ExpressionUtil=function(){function e(e){this.parent=e,this.type=X,this.body=[],this.join=null}function t(e){this.parent=e}function n(e){this.type=K,this.body=e,this.join=null}function r(e,t){this.parent=e,this.type=J,this.body=t,this.arguments=[],this.next=null}function i(e,t){this.parent=e,this.type=z,this.body=t,this.next=null}function o(e,t){this.parent=e,this.prefix=t}function l(t){this.body=t,this.case1=new e(this),this.case2=new e(this)}function a(e,t){null==e&&console.error("Undefined",e,t);var n=e.type;return X===n?(e.body.push(t),t):Z===n||Y===n?e.body=t:z===n||J===n?e.next=t:(console.error("Unsupported - append:",e,t),t)}function s(){if(0===arguments.length)return null;var t=new e(arguments[0].parent);return t.join=arguments[arguments.length-1].join,t.body=Array.prototype.slice.call(arguments),t}function u(e){if(e.type!==X)return null!=e.body&&"object"==typeof e.body&&u(e.body),void 0;for(var t,n,r,i=e.body,o=0,l=i.length;l>o;o++)u(i[o]);for(o=1;l>o&&(t=i[o],n=i[o-1],!(tt[n.join]>tt[t.join]));o++);if(o!==l){for(r=[i[0]],o=1;l>o;o++)t=i[o],n=i[o-1],tt[n.join]>tt[t.join]&&l-1>o&&(t=s(i[o],i[++o])),r.push(t);e.body=r}}function c(e,t){console.error("Expression parser:",e,t,y.substring(C))}function d(e,t,n,r){var i,o,l=e,a=e.body;if(null==o&&null!=t&&(i=t,o=t[a]),null==o&&null!=n&&(i=n,o=n[a]),null==o&&null!=r)do i=r,o=r[a];while(null==o&&null!=(r=r.parent));if(null!=o)for(;;){if(l.type===J){for(var s,u=[],d=0,f=l.arguments.length;f>d;d++)s=l.arguments[d],u[d]=v(s,t,n,r);o=o.apply(i,u)}if(null==o||null==l.next)break;if(l=l.next,a=l.body,i=o,o=o[a],null==o)break}return null==o&&((null==l||null!=l.next)&&c("Mask - Accessor error - ",a),null!=l&&l.type===J&&c("Mask - Accessor error - Function Call -",a)),o}function f(e){for(var t,n,r=!1,i=39===e?"'":'"',o=C;(t=y.indexOf(i,C))>-1&&(C=t,92===y.charCodeAt(t-1));)r=!0,C++;return n=y.substring(o,C),r===!0&&(n=n.replace(regexpEscapedChar[i],i)),n}function p(){for(var e,t,n=C;;){if(e=y.charCodeAt(C),46===e){if(t===!0)return c("Unexpected punc"),null;t=!0}if(!((e>=48&&57>=e||46===e)&&x>C))break;C++}return+y.substring(n,C)}function h(){var e,t=C,n=y.charCodeAt(C);if(34===n||39===n)return C++,e=f(n),C++,e;for(;;){n=y.charCodeAt(C);{if(!(n>47&&60!==n&&61!==n&&62!==n&&124!==n&&63!==n&&x>C))break;C++}}return y.substring(t,C)}function g(e){if(null==e&&C===x)return null;if(40===e)return F;if(41===e)return I;if(44===e)return S;if(46===e)return W;if(43===e)return A;if(45===e)return k;if(42===e)return j;if(47===e)return N;if(61===e)return y.charCodeAt(++C)!==e?(c("Not supported (Apply directive)"),null):E;if(33===e){var t=y.charCodeAt(C+1);return 61===t?(C++,U):O}if(62===e){var t=y.charCodeAt(C+1);return 61===t?(C++,P):M}if(60===e){var t=y.charCodeAt(C+1);return 61===t?(C++,H):D}return 38===e?y.charCodeAt(++C)!==e?(c("Single Binary Operator AND"),null):_:124===e?y.charCodeAt(++C)!==e?(c("Single Binary Operator OR"),null):T:e>=65&&90>=e||e>=97&&122>=e||95===e||36===e?B:e>=48&&57>=e?Q:34===e||39===e?G:63===e?R:58===e?V:(c("Unexpected / Unsupported directive"),null)}function m(s){y=s,C=0,x=s.length,b=new e;for(var d,m,v=b,w=q;;)if(x>C&&33>(d=y.charCodeAt(C)))C++;else{if(C>=x)break;if(m=g(d),null==m&&x>C)break;if(F!==m)if(I!==m)if(S!==m)if(R!==m)if(V!==m)if(W===m&&(d=y.charCodeAt(C+1),d>=48&&57>=d?m=Q:(m=B,C++)),v.type===X&&(v=a(v,new t(v))),k!==m&&O!==m||null!=v.body)if(k!==m&&A!==m&&j!==m&&N!==m&&_!==m&&T!==m&&E!==m&&U!==m&&M!==m&&P!==m&&D!==m&&H!==m){if((G===m||Q===m)&&null!=v.body&&null==v.join){c("Directive Expected");break}if(G!==m)if(Q!==m){if(B===m){for(var L=h();x>C;){d=y.charCodeAt(C);{if(!(33>d))break;C++}}if(40===d){w=et,C++;var z=a(v,new r(v,L));v=z.newArgument();continue}110===d&&"null"===L&&(L=null),102===d&&"false"===L&&(L=!1),116===d&&"true"===L&&(L=!0),v=a(v,"string"==typeof L?new i(v,L):new n(L))}}else a(v,new n(p(d)));else C++,a(v,new n(f(d))),C++}else{for(;v&&v.type!==Z;)v=v.parent;if(null==v.body){c("Unexpected operator",v);break}v.join=m;do v=v.parent;while(null!=v&&v.type!==X);null==v&&console.error("Unexpected parent",v),C++}else v=a(v,new o(v,m)),C++;else v=b.case2,C++;else b=new l(b),v=b.case1,C++;else{if(w!==et){c("Unexpected punctuation, comma");break}do v=v.parent;while(null!=v&&v.type!==J);if(null==v){c("OutOfAst Exception - next argument");break}v=v.newArgument(),C++}else{var K=X;w===et&&(w=q,K=J);do v=v.parent;while(null!=v&&v.type!==K);if(K===X&&(v=v.parent),null==v){c("OutOfAst Exception - body closed");break}C++}else v=a(v,new t(v)),v=a(v,new e(v)),C++}return null==v.body&&v.type===Z&&c("Unexpected end of expression"),u(b),b}function v(e,t,n,r){var i,o;if(null==e)return null;o="string"==typeof e?w.hasOwnProperty(e)===!0?w[e]:w[e]=m(e):e;var l=o.type,i=null;if(X===l){var a,s;e:for(var u,c=0,f=o.body.length;f>c;c++)if(u=o.body[c],a=v(u,t,n,r),null!=s){if(s.join===_)if(i)i=a;else for(;f>c&&o.body[c].join!==T;c++);if(s.join===T){if(i)break e;if(a){i=a;break e}}switch(s.join){case k:i-=a;break;case A:i+=a;break;case N:i/=a;break;case j:i*=a;break;case U:i=i!=a;break;case E:i=i==a;break;case M:i=i>a;break;case P:i=i>=a;break;case D:i=a>i;break;case H:i=a>=i}s=u}else s=u,i=a}if(Z===l)return v(o.body,t,n,r);if(K===l)return o.body;if(z===l||J===l)return d(o,t,n,r);if(J===l){for(var u,p=[],c=0,f=o.arguments.length;f>c;c++)u=o.arguments[c],p[c]=v(u,t,n,r);return util_callFunction(o.body,p,t,n,r)}if(Y===l)switch(i=v(o.body,t,n,r),o.prefix){case k:i=-i;break;case O:i=!i}return $===l&&(i=v(o.body,t,n,r),i=v(i?o.case1:o.case2,t,n,r)),i}var y,b,C=0,x=0,w={},k="-",A="+",N="/",j="*",T="||",_="&&",O="!",E="==",U="!=",M=">",P=">=",D="<",H="<=",L=".",F=20,I=21,S=22,W=23,R=24,V=25,B=30,G=31,Q=32,X=1,Z=2,z=3,J=4,K=6,Y=9,$=10,q=1,et=2,tt={};return tt[L]=1,tt[N]=2,tt[j]=2,tt[k]=3,tt[A]=3,tt[M]=4,tt[P]=4,tt[D]=4,tt[H]=4,tt[E]=5,tt[U]=5,tt[_]=6,tt[T]=6,t.prototype={constructor:t,type:Z,join:null,body:null},r.prototype={constructor:r,newArgument:function(){var t=new e(this);return this.arguments.push(t),t}},o.prototype={constructor:o,type:Y,body:null},l.prototype={constructor:l,type:$,case1:null,case2:null},{parse:m,eval:v}}(),ModelUtils={condition:ConditionUtil.condition,expression:function(e,t,n,r,i){return ExpressionUtil.eval(e,t,n,i)}},CustomAttributes={"class":null,id:null,style:null,name:null,type:null},CustomTags={div:null,span:null,input:null,button:null,textarea:null,select:null,option:null,h1:null,h2:null,h3:null,h4:null,h5:null,h6:null,a:null,p:null,img:null,table:null,td:null,tr:null,pre:null,ul:null,li:null,ol:null,i:null,b:null,strong:null,form:null},Dom={NODE:1,TEXTNODE:2,FRAGMENT:3,COMPONENT:4,CONTROLLER:9,SET:10,Node:Node,TextNode:TextNode,Fragment:Fragment,Component:Component};Node.prototype={constructor:Node,type:Dom.NODE,tagName:null,parent:null,attr:null,nodes:null,__single:null},TextNode.prototype={type:Dom.TEXTNODE,content:null,parent:null},Fragment.prototype={constructor:Fragment,type:Dom.FRAGMENT,nodes:null},Component.prototype={constructor:Component,type:Dom.COMPONENT,parent:null,attr:null,controller:null,nodes:null,components:null};var Parser=function(e,t,n,r){function i(e){for(var t=-1;-1!==(t=e.indexOf(l,t))&&e.charCodeAt(t+1)!==u;)t++;if(-1===t)return e;for(var n=[],r=0,i=0,o=0;;){var o=e.indexOf(a,t+2);if(-1===o)break;for(n[i++]=r===t?"":e.substring(r,t),n[i++]=e.substring(t+2,o),r=t=o+1;-1!==(t=e.indexOf(l,t))&&e.charCodeAt(t+1)!==u;)t++;if(-1===t)break}return e.length>r&&(n[i]=e.substring(r)),e=null,function(e,t,r,i,o,l){if(null==e){for(var a,s="",u=0,c=n.length;c>u;u++)a=n[u],s+=1===u%2?"~["+a+"]":a;return s}return util_interpolate(n,e,t,r,i,o,l)}}function o(e,t,n,r){for(var i,o=0,l=0,a=0,s=/[\r\n]+/g,u={2:"tag",3:"tag",5:"attribute key",6:"attribute value",8:"literal"}[n];;){if(i=s.exec(e),null==i)break;if(i.index>t)break;l++,o=i.index}a=t-o;var c=["Mask - Unexpected:",r,"at(",l,":",a,") [ in",u,"]"];console.error(c.join(" "),{template:e,stopped:e.substring(t)})}var l="~",a="]",s=126,u=91,c=93;return{parse:function(l){for(var a,d,f,p,h,g,m,v=new n,y=v,b=2,C=3,x=0,w=l.length,k=2,A=3,N=5,j=6,T=7,_=8,O=9;;)if(w>x&&33>(g=l.charCodeAt(x)))x++;else if(47!==g||47!==l.charCodeAt(x+1)){if(C===N&&(null!=a&&(v.attr["class"]=i(a),a=null),null!=f&&(v.attr[f]=f,f=null,d=null)),null!=d){if(b===N)null==f?f=d:p=d,null!=f&&null!=p&&("class"!==f?v.attr[f]=p:a=null==a?p:a+" "+p,f=null,p=null);else if(C===A)h=null!=CustomTags[d]?new r(d,v,CustomTags[d]):new e(d,v),null==v.nodes?v.nodes=[h]:v.nodes.push(h),v=h,b=N;else if(C===_){if(h=new t(d,v),null==v.nodes?v.nodes=[h]:v.nodes.push(h),v.__single===!0)do v=v.parent;while(null!=v&&null!=v.__single);b=k}d=null}if(x>=w){b===N&&(null!=a&&(v.attr["class"]=i(a)),null!=f&&(v.attr[f]=f));break}if(b===O){for(v=v.parent;null!=v&&null!=v.__single;)v=v.parent;b=k}if(123!==g)if(62!==g)if(59!==g||null==v.nodes)if(59!==g&&125!==g)if(39!==g&&34!==g)if(b!==k||(C=A,b=A,46!==g&&35!==g)){if(b===N)if(46===g)x++,f="class",b=T;else if(35===g)x++,f="id",b=T;else{if(61===g){x++,b=j;continue}if(null!=f){d=f;continue}}(b===j||b===T)&&(C=b,b=N);var E=null;for(m=x;w>x;){if(g=l.charCodeAt(x),g===s&&l.charCodeAt(x+1)===u){E=!0,++x;do g=l.charCodeAt(++x);while(g!==c&&w>x)}if(39===g||34===g||47===g||60===g){o(l,x,b,String.fromCharCode(g));break}if(C!==j&&(46===g||35===g||61===g))break;if(62===g||123===g||33>g||59===g)break;x++}if(d=l.substring(m,x),!d){o(l,x,b,"*EMPTY*");break}if(E===!0&&b===A){o(l,x,b,"Tag Names cannt be interpolated (in dev)");break}E===!0&&(b===N&&"class"===f)==!1&&(d=i(d))}else d="div";else{b===j?b=N:C=b=_,x++;var U,M=!1,P=39===g?"'":'"';for(m=x;(U=l.indexOf(P,x))>-1&&(x=U,92===l.charCodeAt(U-1));)M=!0,x++;d=l.substring(m,x),M===!0&&(d=d.replace(regexpEscapedChar[P],P)),d=i(d),x++}else x++,C=b,b=O;else x++;else C=b,b=k,x++,v.__single=!0;else C=b,b=k,x++}else for(x++;10!==g&&13!==g&&w>x;)g=l.charCodeAt(++x);if(isNaN(g))throw console.log(g,_index,_length),"";return null!=v.parent&&v.parent!==y&&v.parent.__single!==!0&&null!=v.nodes&&console.warn("Mask - ",v.parent.tagName,JSON.stringify(v.parent.attr),"was not proper closed."),1===y.nodes.length?y.nodes[0]:y},cleanObject:function(e){if(e instanceof Array){for(var t=0;e.length>t;t++)this.cleanObject(e[t]);return e}return delete e.parent,delete e.__single,null!=e.nodes&&this.cleanObject(e.nodes),e},setInterpolationQuotes:function(e,t){return e&&2===e.length?t&&1===t.length?(s=e.charCodeAt(0),u=e.charCodeAt(1),c=t.charCodeAt(0),a=t,l=e.charAt(0),void 0):(console.error("Interpolation End must be of 1 Character"),void 0):(console.error("Interpolation Start must contain 2 Characters"),void 0)}}}(Node,TextNode,Fragment,Component),_controllerID=0,cache={},Mask={render:function(e,t,n,r,i){return null!=r&&"function"!=typeof r.appendChild&&(console.error(".render(template[, model, cntx, container, controller]","Container should implement .appendChild method"),console.warn("Args:",arguments)),"string"==typeof e&&(e=hasOwnProp.call(cache,e)?cache[e]:cache[e]=Parser.parse(e)),builder_build(e,t,n,r,i)},compile:Parser.parse,parse:Parser.parse,registerHandler:function(e,t){CustomTags[e]=t},getHandler:function(e){return null!=e?CustomTags[e]:CustomTags},registerAttrHandler:function(e,t){CustomAttributes[e]=t},registerUtility:function(e,t){ModelUtils[e]=t},clearCache:function(e){"string"==typeof e?delete cache[e]:cache={}},ValueUtils:{condition:ConditionUtil.condition,out:ConditionUtil},Utils:{Condition:ConditionUtil,Expression:ExpressionUtil,getProperty:util_getProperty},Dom:Dom,plugin:function(source){eval(source)},on:function(e,t){null==listeners&&(listeners={}),(listeners[e]||(listeners[e]=[])).push(t)},delegateReload:function(){},setInterpolationQuotes:Parser.setInterpolationQuotes};return Mask.renderDom=Mask.render,function(e){var t=function(){function t(e){for(var t="";e--;)t+=" ";return t}function n(e,n,i){var o,l;null==n&&(n=0),null==i&&(o=!0,i=[]);var a=i.length;if(e.type===d.FRAGMENT&&(e=e.nodes),e instanceof Array)for(l=0;e.length>l;l++)r(e[l],n,i);else r(e,n,i);var s=t(n);for(l=a;i.length>l;l++)i[l]=s+i[l];return o?i.join(0===c?"":"\n"):void 0}function r(e,t,r){return"string"==typeof e.content?(r.push(s(e.content)),void 0):"function"==typeof e.content?(r.push(s(e.content())),void 0):o(e)?(r.push(i(e)+";"),void 0):l(e)?(r.push(i(e)+" > "),n(a(e),c,r),void 0):(r.push(i(e)+"{"),n(e.nodes,c,r),r.push("}"),void 0)}function i(e){var t=e.tagName,n=e.attr.id||"",r=e.attr["class"]||"";"function"==typeof n&&(n=n()),"function"==typeof r&&(r=r()),n&&(n=-1!==n.indexOf(" ")?"":"#"+n),r&&(r="."+r.split(" ").join("."));var i="";for(var o in e.attr)if("id"!==o&&"class"!==o){var l=e.attr[o];"function"==typeof l&&(l=l()),(u===!1||/\s/.test(l))&&(l=s(l)),i+=" "+o+"="+l}return"div"===t&&(n||r)&&(t=""),t+n+r+i}function o(e){return null==e.nodes||e.nodes instanceof Array&&0===e.nodes.length}function l(e){return e.nodes&&(e.nodes instanceof Array==!1||1===e.nodes.length)}function a(e){return e.nodes instanceof Array?e.nodes[0]:e.nodes}function s(e){return-1===e.indexOf('"')?'"'+e.trim()+'"':-1===e.indexOf("'")?"'"+e.trim()+"'":'"'+e.replace(/"/g,'\\"').trim()+'"'}var u,c,d=e.Dom;return function(t,r){return"string"==typeof t&&(t=e.parse(t)),"number"==typeof r?(c=r,u=0===c):(c=r&&r.indent||4,u=0===c||r&&r.minimizeAttributes),n(t)}}();Mask.stringify=t}(Mask),function(e){function t(){}function n(e,t,n,i){null==e.nodes&&"undefined"!=typeof Compo&&Compo.ensureTemplate(e);var o=util_getProperty(t,e.attr.foreach||e.attr.each),l=e.nodes,a=null;if(e.nodes=[],e.template=l,e.container=i,o instanceof Array!=!1){for(var s,u=0,c=o.length;c>u;u++)s=o[u],a=new Component,a.nodes=l,a.model=s,a.container=i,e.nodes[u]=a;for(var d in r)e[d]=r[d]}}e.registerHandler("%",t),t.prototype={constructor:t,renderStart:function(e,t,r){var i=this.attr;if(null!=i.use)return this.model=util_getProperty(e,i.use),void 0;if(null==i["debugger"]){if(null!=i.log){var o=i.log,l=util_getProperty(e,o);return console.log("Key: %s, Value: %s",o,l),void 0}if(this.model=e,null!=i["if"]){var a=i["if"];return this.state=ConditionUtil.isCondition(a,e),this.state||(this.nodes=null),void 0}if(null!=i["else"]){var s=this.parent.components,u=s&&s[s.length-1];return null!=u&&"%"===u.compoName&&null!=u.attr["if"]?(u.state&&(this.nodes=null),void 0):(console.error("Previous Node should be \"% if='condition'\"",u,this.parent),void 0)}(null!=i.each||null!=i.foreach)&&n(this,e,t,r)}},render:null};var r={append:function(t){var n;n=new Component,n.nodes=this.template,n.model=t,e.render(n,t,null,this.container,this)}}}(Mask),function(e){function t(){}function n(){}var r={};e.templates=r,e.registerHandler(":template",t),t.prototype.render=function(){return null!=this.attr.id?(console.warn("Template Should be defined with ID attribute for future lookup"),void 0):(r[this.attr.id]=this,void 0)},e.registerHandler(":html",n),n.prototype.render=function(e,t,n){var r=null;if(null!=this.attr.template){var i=this.attr.template[0];"#"===i&&(r=document.getElementById(this.attr.template.substring(1)).innerHTML)}return this.nodes&&(r=this.nodes[0].content),null==r?(console.warn("No HTML for node",this),void 0):(n.innerHTML=r,void 0)}}(Mask),function(e){function t(e,t){for(var n=0,r=t.length-1;r>n;n++){var i=t.shift();null==e[i]&&(e[i]={}),e=e[i]}return e}function n(e,t){if(null==t)return e;null==e&&(e={});for(var n in t)e[n]=t[n];return e}function r(e,t){for(var n=t.split("."),r=n.length,i=0;r>i;i++){if(null==e)return null;e=e[n[i]]}return e}function i(e,t,n){for(var r=t.split("."),i=r.length,o=0,l=null;i-1>o;o++)l=r[o],null==e[l]&&(e[l]={}),e=e[l];e[r[o]]=n}function o(e,n,r){if(null==e.__observers&&Object.defineProperty(e,"__observers",{value:{},enumerable:!1}),e.__observers[n])return e.__observers[n].push(r),void 0;var i=e.__observers[n]=[r],o=n.split("."),l=o.length>1?t(e,o):e,a=o[0],s=l[a];Object.defineProperty(l,a,{get:function(){return s},set:function(e){s=e;for(var t=0,n=i.length;n>t;t++)i[t](e)}})}function l(e,t){function n(n){e[n]=function(){Array.prototype[n].apply(this,arguments),t(this,n,arguments)}}Object.defineProperty(e,"hasObserver",{value:!0,enumerable:!1,writable:!1});for(var r=0,i=["push","unshift","splice","pop","shift","reverse","sort"],o=i.length;o>r;r++)n(i[r])}function a(e,t,n){return"function"==typeof h?(h(e).on(t,n),void 0):null!=e.addEventListener?(e.addEventListener(t,n,!1),void 0):(e.attachEvent&&e.attachEvent("on"+t,n),void 0)}function s(){}function u(){}function c(e,t,r,i){if(this.constructor===c){var l=r.attr.bindingProvider||t.tagName.toLowerCase();if(g[l]instanceof Function)return new g[l](e,t,r);n(this,g[l])}return null==i&&(i=":bind"===r.compoName?"single":"dual"),this.node=r,this.model=e,this.element=t,this.property=r.attr.property||("single"===i?"element.innerHTML":"element.value"),this.setter=r.attr.setter,this.getter=r.attr.getter,this.dismiss=0,o(e,r.attr.value,this.objectChanged.bind(this)),"single"!==i&&a(t,r.attr.changeEvent||"change",this.domChanged.bind(this)),this.objectChanged(),this}function d(){}function f(){}function p(e,t){if(null==t&&(t=[]),null==e.components)return t;for(var n,r=e.components,i=0,o=r.length;o>i;i++)n=r[i],"validate"!==n.compoName?p(n):t.push(n);return t}var h=window.jQuery||window.Zepto||window.$;null==h&&console.warn("Without jQuery/Zepto etc. binder is limited (mouse dom event bindings)"),e.registerHandler(":visible",s),s.prototype={constructor:s,refresh:function(t,n){n.style.display=e.Utils.Condition.isCondition(this.attr.check,t)?"":"none"},renderStart:function(e,t,n){this.refresh(e,n),this.attr.bind&&o(e,this.attr.bind,this.refresh.bind(this,e,n))}},e.registerHandler(":bind",u),u.prototype.renderStart=function(e,t,n){new c(e,n,this,"single")},e.registerUtility("bind",function(e,t,n,i,l,a,s){var u=r(t,e);switch(s){case"node":var c=document.createTextNode(u);return o(t,e,function(e){c.textContent=e}),c;case"attr":return o(t,e,function(e){var t=i.getAttribute(a);i.setAttribute(a,t?t.replace(u,e):e),u=e}),u}return console.error("Unknown binding type",arguments),"Unknown"});var g={};e.registerBinding=function(e,t){g[e]=t},e.BindingProvider=c,c.prototype={constructor:c,objectChanged:function(e){this.dismiss-->0||(null==e&&(e=this.objectWay.get(this.model,this.node.attr.value)),this.domWay.set(this,e),e instanceof Array&&e.hasObserver!==!0&&l(e,this.objectChanged.bind(this)))},domChanged:function(){var e=this.domWay.get(this);if(this.node.validations)for(var t,n=0,r=this.node.validations.length;r>n;n++)if(t=this.node.validations[n],t.validate(e,this.element,this.objectChanged.bind(this))===!1)return;this.dismiss=1,this.objectWay.set(this.model,this.node.attr.value,e),this.dismiss=0},objectWay:{get:function(t,n){return":"===n[0]?e.Utils.ConditionUtil.condition(n.substring(1)):r(t,n)},set:function(e,t,n){i(e,t,n)}},domWay:{get:function(e){if(e.getter){var t=e.node.parent;return null==t||"function"!=typeof t[e.getter]?(console.error("Mask.bindings: Getter should be a function",e.getter,e),null):t[e.getter]()}return r(e,e.property)},set:function(e,t){if(e.setter){var n=e.node.parent;if(null==n||"function"!=typeof n[e.setter])return console.error("Mask.bindings: Getter should be a function",e.getter,e),void 0;n[e.setter](t)}else i(e,e.property,t)}}},e.registerHandler(":dualbind",d),d.prototype.renderEnd=function(e,t,n,r){if(this.components)for(var i,o=0,l=this.components.length;l>o;o++)i=this.components[o],":validate"===i.compoName&&(this.validations||(this.validations=[])).push(i);new c(t,r,this)},function(){function t(){}function n(e,t,n){console.warn("Validate Notification:",e,t);var r=h(e).next(".-validate-invalid");0===r.length&&(r=h("<div>").addClass("-validate-invalid").html("<span></span><button>cancel</button>").insertAfter(e)),r.children("button").off().on("click",function(){r.hide(),n&&n()}).end().children("span").text(t).end().show()}function i(e){h(e).next(".-validate-invalid").hide()}e.registerValidator=function(e,t){o[e]=t},e.registerHandler(":validate",t),t.prototype={constructor:t,renderStart:function(e,t,n){this.element=n,this.model=e},validate:function(e,t,o){null==t&&(t=this.element),this.attr.getter&&(e=r({node:this,element:t},this.attr.getter)),null==this.validators&&this.initValidators();for(var l,a=0,s=this.validators.length;s>a;a++)if(l=this.validators[a],l.validate(this,e)===!1)return n(t,this.message,o),!1;return i(t),!0},initValidators:function(){this.validators=[],this.message=this.attr.message,delete this.attr.message;for(var e in this.attr)if(e in o!=!1){var t=o[e];"function"==typeof t&&(t=new t(this)),this.validators.push(t)}else console.error("Unknown Validator:",e,this)}};var o={match:{validate:function(e,t){return RegExp(e.attr.match).test(t)}},unmatch:{validate:function(e,t){return!RegExp(e.attr.unmatch).test(t)}},minLength:{validate:function(e,t){return t.length>=parseInt(e.attr.minLength,10)}},maxLength:{validate:function(e,t){return t.length<=parseInt(e.attr.maxLength,10)}}}}(),e.registerHandler(":validate:group",f),f.prototype={constructor:f,validate:function(){for(var e,t=p(this),n=0,r=t.length;r>n;n++)if(e=t[n],!e.validate())return!1;return!0}}}(Mask),Mask});